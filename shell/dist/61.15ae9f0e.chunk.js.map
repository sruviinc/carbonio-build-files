{"version":3,"file":"61.15ae9f0e.chunk.js","mappings":"mBAUO,MAwCMA,EAAkBA,CAACC,EAAoBC,KACnDC,MAVwBA,EAACC,EAAYC,IAChCA,EACEA,EAAQC,QAAO,CAACC,EAAKC,YAEpBD,EAAIC,GACJD,IACLH,GALkBA,EASrBD,CArByBM,EAACL,EAAYM,IACjCA,EACEA,EAASJ,QAAO,CAACC,EAAWC,KAC9BA,EAAIG,KAEPJ,EAAIC,EAAIG,IAAM,IAAKP,EAAKI,EAAIG,OAAQH,IAE9BD,IACLH,GAPmBA,EAqBrBK,EA/BwBL,EA+BWF,EA/BCU,EA+BMX,EAAOW,SAASC,IA9BtDD,EACEA,EAAQN,QAAO,CAACC,EAAWC,KAEjCD,EAAIC,EAAIG,IAAMH,EACPD,IACLH,GALkBA,GA8B4CH,EAAOS,UAAUG,KACjFZ,EAAOI,SAhCgBS,IAACV,EAAYQ,CAiCpC,EAYFG,UAAYA,EAAGC,WAxDkBZ,MAyDhB,YAAZY,EAAKC,IAAoBD,EAAKZ,MAAMc,YAAY,CAAEd,MAzDtBA,EAyD6CY,EAAKZ,KAAKS,SAxDnE,IAATT,EACHA,EAAKE,QAAO,CAACC,EAAWC,KAE9BD,EAAIC,EAAIG,IAAMH,EACPD,IACL,CAAC,GAEE,CAAC,KAmDR,MAAMY,EAASH,EAAKd,OAASkB,OAAOC,KAAKL,EAAKd,OAEjC,WAAZc,EAAKC,KACJD,EAAKf,OAAOW,SAASC,KACrBG,EAAKf,OAAOS,UAAUG,KACrBG,EAAKf,OAAOI,SAlBhB,UAA+B,WAC9BiB,EAAU,OACVH,IAKA,OAAOG,EAAWC,MAAMC,GAAcL,GAAQM,SAASD,IACxD,CAU2BE,CAAsB,CAAEJ,WAAYN,EAAKf,OAAOI,QAASc,aAElFD,YAAY,CAAEd,KAAMJ,EAAgBgB,EAAKf,OAAQe,EAAKd,QAAS,C","sources":["webpack://@zextras/carbonio-shell-ui/./src/workers/tag.ts"],"sourcesContent":["/*\n * SPDX-FileCopyrightText: 2022 Zextras <https://www.zextras.com>\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport type { SoapNotify } from '../types/network';\nimport type { Tag, Tags } from '../types/tags';\nimport type { TagMessage } from '../types/workers';\n\nexport const handleTagRefresh = (tags: Array<Tag>): Tags => {\n\tif (typeof tags !== 'undefined') {\n\t\treturn tags.reduce((acc: Tags, val: Tag): Tags => {\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tacc[val.id] = val;\n\t\t\treturn acc;\n\t\t}, {});\n\t}\n\treturn {};\n};\n\nconst handleTagCreated = (tags: Tags, created?: Array<Tag>): Tags => {\n\tif (!created) return tags;\n\treturn created.reduce((acc: Tags, val: Tag): Tags => {\n\t\t// eslint-disable-next-line no-param-reassign\n\t\tacc[val.id] = val;\n\t\treturn acc;\n\t}, tags);\n};\n\nconst handleTagModified = (tags: Tags, modified?: Array<Partial<Tag>>): Tags => {\n\tif (!modified) return tags;\n\treturn modified.reduce((acc: Tags, val: Partial<Tag>): Tags => {\n\t\tif (val.id) {\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tacc[val.id] = { ...tags[val.id], ...val };\n\t\t}\n\t\treturn acc;\n\t}, tags);\n};\n\nconst handleTagDeleted = (tags: Tags, deleted?: string[]): Tags => {\n\tif (!deleted) return tags;\n\treturn deleted.reduce((acc, val) => {\n\t\t// eslint-disable-next-line no-param-reassign\n\t\tdelete acc[val];\n\t\treturn acc;\n\t}, tags);\n};\n\nexport const handleTagNotify = (notify: SoapNotify, state: Tags): Tags =>\n\thandleTagDeleted(\n\t\thandleTagModified(handleTagCreated(state, notify.created?.tag), notify.modified?.tag),\n\t\tnotify.deleted\n\t);\n\nfunction deletedIdsContainTags({\n\tdeletedIds,\n\ttagIds\n}: {\n\tdeletedIds: Array<string>;\n\ttagIds?: Array<string>;\n}): boolean {\n\treturn deletedIds.some((deletedId) => tagIds?.includes(deletedId));\n}\n\nonmessage = ({ data }: TagMessage): void => {\n\tif (data.op === 'refresh' && data.tags) postMessage({ tags: handleTagRefresh(data.tags.tag) });\n\n\tconst tagIds = data.state && Object.keys(data.state);\n\tif (\n\t\tdata.op === 'notify' &&\n\t\t(data.notify.created?.tag ||\n\t\t\tdata.notify.modified?.tag ||\n\t\t\t(data.notify.deleted && deletedIdsContainTags({ deletedIds: data.notify.deleted, tagIds })))\n\t)\n\t\tpostMessage({ tags: handleTagNotify(data.notify, data.state) });\n};\n"],"names":["handleTagNotify","notify","state","handleTagDeleted","tags","deleted","reduce","acc","val","handleTagModified","modified","id","created","tag","handleTagCreated","onmessage","data","op","postMessage","tagIds","Object","keys","deletedIds","some","deletedId","includes","deletedIdsContainTags"],"sourceRoot":""}