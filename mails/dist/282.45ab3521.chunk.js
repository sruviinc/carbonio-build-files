"use strict";(self.webpackChunkcarbonio_mails_ui=self.webpackChunkcarbonio_mails_ui||[]).push([[282],{152:(e,t,n)=>{n.d(t,{R:()=>s});const a=/<p[^>]*>/g,r=/<br[^>]*>/g,i=/<div[^>]*>/g,l=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,o=/<style\b[^<]*(?:(?!<\/style>)<[^<]*)*<\/style>/gi,s=e=>{if(!e)return"";let t=e.replace(l,"").replace(o,"").replace(a,"\n\n<p>").replace(r,"\n").replace(i,"\n<div>");return t=(new DOMParser).parseFromString(t,"text/html").body.textContent||"",t}},3120:(e,t,n)=>{n.d(t,{_N:()=>k,xM:()=>T,yj:()=>R});var a=n(2509),r=n(1347);const i="text/html",l=/\S+/,o=/^\s+|\s+$/g,s=/\s+/g,c=/\r\n|\r|\n/,d=/[^@\s]+@[A-Za-z0-9-]{2,}(\.[A-Za-z0-9-]{2,})+/,m=/\d+\s*(\/|-|, )20\d\d/,p=new RegExp("^(-{2,}|auf\\s+)","i"),u=new RegExp("^(-{2,}|on\\s+)","i"),g=[{type:r.Vv.ORIG_QUOTED,regex:/^[>|].*/},{type:r.Vv.ORIG_SEP_STRONG,regex:new RegExp("^\\s*--+\\s*(Original Message|Originalnachricht|Weitergeleitete Nachricht|Forwarded Message|Original Appointment)\\s*--+\\s*$","i")},{type:r.Vv.ORIG_SEP_STRONG,regex:new RegExp("^Begin forwarded message:$","i")},{type:r.Vv.ORIG_HEADER,regex:new RegExp(`^\\s*(${["from:","to:","subject:","date:","sent:","cc:"].join("|")}).*`)},{type:r.Vv.ORIG_LINE,regex:/^\\s*_{5,}\\s*$/}],h=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,f={"#comment":!0,br:!0,script:!0,select:!0,style:!0},b=(e,t)=>{const n=e&&e.nodeName.toLowerCase();if(f[n])return;t.push(e);const a=e.childNodes||[];for(let e=0;e<a.length;e+=1)b(a[e],t)};function w(e){const t=document.createElement("div");for(t.innerHTML=e;h.test(e);)e=e.replace(h,"");let n=!1;const a=[];b(t,a);const i=a.length;let l;const o=[],s={};let c,d,g,f,w,S;for(l=0;l<i;l+=1){if(c=a[l],1===c.nodeType&&c.normalize(),g=c.nodeName.toLowerCase(),f=v(a[l]),f===r.Vv.ORIG_UNKNOWN&&"#text"===c.nodeName&&(m.test(c.nodeValue)||u.test(c.nodeValue)||p.test(c.nodeValue))){let e=c.nodeValue;for(let t=1;t<10;t+=1){const n=a[l+t];if(n&&"#text"===n.nodeName&&(e+=n.nodeValue,/:$/.test(e)&&(f=E(y(e)),f===r.Vv.ORIG_WROTE_STRONG))){l+=t;break}}}if(null!==f){if(o.push({type:f,node:c,nodeName:g}),s[f]=s[f]?s[f]+1:1,f===r.Vv.ORIG_SEP_STRONG||f===r.Vv.ORIG_WROTE_STRONG){S=c,n=!0;break}if(f===r.Vv.ORIG_HEADER&&w===r.Vv.ORIG_LINE){S=d,n=!0;break}d=c,w=f}}return S&&A(S,!0),n&&t.textContent?t.innerHTML:e}function v(e){if(!e)return null;const t=e.nodeName.toLowerCase();let n=null;if("#text"===t){const t=y(e.nodeValue);l.test(t)&&(n=E(t))}else"hr"===t?n=e.id===r.Vv.HTML_SEP_ID||"2"===e.size&&"100%"===e.width&&"center"===e.align?r.Vv.ORIG_SEP_STRONG:r.Vv.ORIG_LINE:"pre"===t?n=S(e):"div"===t?("OutlookMessageHeader"!==e.className&&"gmail_quote"!==e.className||(n=r.Vv.ORIG_SEP_STRONG),n=n||S(e)):"span"===t?n=n||S(e):"img"===t?n=r.Vv.ORIG_UNKNOWN:"blockquote"===t&&(n=r.Vv.ORIG_QUOTED);return n}function E(e){let t=r.Vv.ORIG_UNKNOWN;for(let n=0;n<g.length;n+=1){const a=g[n],{regex:i}=a;if(a.type!==r.Vv.ORIG_HEADER&&i.test(e.toLowerCase())){if(a.type===r.Vv.ORIG_QUOTED&&/^\s*\|.*\|\s*$/.test(e))continue;t=a.type;break}}if(t===r.Vv.ORIG_UNKNOWN){const n=e.match(/(\w+):$/),a=n&&n[1]&&n[1].toLowerCase();if(a){let n=0;n=n?5:"changed"===a?0:2,d.test(e)&&(n+=4),m.test(e)&&(n+=3),n>=7&&(t=r.Vv.ORIG_WROTE_STRONG),n>=5&&(t=r.Vv.ORIG_WROTE_WEAK)}}return t}function y(e,t,n){if(!e)return"";let a=o,r=s;return n?(a=new RegExp(`^${n}+|${n}+$`,"g"),r=new RegExp(`${n}+`,"g")):n=" ",e=e.replace(a,""),t&&(e=e.replace(r,n)),e}function S(e){const t=e.textContent||"";if(!l.test(t)||t.length>200)return null;const n=E(t);return n===r.Vv.ORIG_SEP_STRONG||n===r.Vv.ORIG_WROTE_STRONG?n:null}function A(e,t){const n=e&&e.parentNode;for(;n&&n.lastChild&&n.lastChild!==e;)n.removeChild(n.lastChild);t&&n&&n.lastChild===e&&n.removeChild(n.lastChild);const a=n&&n.nodeName.toLowerCase();n&&"body"!==a&&"html"!==a&&A(n,!1)}function T(e,t){if(!e)return"";if(t)return w(e);const n=[],a=e.split(c);let i,o=[];const s={};let d,m,g=!1;for(let e=0;e<a.length;e+=1){const t=a[e];let c=y(t);l.test(c)||o.push(t),0===c.indexOf("| DO NOT REPLY")&&-1!==a[e+2].indexOf("bugzilla")&&(g=!0);let h=E(c);h===r.Vv.ORIG_QUOTED?h=g?r.Vv.ORIG_UNKNOWN:h:g=!1;let f=a[e+1];if(d=!1,f&&h===r.Vv.ORIG_UNKNOWN&&(u.test(c)||p.test(c))&&f.match(/\w+:$/)&&(c=[c,f].join(" "),h=E(c),d=!0),h===r.Vv.ORIG_LINE){let t=e+1;for(f=a[t];!l.test(f)&&t<a.length;)f=a[++t];h=(f&&E(f))===r.Vv.ORIG_HEADER?r.Vv.ORIG_HEADER:r.Vv.ORIG_UNKNOWN}i?i!==h&&(n.push({type:i,block:o}),m=i===r.Vv.ORIG_UNKNOWN?o:m,s[i]=s[i]?s[i]+1:1,o=[],i=h):i=h,!d||h!==r.Vv.ORIG_WROTE_WEAK&&h!==r.Vv.ORIG_WROTE_STRONG?o.push(t):(o.push(t),o.push(f),e+=1,d=!1)}o.length&&(n.push({type:i,block:o}),m=i===r.Vv.ORIG_UNKNOWN?o:m,s[i]=s[i]?s[i]+1:1);const h=n[0],f=n[1];if(h&&h.type===r.Vv.ORIG_UNKNOWN&&f&&(f.type===r.Vv.ORIG_HEADER||f.type===r.Vv.ORIG_WROTE_STRONG)){const e=x(h.block);if(e){const t=n[2];if(t&&t.type===r.Vv.ORIG_UNKNOWN){const n=x(t.block);if(n&&-1!==n.indexOf(r.Vv.NOTES_SEPARATOR))return e+n}return e}}let b=function(e,t){if(e[r.Vv.ORIG_WROTE_STRONG]>0){let n,a=!1;const i={};for(let e=0;e<t.length;e+=1){const l=t[e],{type:o}=l;if(o===r.Vv.ORIG_WROTE_STRONG)a=!0;else if(o!==r.Vv.ORIG_UNKNOWN||a)a&&(i[o]=!0);else{if(n)return null;n=l.block}}const l=i[r.Vv.ORIG_UNKNOWN]&&i[r.Vv.ORIG_QUOTED],o=2===e[r.Vv.ORIG_UNKNOWN]&&t[t.length-1].type===r.Vv.ORIG_UNKNOWN;if(n&&(!l||o)){const e=x(n);if(e)return e}}return null}(s,n);if(b)return b;if(1===s[r.Vv.ORIG_UNKNOWN]&&s[r.Vv.ORIG_QUOTED]>0&&(b=x(m),b))return b;if(s[r.Vv.ORIG_SEP_STRONG]>0){let e=[];for(let t=0;t<n.length;t+=1){const a=n[t];if(a.type===r.Vv.ORIG_SEP_STRONG)break;e=e.concat(a.block)}if(b=x(e),b)return b}return e}function x(e){if(!e||!e.length)return null;let t=`${e.join("\n")}\n`;return t=t.replace(/\s+$/,"\n"),l.test(t)?t:null}function C(e){return-1!==(e=e.replace("</div></div>","</div>")).indexOf("</div></div>")&&(e=C(e)),e}function _(e){return null!=e?e.replace(/(?:\r\n|\r|\n)/g,"<br />"):""}function R(e,t){const n=e,r=T(n,t);if(r.length>=n.length-5)return"";if(null!=n&&""!==n){const e=new DOMParser,t=e.parseFromString(n,"text/html"),l=t.body.innerHTML;let o=[{name:"zimbra",index:l.indexOf('id="zwchr">')},{name:"gmail",index:l.indexOf('<div class="gmail_quote">')},{name:"original",index:l.indexOf("Original Message")},{name:"original_de",index:l.indexOf("Originalnachricht")},{name:"forward",index:l.indexOf("Forwarded Message")},{name:"forward_de",index:l.indexOf("Weitergeleitete Nachricht")},{name:"blockquote",index:l.indexOf('<blockquote style="margin: 0 0 1.25rem 0;">')}].filter((e=>-1!==e.index));if(o=(0,a.orderBy)(o,"index","asc"),o.length>0&&"text/html"===i){let e="";switch(o[0].name){case"zimbra":t.body.innerHTML="",l.split('id="zwchr">').splice(1).forEach((e=>{const n=t.createElement("div");n.setAttribute("class","quoted_text"),n.innerHTML=e,t.body.appendChild(n)})),e=t.body.innerHTML;break;case"gmail":t.body.innerHTML="",l.split('<div class="gmail_quote">').splice(1).forEach((e=>{const n=t.createElement("div");n.setAttribute("class","quoted_text"),n.innerHTML=e,t.body.appendChild(n)})),e=t.body.innerHTML;break;case"original":{const n=l.split(/\s*--+\s*Original Message\s*--+\s*/gi);t.body.innerHTML="",n.splice(1).forEach((e=>{const n=t.createElement("div");n.innerHTML=e,t.body.appendChild(n)})),e=`----- Original message -----${t.body.innerHTML}`;break}case"original_de":{const n=l.split(/\s*--+\s*Originalnachricht\s*--+\s*/gi);t.body.innerHTML="",n.splice(1).forEach((e=>{const n=t.createElement("div");n.innerHTML=e,t.body.appendChild(n)})),e=`----- Originalnachricht -----${t.body.innerHTML}`;break}case"forward":{const n=l.split(/\s*--+\s*Forwarded Message\s*--+\s*/gi);t.body.innerHTML="",n.splice(1).forEach((e=>{const n=t.createElement("div");n.innerHTML=e,t.body.appendChild(n)})),e=`----- Forwarded message -----${t.body.innerHTML}`;break}case"forward_de":{const n=l.split(/\s*--+\s*Weitergeleitete Nachricht\s*--+\s*/gi);t.body.innerHTML="",n.splice(1).forEach((e=>{const n=t.createElement("div");n.innerHTML=e,t.body.appendChild(n)})),e=`----- Weitergeleitete Nachricht -----${t.body.innerHTML}`;break}case"blockquote":{const n=l.split('<blockquote style="margin: 0 0 1.25rem 0;">');t.body.innerHTML="",n.splice(1).forEach((e=>{const n=t.createElement("div");n.innerHTML=e,t.body.appendChild(n)})),e=t.body.innerHTML;break}}return e}if(t.getElementsByClassName("OutlookMessageHeader").length>0&&t.getElementsByClassName("OutlookMessageHeader")[0]){const e=l.split('class="OutlookMessageHeader">');return t.body.innerHTML="",e.splice(1).forEach((e=>{const n=t.createElement("div");n.setAttribute("class","quoted_text"),n.innerHTML=e,t.body.appendChild(n)})),t.body.innerHTML}const s=C(e.parseFromString(r,"text/html").body.innerHTML),c=C(t.body.innerHTML),d=c.slice(0,s.length);let m=c.split(d)[1];""!==m&&void 0!==m||(m=_(c.slice(s.length,c.length))),t.body.innerHTML="";const p=t.createElement("div");return p.setAttribute("class","quoted_text"),"text/html"!==i&&(m=_(m)),p.innerHTML=m,t.body.appendChild(p),m=t.body.innerHTML,"text/html"!==i?_(m):m}return""}function k(e,t){return e?("string"!=typeof e&&(e=e.toString?e.toString():""),t?e.replace(/[&]/g,"&amp;").replace(/ {2}/g," &nbsp;").replace(/[<]/g,"&lt;").replace(/[>]/g,"&gt;"):e.replace(/[&]/g,"&amp;").replace(/[<]/g,"&lt;").replace(/[>]/g,"&gt;")):""}},6961:(e,t,n)=>{n.d(t,{Ay:()=>C,IS:()=>h,ag:()=>v,zq:()=>f});var a=n(7559),r=n.n(a),i=n(4702),l=n(7196),o=n(2509),s=n(8153),c=n(4710),d=n.n(c),m=n(3120),p=n(1347),u=n(7995),g=n(6505);const h=/^<(.*)>$/,f=/^cid:(.*)$/,b=/(?:https?:\/\/|www\.)+(?![^\s]*?")([\w.,@?!^=%&amp;:()/~+#-]*[\w@?!^=%&amp;()/~+#-])?/gi,w=/(?:\r\n|\r|\n)/g,v=e=>null!=e?e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(w,"<br />"):"",E=d()(i.Container).withConfig({displayName:"mail-message-renderer__BannerContainer",componentId:"sc-1dz62ij-0"})(["border-bottom:0.0625rem solid ",";padding:0.5rem 1rem;display:flex;flex-direction:row;align-items:center;height:3.625rem;border-radius:0.125rem 0.125rem 0 0;"],(e=>e.theme.palette.warning.regular)),y=d()(i.MultiButton).withConfig({displayName:"mail-message-renderer__StyledMultiBtn",componentId:"sc-1dz62ij-1"})(["border:0.0625rem solid ",";height:2rem;& > *{background-color:"," !important;cursor:pointer;}&:hover{background-color:",";}svg{padding:0 !important;}"],(e=>e.theme.palette.warning.regular),(e=>e.theme.palette.transparent.regular),(({theme:e})=>e.palette.gray6.focus)),S=({body:e})=>{const[t,n]=(0,a.useState)(!1),o=(0,m.xM)(e.content,!1),s=(0,m.yj)(e.content,!1),c=(0,a.useMemo)((()=>t?e.content:o),[t,e.content,o]),d=(0,a.useMemo)((()=>{return""===(e=v(c))||void 0===e?"":e.replace(b,(e=>{const t=document.createElement("div"),n=document.createElement("a");let a=e.replace(/&amp;/g,"&");return e.startsWith("http")||e.startsWith("https")||(a=`http://${e}`),n.href=a.replace(/&#64;/g,"@").replace(/&#61;/g,"="),n.target="_blank",n.innerHTML=e,t.appendChild(n),t.innerHTML}));var e}),[c]);return r().createElement(r().Fragment,null,r().createElement(i.Text,{overflow:"break-word",color:"text",style:{fontFamily:"monospace"},dangerouslySetInnerHTML:{__html:d}}),!t&&s.length>0&&r().createElement(i.Row,{mainAlignment:"center",crossAlignment:"center",padding:{top:"medium"}},r().createElement(i.Button,{label:(0,l.t)("label.show_quoted_text","Show quoted text"),icon:"EyeOutline",type:"outlined",onClick:()=>n(!0)})))},A=({msgId:e,body:t,parts:n,participants:c})=>{const d=(0,a.useRef)(null),b=(0,a.useRef)(null),[w,v]=(0,a.useState)(!1),S=(0,l.useUserSettings)()?.prefs,A=(0,o.filter)(c,{type:u.s.FROM})[0]?.address??(0,g.jq)(),T=A?.substring(A.lastIndexOf("@")+1),[x,C]=(0,a.useState)(!1),[_,R]=(0,a.useState)(!0),k=(0,m.xM)(t.content,!0),M=(0,m.yj)(t.content,!0),I=(0,a.useMemo)((()=>w?t.content:k),[w,t.content,k]),O=(0,a.useMemo)((()=>{const e=(new DOMParser).parseFromString(I,"text/html").body.getElementsByTagName("img");return(0,o.some)(e,(e=>e.hasAttribute("dfsrc")))}),[I]),$=(0,a.useMemo)((()=>O&&!(0,p.vX)(S.zimbraPrefMailTrustedSenderList??"",A)&&_),[A,O,S.zimbraPrefMailTrustedSenderList,_]);(0,a.useEffect)((()=>{(0,p.vX)(S.zimbraPrefMailTrustedSenderList??"",A)&&C(!0)}),[A,S.zimbraPrefMailTrustedSenderList]);const N=()=>{(0,o.isNull)(b.current)||(b.current.style.height="0",b.current.style.height=(b?.current?.contentDocument?.body?.scrollHeight||0)/16+1.5+"rem")},P=(0,a.useCallback)((e=>{let t=[];S.zimbraPrefMailTrustedSenderList&&(t=(0,o.isArray)(S.zimbraPrefMailTrustedSenderList)?S.zimbraPrefMailTrustedSenderList:S.zimbraPrefMailTrustedSenderList?.split(",")),(0,l.editSettings)({prefs:{zimbraPrefMailTrustedSenderList:[...t,e]}}).then((e=>{e.type?.includes("fulfilled")&&C(!0)}))}),[S.zimbraPrefMailTrustedSenderList]),D=(0,a.useMemo)((()=>[{id:"always-allow-address",label:r().createElement(s.Trans,{i18nKey:"label.always_allow_address",defaults:"Always allow from <strong>{{values}}</strong>",values:{from:A}}),onClick:()=>P(A)},{id:"always-allow-domain",label:r().createElement(s.Trans,{i18nKey:"label.always_allow_domain",defaults:"Always allow from <strong>{{values}}</strong> domain",values:{domain:T}}),onClick:()=>P(T)}]),[A,T,P]),L=(0,a.useMemo)((()=>x&&_),[_,x]);(0,a.useLayoutEffect)((()=>{(0,o.isNull)(b.current)||(0,o.isNull)(b.current.contentDocument)||(b.current.contentDocument.open(),b.current.contentDocument.write(I),b.current.contentDocument.close());const t=document.createElement("style");t.textContent="\n\t\t\tmax-width: 100% !important;\n\t\t\tbody {\n\t\t\t\tmax-width: 100% !important;\n\t\t\t\tmargin: 0;\n\t\t\t\toverflow-y: hidden;\n\t\t\t\tfont-family: Roboto, sans-serif;\n\t\t\t\tfont-size: 0.875rem;\n\t\t\t\t\n\t\t\t\tbackground-color: #ffffff;\n\t\t\t}\n\t\t\tbody pre, body pre * {\n\t\t\t\twhite-space: pre-wrap;\n\t\t\t\tword-wrap: anywhere !important;\n\t\t\t\ttext-wrap: suppress !important;\n\t\t\t}\n\t\t\timg {\n\t\t\t\tmax-width: 100%\n\t\t\t}\n\t\t\ttbody{position:relative !important}\n\t\t\ttd{\n\t\t\t\tmax-width: 100% !important;\n\t\t\t\toverflow-wrap: anywhere !important;\n\t\t\t}\n\t\t\t#bodyTable {\n\t\t\t\theight: fit-content\n\t\t\t}\n\t\t",(0,o.isNull)(b.current)||(0,o.isNull)(b.current.contentDocument)||b.current.contentDocument.head.append(t),N();const a=(0,o.reduce)(n,((e,t)=>h.test(t.ci??"")?(e[h.exec(t.ci??"")?.[1]??""]=t,e):e),{}),r=b.current&&b.current.contentDocument&&b.current.contentDocument.body.getElementsByTagName("img");r&&(0,o.forEach)(r,(t=>{if(t.hasAttribute("dfsrc")&&L&&t.setAttribute("src",t.getAttribute("dfsrc")??""),!f.test(t.src))return;const n=f.exec(t.getAttribute("src")??"")?.[1]??"";if(a[n]){const r=a[n];t.setAttribute("pnsrc",t.getAttribute("src")??""),t.setAttribute("src",`/service/home/~/?auth=co&id=${e}&part=${r.name}`)}}));const i=new ResizeObserver(N);return d.current&&i.observe(d.current),()=>i.disconnect()}),[I,e,n,L]);const z=(0,a.useMemo)((()=>(0,l.t)("label.view_images","VIEW IMAGES")),[]);return r().createElement("div",{ref:d,className:"force-white-bg"},$&&!x&&r().createElement(E,{orientation:"horizontal",mainAlignment:"space-between",crossAlignment:"center",padding:{all:"large"},height:"3.625rem",background:"#FFF7DE",width:"100%"},r().createElement(i.Row,{height:"fit",orientation:"vertical",display:"flex",wrap:"nowrap",mainAlignment:"flex-start",style:{flexGrow:1,flexDirection:"row"}},r().createElement(i.Padding,{right:"large"},r().createElement(i.Icon,{icon:"AlertTriangleOutline",color:"warning",size:"large"})),r().createElement(i.Text,{overflow:"break-word",size:"small"},(0,l.t)("message.external_images_blocked","External images have been blocked to protect you against potential spam"))),r().createElement(i.Row,{height:"fit",orientation:"vertical",display:"flex",wrap:"nowrap",mainAlignment:"flex-end",padding:{left:"small"},style:{flexGrow:1,flexDirection:"row"}},r().createElement(y,{background:"transparent",type:"outlined",label:z,color:"warning",onClick:()=>{C(!0)},dropdownProps:{maxWidth:"31.25rem",width:"fit",items:D},items:D}),r().createElement(i.IconButton,{icon:"CloseOutline",onClick:()=>R(!1),customSize:{iconSize:"large",paddingSize:"small"},size:"small"}))),r().createElement("iframe",{"data-testid":"message-renderer-iframe",title:e,ref:b,onLoad:N,style:{border:"none",width:"100%",display:"block",maxWidth:"100%"}}),!w&&M.length>0&&r().createElement(i.Row,{mainAlignment:"center",crossAlignment:"center"},r().createElement(i.Button,{label:(0,l.t)("label.show_quoted_text","Show quoted text"),icon:"EyeOutline",type:"outlined",onClick:()=>v(!0),width:"fill"})))},T=()=>r().createElement(i.Container,{padding:{bottom:"medium"}},r().createElement(i.Text,null,`(${(0,l.t)("messages.no_content","This message has no text content")}.)`)),x=(0,a.memo)((({parts:e,body:t,id:n,fragment:a,participants:i})=>t?.content?.length||a?"text/html"===t?.contentType?r().createElement(A,{msgId:n,body:t,parts:e,participants:i}):"text/plain"===t?.contentType?r().createElement(S,{body:t}):r().createElement(T,null):r().createElement(T,null)));x.displayName="MailMessageRenderer";const C=x},2705:(e,t,n)=>{n.d(t,{w:()=>p});var a=n(2509),r=n(7196),i=n(7431),l=n(4222),o=n.n(l);const s=(e,t)=>{const n=(0,a.map)(e,(e=>`${e.fullName||e.name||e.address} < ${e.address} > `)).join(", ");return 0===e.length?"":`\n    <tr>\n   <td style="\n      width: auto;\n      padding: 0.1875rem 0 0.1875rem 0;\n      vertical-align: top;\n      text-align: left;\n      font-weight: bold;\n      ">${t}: <span style="padding: 0.1875rem 0.1875rem 0.1875rem 0.1875rem; vertical-align: top; overflow: hidden;font-family: Roboto, sans-serif;\n      font-style: normal;\n      font-weight: 400;\n      font-size: 0.875rem;\n      line-height: 1.3125rem;">${n}</span></td>\n</tr>\n\n   `};function c(e,t){const{participants:n,subject:i}=e,l=(0,a.filter)(n,{type:"f"}),c=(0,a.filter)(n,{type:"t"}),d=(0,a.filter)(n,{type:"c"}),m=(0,a.filter)(n,{type:"b"}),p=(0,a.filter)(n,{type:"r"}),u=o()(e.date).format("ddd, MMM DD, YYYY hh:mm A"),g=e.attachments&&e.attachments?.length>0;return`\n    <table width="100%" cellpadding="0" cellspacing="0" class="Msg" style="padding:0.625rem;">\n        <tr>\n            <td  colspan="2">\n                <table width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color:#EEEEEE;" >\n                    <tr>\n                        <td align="left">\n                            <table width="100%" align="left" cellpadding="2" cellspacing="0" border="0">\n                                ${s(l,"From")}\n                                ${((e,t)=>`<tr>\n    <td style="\n       width: auto;\n       padding: 0.1875rem 0 0.1875rem 0;\n       vertical-align: top;\n       text-align: left;\n       font-weight: bold;\n       ">${t}: <span style="padding: 0.1875rem 0.1875rem 0.1875rem 0.1875rem; vertical-align: top; overflow: hidden;font-family: Roboto, sans-serif;\n       font-style: normal;\n       font-weight: 400;\n       font-size: 0.875rem;\n       line-height: 1.3125rem;">${e}</span></td>\n    </tr>`)(i,"Subject")}\n                                ${s(c,"To")} \n                                ${s(d,"Cc")}\n                                ${s(m,"Bcc")}\n                                ${s(p,"Reply To")}\n                        </table>\n                        </td>\n                        <td valign='top'>\n                            <table width="100%" cellpadding="2" cellspacing="0" border="0">\n                                <tr>\n                                    <td nowrap align='right' class='MsgHdrSent'>\n                                        <span id="messageDisplayTime_19062">${u}</span>\n                                    </td>\n                                </tr>\n                            </table>\n                        </td>\n                    </tr>\n                </table>\n            </td>\n        </tr>\n\t\t  <tr>\n      ${g?(({msg:e})=>`\n\t<tr\n   style="\n   display: flow-root;\n   margin-bottom: 1rem"\n   >\n   <td style="\n      margin: 0.5rem;\n      display: flex;\n      ">\n      <div style="\n         color: #828282;\n         display: flex;\n         font-family: Roboto, sans-serif;\n         font-size: 1rem;\n         width: fill-content">\n         ${(0,r.t)("label.attachment_plural","Attachments")}:\n      </div>\n   </td>\n   ${(0,a.map)(e.attachments,(e=>`\n   <td style="\n      color: #000000;\n      white-space: nowrap;\n      width: 100%;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      display: flex;\n      "\n      >\n      <div style="\n         display: flex;\n         ">\n         <svg \n            style="\n            width: 0.75rem;\n            display: flex;\n            fill: #333333;\n            margin: 0 0.375rem 0 0.5rem;\n            " \n            xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n            <path\n               d="M9.29 21a6.23 6.23 0 0 1-4.43-1.88 6 6 0 0 1-.22-8.49L12 3.2A4.11 4.11 0 0 1 15 2a4.48 4.48 0 0 1 3.19 1.35 4.36 4.36 0 0 1 .15 6.13l-7.4 7.43a2.54 2.54 0 0 1-1.81.75 2.72 2.72 0 0 1-1.95-.82 2.68 2.68 0 0 1-.08-3.77l6.83-6.86a1 1 0 0 1 1.37 1.41l-6.83 6.86a.68.68 0 0 0 .08.95.78.78 0 0 0 .53.23.56.56 0 0 0 .4-.16l7.39-7.43a2.36 2.36 0 0 0-.15-3.31 2.38 2.38 0 0 0-3.27-.15L6.06 12a4 4 0 0 0 .22 5.67 4.22 4.22 0 0 0 3 1.29 3.67 3.67 0 0 0 2.61-1.06l7.39-7.43a1 1 0 1 1 1.42 1.41l-7.39 7.43A5.65 5.65 0 0 1 9.29 21z"\n               data-name="attach"\n               />\n         </svg>\n         <p style="\n            font-family: Roboto, sans-serif;\n            font-size: 0.75rem;\n            display: flex;\n            line-height: 0;\n            ">\n            ${e.filename}\n         </p>\n      </div>\n   </td>\n   `)).join("")}\n   </td>\n</tr>\n`)({msg:e}):""}\n\n   </tr>\n        <td id="iframeBody" style="padding:0.3125rem; font-family: monospace" valign='top' colspan="2">\n            <div id="iframeBody" class="MsgBody-html">\n                ${t}\n            </div>\n            <hr>\n        </td>\n    </tr>\n</table>`}var d=n(169),m=n(6961);const p=({messages:e,conversations:t,isMsg:n=!1})=>{let l="";return(0,a.map)(t,(t=>{const r=(0,a.filter)(e,{conversation:t.id})??[],i=(o=n?e:r,(0,a.map)(o,(e=>{const{body:t}=e;switch(t.contentType){case"text/html":{const n=(0,d._y)(e.parts??[],[]),r=(new DOMParser).parseFromString(t.content,"text/html"),i=(0,a.reduce)(n,((e,t)=>m.IS.test(t.ci)?(e[m.IS.exec(t.ci)[1]]=t,e):e),{}),l=r.getElementsByTagName("img");return(0,a.forEach)(l,(t=>{if(t.hasAttribute("dfsrc")&&t.setAttribute("src",t.getAttribute("dfsrc")??""),!m.zq.test(t.src))return;const n=m.zq.exec(t.getAttribute("src")??"")?.[1]??"";if(i[n]){const a=i[n];t.setAttribute("pnsrc",t.getAttribute("src")??""),t.setAttribute("src",`/service/home/~/?auth=co&id=${e.id}&part=${a.name}`)}})),c(e,r.body.innerHTML)}case"text/plain":return(0,a.isEmpty)(t.content)?c(e,"<p>No Content</p>"):c(e,`<p>${(0,m.ag)(t.content)}</p>`);default:return c(e,"<p>No Content</p>")}})));var o;l+=function({content:e,subject:t}){return`\n        <div className="ZhCallListPrintView">\n\t\t\t<table cellPadding="0" cellSpacing="5" width="100%">\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<div className="ZhPrintSubject" \n                        style="background: rgba(176, 195, 231, 0.8);\n                        padding-left: 0.25rem;\n                        display: flex;\n                        align-items: center;">\n\t\t\t\t\t\t\t<b>${t}</b>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<hr />\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>${e}</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t</div>`}({content:i.join("<br/>"),subject:t.subject})})),function({content:e}){return`\t<html>\n\t\t<head>\n\t\t\t<title>Carbonio</title>\n                <style>\n                    max-width: 100% !important;\n                    body {\n                        max-width: 100% !important;\n                        margin: 0;\n                        overflow-y: hidden;\n                        font-family: Roboto, sans-serif;\n                        font-size: 0.875rem;                      \n                        background-color: #ffffff;\n                    }\n                    body pre, body pre * {\n                        white-space: pre-wrap;\n                        word-wrap: anywhere !important;\n                        text-wrap: suppress !important;\n                    }\n                    img {\n                        max-width: 100%\n                    }\n                    tbody{position:relative !important}\n                    td{\n                        max-width: 100% !important;\n                        overflow-wrap: anywhere !important;\n                    }\n                    \n                    .ZhCallListPrintView td, .zPrintMsgs :not(font){\n                        font-family: Tahoma,Arial,Helvetica,sans-serif;\n                        font-size: 12pt;\n                    }\n                    .ZhPrintSubject {\n                        padding: 0.625rem;\n                        font-weight: bold;\n                    }\n                    table.Msg img {\n                        max-width: 100%;\n                    }\n                    \n                    /* span, p td or div will honour parent's styling if these elements have their own styling that will get applied else will fallback to defaultPrintFontSize */\n                    *[style*="font"] > span, *[style*="font"] > p, *[style*="font"] > td, *[style*="font"] > div {\n                        font-family: inherit;\n                        font-size: inherit;\n                    }\n\n                    .MsgHdrName {\n                        width: 10%;\n                        padding: 0.1875rem 0 0.1875rem 0;\n                        vertical-align: top;\n                        text-align: right;\n                        font-weight: bold;\n                        white-space: nowrap;\n                    }\n                    .MsgHdrValue {\n                        padding: 0.1875rem 0.1875rem 0.1875rem 0.1875rem;\n                        vertical-align: top;\n                        overflow: hidden;\n                    }\n                    .footer {\n                        font-size: 0.5625rem;\n                        text-align: left;\n                        padding-left: 1.25rem;\n                    }\n                        \n                    @page {\n                        size: A4;\n                        margin: 11mm 17mm 17mm 17mm;\n                    }\n                        \n                    @media print {\n                        .footer {\n                            position: fixed;\n                            bottom: 0;\n                        }\n                        \n                        .content-block, p {\n                            page-break-inside: avoid;\n                        }\n                        \n                        html, body {\n                            width: 210mm;\n                            height: 297mm;\n                        }\n                    }\n             </style>\n\t\t</head>\n\t\t<body>\n\t\t\t<table cellPadding="0" cellSpacing="5" width="100%">\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<b>Carbonio</b>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td nowrap width="1%">\n\t\t\t\t\t\t<b>${(0,r.getUserAccount)()?.name??i.WM}</b>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t\t<hr />${e}\n\t\t\t<div className="footer">${window.location.hostname} </div>\n\t\t\t<script type="text/javascript">setTimeout('window.print()', 3000);<\/script>\n\t\t</body>\n\t</html>`}({content:l})}},5740:(e,t,n)=>{n.d(t,{U0:()=>s,gU:()=>d,vb:()=>o});var a=n(7196),r=n(2509),i=n(152),l=n(1347);const o="11111111-1111-1111-1111-111111111111",s="No signature",c=new RegExp(`^(${l.Vv.SIGNATURE_PRE_SEP}\\n)(((?!\\s${l.Vv.PLAINTEXT_SEP}$).)*)`,"ms"),d=(e,t="")=>{const n=""!==t?((e,t)=>((e,t,n)=>{const a=(e=>{const t=[{label:s,value:{description:"",id:o}}];return(0,r.map)(e?.signatures?.signature,(e=>t.push({label:e.name,value:{description:e.content?e.content[0]._content:"",id:e?.id}}))),t})(e);return(0,r.find)(a,(e=>e.value.id===t))??(n?a?.[0]:void 0)})(e,t)?.value.description??"")((0,a.getUserAccount)(),t):"",d=""!==n?`\n${(0,i.R)(n)}\n\n`:"",m=((e,t)=>{const n=(new DOMParser).parseFromString(e,"text/html"),a=n.getElementsByClassName(l.Vv.SIGNATURE_CLASS);let r=null;const i=n.getElementById(l.Vv.HTML_SEP_ID);return r=a.item(0),null==r||i&&r.compareDocumentPosition(i)!==Node.DOCUMENT_POSITION_FOLLOWING?e:(r.innerHTML=t,n.documentElement.innerHTML)})(e.richText,n);return{plainText:((e,t)=>{if(!e.match(c))return e;const n=e.indexOf(l.Vv.PLAINTEXT_SEP),a=e.match(c);return!a||n>=0&&n<(a.index??0)?e:e.replace(c,`$1${t}`)})(e.plainText,d),richText:m}}},2325:(e,t,n)=>{n.d(t,{p:()=>u,s:()=>p});var a=n(2940),r=n(7196),i=n(9126),l=n(9683),o=n(7995),s=n(6505),c=n(5299),d=n(5581),m=n(3539);const p=(0,a.createAsyncThunk)("sendMsg",(async({msg:e},{rejectWithValue:t,dispatch:n})=>{const a=(0,d.kC)(e),m=(0,c.QH)(e,o.s.FROM)?.[0].address,p=(0,s.P8)(m);let u;try{u=await(0,r.soapFetch)("SendMsg",{_jsns:"urn:zimbraMail",m:a},p??void 0)}catch(e){return console.error(e),t(e)}const g=u?.Fault?{...u.Fault,error:!0}:u;return g?.error?t(g):(g?.m&&g?.m[0]?.id&&n((0,l.q)({msgId:g.m[0].id})),g?.m&&g?.m[0]?.cid&&n((0,i.F)({conversationId:g.m[0].cid})),{response:g})})),u=(0,a.createAsyncThunk)("sendMsg",(async({editor:e},{rejectWithValue:t,dispatch:n})=>{if(!e)return t("No editor provided");if(!e.identityId)return t("Missing sender");const a=(0,m.l7)(e),o=(0,s.AR)(e.identityId);let c;try{c=await(0,r.soapFetch)("SendMsg",{_jsns:"urn:zimbraMail",m:a},o?.ownerAccount??void 0)}catch(e){return console.error(e),t(e)}const d=c?.Fault?{...c.Fault,error:!0}:c;return d?.error?t(d):(d?.m&&d?.m[0]?.id&&n((0,l.q)({msgId:d.m[0].id})),d?.m&&d?.m[0]?.cid&&n((0,i.F)({conversationId:d.m[0].cid})),{response:d})}))},5581:(e,t,n)=>{n.d(t,{A5:()=>b,BR:()=>E,DV:()=>A,G3:()=>h,Qn:()=>w,i9:()=>S,jz:()=>p,kC:()=>T,s5:()=>f,vC:()=>_,vG:()=>v});var a=n(7196),r=n(2509),i=n(4222),l=n.n(i),o=n(7995),s=n(152),c=n(3120),d=n(1347),m=n(6505);const p=(e,t)=>(0,r.reduce)(e?.parts?.[0]?.parts??[],((n,a)=>a.disposition&&a.disposition===t?[...n,{part:a.name,mid:e.id,requiresSmartLinkConversion:!!a.requiresSmartLinkConversion}]:n),[]),u=(e,t,n)=>(0,r.map)((0,r.filter)(e.participants,(e=>e.type===t)),(e=>({...e,type:n}))),g=(e,t)=>(0,r.map)(e,(e=>({...e,type:t}))),h=e=>0===(0,r.filter)(e.participants,(e=>e.type===o.s.REPLY_TO)).length?e.parent===a.FOLDERS.SENT?(0,r.filter)(e.participants,(e=>e.type===o.s.TO)):u(e,o.s.FROM,o.s.TO):u(e,o.s.REPLY_TO,o.s.TO),f=e=>(0,r.filter)(e.participants,(e=>e.type===o.s.TO));function b(e,t){const n=(0,r.filter)(e.participants,(e=>e.type===o.s.TO)),i=(0,r.filter)(e.participants,(e=>e.type===o.s.FROM&&t!==(0,m.P8)(e.address))),l=(0,r.filter)(e.participants,(e=>e.type===o.s.REPLY_TO)),s=(0,r.some)((0,r.filter)(e.participants,(e=>e.type===o.s.FROM)),(e=>t===(0,m.P8)(e.address)));return 0===l.length?e.parent===a.FOLDERS.SENT||e.isSentByMe||s?0===(0,r.filter)(n,(e=>t!==(0,m.P8)(e.address))).length?n:(0,r.filter)(n,(e=>t!==(0,m.P8)(e.address))):g(i,o.s.TO):u(e,o.s.REPLY_TO,o.s.TO)}const w=e=>(0,r.filter)(e.participants,(e=>e.type===o.s.CARBON_COPY));function v(e,t){const n=(0,r.filter)(e.participants,(e=>e.type===o.s.TO&&t!==(0,m.P8)(e.address))),i=(0,r.filter)(e.participants,(e=>e.type===o.s.CARBON_COPY&&t!==(0,m.P8)(e.address))),l=b(e,t),s=(0,r.reduce)(i,((e,t)=>(n.filter((e=>e.address===t.address)).length>0||l.filter((e=>e.address===t.address)).length>0||e.push({...t,type:o.s.CARBON_COPY}),e)),[]);return e.parent===a.FOLDERS.SENT||e.isSentByMe?g(s,o.s.CARBON_COPY):(0,r.reduce)((0,r.concat)(n,s),((e,t)=>(l.filter((e=>e.address===t.address)).length>0||e.push({...t,type:o.s.CARBON_COPY}),e)),[])}const E=e=>(0,r.filter)(e.participants,(e=>e.type===o.s.BLIND_CARBON_COPY));function y(e,t,n=[]){return(0,r.reduce)(e,((e,a)=>(a.contentType===t&&a.content&&e.push(a.content),a.parts?y(a.parts,t,n):n)),n)}const S=e=>{const t=y(e.parts,"text/plain"),n=y(e.parts,"text/html"),a=t.length?t[0].replaceAll("\n","<br/>"):void 0,r=n.length?n[0].replaceAll("dfsrc","src"):void 0;return[a??r??"",r??a??""]};function A(e,t){const n=(0,r.map)((0,r.filter)(e.participants,["type",o.s.FROM]),(e=>`"${e.fullName}" <${e.address}>`)).join(", "),a=(0,r.map)((0,r.filter)(e.participants,["type",o.s.TO]),(e=>`"${e.fullName}" <${e.address}>`)).join(", "),i=(0,r.map)((0,r.filter)(e.participants,["type",o.s.CARBON_COPY]),(e=>`"${e.fullName}" <${e.address}>`)).join(", "),m=l()(e.date).format("LLLL"),p=[`\n\n${d.Vv.PLAINTEXT_SEP}\n${t.from} ${n}\n${t.to} ${a}\n`,`<br /><br /><hr id="${d.Vv.HTML_SEP_ID}" ><div style="color: black; font-size: 12pt; font-family: tahoma, arial, helvetica, sans-serif;"><b>${t.from}</b> ${(0,c._N)(n)} <br /> <b>${t.to}</b> ${(0,c._N)(a)} <br />`];return i.length>0&&(p[1]+=`<b>${t.cc}</b> ${(0,c._N)(i)}<br />`,p[0]+=`${t.cc} ${i}\n`),p[1]+=`<b>${t.sent}</b> ${m} <br /> <b>${t.subject}</b> ${(0,c._N)(e.subject)} <br /><br />${S(e)[1]}</div>`,p[0]+=`${t.sent} ${m}\n${t.subject} ${e.subject}\n\n${S(e)[0]}`,[(0,s.R)(p[0]),p[1]]}const T=e=>{const t=S(e),n=(a=e.parts,a?.some((function e(t){return"text/html"===t.contentType||!!t.parts&&t.parts.some(e)}))||!1);var a;return{id:"new"===e.id?void 0:e.id,did:e.isDraft?e.did??e.id:void 0,attach:{mp:p(e,"attachment")},su:{_content:e.subject??""},e:(0,r.map)(e.participants,(e=>({t:e.type,a:e.address,d:e.fullName??e.name??void 0}))),mp:[n?{ct:"multipart/alternative",mp:[{ct:"text/html",body:!0,content:{_content:t[1]??""}},{ct:"text/plain",content:{_content:t[0]??""}}]}:{ct:"text/plain",body:!0,content:{_content:t[0]??""}}]}},x=(e,t)=>`<html><style>p {margin: 0};</style><body><div style="font-family: ${t?.font}; font-size: ${t?.fontSize}; color: ${t?.color}">${e}</div></body></html>`,C=({data:e,style:t})=>{const n=((e,t)=>{const n=(new DOMParser).parseFromString(e,"text/html"),a=n.getElementsByTagName("img");return a&&(0,r.forEach)(a,(e=>{if(e.hasAttribute("src")&&e.getAttribute("src")?.includes("/service/home")){const n=((e,t)=>{const n=(0,r.find)(e,(e=>e.attach?.mp?.[0]?.part===t))?.ci;return`cid:${n}`})(t,e.getAttribute("src")?.split("&part=")[1]);e.setAttribute("src",n??"")}})),n.body.innerHTML})(e?.text?.[1],e?.inline);return e.richText?e?.inline&&e?.inline?.length>0?[{ct:"multipart/alternative",mp:[{ct:"text/plain",content:{_content:e?.text[0]??""}},{ct:"multipart/related",mp:[{ct:"text/html",content:{_content:x(n,t)??""}},...e.inline]}]}]:[{ct:"multipart/alternative",mp:[{ct:"text/html",body:!0,content:{_content:x(e?.text[1],t)??""}},{ct:"text/plain",content:{_content:e?.text[0]??""}}]}]:[{ct:"text/plain",body:!0,content:{_content:e?.text[0]??""}}]},_=(e,t)=>{const n={font:t?.zimbraPrefHtmlEditorDefaultFontFamily,fontSize:t?.zimbraPrefHtmlEditorDefaultFontSize,color:t?.zimbraPrefHtmlEditorDefaultFontColor},a=(0,m.AR)(e.identityId)?.fromAddress,i=(0,r.map)(e.recipients?e.recipients:(0,r.isEmpty)(e.sender)?[a,...e.to,...e.cc,...e.bcc]:[a,e.sender,...e.to,...e.cc,...e.bcc],(e=>({t:e.type,a:e.email??e.address,d:e.fullName??e.firstName??void 0})));return e.requestReadReceipt&&i.push({a:e?.sender?.email??a?.address,t:o.s.READ_RECEIPT_NOTIFICATION,d:a.fullName??a.firstName??void 0}),{autoSendTime:e.autoSendTime,did:e.did,id:e.id??void 0,attach:e.attach,su:{_content:e.subject??""},rt:e?.rt??void 0,origid:e?.origid??void 0,e:i,mp:C({data:e,style:n})}}},903:(e,t,n)=>{n.d(t,{hZ:()=>E});var a=n(7196),r=n(2575),i=n(3539),l=n(6424),o=n(5307),s=n(7995),c=n(5302),d=n(1347),m=n(7431),p=n(6505),u=n(5299),g=n(5740),h=n(5581);const f=/(^(re:\s)+)/i,b=/(^(fwd:\s)+)/i,w={to:`${(0,a.t)("label.to","To")}:`,from:`${(0,a.t)("label.from","From")}:`,cc:`${(0,a.t)("label.cc","CC")}:`,subject:`${(0,a.t)("label.subject","Subject")}:`,sent:`${(0,a.t)("label.sent","Sent")}:`},v=(e,t,n)=>{const o=(0,r.A)(),s=(0,l.oq)((0,i.yW)(t)),u={plainText:`\n\n${d.Vv.SIGNATURE_PRE_SEP}\n`,richText:`<p></p><div class="${d.Vv.SIGNATURE_CLASS}"></div>`},b=(0,c.cK)(),v=(0,p.Sq)(b,t),E=(0,p.qz)(),y=v.identityId?v.forwardReplySignatureId:E.forwardReplySignatureId,S=(0,g.gU)(u,y),A={plainText:`${S.plainText} ${(0,h.DV)(t,w)[0]}`,richText:(0,i.IY)(`${S.richText} ${(0,h.DV)(t,w)[1]}`,s)},T=(0,p.P8)(v.address)??m.WM,x="html"===(0,a.getUserSettings)().prefs?.zimbraPrefComposeFormat,C=n===m.F5.REPLY?(0,h.G3)(t):(0,h.A5)(t,T),_={action:m.F5.REPLY,identityId:v.identityId??E.id,sender:void 0,id:o,unsavedAttachments:[],savedAttachments:s,isRichText:x,isUrgent:t.urgent,recipients:{to:C,cc:n===m.F5.REPLY_ALL?(0,h.vG)(t,T):[],bcc:[]},subject:`RE: ${t.subject?t.subject.replace(f,""):""}`,text:A,requestReadReceipt:!1,replyType:"r",originalId:t.id,originalMessage:t,messagesStoreDispatch:e,size:t.size,totalSmartLinksSize:0};return _.draftSaveAllowedStatus=(0,l.SL)(_),_.sendAllowedStatus=(0,l.Ao)(_),_},E=({action:e,id:t,messagesStoreDispatch:n,message:f,compositionData:E})=>{switch(e){case m.F5.RESUME:if(!t)throw new Error("Cannot resume editor without an editor id");return(0,o.M8)({id:t});case m.F5.NEW:return(e=>{const t=(0,r.A)(),n={plainText:`\n\n${d.Vv.SIGNATURE_PRE_SEP}\n`,richText:`<p></p><div class="${d.Vv.SIGNATURE_CLASS}"></div>`},i=(0,p.qz)(),o=(0,g.gU)(n,i.defaultSignatureId),s="html"===(0,a.getUserSettings)().prefs?.zimbraPrefComposeFormat,c={action:m.F5.NEW,identityId:(0,p.qz)().id,id:t,unsavedAttachments:[],savedAttachments:[],isRichText:s,isUrgent:!1,recipients:{to:[],cc:[],bcc:[]},subject:"",text:o,requestReadReceipt:!1,messagesStoreDispatch:e,size:0,totalSmartLinksSize:0};return c.draftSaveAllowedStatus=(0,l.SL)(c),c.sendAllowedStatus=(0,l.Ao)(c),c})(n);case m.F5.REPLY:if(!t)throw new Error("Cannot generate a reply editor without a message id");if(f)return v(n,f,e);break;case m.F5.REPLY_ALL:if(!t)throw new Error("Cannot generate a reply all editor without a message id");if(f)return v(n,f,e);break;case m.F5.FORWARD:if(!t)throw new Error("Cannot generate a forward editor without a message id");if(f)return((e,t)=>{const n=(0,r.A)(),o=(0,i.yW)(t),s={plainText:`\n\n${d.Vv.SIGNATURE_PRE_SEP}\n`,richText:`<p></p><div class="${d.Vv.SIGNATURE_CLASS}"></div>`},u=(0,p.qz)(),f=(0,c.cK)(),v=(0,p.Sq)(f,t),E=v.identityId?v.forwardReplySignatureId:u.forwardReplySignatureId,y=(0,g.gU)(s,E),S={plainText:`${y.plainText} ${(0,h.DV)(t,w)[0]}`,richText:(0,i.IY)(`${y.richText} ${(0,h.DV)(t,w)[1]}`,o)},A="html"===(0,a.getUserSettings)().prefs?.zimbraPrefComposeFormat,T={action:m.F5.REPLY,identityId:v.identityId??u.id,id:n,unsavedAttachments:[],savedAttachments:o,isRichText:A,isUrgent:t.urgent,recipients:{to:[],cc:[],bcc:[]},subject:`FWD: ${t.subject?t.subject.replace(b,""):""}`,text:S,requestReadReceipt:!1,replyType:"w",originalId:t.id,originalMessage:t,messagesStoreDispatch:e,size:t.size,totalSmartLinksSize:0};return T.draftSaveAllowedStatus=(0,l.SL)(T),T.sendAllowedStatus=(0,l.Ao)(T),T})(n,f);break;case m.F5.EDIT_AS_DRAFT:if(!t)throw new Error("Cannot generate a draft editor without a message id");if(f)return((e,t)=>{const n=(0,r.A)(),o=(0,i.yW)(t),s={plainText:`${(0,h.i9)(t)[0]}`,richText:(0,i.IY)(`${(0,h.i9)(t)[1]}`,o)},c="html"===(0,a.getUserSettings)().prefs?.zimbraPrefComposeFormat,d=(0,u.B1)(t),g=d&&(0,p.I6)(d),f={action:m.F5.EDIT_AS_DRAFT,identityId:(g??(0,p.qz)()).id,id:n,unsavedAttachments:[],savedAttachments:o,isRichText:c,isUrgent:t.urgent,recipients:{to:(0,h.s5)(t),cc:(0,h.Qn)(t),bcc:(0,h.BR)(t)},subject:t.subject,text:s,requestReadReceipt:!1,did:t.id,messagesStoreDispatch:e,size:t.size,totalSmartLinksSize:0};return f.draftSaveAllowedStatus=(0,l.SL)(f),f.sendAllowedStatus=(0,l.Ao)(f),f})(n,f);break;case m.F5.EDIT_AS_NEW:if(!t)throw new Error("Cannot generate an edit as new editor without a message id");if(f)return((e,t)=>{const n=(0,r.A)(),o=(0,i.yW)(t),s={plainText:`${(0,h.i9)(t)[0]}`,richText:(0,i.IY)(`${(0,h.i9)(t)[1]}`,o)},c="html"===(0,a.getUserSettings)().prefs?.zimbraPrefComposeFormat,d=(0,u.B1)(t),g=d&&(0,p.I6)(d),f={action:m.F5.EDIT_AS_NEW,identityId:(g??(0,p.qz)()).id,id:n,unsavedAttachments:[],savedAttachments:(0,i.yW)(t),isRichText:c,isUrgent:t.urgent,recipients:{to:(0,h.s5)(t),cc:(0,h.Qn)(t),bcc:(0,h.BR)(t)},subject:t.subject,text:s,requestReadReceipt:!1,originalId:t.id,originalMessage:t,messagesStoreDispatch:e,size:t.size,totalSmartLinksSize:0};return f.draftSaveAllowedStatus=(0,l.SL)(f),f.sendAllowedStatus=(0,l.Ao)(f),f})(n,f);break;case m.F5.MAIL_TO:case m.F5.COMPOSE:case m.F5.PREFILL_COMPOSE:return((e,t)=>{const n=(0,r.A)(),i=t?.text?.[0]??`\n\n${d.Vv.SIGNATURE_PRE_SEP}\n`,o=t?.text?.[1]??`<p></p><div class="${d.Vv.SIGNATURE_CLASS}"></div>`,c=t?.recipients?t.recipients:(E=t?.to,E?E.map((e=>(e=>{const t=!("name"in(n=e)&&"email"in n&&"isOptional"in n&&"response"in n);var n;return{type:t&&e.type?e.type:s.s.TO,address:t&&e.address?e.address:e.email??"",name:e.name,fullName:t?e.fullName:e.name,email:e.email}})(e))):[]),u={plainText:i,richText:o},h="html"===(0,a.getUserSettings)().prefs?.zimbraPrefComposeFormat,f=(0,p.qz)(),b=(0,g.gU)(u,f.defaultSignatureId),w=t?.aid?t.aid.map((e=>({isInline:!1,aid:e,filename:"unnamed",size:0,contentType:"application/octet-stream"}))):[],v={action:m.F5.NEW,identityId:(0,p.qz)().id,id:n,unsavedAttachments:w,savedAttachments:[],isRichText:h,isUrgent:!1,recipients:{to:c??[],cc:[],bcc:[]},subject:t?.subject??"",text:b,requestReadReceipt:!1,messagesStoreDispatch:e,size:0,totalSmartLinksSize:0};var E;return v.draftSaveAllowedStatus=(0,l.SL)(v),v.sendAllowedStatus=(0,l.Ao)(v),v})(n,E);default:return null}return null}},5307:(e,t,n)=>{n.d(t,{T3:()=>a.T3,dL:()=>a.dL,M8:()=>a.M8,de:()=>I,rf:()=>d,fC:()=>h,v8:()=>g,YO:()=>m,v1:()=>l.v1,a:()=>l.a,KH:()=>f,sP:()=>p,kD:()=>b,Or:()=>w,ZJ:()=>S,Fj:()=>s,I4:()=>c,Ed:()=>u});var a=n(8772),r=n(7559),i=n(2864),l=n(2695),o=n(3472);const s=e=>{const{debouncedSaveDraft:t}=(0,l.dq)(),n=(0,o.T)((t=>t.editors[e].subject)),a=(0,o.T)((e=>e.setSubject));return(0,r.useMemo)((()=>({subject:n,setSubject:n=>{a(e,n),t(e)}})),[e,t,a,n])},c=e=>{const{debouncedSaveDraft:t}=(0,l.dq)(),n=(0,o.T)((t=>t.editors[e].text)),a=(0,o.T)((e=>e.setText)),i=(0,r.useCallback)((n=>{a(e,n),t(e)}),[e,t,a]),s=(0,r.useCallback)((()=>{a(e,{plainText:"",richText:""}),t(e)}),[e,t,a]);return(0,r.useMemo)((()=>({text:n,setText:i,resetText:s})),[s,i,n])},d=e=>{const{debouncedSaveDraft:t}=(0,l.dq)(),n=(0,o.T)((t=>t.editors[e].autoSendTime)),a=(0,o.T)((e=>e.setAutoSendTime));return(0,r.useMemo)((()=>({autoSendTime:n,setAutoSendTime:n=>{a(e,n),t(e)}})),[e,t,a,n])},m=e=>{const{debouncedSaveDraft:t}=(0,l.dq)(),n=(0,o.T)((t=>t.editors[e].did)),a=(0,o.T)((e=>e.setDid));return(0,r.useMemo)((()=>({did:n,setDid:n=>{a(e,n),t(e)}})),[e,t,a,n])},p=e=>{const{debouncedSaveDraft:t}=(0,l.dq)(),n=(0,o.T)((t=>t.editors[e].isRichText)),a=(0,o.T)((e=>e.setIsRichText));return(0,r.useMemo)((()=>({isRichText:n,setIsRichText:n=>{a(e,n),t(e)}})),[e,t,a,n])},u=e=>{const{debouncedSaveDraft:t}=(0,l.dq)(),n=(0,o.T)((t=>t.editors[e].recipients.to)),a=(0,o.T)((e=>e.setToRecipients));return(0,r.useMemo)((()=>({toRecipients:n,setToRecipients:n=>{a(e,n),(0,i.p)(e),t(e)}})),[e,t,a,n])},g=e=>{const{debouncedSaveDraft:t}=(0,l.dq)(),n=(0,o.T)((t=>t.editors[e].recipients.cc)),a=(0,o.T)((e=>e.setCcRecipients));return(0,r.useMemo)((()=>({ccRecipients:n,setCcRecipients:n=>{a(e,n),(0,i.p)(e),t(e)}})),[e,t,a,n])},h=e=>{const{debouncedSaveDraft:t}=(0,l.dq)(),n=(0,o.T)((t=>t.editors[e].recipients.bcc)),a=(0,o.T)((e=>e.setBccRecipients));return(0,r.useMemo)((()=>({bccRecipients:n,setBccRecipients:n=>{a(e,n),(0,i.p)(e),t(e)}})),[e,t,a,n])},f=e=>{const{debouncedSaveDraft:t}=(0,l.dq)(),n=(0,o.T)((t=>t.editors[e].identityId)),a=(0,o.T)((e=>e.setIdentityId));return(0,r.useMemo)((()=>({identityId:n,setIdentityId:n=>{a(e,n),(0,i.p)(e),t(e)}})),[e,t,a,n])},b=e=>{const{debouncedSaveDraft:t}=(0,l.dq)(),n=(0,o.T)((t=>t.editors[e].isUrgent)),a=(0,o.T)((e=>e.setIsUrgent));return(0,r.useMemo)((()=>({isUrgent:n,setIsUrgent:n=>{a(e,n),t(e)}})),[e,t,a,n])},w=e=>{const{debouncedSaveDraft:t}=(0,l.dq)(),n=(0,o.T)((t=>t.editors[e].requestReadReceipt)),a=(0,o.T)((e=>e.setRequestReadReceipt));return(0,r.useMemo)((()=>({requestReadReceipt:n,setRequestReadReceipt:n=>{a(e,n),t(e)}})),[e,t,a,n])};var v=n(7196),E=n(2509),y=n(2325);const S=e=>{const t=(0,o.T)((t=>t.editors[e].sendAllowedStatus)),n=(0,r.useCallback)((t=>((e,t)=>{const n=(0,a.M8)({id:e});if(!n)return console.warn("Cannot find the editor",e),{};if(!n.sendAllowedStatus?.allowed)return{};const r=(({secondsDelay:e,onTick:t,onCancel:n})=>{let a,r=e;const i=()=>{a&&(clearInterval(a),a=null,n&&n())};return{promise:new Promise((n=>{e<=0?n():a=setInterval((()=>{r>0?(r-=1,t&&t(r,i)):(a&&clearInterval(a),n())}),1e3)})),cancel:i}})({secondsDelay:(0,E.find)((0,v.getUserSettings)().props,["name","mails_snackbar_delay"])?._content??3,onTick:(e,n)=>{t?.onCountdownTick&&t?.onCountdownTick(e,n)},onCancel:()=>{o.T.getState().setSendProcessStatus(e,{status:"aborted",abortReason:(0,v.t)("messages.snackbar.message_sending_aborted","canceled by the user")}),(0,i.p)(e)}});return r.promise.then((()=>{n.messagesStoreDispatch((0,y.p)({editor:n})).then((n=>{if("rejected"===n.meta.requestStatus){const a=n.payload.reason;o.T.getState().setSendProcessStatus(e,{status:"aborted",abortReason:a}),(0,i.p)(e),t?.onError&&t.onError(a)}else o.T.getState().setSendProcessStatus(e,{status:"completed"}),(0,i.p)(e),t?.onComplete&&t.onComplete()})).catch((n=>{o.T.getState().setSendProcessStatus(e,{status:"aborted",abortReason:n}),(0,i.p)(e),t?.onError&&t.onError(n)}))})).catch((n=>{o.T.getState().setSendProcessStatus(e,{status:"aborted",abortReason:n}),(0,i.p)(e),t?.onError&&t.onError(n)})),o.T.getState().setSendProcessStatus(e,{status:"running",cancel:r.cancel}),(0,i.p)(e),{cancel:r.cancel}})(e,t)),[e]);return(0,r.useMemo)((()=>({status:t,send:n})),[n,t])};var A=n(7431),T=n(169),x=n(7625),C=n(8112),_=n(2575),R=n(6928);var k=n(3539),M=n(6424);const I=e=>{const{debouncedSaveDraft:t}=(0,l.dq)(),n=(()=>{const{createSnackbar:e}=(0,x.m)();return(0,r.useCallback)((t=>{e({key:"upload-error",replace:!0,type:"error",label:(0,v.t)("label.errors.upload_failed_generic",{filename:t.name,defaultValue:'Upload failed for the file "{{filename}}"'}),autoHideTimeout:A.fT.SNACKBAR_DEFAULT_TIMEOUT})}),[e])})(),s=(0,E.reject)((0,o.T)((t=>t.editors[e].unsavedAttachments)),"isInline"),c=(0,E.reject)((0,o.T)((t=>t.editors[e].savedAttachments)),"isInline"),d=(0,o.T)((e=>e.clearStandardAttachments)),m=(0,o.T)((e=>e.removeSavedAttachment)),p=(0,o.T)((e=>e.removeUnsavedAttachment)),u=(0,o.T)((e=>e.toggleSmartLink)),g=(t,a,r)=>{const l=((e,t)=>{const n=[],a=[],r=[],i=(e,i)=>{const l=(0,E.remove)(n,(t=>t===e))?.[0];l&&("completed"===i&&a.push(l),"error"===i&&r.push(l),0===n.length&&t?.onUploadsEnd&&t.onUploadsEnd(a,r))},l={...t,onUploadComplete:(e,n,a)=>{t?.onUploadComplete&&t.onUploadComplete(e,n,a),i(n,"completed")},onUploadError:(e,n,a)=>{t?.onUploadError&&t.onUploadError(e,n,a),i(n,"error")}},o=(0,E.map)(e,(e=>((e,t)=>{const n=(0,_.A)(),a=new AbortController;return C.A.post("/service/upload?fmt=extended,raw",e,{headers:{"Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest","Content-Type":`${e.type||"application/octet-stream"};`,"Content-Disposition":`attachment; filename="${(0,R.Ks)(e.name)}"`},onUploadProgress:a=>{const{loaded:r,total:i}=a,l=i?Math.round(100*r/i):0;l<100&&t?.onUploadProgress&&t?.onUploadProgress(e,n,l)},signal:a.signal}).then((e=>e.data)).then((e=>Function(`'use strict'; return ([${e}])`)())).then((a=>{a[2]?t?.onUploadComplete&&t?.onUploadComplete(e,n,a[2][0].aid):t?.onUploadError&&t?.onUploadError(e,n,"The upload process returned no aid")})).catch((a=>{t?.onUploadError&&t?.onUploadError(e,n,a)})),{file:e,uploadId:n,abortController:a}})(e,l)));return o.forEach((e=>{n.push(e.uploadId)})),o})(t,{onUploadProgress:(t,n,a)=>{(0,o.T.getState().setAttachmentUploadStatus)(e,n,{status:"running",progress:a}),r?.onUploadProgress&&r.onUploadProgress(t,n,a)},onUploadError:(t,a,l)=>{const s=o.T.getState().setAttachmentUploadStatus,c={status:"aborted",abortReason:l};n(t),s(e,a,c),(0,i.p)(e),r?.onUploadError&&r.onUploadError(t,a,l)},onUploadComplete:(t,n,a)=>{(0,o.T.getState().setAttachmentUploadCompleted)(e,n,a),(0,i.p)(e),r?.onUploadComplete&&r.onUploadComplete(t,n,a)},onUploadsEnd:(e,t)=>{r?.onUploadsEnd&&r.onUploadsEnd(e,t)}}),{addUnsavedAttachments:s}=o.T.getState(),c=l.map((({file:e,uploadId:t,abortController:n})=>{const r={filename:e.name,contentType:e.type,size:e.size,uploadId:t,isInline:a,uploadStatus:{status:"running",progress:0},uploadAbortController:n};return a&&(r.contentId=`${r.uploadId}@carbonio`),r}));return s(e,c),(0,i.p)(e),c},h=(n,r,i)=>{const l={...i,onUploadsEnd:(n,l)=>{const o=(0,a.M8)({id:e});if(o){const a=(0,M.AE)(o.unsavedAttachments,n),l=[];a.forEach((e=>{e.isInline===r&&e.contentId&&l.push(e.contentId)})),t(e,{onComplete:()=>{i?.onSaveComplete&&i.onSaveComplete(l)}})}i?.onUploadsEnd&&i.onUploadsEnd(n,l)}};return g(n,r,l)};return{hasStandardAttachments:s.length+c.length>0,unsavedStandardAttachments:s,savedStandardAttachments:c,removeUnsavedAttachment:n=>{p(e,n),(0,i.p)(e),t(e)},removeSavedAttachment:n=>{m(e,n),(0,i.p)(e),t(e)},removeStandardAttachments:()=>{d(e),(0,i.p)(e),t(e)},addStandardAttachments:(e,t)=>h(e,!1,t),addInlineAttachments:(t,n)=>{const r={...(0,E.omit)(n,"onSaveComplete"),onSaveComplete:t=>{const r=(0,a.M8)({id:e});if(!r)return void(n?.onSaveComplete&&n.onSaveComplete([]));const i=(0,M._3)(t,r.savedAttachments).map((e=>({contentId:e.contentId,cidUrl:e.contentId?(0,k.gc)(e.contentId)??void 0:void 0,downloadServiceUrl:(0,T.L)(e)})));n?.onSaveComplete&&n.onSaveComplete(i)}};return h(t,!0,r)},addUploadedAttachment:({attachmentId:n,fileName:a,contentType:r,size:l})=>(({attachmentId:n,fileName:a,contentType:r,size:l})=>{const{addUnsavedAttachments:s}=o.T.getState(),c={filename:a,contentType:r,size:l,aid:n,isInline:!1,uploadStatus:{status:"completed",progress:0}};return s(e,[c]),(0,i.p)(e),t(e),c})({attachmentId:n,fileName:a,contentType:r,size:l}),toggleSmartLink:t=>{u(e,t)}}}},2864:(e,t,n)=>{n.d(t,{p:()=>l});var a=n(8772),r=n(6424),i=n(3472);const l=e=>{const t=(0,a.M8)({id:e});t?(i.T.getState().setDraftSaveAllowedStatus(e,(0,r.SL)(t)),i.T.getState().setSendAllowedStatus(e,(0,r.Ao)(t))):console.warn("Cannot find the editor",e)}},8772:(e,t,n)=>{n.d(t,{M8:()=>r,T3:()=>i,dL:()=>l});var a=n(3472);const r=({id:e})=>a.T.getState()?.editors?.[e]??null,i=({id:e,editor:t})=>{a.T.getState().addEditor(e,t)},l=({id:e})=>a.T.getState().deleteEditor(e)},2695:(e,t,n)=>{n.d(t,{a:()=>f,dq:()=>g,v1:()=>h});var a=n(7559),r=n(2509),i=n(8153),l=n(2864),o=n(8772),s=n(7625),c=n(3661),d=n(9328),m=n(3539),p=n(3472),u=n(6992);const g=()=>{const{createSnackbar:e}=(0,s.m)(),[t]=(0,i.useTranslation)(),n=(0,a.useCallback)(((n,a)=>{const r=(0,o.M8)({id:n});if(!r)return void console.warn("Cannot find the editor",n);if(!r.draftSaveAllowedStatus?.allowed)return;const i=r=>{p.T.getState().setDraftSaveProcessStatus(n,{status:"aborted",abortReason:r}),e({key:"save-draft",replace:!0,type:"error",label:t("label.error_try_again","Something went wrong, please try again"),autoHideTimeout:3e3}),(0,l.p)(n),a?.onError&&a.onError(r)};(0,d.k)({editor:r}).then((e=>{if("Fault"in e)return void i(e.Fault.Detail?.Error?.Detail);if(!e.m)return void i(t("label.save_draft.incomplete_response","The save draft response is incomplete"));const o=(0,c.fD)(e.m[0]);p.T.getState().setDid(n,o.id),p.T.getState().setSize(n,o.size),p.T.getState().removeUnsavedAttachments(n);const s=(0,m.yW)(o);p.T.getState().setSavedAttachments(n,s),p.T.getState().setSavedAttachments(n,s),p.T.getState().setTotalSmartLinksSize(n),p.T.getState().setDraftSaveProcessStatus(n,{status:"completed",lastSaveTimestamp:new Date}),(0,l.p)(n),a?.onComplete&&a?.onComplete(),r.messagesStoreDispatch&&r.messagesStoreDispatch((0,d.v)(e))})).catch((e=>{p.T.getState().setDraftSaveProcessStatus(n,{status:"aborted",abortReason:e}),(0,l.p)(n),i(e),a?.onError&&a?.onError(e)})),p.T.getState().setDraftSaveProcessStatus(n,{status:"running"}),(0,l.p)(n)}),[e,t]),g=(0,u.mT)();return(0,a.useMemo)((()=>({debouncedSaveDraft:(0,r.debounce)(n,g),immediateSaveDraft:n})),[g,n])},h=e=>{const{immediateSaveDraft:t,debouncedSaveDraft:n}=g(),r=(0,p.T)((t=>t.editors[e].draftSaveAllowedStatus)),i=(0,a.useCallback)((()=>{n.cancel(),t(e)}),[n,e,t]);return(0,a.useMemo)((()=>({status:r,saveDraft:i})),[i,r])},f=e=>(0,p.T)((t=>t.editors[e].draftSaveProcessStatus))},8821:(e,t,n)=>{n.d(t,{Ed:()=>r.Ed,Fj:()=>r.Fj,I4:()=>r.I4,KH:()=>r.KH,M8:()=>r.M8,Or:()=>r.Or,T2:()=>a.T,T3:()=>r.T3,YO:()=>r.YO,ZJ:()=>r.ZJ,a:()=>r.a,dL:()=>r.dL,de:()=>r.de,fC:()=>r.fC,kD:()=>r.kD,rf:()=>r.rf,sP:()=>r.sP,v1:()=>r.v1,v8:()=>r.v8});var a=n(3472),r=n(5307)},6992:(e,t,n)=>{n.d(t,{mT:()=>o,qH:()=>l});var a=n(7196),r=n(2509),i=n(7431);const l=(e,t,n)=>{if(!e?.editors?.[t])return null;const a=(0,r.findIndex)(e.editors[t].unsavedAttachments,["uploadId",n]);return a<0?null:a};function o(){const e=i.fT.DRAFT_SAVE_DELAY,t=(0,a.getUserSettings)().prefs.zimbraPrefAutoSaveDraftInterval;return t&&"0"!==t?t.includes("s")?(t.replace("s",""),Math.min(1e3*parseInt(t,10),e)):t.includes("m")?(t.replace("m",""),Math.min(1e3*parseInt(t,10)*60,e)):i.fT.DRAFT_SAVE_DELAY:i.fT.DRAFT_SAVE_DELAY}},3472:(e,t,n)=>{n.d(t,{T:()=>s});var a=n(6535),r=n(2509),i=n(1621),l=n(6424),o=n(6992);const s=(0,i.vt)()((e=>({editors:{},addEditor:(t,n)=>{e((0,a.jM)((e=>{e.editors[t]=n})))},deleteEditor:t=>{e((0,a.jM)((e=>{delete e.editors[t]})))},setSubject:(t,n)=>{e((0,a.jM)((e=>{e?.editors?.[t]&&(e.editors[t].subject=n)})))},setText:(t,n)=>{e((0,a.jM)((e=>{e?.editors?.[t]&&(e.editors[t].text=n)})))},setAutoSendTime:(t,n)=>{e((0,a.jM)((e=>{e?.editors?.[t]&&(e.editors[t].autoSendTime=n)})))},setDid:(t,n)=>{e((0,a.jM)((e=>{e?.editors?.[t]&&(e.editors[t].did=n)})))},setSize:(t,n)=>{e((0,a.jM)((e=>{e?.editors?.[t]&&(e.editors[t].size=n)})))},setTotalSmartLinksSize:t=>{e((0,a.jM)((e=>{if(e?.editors?.[t]){const n=e?.editors?.[t],{savedAttachments:a}=n,r=a.reduce(((e,t)=>t.requiresSmartLinkConversion?e+t.size:e),0);n.totalSmartLinksSize=r}})))},setIsRichText:(t,n)=>{e((0,a.jM)((e=>{e?.editors?.[t]&&(e.editors[t].isRichText=n)})))},setOriginalId:(t,n)=>{e((0,a.jM)((e=>{e?.editors?.[t]&&(e.editors[t].originalId=n)})))},setRecipients:(t,n)=>{e((0,a.jM)((e=>{e?.editors?.[t]&&(e.editors[t].recipients=n)})))},setToRecipients:(t,n)=>{e((0,a.jM)((e=>{e?.editors?.[t]&&(e.editors[t].recipients.to=n)})))},setCcRecipients:(t,n)=>{e((0,a.jM)((e=>{e?.editors?.[t]&&(e.editors[t].recipients.cc=n)})))},setBccRecipients:(t,n)=>{e((0,a.jM)((e=>{e?.editors?.[t]&&(e.editors[t].recipients.bcc=n)})))},setIdentityId:(t,n)=>{e((0,a.jM)((e=>{e?.editors?.[t]&&(e.editors[t].identityId=n)})))},setIsUrgent:(t,n)=>{e((0,a.jM)((e=>{e?.editors?.[t]&&(e.editors[t].isUrgent=n)})))},setRequestReadReceipt:(t,n)=>{e((0,a.jM)((e=>{e?.editors?.[t]&&(e.editors[t].requestReadReceipt=n)})))},setDraftSaveAllowedStatus:(t,n)=>{e((0,a.jM)((e=>{e?.editors?.[t]&&(e.editors[t].draftSaveAllowedStatus=n)})))},setDraftSaveProcessStatus:(t,n)=>{e((0,a.jM)((e=>{e?.editors?.[t]&&(e.editors[t].draftSaveProcessStatus=n)})))},setSendAllowedStatus:(t,n)=>{e((0,a.jM)((e=>{e?.editors?.[t]&&(e.editors[t].sendAllowedStatus=n)})))},setSendProcessStatus:(t,n)=>{e((0,a.jM)((e=>{e?.editors?.[t]&&(e.editors[t].sendProcessStatus=n)})))},toggleSmartLink:(t,n)=>{e((0,a.jM)((e=>{const a=e?.editors?.[t];if(!a)return;const i=(0,r.find)(a.savedAttachments,["partName",n]);i&&(i.requiresSmartLinkConversion=!i.requiresSmartLinkConversion)})))},setSavedAttachments:(t,n)=>{e((0,a.jM)((e=>{e?.editors?.[t]&&(e.editors[t].savedAttachments=[...n])})))},removeSavedAttachment:(t,n)=>{e((0,a.jM)((e=>{e?.editors?.[t]&&(0,r.remove)(e.editors[t].savedAttachments,["partName",n])})))},removeUnsavedAttachments:t=>{e((0,a.jM)((e=>{e?.editors?.[t]&&(e.editors[t].unsavedAttachments=[])})))},addUnsavedAttachment:(t,n)=>{e((0,a.jM)((e=>{e?.editors?.[t]&&e.editors[t].unsavedAttachments.push(n)})))},addUnsavedAttachments:(t,n)=>{e((0,a.jM)((e=>{e?.editors?.[t]&&e.editors[t].unsavedAttachments.push(...n)})))},addSavedAttachment:(t,n)=>{e((0,a.jM)((e=>{e?.editors?.[t]&&e.editors[t].savedAttachments.push(n)})))},setAttachmentUploadStatus:(t,n,r)=>{e((0,a.jM)((e=>{const a=(0,o.qH)(e,t,n);null!==a&&(e.editors[t].unsavedAttachments[a].uploadStatus=r)})))},setAttachmentUploadCompleted:(t,n,r)=>{e((0,a.jM)((e=>{const a=(0,o.qH)(e,t,n);null!==a&&(e.editors[t].unsavedAttachments[a].aid=r,e.editors[t].unsavedAttachments[a].uploadStatus={status:"completed"})})))},removeUnsavedAttachment:(t,n)=>{e((0,a.jM)((e=>{e?.editors?.[t]&&(0,r.remove)(e.editors[t].unsavedAttachments,["uploadId",n])})))},clearStandardAttachments:t=>{e((0,a.jM)((e=>{e?.editors?.[t]&&(e.editors[t].savedAttachments=(0,l.oq)(e.editors[t].savedAttachments),e.editors[t].unsavedAttachments=(0,l.tl)(e.editors[t].unsavedAttachments))})))},setMessagesStoreDispatch:(t,n)=>{e((0,a.jM)((e=>{e?.editors?.[t]&&(e.editors[t].messagesStoreDispatch=n)})))}})))},578:(e,t,n)=>{n.d(t,{A:()=>p});var a=n(7559),r=n.n(a),i=n(4702),l=n(7196),o=n(9628),s=n(9902),c=n(8032),d=n(7625),m=n(7656);const p=({selectedIDs:e,isMessageView:t,deselectAll:n,onClose:p})=>{const u=(0,c.j)(),{createSnackbar:g}=(0,d.m)(),h=(0,a.useCallback)((()=>{u(t?(0,m.SU)({operation:"delete",ids:e}):(0,m.Rs)({operation:"delete",ids:e})).then((t=>{t.type.includes("fulfilled")?(n&&n(),g({key:`trash-${e}`,replace:!0,type:"info",label:(0,l.t)("label.email_perm_deleted","E-mail permanently deleted"),autoHideTimeout:3e3,hideButton:!0})):g({key:"edit",replace:!0,type:"error",label:(0,l.t)("label.error_try_again","Something went wrong, please try again"),autoHideTimeout:3e3}),p()}))}),[u,t,e,p,n,g]);return r().createElement(r().Fragment,null,r().createElement(i.Container,{padding:{all:"large"},mainAlignment:"center",crossAlignment:"flex-start",height:"fit"},r().createElement(s.A,{onClose:p,title:(0,l.t)("messages.permanent_delete_title","Are you sure to permanently delete this element?")}),r().createElement(i.Container,{padding:{all:"small"},mainAlignment:"center",crossAlignment:"flex-start",height:"fit"},r().createElement(i.Text,{overflow:"break-word"},(0,l.t)("messages.permanent_delete_body","If you permanently delete this element you will not be able to recover it. Continue?")),r().createElement(o.A,{onConfirm:h,label:(0,l.t)("label.delete_permanently","Delete permanently"),background:"error"}))))}},259:(e,t,n)=>{n.d(t,{W:()=>l});var a=n(7196);const r=n.p+"f568d7fc85121ed1c2c6.png",i=n.p+"4b45f003c31d38b483c8.png",l=`<!DOCTYPE html>\n<html>\n    <head>\n        <meta charset="UTF-8">\n        <title>${(0,a.t)("label.error","Error")}</title>\n        <style>\n            html, body, .container {\n                width: 100%;\n                height: 100%;\n                overflow: hidden;\n            }\n            body {\n                background-color: #ffffff;\n                color: #4d4d4d;\n                font-size: 0.8125rem;\n                font-family: Roboto, sans-serif;\n            }\n            .container {\n                display: flex;\n                flex-direction: column;\n                justify-content: center;\n                align-items: center;\n            }\n            .mainTextWrapper {\n                color: #2b73d2;\n                font-weight: 900;\n                font-size: 1.625rem;\n                line-height: 1.5rem;\n                margin-top: 1.875rem;\n            }\n            .errorWrapper {\n                display: flex;\n                flex-direction: row;\n                align-items: center;\n                margin: 1.4375rem 0 0.625rem;\n            }\n            .line {\n                height: 0.0625rem;\n                width: 6.25rem;\n                background-color: gray;\n            }\n            .errorCode {\n                color: #4d4d4d;\n                font-weight: 300;\n                font-size: 0.875rem;\n                line-height: 1.3125rem;\n                padding: 0 3.125rem;\n                text-transform: uppercase;\n            }\n            .customText {\n                margin: 0 0.3125rem 0 0;\n                color: #414141;\n            }\n            .needSupportText {\n                color: #414141;\n                font-size: 0.9375rem;\n            }\n            .poweredByZextras {\n                display: flex;\n                margin: 1.875rem 0 0 0;\n            }\n            .zextrasLogo {\n                top: 0.1875rem;\n                position: relative;\n            }\n            .productLogo {\n                height: 4.6875rem;\n                width: 35.25rem;\n            }\n        </style>\n    </head>\n    <body>\n        <div class="container">\n            <div class="productLogo" >\n                <img src=${r} width="564" height="75"/>\n            </div>\n            <div class="mainTextWrapper">\n            ${(0,a.t)("messages.could_not_find_to_show","Sorry, we couldnt find anything to show")}\n            </div>\n            <div class="errorWrapper">\n                <div class="line"></div>\n                <div class="errorCode"><p>${(0,a.t)("messages.something_went_wrong","SOMETHING WENT WRONG")}</p></div>\n                <div class="line"></div>\n            </div>\n            <p class="needSupportText">${(0,a.t)("messages.check_and_try_again","Please, check Carbonio and try again")}</p>\n            <div class="poweredByZextras">\n                <p class="customText">${(0,a.t)("messages.powered_by","powered by")}</p>\n                <div class="zextrasLogo">\n                    <img src=${i} height="10" width="63"/>\n                </div>\n            </div>\n        </div>\n    </body>\n</html>`},7634:(e,t,n)=>{n.d(t,{ZY:()=>q,s2:()=>F,jw:()=>z,Au:()=>I,p6:()=>O,zI:()=>L,Qb:()=>D,A2:()=>j,AI:()=>H,sC:()=>R,kD:()=>_,Su:()=>$,xW:()=>G,NZ:()=>W,y4:()=>P,JH:()=>U,LL:()=>V,nm:()=>N,$x:()=>B,s1:()=>k});var a=n(7559),r=n.n(a),i=n(4702),l=n(7196),o=n(2509),s=n(578),c=n(259),d=n(6784),m=n(9628),p=n(9902),u=n(7431),g=n(7625),h=n(7656);const f=({onClose:e,id:t})=>{const{createSnackbar:n}=(0,g.m)(),[s,c]=(0,l.useIntegratedComponent)("contact-input"),[d,f]=(0,a.useState)([]),b=(0,a.useCallback)((e=>{f(e.map((e=>({address:e.label,email:e.label}))))}),[]),w=(0,a.useCallback)((e=>f(e)),[]),v=(0,a.useMemo)((()=>0===d?.length||(0,o.some)(d,{error:!0})),[d]),E=(0,a.useCallback)((()=>{n({key:`redirect-${t}`,replace:!0,type:"error",label:(0,l.t)("label.error_try_again","Something went wrong, please try again"),autoHideTimeout:u.fT.REDIRECT})}),[n,t]),y=(0,a.useCallback)((()=>(0,h.Mq)({id:t,e:(0,o.map)(d,(e=>({a:e.email,t:"t"})))}).then((a=>{"Fault"in a?E():(n({key:`redirect-${t}`,replace:!0,type:"success",label:(0,l.t)("messages.snackbar.message_redirected","The message has been redirected"),autoHideTimeout:u.fT.REDIRECT}),e())})).catch((()=>{E()}))),[d,n,t,e,E]);return r().createElement(r().Fragment,null,r().createElement(i.Container,{padding:{all:"large"},mainAlignment:"center",crossAlignment:"flex-start",height:"fit"},r().createElement(p.A,{onClose:e,title:(0,l.t)("header.redirect_email","Redirect e-mail")}),r().createElement(i.Container,{padding:{top:"small",bottom:"small"},mainAlignment:"center",crossAlignment:"flex-start",height:"fit"},r().createElement(i.Container,null,r().createElement(i.Text,{overflow:"break-word"},r().createElement("em",null,(0,l.t)("messages.modal.redirect.first","This e-mail will be sent on to a new recipient while preserving the e-mail address of the original sender."))),r().createElement("br",null),r().createElement(i.Text,{overflow:"break-word"},r().createElement("em",null,(0,l.t)("messages.modal.redirect.second","The e-mail will appear as originally intended for the new recepient"))),r().createElement(i.Container,{height:"fit",padding:{top:"medium"}},c?r().createElement(s,{"data-testid":"redirect-recipients-address",placeholder:(0,l.t)("placeholder.add_new_recipients","Add new recipients"),onChange:w,defaultValue:d,disablePortal:!0}):r().createElement(i.ChipInput,{"data-testid":"redirect-recipients-address",placeholder:(0,l.t)("label.to","To"),onChange:b,defaultValue:d})),r().createElement(i.Divider,{color:"primary"}),r().createElement(m.A,{onConfirm:y,label:(0,l.t)("action.redirect","Redirect"),disabled:v})))))};var b=n(5302),w=n(2705),v=n(6505),E=n(643),y=n(5581);const S=e=>{const t=(0,E.cK)();return(0,v.Sq)(t,e)};var A=n(2325),T=n(8333),x=n(4602),C=n(6958);const _=({ids:e,value:t,dispatch:n,folderId:a,shouldReplaceHistory:r=!1,deselectAll:i})=>({id:(t?u.PA.MARK_AS_UNREAD:u.PA.MARK_AS_READ).id,icon:t?"EmailOutline":"EmailReadOutline",label:t?(0,l.t)("action.mark_as_unread","Mark as unread"):(0,l.t)("action.mark_as_read","Mark as read"),onClick:o=>{o&&o.preventDefault(),n((0,h.SU)({operation:(t?"!":"")+"read",ids:e})).then((e=>{i&&i(),e.type.includes("fulfilled")&&r&&(0,l.replaceHistory)(`/folder/${a}`)}))}});function R({ids:e,value:t,dispatch:n}){return{id:(t?u.PA.UNFLAG:u.PA.FLAG).id,icon:t?"Flag":"FlagOutline",label:t?(0,l.t)("action.unflag","Remove flag"):(0,l.t)("action.flag","Add flag"),onClick:a=>{a&&a.preventDefault(),n((0,h.SU)({operation:(t?"!":"")+"flag",ids:e}))}}}const k=()=>{const{createSnackbar:e}=(0,g.m)(),t=(0,a.useCallback)((({notCanceled:t,value:n,dispatch:a,ids:r,shouldReplaceHistory:i,folderId:o})=>{t&&a((0,h.SU)({operation:(n?"!":"")+"spam",ids:r})).then((t=>{t.type.includes("fulfilled")&&i&&(0,l.replaceHistory)(`/folder/${o}`),t.type.includes("fulfilled")||e({key:`trash-${r}`,replace:!0,type:"error",label:(0,l.t)("label.error_try_again","Something went wrong, please try again"),autoHideTimeout:3e3})}))}),[e]);return(0,a.useCallback)((({ids:n,value:a,dispatch:r,shouldReplaceHistory:i=!0,folderId:o})=>({id:(a?u.PA.MARK_AS_NOT_SPAM:u.PA.MARK_AS_SPAM).id,icon:a?"AlertCircleOutline":"AlertCircle",label:a?(0,l.t)("action.mark_as_non_spam","Not spam"):(0,l.t)("action.mark_as_spam","Mark as spam"),onClick:s=>{s&&s.preventDefault();let c=!0;((t=!1)=>{e({key:`trash-${n}`,replace:!0,type:"info",label:a?(0,l.t)("messages.snackbar.marked_as_non_spam","Youve marked this e-mail as Not Spam"):(0,l.t)("messages.snackbar.marked_as_spam","Youve marked this e-mail as Spam"),autoHideTimeout:u.fT.SET_AS_SPAM,hideButton:t,actionLabel:(0,l.t)("label.undo","Undo"),onActionClick:()=>{c=!1}})})(),setTimeout((()=>{t({notCanceled:c,value:a,dispatch:r,ids:n,shouldReplaceHistory:i,folderId:o})}),u.fT.SET_AS_SPAM)}})),[e,t])},M=(e,t,n,a,i)=>{a&&a({name:`message-${e}`,returnComponent:!1,children:r().createElement(x.I,{messageId:e,folderId:t,messageActions:i}),title:n,closeOnUnmount:!1})};function I(e,t,n,a,r){return{id:u.PA.PREVIEW_ON_SEPARATED_WINDOW.id,icon:"ExternalLink",label:(0,l.t)("action.preview_on_separated_tab","Open in a new tab"),onClick:()=>{M(e,t,n,a,r)}}}function O({message:e}){const t=(0,o.map)([e],(e=>({conversation:e.conversation,subject:e.subject})));return{id:u.PA.PRINT.id,icon:"PrinterOutline",label:(0,l.t)("action.print","Print"),onClick:()=>{const n=window.open("","_blank");(0,h.je)({ids:[e.id]}).then((e=>{const a=(0,w.w)({messages:e,conversations:t,isMsg:!0});n?.top&&(n.top.document.title="Carbonio",n.document.write(a))})).catch((()=>{n&&n.document.write(c.W)}))}}}function $({id:e}){return{id:u.PA.SHOW_SOURCE.id,icon:"CodeOutline",label:(0,l.t)("action.show_original","Show original"),onClick:t=>{t&&t.preventDefault(),window.open(`/service/home/~/?auth=co&view=text&id=${e}`,"_blank")}}}const N=()=>{const{createSnackbar:e}=(0,g.m)(),t=(()=>{const{createSnackbar:e}=(0,g.m)();return(0,a.useCallback)(((t,n,a,r,i)=>{((e,t,n)=>e((0,h.SU)({operation:"move",ids:t,parent:n})))(t,n,a).then((t=>{t.type.includes("fulfilled")?(r&&(0,l.replaceHistory)(i?`/folder/${a}/conversation/${i}`:`/folder/${a}/conversation/-${n[0]}`),e({key:`move-${n}`,replace:!0,type:"success",label:(0,l.t)("messages.snackbar.email_restored","E-mail restored in destination folder"),autoHideTimeout:3e3,hideButton:!0})):e({key:`move-${n}`,replace:!0,type:"error",label:(0,l.t)("label.error_try_again","Something went wrong, please try again"),autoHideTimeout:3e3,hideButton:!0})}))}),[e])})();return(0,a.useCallback)((({ids:n,dispatch:a,deselectAll:r,folderId:i=l.FOLDERS.INBOX,conversationId:o,closeEditor:s})=>({id:u.PA.MOVE_TO_TRASH.id,icon:"Trash2Outline",label:(0,l.t)("label.delete","Delete"),onClick:c=>{c&&c.preventDefault(),a((0,h.SU)({operation:"trash",ids:n})).then((c=>{c.type.includes("fulfilled")?(r&&r(),s&&(0,l.replaceHistory)(`/folder/${i}`),e({key:`trash-${n}`,replace:!0,type:"info",label:(0,l.t)("messages.snackbar.email_moved_to_trash","E-mail moved to Trash"),autoHideTimeout:5e3,hideButton:!1,actionLabel:(0,l.t)("label.undo","Undo"),onActionClick:()=>t(a,n,i,s,o)})):e({key:`trash-${n}`,replace:!0,type:"error",label:(0,l.t)("label.error_try_again","Something went wrong, please try again"),autoHideTimeout:3e3,hideButton:!0})}))}})),[e,t])},P=()=>{const{createSnackbar:e,createModal:t}=(0,g.m)();return(0,a.useCallback)((({ids:n,dispatch:a})=>({id:u.PA.DELETE.id,icon:"Trash2Outline",label:(0,l.t)("label.delete","Delete"),onClick:o=>{o&&o.preventDefault();const s=t({title:(0,l.t)("header.delete_email","Delete e-mail"),confirmLabel:(0,l.t)("action.ok","Ok"),onConfirm:()=>{a((0,h.SU)({operation:"delete",ids:n})).then((t=>{s(),t.type.includes("fulfilled")?e({key:`trash-${n}`,replace:!0,type:"info",label:(0,l.t)("messages.snackbar.message_deleted","Message deleted"),autoHideTimeout:3e3}):e({key:`trash-${n}`,replace:!0,type:"error",label:(0,l.t)("label.error_try_again","Something went wrong, please try again."),autoHideTimeout:3e3})}))},onClose:()=>{s()},onSecondaryAction:()=>{s()},dismissLabel:(0,l.t)("label.cancel","Cancel"),children:r().createElement(T.t,null,r().createElement(i.Text,{overflow:"break-word"},(0,l.t)("messages.modal.delete.sure_delete_email","Are you sure to delete the selected e-mail?")),r().createElement(i.Text,{overflow:"break-word"},(0,l.t)("messages.modal.delete.if_delete_lost_forever","If you delete the e-mail, it will be lost forever.")))})}})),[t,e])};function D({id:e}){return{id:u.PA.REPLY.id,icon:"UndoOutline",label:(0,l.t)("action.reply","Reply"),onClick:t=>{t&&t.preventDefault(),(0,l.addBoard)({url:`${u.lU}/edit?action=${u.F5.REPLY}&id=${e}`,title:""})}}}function L({id:e}){return{id:u.PA.REPLY_ALL.id,icon:"ReplyAll",label:(0,l.t)("action.reply_all","Reply all"),onClick:t=>{t&&t.preventDefault(),(0,l.addBoard)({url:`${u.lU}/edit?action=${u.F5.REPLY_ALL}&id=${e}`,title:""})}}}function z({id:e}){return{id:u.PA.FORWARD.id,icon:"Forward",label:(0,l.t)("action.forward","Forward"),onClick:t=>{t&&t.preventDefault(),(0,l.addBoard)({url:`${u.lU}/edit?action=${u.F5.FORWARD}&id=${e}`,title:""})}}}function F({id:e}){return{id:u.PA.EDIT_AS_NEW.id,icon:"Edit2Outline",label:(0,l.t)("action.edit_as_new","Edit as new"),onClick:t=>{t&&t.preventDefault(),(0,l.addBoard)({url:`${u.lU}/edit?action=${u.F5.EDIT_AS_NEW}&id=${e}`,title:""})}}}const U=()=>{const{createModal:e}=(0,g.m)();return(0,a.useCallback)((({id:t,folderId:n,message:a})=>({id:u.PA.EDIT_DRAFT.id,icon:"Edit2Outline",label:(0,l.t)("label.edit","Edit"),onClick:n=>{if(n&&n.preventDefault(),a?.isScheduled){const n=e({title:(0,l.t)("label.warning","Warning"),confirmLabel:(0,l.t)("action.edit_anyway","Edit anyway"),onConfirm:()=>{n(),(0,l.addBoard)({url:`${u.lU}/edit?action=${u.F5.EDIT_AS_DRAFT}&id=${t}`,title:""})},onClose:()=>{n()},showCloseIcon:!0,children:r().createElement(T.t,null,r().createElement(i.Text,{overflow:"break-word"},(0,l.t)("messages.edit_schedule_warning","By editing this e-mail, the time and date previously set for delayed sending will be reset.")))})}else(0,l.addBoard)({url:`${u.lU}/edit?action=${u.F5.EDIT_AS_DRAFT}&id=${t}`,title:""})}})),[e])};function j({message:e,dispatch:t}){return{id:u.PA.SEND.id,icon:"PaperPlaneOutline",label:(0,l.t)("label.send","Send"),onClick:n=>{n&&n.preventDefault(),t((0,A.s)({msg:e})).then().catch()}}}function H({generateEditorFunction:e,dispatch:t}){return{id:u.PA.SEND.id,icon:"PaperPlaneOutline",label:(0,l.t)("label.send","Send"),onClick:async n=>{n&&n.preventDefault(),e().then((e=>t((0,A.p)({editor:e})))).then().catch(o.noop)}}}const B=()=>{const{createModal:e}=(0,g.m)();return(0,a.useCallback)((({id:t})=>({id:u.PA.REDIRECT.id,icon:"CornerUpRight",label:(0,l.t)("action.redirect","Redirect"),onClick:n=>{n&&n.preventDefault();const a=e({maxHeight:"90vh",children:r().createElement(T.t,null,r().createElement(f,{onClose:()=>a(),id:t}))},!0)}})),[e])},V=()=>{const{createModal:e}=(0,g.m)();return(0,a.useCallback)((({id:t,dispatch:n,isRestore:a,deselectAll:i,folderId:s})=>({id:(a?u.PA.RESTORE:u.PA.MOVE).id,icon:a?"RestoreOutline":"MoveOutline",label:a?(0,l.t)("label.restore","Restore"):(0,l.t)("label.move","Move"),onClick:()=>{const l=e({maxHeight:"90vh",size:"medium",children:r().createElement(T.t,null,r().createElement(d.A,{folderId:s??"",selectedIDs:[t],onClose:()=>l(),isMessageView:!0,isRestore:a??!1,deselectAll:i??o.noop,dispatch:n}))},!0)}})),[e])},W=()=>{const{createModal:e}=(0,g.m)();return(0,a.useCallback)((({ids:t,deselectAll:n})=>({id:u.PA.DELETE_PERMANENTLY.id,icon:"DeletePermanentlyOutline",label:(0,l.t)("label.delete_permanently","Delete Permanently"),onClick:()=>{const a=e({children:r().createElement(T.t,null,r().createElement(s.A,{selectedIDs:t,isMessageView:!0,onClose:()=>a(),deselectAll:n||(()=>null)}))},!0)}})),[e])};function q({id:e}){return{id:u.PA.DOWNLOAD_EML.id,icon:"DownloadOutline",label:(0,l.t)("action.download_eml","Download EML"),onClick:t=>{t?.preventDefault();const n=document.createElement("a");n.download=`${e}.eml`,n.href=`${(0,C.IU)()}/service/home/~/?auth=co&id=${e}`,n.click(),n.remove()}}}const G=()=>{const e=(0,i.useSnackbar)();return(0,a.useCallback)((({item:t,openAppointmentComposer:n})=>({id:u.PA.CREATE_APPOINTMENT.id,icon:"CalendarModOutline",label:(0,l.t)("action.create_appointment","Create Appointment"),onClick:a=>{a?.preventDefault();const r=(e=>{const t=S(e),n=(0,v.P8)(t.address)??u.WM;return(0,y.A5)(e,n).map((({address:e})=>({email:e})))})(t),i=(e=>{const t=S(e),n=(0,v.P8)(t.address)??u.WM;return(0,y.vG)(e,n).map((({address:e})=>({email:e})))})(t),s=(0,b.Zn)(t.parent);let c=null,d=null;const m=(0,y.i9)(t)[1];if(s&&s?.isLink){const e=`${s.id.split(":")[0]}:${l.FOLDERS.CALENDAR}`;c={id:e,owner:s?.isLink&&s.owner},d=(e=>{if(!e)return null;const t=(0,v.vj)().find((t=>t.ownerAccount===e));return t?{address:t.ownerAccount,fullName:t.fromDisplay??t.identityName,identityName:t.identityName,label:t.identityName}:null})(s?.owner)}t?.isComplete?n({title:t.subject,isRichText:!0,richText:m,...(0,o.isNull)(c)?{}:{calendar:c},...(0,o.isNull)(d)?{}:{sender:d},attendees:r,optionalAttendees:i}):(0,h.y0)({msgId:t.id}).then((e=>{const t=(0,y.i9)(e)[1];n({title:e.subject,isRichText:!0,richText:t,...(0,o.isNull)(c)?{}:{calendar:c},...(0,o.isNull)(d)?{}:{sender:d},attendees:r,optionalAttendees:i})})).catch((()=>{e({key:"get-msg-on-new-appointment",replace:!0,type:"warning",hideButton:!0,label:(0,l.t)("message.snackbar.att_err","There seems to be a problem when saving, please try again"),autoHideTimeout:3e3})}))}})),[e])}},3011:(e,t,n)=>{n.d(t,{R1:()=>o,Qu:()=>l,Pc:()=>c});var a=n(2509),r=n(7196),i=n(3472);function l({folderId:e,isConversation:t,items:n}){return e||(t?n?.[0]?.messages?.[0]?.parent:n?.[0]?.parent)}const o=(e,t)=>{if(e&&e.length)return(0,a.find)(e,["id",t])},s=({smartLink:e,filename:t})=>`<a style='background-color: #D3EBF8;\npadding: 11px 16px;\ncolor: #2B73D2;\ndisplay: inline-block;\nmargin-top: 5px;\nmax-width: 80%;\nborder-radius: 5px;'\n href='${e.publicUrl}' download>${(0,a.truncate)(t??e.publicUrl,{length:76,omission:"..."})}</a>`;async function c({createSnackbar:e,t,editorId:n}){const a=i.T.getState().editors[n].savedAttachments,l=a.filter((e=>e.requiresSmartLinkConversion)).map((e=>({draftId:e.messageId,partName:e.partName})));try{const e=await async function(e){return(0,r.soapFetch)("CreateSmartLinks",{_jsns:"urn:zimbraMail",attachments:e}).then((e=>"Fault"in e?Promise.reject(e.Fault):e))}(l),{text:t}=i.T.getState().editors[n],o=function({response:e,text:t,attachments:n}){return{plainText:t.plainText.concat(e.smartLinks.map((e=>e.publicUrl)).join("\n")),richText:t.richText.concat(` ${e.smartLinks.map(((e,t)=>s({smartLink:e,filename:n[t]?.filename}))).join("<br/>")}`)}}({response:e,text:t,attachments:a.filter((e=>e.requiresSmartLinkConversion))});i.T.getState().setText(n,o);const{removeSavedAttachment:c}=i.T.getState();l.forEach((e=>{c(n,e.partName)}))}catch(n){throw e({key:"save-draft",replace:!0,type:"error",label:t("label.error_try_again","Something went wrong, please try again"),autoHideTimeout:3e3}),n}}},4602:(e,t,n)=>{n.d(t,{I:()=>g});var a=n(7559),r=n.n(a),i=n(4702),l=n(2509),o=n(7289),s=n(2863),c=n(7431),d=n(8032),m=n(7656),p=n(348),u=n(8350);const g=({folderId:e,messageId:t,messageActions:n})=>{const{isInsideExtraWindow:g}=(0,u.C)(),h=(0,d.j)(),f=n.some((e=>e.id===c.Nf))?n.filter((e=>e.id!==c.Nf)):(0,l.uniqBy)([...n[0],...n[1]],"id"),b=(0,d.G)((e=>(0,p.kp)(e,t)));return(0,a.useEffect)((()=>{b?.isComplete||h((0,m.qG)({msgId:t}))}),[h,e,b,t]),r().createElement(i.Container,{orientation:"vertical",mainAlignment:"flex-start",crossAlignment:"flex-start"},b&&r().createElement(r().Fragment,null,!g&&r().createElement(s.A,{item:b,folderId:e}),r().createElement(i.Container,{style:{overflowY:"auto"},height:"fill",background:"gray5",padding:{horizontal:"large",bottom:"small",top:"large"},mainAlignment:"flex-start"},r().createElement(i.Container,{height:"fit",mainAlignment:"flex-start",background:"gray5"},r().createElement(i.Padding,{bottom:"medium",width:"100%"},r().createElement(o.A,{message:b,expanded:!0,isAlone:!0,messageActions:f,isMessageView:!0,isInsideExtraWindow:g}))))))}},7289:(e,t,n)=>{n.d(t,{A:()=>Ae});var a=n(7559),r=n.n(a),i=n(4702),l=n(7196),o=n(2509),s=n(8698),c=n(6721),d=n(4710),m=n.n(d),p=n(9628),u=n(9902);const g=({onClose:e,onDownloadAndDelete:t,onDeleteAttachment:n})=>{const o=(0,a.useCallback)((()=>{e(),n()}),[e,n]),s=(0,a.useCallback)((()=>{e(),t()}),[e,t]);return r().createElement(r().Fragment,null,r().createElement(u.A,{onClose:e,title:(0,l.t)("header.warning","Warning")}),r().createElement(i.Container,{padding:{right:"large",top:"extrasmall"},crossAlignment:"flex-start"},r().createElement(i.Text,{overflow:"break-word"},(0,l.t)("message.delete_attachment_message1","Your attachment will be permanently deleted from Carbonio.")),r().createElement(i.Text,{overflow:"break-word",style:{textAlign:"left"}},(0,l.t)("message.delete_attachment_message2","Do you want to download it before?"))),r().createElement(p.A,{onConfirm:o,label:(0,l.t)("label.delete_permanently","Delete Permanently"),secondaryBtnType:"outlined",secondaryAction:s,secondaryLabel:(0,l.t)("label.download_and_delete","Download And Delete"),secondaryColor:"error",color:"error",paddingTop:"extrasmall"}))},h=e=>{if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return`${(e/1024**t).toFixed(2).toString()} ${["B","KB","MB","GB","TB"][t]}`},f=e=>e?.startsWith("image")&&!e?.includes("photoshop")?"image":(0,o.includes)(["text/vcard"],e)?"vcard":e?.endsWith("pdf")||(0,o.includes)(["text/csv","text/plain","application/msword","application/vnd.ms-excel","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.oasis.opendocument.text"],e)?"pdf":void 0;var b=n(6958),w=n(6928),v=n(169),E=n(8032),y=n(7625),S=n(7656),A=n(7585),T=n(8333),x=n(8350);const C=/\d+\.\d+\../,_=m()(i.Container).withConfig({displayName:"attachments-block__AttachmentHoverBarContainer",componentId:"sc-w0voss-0"})(["display:none;height:0;"]),R=m()(i.Container).attrs((e=>({requiresSmartLinkConversion:e.requiresSmartLinkConversion}))).withConfig({displayName:"attachments-block__AttachmentContainer",componentId:"sc-w0voss-1"})(["border-bottom:",";border-radius:0.125rem;width:calc(50% - 0.25rem);transition:0.2s ease-out;margin-bottom:",";&:hover{background-color:",";& ","{display:flex;}}&:focus{background-color:",";}cursor:pointer;"],(e=>e.requiresSmartLinkConversion?`1px solid ${e.theme.palette.primary.regular}`:"none"),(({theme:e})=>e.sizes.padding.small),(({theme:e,background:t="currentColor"})=>(0,i.getColor)(`${t}.hover`,e)),_,(({theme:e,background:t="currentColor"})=>(0,i.getColor)(`${t}.focus`,e))),k=m().a.withConfig({displayName:"attachments-block__AttachmentLink",componentId:"sc-w0voss-2"})(["margin-bottom:",";position:relative;text-decoration:none;"],(({theme:e})=>e.sizes.padding.small)),M=m()(i.Text).withConfig({displayName:"attachments-block__AttachmentExtension",componentId:"sc-w0voss-3"})(["display:flex;justify-content:center;align-items:center;width:2rem;height:2rem;border-radius:",";background-color:",";color:",";font-size:calc("," - 0.125rem);text-transform:uppercase;margin-right:",";"],(({theme:e})=>e.borderRadius),(({background:e})=>e),(({theme:e})=>e.palette.gray6.regular),(({theme:e})=>e.sizes.font.small),(({theme:e})=>e.sizes.padding.small)),I=({filename:e,size:t,link:n,downloadlink:o,message:s,isExternalMessage:d=!1,part:m,att:p,openEmlPreview:u})=>{const{createPreview:I}=(0,a.useContext)(c.PreviewsManagerContext),{isInsideExtraWindow:O}=(0,x.C)(),$=(0,w.QC)(p).value,{createSnackbar:N,createModal:P}=(0,y.m)(),D=(0,a.useRef)(null),L=(0,a.useRef)(null),z=(0,E.j)(),F=f(p.contentType),[U,j]=(0,l.useIntegratedFunction)("create_contact_from_vcard"),H=(0,a.useCallback)((()=>{D.current&&(L.current.value=null,D.current.click())}),[D]),B=(0,a.useCallback)((()=>{L.current&&L.current.click()}),[L]),V="EML"===$,W=V?(0,l.t)("action.click_open","Click to open"):(0,l.t)("action.click_preview","Click to preview"),q=(0,a.useCallback)((()=>{z((0,A.m)({id:s.id,attachments:[m]}))}),[z,s.id,m]),G=(0,a.useCallback)((()=>{H(),q()}),[H,q]),Y=(0,a.useCallback)((()=>{const e=P({maxHeight:"90vh",children:r().createElement(T.t,null,r().createElement(g,{onClose:()=>e(),onDownloadAndDelete:G,onDeleteAttachment:q}))},!0)}),[P,q,G]),K=(0,a.useCallback)((e=>{(0,l.soapFetch)("CopyToFiles",{_jsns:"urn:zimbraMail",mid:s.id,part:p.name,destinationFolderId:e[0].id}).then((e=>{N("Fault"in e?{key:"mail-moved-root",replace:!0,type:"warning",hideButton:!0,label:(0,l.t)("message.snackbar.att_err","There seems to be a problem when saving, please try again"),autoHideTimeout:3e3}:{key:"mail-moved-root",replace:!0,type:"info",hideButton:!0,label:(0,l.t)("message.snackbar.att_saved","Attachment saved in the selected folder"),autoHideTimeout:3e3})})).catch((()=>{N({key:"calendar-moved-root",replace:!0,type:"warning",hideButton:!0,label:(0,l.t)("message.snackbar.att_err","There seems to be a problem when saving, please try again"),autoHideTimeout:3e3})}))}),[p.name,N,s.id]),Z=(0,a.useCallback)((()=>{U({messageId:s.id,part:m})}),[U,s.id,m]),Q=(0,a.useCallback)((e=>e?.permissions?.can_write_file),[]),X=(0,a.useMemo)((()=>({title:(0,l.t)("label.select_folder","Select folder"),confirmAction:K,confirmLabel:(0,l.t)("label.save","Save"),disabledTooltip:(0,l.t)("label.invalid_destination","This node is not a valid destination"),allowFiles:!1,allowFolders:!0,isValidSelection:Q,canSelectOpenedFolder:!0,maxSelection:1})),[K,Q]),[J,ee]=(0,l.getIntegratedFunction)("select-nodes"),te=(0,a.useCallback)((()=>{(0,S.je)({ids:[s.id],part:p?.name}).then((e=>{u&&u(s.id,p?.name,e[0])})).catch((()=>{N({key:"eml-attachment-failed-download",replace:!0,type:"error",hideButton:!0,label:(0,l.t)("message.snackbar.eml_download_failed","The EML attachment could not be downloaded. Try later"),autoHideTimeout:3e3})}))}),[p?.name,N,s.id,u]),ne=(0,a.useCallback)((e=>{e.preventDefault();const t=f(p.contentType);"pdf"===t||"image"===t?"pdf"===t&&p.name.match(C)?B():I({src:n,previewType:t,closeAction:{id:"close",icon:"ArrowBack",tooltipLabel:(0,l.t)("preview.close","Close Preview")},actions:[{icon:"DownloadOutline",tooltipLabel:(0,l.t)("label.download","Download"),id:"DownloadOutline",onClick:H}],extension:p.filename.substring(p.filename.lastIndexOf(".")+1),filename:p.filename,size:h(p.size)}):V?te():L.current&&(L.current.value=null,L.current.click())}),[p.contentType,p.filename,p.name,p.size,B,I,H,V,n,te]),ae=(0,i.useTheme)(),re=!!p.requiresSmartLinkConversion,ie=(0,a.useMemo)((()=>h(t)),[t]),le=(0,a.useMemo)((()=>re?ae.palette.infoBanner.regular:"gray3"),[re,ae.palette.infoBanner.regular]),oe=(0,a.useMemo)((()=>re?r().createElement(i.Icon,{icon:"Link2Outline",size:"large",color:"primary"}):$),[$,re]),se=(0,v.zq)(p),ce=(0,a.useMemo)((()=>re?"transparent":se),[se,re]);return r().createElement(R,{orientation:"horizontal",mainAlignment:"flex-start",height:"fit",background:le,"data-testid":`attachment-container-${e}`,requiresSmartLinkConversion:re},r().createElement(i.Tooltip,{key:`${s.id}-Preview`,label:W},r().createElement(i.Row,{padding:{all:"small"},mainAlignment:"flex-start",onClick:ne,takeAvailableSpace:!0},r().createElement(M,{background:ce},oe),r().createElement(i.Row,{orientation:"vertical",crossAlignment:"flex-start",takeAvailableSpace:!0},re&&r().createElement(i.Padding,{top:"small"}),r().createElement(i.Padding,{style:{width:"100%"},bottom:"extrasmall"},r().createElement(i.Text,null,e||(0,l.t)("label.attachement_unknown",{mimeType:p?.contentType,defaultValue:"Unknown <{{mimeType}}>"}))),re?r().createElement(i.Padding,{top:"small"}):r().createElement(i.Text,{color:"gray1",size:"small"},ie)))),r().createElement(i.Row,{orientation:"horizontal",crossAlignment:"center"},r().createElement(_,{orientation:"horizontal"},ee&&!O&&r().createElement(i.Tooltip,{key:`${s.id}-DriveOutline`,label:O?(0,l.t)("label.extra_window.save_to_files_disabled","Files attachments saving is available only from the main tab"):(0,l.t)("label.save_to_files","Save to Files")},r().createElement(i.IconButton,{size:"medium",icon:"DriveOutline",onClick:()=>{J&&J(X)}})),r().createElement(i.Padding,{right:"small"},r().createElement(i.Tooltip,{key:`${s.id}-DownloadOutline`,label:(0,l.t)("label.download","Download")},r().createElement(i.IconButton,{"data-testid":`download-attachment-${e}`,size:"medium",icon:"DownloadOutline",onClick:H}))),!d&&r().createElement(i.Padding,{right:"small"},r().createElement(i.Tooltip,{key:`${s.id}-DeletePermanentlyOutline`,label:(0,l.t)("label.delete","Delete")},r().createElement(i.IconButton,{"data-testid":`remove-attachments-${e}`,size:"medium",icon:"DeletePermanentlyOutline",onClick:Y}))),j&&"vcard"===F&&r().createElement(i.Padding,{right:"small"},r().createElement(i.Tooltip,{key:`${s.id}-UploadOutline`,label:(0,l.t)("label.import_to_contacts","Import to Contacts")},r().createElement(i.IconButton,{"data-testid":`import-contacts-${e}`,size:"medium",icon:"UploadOutline",onClick:Z}))))),r().createElement(k,{rel:"noopener",ref:L,target:"_blank",href:`${(0,b.IU)()}/service/home/~/?auth=co&id=${s.id}&part=${m}`}),r().createElement(k,{ref:D,rel:"noopener",target:"_blank",href:o}))},O=({message:e,isExternalMessage:t=!1,openEmlPreview:n})=>{const{createSnackbar:s}=(0,y.m)(),[c,d]=(0,a.useState)(!1),m=(0,a.useMemo)((()=>(0,o.filter)(e?.attachments,{cd:"attachment"})),[e?.attachments]),p=(0,a.useMemo)((()=>m?.length||0),[m]),u=(0,a.useMemo)((()=>(0,o.map)(m,"name")),[m]),g=(0,i.useTheme)(),h=(0,a.useMemo)((()=>(0,b.Rb)({messageId:e.id,messageSubject:e.subject,attachments:u})),[e,u]),f=(0,a.useCallback)((t=>{const n=(0,o.map)(m,(n=>((e,t,n)=>(0,l.soapFetch)("CopyToFiles",{_jsns:"urn:zimbraMail",mid:t.id,part:e.name,destinationFolderId:n?.[0]?.id}))(n,e,t)));Promise.allSettled(n).then((e=>{const t=!(e.length===(0,o.filter)(e,(e=>e?.value?.Fault))?.length)&&e.length===(0,o.filter)(e,["status","fulfilled"])?.length,n=t?"info":"warning",a=(({allSuccess:e,allFails:t})=>e?(0,l.t)("message.snackbar.all_att_saved","Attachments successfully saved in the selected folder"):t?(0,l.t)("message.snackbar.att_err","There seems to be a problem when saving, please try again"):(0,l.t)("message.snackbar.some_att_fails","There seems to be a problem when saving some files, please try again"))({allSuccess:t,allFails:e.length===(0,o.filter)(e,["status","rejected"])?.length});s({key:"calendar-moved-root",replace:!0,type:n,hideButton:!0,label:a,autoHideTimeout:4e3})}))}),[m,s,e]),w=(0,a.useCallback)((e=>e?.permissions?.can_write_file),[]),v=(0,a.useMemo)((()=>({title:(0,l.t)("label.select_folder","Select folder"),confirmAction:f,confirmLabel:(0,l.t)("label.save","Save"),disabledTooltip:(0,l.t)("label.invalid_destination","This node is not a valid destination"),allowFiles:!1,allowFolders:!0,isValidSelection:w,canSelectOpenedFolder:!0,maxSelection:1})),[f,w]),[E,S]=(0,l.getIntegratedFunction)("select-nodes"),{isInsideExtraWindow:A}=(0,x.C)(),T=(0,a.useCallback)((()=>!S||A?null:r().createElement(i.Link,{size:"medium",onClick:()=>{E&&E(v)},style:{paddingLeft:"0.5rem"}},(0,l.t)("label.save_to_files","Save to Files"))),[v,A,S,E]),C=(0,l.t)("label.attachment",{count:p,defaultValue_one:"{{count}} attachment",defaultValue_other:"{{count}} attachments"});return p>0?r().createElement(i.Container,{crossAlignment:"flex-start"},r().createElement(i.Container,{orientation:"horizontal",mainAlignment:"space-between",wrap:"wrap"},(0,o.map)(c?m:m?.slice(0,2),((a,i)=>r().createElement(I,{key:`att-${a.filename}-${i}`,filename:a?.filename,size:a?.size??0,link:(0,b.h1)({messageId:e.id,messageSubject:e.subject,attachments:[a.name],attachmentType:a.contentType}),downloadlink:(0,b.Rb)({messageId:e.id,messageSubject:e.subject,attachments:[a.name]}),message:e,isExternalMessage:t,part:a?.name??"",iconColors:(0,b.bM)({attachments:m,theme:g}),att:a,openEmlPreview:n})))),r().createElement(i.Row,{mainAlignment:"flex-start",padding:{top:"extrasmall",bottom:"medium"}},r().createElement(i.Padding,{right:"small"},p>0&&p<=2&&r().createElement(i.Text,{color:"gray1"},C),p>2&&(c?r().createElement(i.Row,{"data-testid":"attachment-list-collapse-link",onClick:()=>d(!1),style:{cursor:"pointer"}},r().createElement(i.Padding,{right:"small"},r().createElement(i.Text,{color:"primary"},C)),r().createElement(i.Icon,{icon:"ArrowIosUpward",color:"primary"})):r().createElement(i.Row,{"data-testid":"attachment-list-expand-link",onClick:()=>d(!0),style:{cursor:"pointer"}},r().createElement(i.Padding,{right:"small"},r().createElement(i.Text,{color:"primary"},(0,l.t)("label.show_all_attachments",{count:p,defaultValue_one:"Show attachment",defaultValue_other:"Show all {{count}} attachments"}))),r().createElement(i.Icon,{icon:"ArrowIosDownward",color:"primary"})))," "),r().createElement(i.Link,{target:"_blank",size:"medium",href:h},(0,l.t)("label.download",{count:p,defaultValue_one:"Download",defaultValue_other:"Download all"})),T())):r().createElement(r().Fragment,null)};var $=n(4222),N=n.n($),P=n(960);function D(e){return e.split(" ").map((e=>(0,o.capitalize)(e))).join(" ")}const L=({contacts:e,label:t})=>{const{createSnackbar:n}=(0,y.m)();return r().createElement(r().Fragment,null,r().createElement(i.Row,{mainAlignment:"flex-start"},r().createElement(i.Text,{color:"secondary",size:"small",style:{paddingRight:"0.25rem"}},t)),r().createElement(i.Row,{mainAlignment:"flex-start",takeAvailableSpace:!0,height:"fit",orientation:"vertical",display:"flex",wrap:"nowrap",style:{lineHeight:"1.125rem",flexDirection:"row",overflow:"hidden"}},r().createElement(i.Container,{orientation:"horizontal",wrap:"wrap",mainAlignment:"flex-start",style:{gap:"0.5rem"}},(0,o.map)(e,((t,a)=>r().createElement(i.Row,{"data-testid":`chip-${t.address}`,key:a},r().createElement(i.Text,{color:"secondary",size:"small"},function(e){const t=e.fullName?D(e.fullName):null,n=e.name?D(e.name):null,a=t??n??"";return a.includes(",")?`"${a}"`:a}(t)),r().createElement(i.Padding,{right:"extrasmall"}),r().createElement(i.Chip,{label:t.address,background:"gray2",color:"text",actions:[{id:"action1",label:(0,l.t)("message.send_email","Send e-mail"),type:"button",icon:"EmailOutline",background:"gray3",onClick:()=>(e=>{const t={...e,type:"t"};(0,P.aF)([t])})(t)},{id:"action2",label:(0,l.t)("message.copy","Copy"),type:"button",icon:"Copy",background:"gray3",onClick:()=>((e,t)=>{navigator.clipboard.writeText(e).then((()=>{t({key:"clipboard-copy-success",replace:!0,type:"success",hideButton:!0,label:(0,l.t)("snackbar.email_copied_to_clipboard","Email copied to clipboard."),autoHideTimeout:3e3})}))})(t.address,n)}]}),a!==e.length-1&&r().createElement(i.Padding,{left:"extrasmall"},r().createElement(i.Text,{color:"secondary",size:"small"},","))))))))};var z=n(1347);const F=m()(i.Text).withConfig({displayName:"contact-names__ContactSubText",componentId:"sc-1nxw7sx-0"})(["padding:0 0.125rem;overflow:initial;&:not(:last-child){&:after{content:',';}}"]),U=({showOverflow:e,contacts:t,label:n})=>{const s=(0,l.useUserAccounts)(),c=(0,a.useRef)(null),[d,m]=(0,a.useState)(!1);return(0,a.useLayoutEffect)((()=>{if(c?.current?.clientWidth){const e=c?.current.scrollWidth>c?.current.clientWidth;m(e)}}),[e]),r().createElement(r().Fragment,null,r().createElement(i.Row,{mainAlignment:"flex-start"},r().createElement(i.Text,{color:"secondary",size:"small",style:{paddingRight:"0.25rem"}},n)),r().createElement(i.Row,{ref:c,mainAlignment:"flex-start",takeAvailableSpace:!0,height:"fit",orientation:"vertical",display:"flex",wrap:e?"nowrap":"wrap",style:{lineHeight:"1.125rem",flexDirection:"row",overflow:"hidden"}},(0,o.map)(t,((e,t)=>r().createElement(i.Tooltip,{label:e.address,key:t},r().createElement(F,{color:"secondary",size:"small"},(0,o.capitalize)((0,z.ef)(e,s))))))),d&&e&&r().createElement(i.Text,{color:"secondary",size:"small",style:{paddingLeft:"0.3125rem"}},"..."))};var j=n(5302),H=n(790);const B=({message:e,folderId:t,contactListExpandCB:n})=>{const[s,c]=(0,a.useState)(!1),d=(0,a.useCallback)((e=>{e.preventDefault(),c((e=>(n(!e),!e)))}),[n]),m=(0,j.Fi)(),p=(0,a.useMemo)((()=>(0,o.filter)(e.participants,["type","t"])),[e.participants]),u=(0,a.useMemo)((()=>(0,o.filter)(e.participants,["type","c"])),[e.participants]),g=(0,a.useMemo)((()=>(0,o.filter)(e.participants,["type","b"])),[e.participants]),h=(0,a.useMemo)((()=>void 0===e.read||e.read?{color:"text",weight:"regular",badge:"read",size:"small"}:{color:"primary",weight:"bold",badge:"unread",size:"medium"}),[e.read]),f=(0,a.useMemo)((()=>m[e.parent?.includes(":")?t:e.parent]),[t,m,e.parent]),b=(0,a.useMemo)((()=>`${(0,l.t)("label.to","To")}: `),[]),w=(0,a.useMemo)((()=>`${(0,l.t)("label.cc","CC")}: `),[]),v=(0,a.useMemo)((()=>`${(0,l.t)("label.bcc","BCC")}: `),[]),E=(0,a.useMemo)((()=>f?.name&&f?.id!==t),[t,f]),y=(0,a.useMemo)((()=>s?(0,l.t)("label.collapse_receivers_list","Collapse receiver's list"):(0,l.t)("label.expand_receivers_list","Expand receiver's list")),[s]),S=(0,a.useRef)(null),[A,T]=(0,a.useState)("100%");return(0,a.useLayoutEffect)((()=>{S?.current?.clientWidth&&T(`calc(100% - ${S.current.clientWidth+25}px)`)}),[]),r().createElement(i.Container,{crossAlignment:"flex-start",orientation:"horizontal",width:"100%",mainAlignment:"flex-start",padding:{bottom:"small"}},r().createElement(i.Container,{style:{width:"1.5625rem",padding:"0 0.5rem 0 0"},crossAlignment:"baseline",mainAlignment:"space-between",orientation:"horizontal"},r().createElement(i.Tooltip,{label:y},r().createElement(i.IconButton,{size:"small",icon:s?"ChevronUp":"ChevronDown",onClick:d,customSize:{iconSize:"small",paddingSize:""},"data-testid":"contacs-list-toggle-icon"}))),r().createElement(i.Container,{mainAlignment:"flex-start",crossAlignment:"flex-start",width:A},!s&&r().createElement(i.Container,{width:"calc(100% - 1.5rem)",crossAlignment:"flex-start"},r().createElement(i.Row,{height:"fit",crossAlignment:"flex-start",mainAlignment:"flex-start"},p.length>0&&r().createElement(U,{showOverflow:!0,contacts:p,label:b})),r().createElement(i.Row,{height:"fit",crossAlignment:"flex-start",mainAlignment:"flex-start"},u.length>0&&r().createElement(U,{showOverflow:!0,contacts:u,label:w})),r().createElement(i.Row,{height:"fit",width:"100%",crossAlignment:"flex-start",mainAlignment:"flex-start"},g.length>0&&r().createElement(U,{showOverflow:!0,contacts:g,label:v}))),s&&r().createElement(i.Container,{width:"calc(100% - 1.5rem)",crossAlignment:"flex-start"},r().createElement(i.Container,{width:"100%"},r().createElement(i.Row,{height:"fit",width:"100%",crossAlignment:"flex-start",mainAlignment:"flex-start",padding:{bottom:"small"}},p.length>0&&r().createElement(L,{contacts:p,label:b})),r().createElement(i.Row,{height:"fit",width:"100%",crossAlignment:"flex-start",mainAlignment:"flex-start",padding:{bottom:"small"}},u.length>0&&r().createElement(L,{contacts:u,label:w})),r().createElement(i.Row,{height:"fit",width:"100%",crossAlignment:"flex-start",mainAlignment:"flex-start"},g.length>0&&r().createElement(L,{contacts:g,label:v}))))),r().createElement(i.Container,{ref:S,width:"fit",mainAlignment:"flex-start"},e.urgent&&r().createElement(i.Icon,{"data-testid":"UrgentIcon",color:"error",icon:"ArrowUpward"}),E&&r().createElement(i.Padding,{left:"small"},r().createElement(i.Badge,{"data-testid":"FolderBadge",value:(0,H.k0)({folderId:t,folderName:f.name}),type:h.badge}))))},V=m().span.withConfig({displayName:"on-behalf-of-displayer__StyledText",componentId:"sc-qci8vl-0"})(["padding:0 0.125rem;color:",";font-weight:",";"],(({theme:e,color:t,isRead:n})=>t?(0,i.getColor)(t,e):n?e.palette.text.regular:e.palette.primary.regular),(({theme:e,isRead:t})=>t?e.fonts.weight.regular:e.fonts.weight.bold)),W=({compProps:{senderContact:e,mainContact:t,message:n}})=>{const[s,c]=(0,a.useMemo)((()=>[(0,o.capitalize)(t.fullName||t.name),t.address]),[t]),[d,m]=(0,a.useMemo)((()=>[(0,o.capitalize)(e.fullName),e.address]),[e]),p=(0,a.useMemo)((()=>(0,l.t)("label.behalf_of","behalf of")),[]);return r().createElement(i.TextWithTooltip,null,r().createElement(V,{isRead:n.read??""},d),r().createElement(V,{color:"secondary",isRead:n.read},` <${m}> `),r().createElement(V,{color:"text"},p),r().createElement(V,{isRead:n.read},s),r().createElement(V,{color:"secondary",isRead:n.read},` <${c}> `))};var q=n(7995),G=n(6505),Y=n(5581),K=n(9518);const Z=({actions:e,maxWidth:t="7.5rem",mainAlignment:n="flex-end"})=>{const{folderId:c}=(0,s.useParams)(),d=(0,a.useRef)(null),[m,p]=(0,a.useState)(!1),u=(0,a.useContext)(i.ThemeContext),g=(0,a.useMemo)((()=>(0,K.wL)(c).id===l.FOLDERS.TRASH?2:(0,K.wL)(c).id===l.FOLDERS.DRAFTS?4:6),[c]),[h,f]=((e,t)=>{const[n,r]=(0,a.useState)(0),{iconWidth:l,numberLimit:s}=t,c=(0,a.useContext)(i.ThemeContext),d=l??parseFloat(c.sizes.icon.large),m=(0,a.useCallback)((()=>{if(e&&e.current&&e?.current?.clientWidth>0){const t=Math.floor(e.current.clientWidth/d),n=s?(0,o.min)([t,s]):t;r(n)}}),[e,d,s]);return(0,a.useEffect)((()=>(window.addEventListener("resize",m),()=>window.removeEventListener("resize",m))),[m]),(0,a.useEffect)((()=>(window.addEventListener("transitionend",m),()=>window.removeEventListener("transitionend",m))),[m]),[n,m]})(d,{numberLimit:g}),b=(0,a.useMemo)((()=>(0,o.slice)(e,0,h>0&&e?.length>2?h-1:h)),[e,h]),w=(0,a.useMemo)((()=>(0,o.difference)(e,b)),[e,b]),v=(0,a.useMemo)((()=>u.sizes.icon.large),[u.sizes.icon.large]),E=(0,a.useCallback)((e=>{e.stopPropagation(),p((e=>!e))}),[]),y=(0,a.useCallback)((()=>{p(!1)}),[]),S=(0,a.useMemo)((()=>v&&g?`calc(${v} * ${g})`:t),[v,g,t]),A=(0,a.useMemo)((()=>(0,K.wL)(c).id===l.FOLDERS.TRASH?`calc(${v} * ${g})`:u.sizes.icon.large),[c,v,g,u?.sizes?.icon?.large]);return(0,a.useLayoutEffect)((()=>{f()}),[f]),r().createElement(i.Row,{ref:d,mainAlignment:n,maxWidth:S,wrap:"nowrap",style:{flexGrow:1,flexBasis:"fit-content",whiteSpace:"nowrap",overflow:"hidden",minWidth:A}},b?.length>0&&(0,o.map)(b,(e=>e.items?r().createElement(i.Padding,{right:"small"},r().createElement(i.Tooltip,{label:e.label},r().createElement(i.Dropdown,{items:e.items},r().createElement(i.IconButton,{icon:e.icon,size:"small",onClick:o.noop})))):r().createElement(i.Tooltip,{key:`${e.icon}`,label:e.label},r().createElement(i.IconButton,{size:"small",icon:e.icon,onClick:t=>{t&&t.preventDefault(),e.onClick()}})))),w?.length>0&&r().createElement(i.Dropdown,{items:w,forceOpen:m,onClose:y},r().createElement(i.IconButton,{size:"small",icon:"MoreVertical",onClick:E})))};var Q=n(1843);const X=m()(i.Container).withConfig({displayName:"preview-header__HoverContainer",componentId:"sc-1d95ipr-0"})(["cursor:pointer;border-radius:",";&:hover{background:",";}"],(({isExpanded:e})=>e?"0.25rem 0.25rem 0 0":"0.25rem"),(({theme:e,background:t="currentColor"})=>(0,i.getColor)(`${t}.hover`,e))),J=m()(i.Chip).withConfig({displayName:"preview-header__TagChip",componentId:"sc-1d95ipr-1"})(["margin-left:",";padding:0.0625rem 0.5rem !important;margin-bottom:0.25rem;"],(({theme:e})=>e.sizes.padding.extrasmall)),ee={type:q.s.FROM,address:"",displayName:(0,G.jq)(),fullName:""},te=({compProps:e,actions:t})=>{const{message:n,onClick:c,open:d,isExternalMessage:m}=e,p=(0,a.useRef)(null),u=(0,l.useUserAccounts)(),[g,h]=(0,a.useState)(""),[f,b]=(0,a.useState)(!1),w=(0,o.find)(n.participants,["type","f"])||ee,v=(0,a.useCallback)((e=>!e.isDefaultPrevented()&&c(e)),[c]),E=(0,Y.jz)(n,"attachment"),y=(0,o.find)(n.participants,["type","s"]),{folderId:S}=(0,s.useParams)(),A=(0,a.useCallback)((e=>{b(e)}),[]),T=(0,a.useContext)(i.ThemeContext),x=(0,a.useMemo)((()=>parseInt(T?.sizes.icon.large,10)),[T?.sizes?.icon?.large]);(0,a.useLayoutEffect)((()=>{let e=t.length>2?x:2*x;n.hasAttachment&&E.length>0&&(e+=x),n.flagged&&(e+=x),p?.current?.clientWidth&&(e+=p.current.clientWidth),h(`${e}px`)}),[t.length,E.length,x,n.hasAttachment,n.flagged,p?.current?.clientWidth]);const C=(0,l.useTags)(),_=(0,a.useMemo)((()=>(0,o.reduce)(C,((e,t)=>((0,o.includes)(n.tags,t.id)?e.push({...t,color:l.ZIMBRA_STANDARD_COLORS[t.color??0].hex,label:t.name,customComponent:r().createElement(i.Row,{takeAvailableSpace:!0,mainAlignment:"flex-start"},r().createElement(i.Row,{takeAvailableSpace:!0,mainAlignment:"space-between"},r().createElement(i.Row,{mainAlignment:"flex-end"},r().createElement(i.Padding,{right:"small"},r().createElement(i.Icon,{icon:"Tag",color:l.ZIMBRA_STANDARD_COLORS[t.color??0].hex}))),r().createElement(i.Row,{takeAvailableSpace:!0,mainAlignment:"flex-start"},r().createElement(i.Text,null,t.name))))}):n.tags?.length>0&&!(0,o.includes)(n.tags,t.id)&&(0,o.forEach)((0,o.filter)(n.tags,(e=>e?.includes("nil:"))),(t=>{e.push({id:t,name:t.split(":")[1],label:(0,l.t)("label.not_in_list",{name:t.split(":")[1],defaultValue:"{{name}} - Not in your tag list"}),color:l.ZIMBRA_STANDARD_COLORS[0].hex,customComponent:r().createElement(i.Row,{takeAvailableSpace:!0,mainAlignment:"flex-start"},r().createElement(i.Row,{takeAvailableSpace:!0,mainAlignment:"space-between"},r().createElement(i.Row,{mainAlignment:"flex-end"},r().createElement(i.Padding,{right:"small"},r().createElement(i.Icon,{icon:"Tag",color:l.ZIMBRA_STANDARD_COLORS[0].hex}))),r().createElement(i.Row,{takeAvailableSpace:!0,mainAlignment:"flex-start"},r().createElement(i.Text,null,(0,l.t)("label.not_in_list",{name:t.split(":")[1],defaultValue:"{{name}} - Not in your tag list"})))))})})),(0,o.uniqBy)(e,"id"))),[])),[n.tags,C]),R=(0,a.useMemo)((()=>_.length>1?"TagsMoreOutline":"Tag"),[_]),k=(0,a.useMemo)((()=>1===_?.length?_[0].color:void 0),[_]),M=(0,a.useMemo)((()=>(0,l.t)("label.tags","Tags")),[]),[I,O]=(0,a.useState)(!1),$=(0,a.useCallback)((e=>{e.stopPropagation(),O((e=>!e))}),[]),P=(0,a.useCallback)((()=>{O(!1)}),[]),D=(0,Q.nK)(_),F=(0,a.useMemo)((()=>n.tags?.length>1),[n]),U=(0,a.useMemo)((()=>n.tags&&0!==n.tags?.length&&!F&&D&&(0,o.every)(n.tags,(e=>""!==e))),[D,n.tags,F]),j=(0,a.useCallback)((e=>(0,l.runSearch)([{avatarBackground:e?.color||0,avatarIcon:"Tag",background:"gray2",hasAvatar:!0,isGeneric:!1,isQueryFilter:!0,label:`tag:${e?.name}`,value:`tag:"${e?.name}"`}],"mails")),[]),H=(0,a.useMemo)((()=>(0,l.t)("message.schedule_mail",{date:N()(n?.autoSendTime).format("DD/MM/YYYY"),time:N()(n?.autoSendTime).format("HH:mm"),defaultValue:"Will be sent on: {{date}} at {{time}}"})),[n?.autoSendTime]);return r().createElement(X,{height:"fit",mainAlignment:"flex-start",crossAlignment:"flex-start",background:"gray6",isExpanded:d,onClick:v},r().createElement(i.Container,{height:"fit",width:"100%"},r().createElement(i.Container,{orientation:"horizontal"},r().createElement(i.Container,{orientation:"vertical",width:"fit",mainAlignment:"flex-start",padding:{all:"small"}},r().createElement(i.Avatar,{label:w.fullName||w.address||(0,G.jq)(),colorLabel:w.address||(0,G.jq)(),size:"small"})),r().createElement(i.Row,{height:"fit",width:"calc(100% - 3rem)",padding:{vertical:"small"},takeAvailableSpace:!0},r().createElement(i.Container,{orientation:"horizontal",mainAlignment:"space-between",width:"fill"},r().createElement(i.Row,{style:{flexGrow:1,flexBasis:"fit-content",overflow:"hidden",whiteSpace:"nowrap"},mainAlignment:"flex-start",wrap:"nowrap"},(0,o.isEmpty)(y)?r().createElement(i.Row,{takeAvailableSpace:!0,width:"fit",mainAlignment:"flex-start",wrap:"nowrap"},r().createElement(i.Text,{"data-testid":"SenderText",size:n.read?"small":"medium",color:n.read?"text":"primary",weight:n.read?"regular":"bold"},(0,o.capitalize)((0,z.ef)(w,u))),r().createElement(i.Row,{takeAvailableSpace:!0,width:"fit",mainAlignment:"flex-start",wrap:"nowrap",padding:{left:"small"}},!f&&r().createElement(i.Text,{color:"gray1",size:n.read?"small":"medium"},w.address&&w.address),f&&w.address&&r().createElement(L,{contacts:[w],label:""}))):r().createElement(W,{compProps:{senderContact:y,message:n,mainContact:w}})),!m&&r().createElement(i.Row,{wrap:"nowrap",mainAlignment:"flex-end",style:{flexGrow:1,flexBasis:"fit-content",whiteSpace:"nowrap",overflow:"hidden"},minWidth:g},U&&r().createElement(i.Padding,{left:"small"},r().createElement(i.Tooltip,{label:n?.tags?.[0],disabled:F},r().createElement(i.Icon,{"data-testid":"TagIcon",icon:R,color:`${k}`}))),F&&r().createElement(i.Dropdown,{items:_,forceOpen:I,onClose:P},r().createElement(i.Padding,{left:"small"},r().createElement(i.IconButton,{"data-testid":"TagIcon",icon:R,onClick:$}))),n.hasAttachment&&E.length>0&&r().createElement(i.Padding,{left:"small"},r().createElement(i.Icon,{icon:"AttachOutline"})),n.flagged&&r().createElement(i.Padding,{left:"small"},r().createElement(i.Icon,{color:"error",icon:"Flag","data-testid":"FlagIcon"})),r().createElement(i.Row,{ref:p,minWidth:"fit",padding:{horizontal:"small"}},n?.isScheduled?r().createElement(i.Text,{color:"primary","data-testid":"scheduledLabel",size:"small"},H):r().createElement(i.Text,{color:"gray1","data-testid":"DateLabel",size:"extrasmall"},(0,z.oP)(n.date))),d&&r().createElement(Z,{actions:t}))))),!m&&_?.length>0&&d&&r().createElement(i.Container,{orientation:"horizontal",crossAlignment:"flex-start",mainAlignment:"flex-start",padding:{left:"large"}},r().createElement(i.Padding,{left:"extrasmall"},r().createElement(i.Text,{color:"secondary",size:"small",overflow:"break-word"},M,":",(0,o.map)(_,(e=>r().createElement(J,{label:e?.label,avatarBackground:e.color,background:"gray2",hasAvatar:!0,avatarIcon:"Tag",onClick:()=>j(e)}))))))),r().createElement(i.Container,{orientation:"horizontal",padding:{horizontal:"small"},mainAlignment:"flex-start"},!d&&r().createElement(i.Row,{padding:{bottom:"small"}},r().createElement(i.Text,{color:"secondary",size:"small"},n.fragment)),d&&r().createElement(B,{message:n,folderId:S,contactListExpandCB:A})))},ne=({open:e,onClose:t,message:n,readReceiptSetting:o})=>{const{createSnackbar:s}=(0,y.m)(),c=(0,E.j)(),d=(0,a.useMemo)((()=>(0,l.t)("label.read_receipt_req","Read receipt required")),[]),m=(0,a.useCallback)((()=>{c((0,S.SU)({operation:"update",ids:[n?.id],flag:"n"}))}),[c,n?.id]),g=(0,a.useCallback)((()=>{(async e=>await(0,l.soapFetch)("SendDeliveryReport",{mid:e,_jsns:"urn:zimbraMail"}))(n.id).then((()=>{s({key:"read-receipt-sent",replace:!0,hideButton:!0,type:"info",label:(0,l.t)("label.read_receipt_sent","A read receipt has been sent for this message"),autoHideTimeout:3e3})})),t()}),[s,n.id,t]);(0,a.useEffect)((()=>{n?.isReadReceiptRequested&&"always"===o&&!n?.isSentByMe&&g()}),[n?.isReadReceiptRequested,g,o,n?.isSentByMe]);const h=(0,a.useMemo)((()=>(0,l.t)("label.do_not_notify","Do not notify")),[]),f=(0,a.useMemo)((()=>(0,l.t)("label.notify","Notify")),[]),b=(0,a.useMemo)((()=>(0,l.t)("messages.read_receipt_1","The sender of this message has requested to be notified when you read this message.")),[]),w=(0,a.useMemo)((()=>(0,l.t)("messages.read_receipt_2","Do you wish to notify the sender?")),[]);return r().createElement(i.CustomModal,{open:e,onClose:()=>null,maxHeight:"90vh"},r().createElement(i.Container,{padding:{all:"large"}},r().createElement(u.A,{title:d}),r().createElement(i.Container,{crossAlignment:"flex-start"},r().createElement(i.Text,{overflow:"break-word"},b),r().createElement(i.Padding,{top:"large"},r().createElement(i.Text,null,w))),r().createElement(p.A,{onConfirm:g,secondaryAction:m,secondaryLabel:h,label:f,secondaryBtnType:"outlined",secondaryColor:"primary"})))};var ae=n(6961),re=n(7431);const ie=({label:e,icon:t,text:n})=>r().createElement(i.Row,{width:"fill",mainAlignment:"flex-start",padding:{horizontal:"small",bottom:"small"}},r().createElement(i.Row,{padding:{right:"small"}},r().createElement(i.Icon,{icon:t})),r().createElement(i.Row,{takeAvailableSpace:!0,mainAlignment:"flex-start",display:"flex"},r().createElement(i.Text,{overflow:"break-word",weight:"bold"},e),r().createElement(i.Text,{overflow:"break-word"},"",n)));var le=n(6279),oe=n(2940);const se=(0,oe.createAsyncThunk)("sendMsg",(async({data:e},{getState:t,dispatch:n})=>{const a=(0,Y.vC)(e);return{resp:await(0,l.soapFetch)("SendMsg",{_jsns:"urn:zimbraMail",m:a})}})),ce=(0,oe.createAsyncThunk)("calendar/mountSharedCalendar",(async(e,{getState:t})=>{const n={};n.mountSharedCalendarRequest=`<CreateMountpointRequest xmlns="urn:zimbraMail">\n        <link l="1" name="${e.calendarName}" zid="${e.zid}" rid="${e.rid}" view="${e.view}" color="${e.color}" f="#"/>\n        </CreateMountpointRequest>`;const a=await fetch("/service/soap/CreateMountpointRequest",{method:"POST",headers:{"content-type":"application/soap+xml"},body:`<?xml version="1.0" encoding="utf-8"?>\n\t\t\t<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">\n\t\t\t\t<soap:Header>\n\t\t\t\t\t<context xmlns="urn:zimbra">\n\t\t\t\t\t\t<account by="name">${e.accounts[0].name}</account>\n\t\t\t\t\t\t<format type="js"/>\n\t\t\t\t\t</context>\n\t\t\t\t</soap:Header>\n\t\t\t\t<soap:Body>\n\t\t\t\t\t${n.mountSharedCalendarRequest??""}\t\t\t\t\n\t\t\t\t</soap:Body>\n\t\t\t</soap:Envelope>\n\t\t`}),r=await a.json();if(r.Body.Fault)throw new Error(r.Body.Fault.Reason.Text);return{response:r}})),de=({dispatch:e,sharedCalendarName:t,owner:n,participants:a,grantee:r,customMessage:i,role:l,allowedActions:s,isAccepted:c})=>{const d=i?.length>0?i:"";return e(se({data:{attach:[{mp:[]}],subject:c?`Share Accepted: ${t} shared by ${n}`:`Share Declined: ${t} shared by ${n}`,participants:(0,o.map)(a,(e=>e.type===q.s.FROM?{...e,type:q.s.TO}:{...e,type:q.s.FROM})),text:[c?`Accepted: ${r} has accepted the sharing of "${t}"\n\n----------------------------------------------\n\nShared item: ${t}\nOwner: ${n}\nGrantee: ${r}\nRole: ${l}\nAllowed actions: ${s}\n*~*~*~*~*~*~*~*~*~*\n${d}`:`Declined: ${r} has declined the sharing of "${t}"\n\n----------------------------------------------\n\nShared item: ${t}\nOwner: ${n}\nGrantee: ${r}\nRole: ${l}\nAllowed actions: ${s}\n*~*~*~*~*~*~*~*~*~*\n${d}`]}}))};var me=n(2861);const pe=({dispatch:e,t,zid:n,view:s,rid:c,msgId:d,sharedCalendarName:m,grantee:p,owner:u,role:g,allowedActions:h,participants:f})=>{const[b,w]=(0,a.useState)(""),[v,E]=(0,a.useState)(!1),[A,T]=(0,a.useState)(m),[x,C]=(0,a.useState)("0"),_=(0,l.useUserAccounts)(),R=(0,l.useFoldersByView)(me.P6.appointment),k=(0,a.useMemo)((()=>(0,o.find)(R[0]?.children,(e=>e?.name.toLowerCase()===A.toLowerCase()))),[R,A]),M=(0,a.useMemo)((()=>!(0!==A.length&&!k)),[A,k]),I=(()=>{const{createSnackbar:e}=(0,y.m)(),t=(()=>{const{createSnackbar:e}=(0,y.m)();return(0,a.useCallback)((({msgId:t,dispatch:n,t:a})=>n((0,S.SU)({operation:"trash",ids:[t]})).then((t=>{t.type.includes("fulfilled")||e({key:"share",replace:!0,hideButton:!0,type:"error",label:a("label.error_try_again","Something went wrong, please try again"),autoHideTimeout:3e3})}))),[e])})();return(0,a.useCallback)((({zid:n,view:a,rid:r,calendarName:i,color:l,accounts:o,t:s,dispatch:c,msgId:d,sharedCalendarName:m,owner:p,participants:u,grantee:g,customMessage:h,role:f,allowedActions:b,notifyOrganizer:w})=>{(({zid:e,view:t,rid:n,calendarName:a,color:r,accounts:i,dispatch:l})=>l(ce({zid:e,view:t,rid:n,calendarName:a,color:r,accounts:i})))({zid:n,view:a,rid:r,calendarName:i,color:l,accounts:o,dispatch:c}).then((n=>{n.type.includes("fulfilled")?(w&&de({dispatch:c,sharedCalendarName:m,owner:p,participants:u,grantee:g,customMessage:h,role:f,allowedActions:b,isAccepted:!0}),t({msgId:d,dispatch:c,t:s}),e({key:"share_accepted",replace:!0,type:"info",label:s("message.snackbar.share.accepted","You have accepted the share request"),autoHideTimeout:3e3,hideButton:!0})):e({key:"share",replace:!0,type:"error",label:s("label.error_try_again","Something went wrong, please try again"),autoHideTimeout:3e3,hideButton:!0})}))}),[e,t])})(),O=(0,a.useCallback)((()=>I({zid:n,view:s,rid:c,calendarName:A,color:parseInt(x??"0",10),accounts:_,t,dispatch:e,msgId:d,sharedCalendarName:m,owner:u,participants:f,grantee:p,customMessage:b,role:g,allowedActions:h,notifyOrganizer:v})),[I,n,s,c,A,x,_,t,e,d,m,u,f,p,b,g,h,v]),$=(()=>{const{createSnackbar:e}=(0,y.m)();return(0,a.useCallback)((({dispatch:t,t:n,msgId:a,sharedCalendarName:r,owner:i,participants:l,grantee:o,customMessage:s,role:c,allowedActions:d,notifyOrganizer:m})=>t((0,S.SU)({operation:"trash",ids:[a]})).then((a=>{a.type.includes("fulfilled")?(m&&de({dispatch:t,sharedCalendarName:r,owner:i,participants:l,grantee:o,customMessage:s,role:c,allowedActions:d,isAccepted:!1}),e({key:"share_declined",replace:!0,type:"info",label:n("message.snackbar.share.declined","You have declined the share request"),autoHideTimeout:3e3,hideButton:!0})):e({key:"share",replace:!0,type:"error",label:n("label.error_try_again","Something went wrong, please try again"),autoHideTimeout:3e3,hideButton:!0})}))),[e])})(),N=(0,a.useCallback)((()=>{$({dispatch:e,t,msgId:d,sharedCalendarName:m,owner:u,participants:f,grantee:p,customMessage:b,role:g,allowedActions:h,notifyOrganizer:v})}),[$,e,t,d,m,u,f,p,b,g,h,v]);return r().createElement(r().Fragment,null,r().createElement(i.Row,{width:"100%",crossAlignment:"baseline",padding:{vertical:"small"}},r().createElement(i.Row,{width:"auto"},r().createElement(i.Padding,{right:"small"},r().createElement(i.Checkbox,{value:v,onClick:()=>E(!v),label:t("label.notify_organizer","Notify Organizer")}))),r().createElement(i.Row,{width:"80%",padding:{left:"small",vertical:"small"}},r().createElement(i.Input,{label:t("label.add_custom_message","Add a custom message"),value:b,onChange:e=>{w(e.target.value)},backgroundColor:"gray6",disabled:!v}))),r().createElement(i.Row,{width:"fill",mainAlignment:"space-around"},r().createElement(i.Row,{width:"50%",mainAlignment:"flex-start"},r().createElement(i.Input,{label:t("label.type_name_here","Item name"),backgroundColor:"gray5",value:A,hasError:M,onChange:e=>T(e.target.value)})),r().createElement(i.Row,{width:"50%",mainAlignment:"flex-start",padding:{horizontal:"small",vertical:"small"}},r().createElement(le.A,{onChange:e=>C(e),defaultColor:0,label:t("label.calendar_color","Item color")})),r().createElement(i.Row,{width:"100%",height:"1rem",mainAlignment:"flex-start",style:{marginBottom:"0.5rem"}},0===A.length&&r().createElement(i.Text,{size:"small",color:"error"},t("messages.enter_calendar_name","Enter a name to accept the calendar"))||k&&r().createElement(i.Text,{size:"small",color:"error"},t("messages.cal_name_exist_warning","A calendar with the same name already exists in this path")))),r().createElement(i.Divider,null),r().createElement(i.Row,{orientation:"horizontal",crossAlignment:"flex-start",mainAlignment:"center",height:"fit",padding:{all:"large"}},r().createElement(i.Button,{type:"outlined",label:t("label.accept","Accept"),icon:"Checkmark",onClick:O,disabled:M}),r().createElement(i.Padding,{horizontal:"small"}),r().createElement(i.Button,{color:"error",type:"outlined",label:t("label.decline","Decline"),icon:"CloseOutline",onClick:N}),r().createElement(i.Padding,{horizontal:"small"})))};var ue=n(612);const ge=m()(i.Container).withConfig({displayName:"shared-invite-reply__InviteContainer",componentId:"sc-4raa8i-0"})(["border:0.0625rem solid ",";border-radius:0.875rem;margin:",";"],(({theme:e})=>e.palette.gray2.regular),(({theme:e})=>e.sizes.padding.extrasmall)),he=({sharedContent:e,mailMsg:t,onLoadChange:n})=>{(0,a.useEffect)((()=>{"false"===t.read&&n&&n()}),[t.read,n]);const o=(0,E.j)(),s=(0,a.useMemo)((()=>e?.split("<link ")[1].split('perm="')[1].split('" ')[0]),[e]),c=(0,a.useMemo)((()=>(0,ue.kL)(l.t,s?.includes("p"))),[s]),d=(0,a.useMemo)((()=>(0,ue.E7)(c,s||"")),[c,s]),m=(0,a.useMemo)((()=>e?.split("<link ")[1]?.split('view="')[1]?.split('" ')[0]),[e]),p=(0,a.useMemo)((()=>e?.split("<grantor ")[1]?.split('id="')[1]?.split('"')[0]),[e]),u=(0,a.useMemo)((()=>e?.split("<link ")[1].split('id="')[1].split('" ')[0]?.split('"')[0]),[e]),g=(0,a.useMemo)((()=>t?.body?.content?.substring(Number(t?.body?.content?.lastIndexOf("<hr />"))+6).replace(/<p>/gi,"").replace(/<\/p>/gi,"")),[t?.body?.content]),[h,f]=(0,a.useMemo)((()=>{switch(m){case"message":return[(0,l.t)("label.mail_folder","Mail Folder"),"MailModOutline"];case"appointment":return[(0,l.t)("label.calendar","Calendar"),"CalendarOutline"];default:return[(0,l.t)("label.contact_folder","Contact Folder"),"ContactsModOutline"]}}),[m]),b=(0,a.useMemo)((()=>"rwidx"===s||"rwidxp"===s?(0,l.t)("message.manager_rights","View,Edit,Add,Remove"):"r"===s||"rp"===s?(0,l.t)("message.view_rights","View"):"rwidxa"===s||"rwidxap"===s?(0,l.t)("message.admin_rights","View,Edit,Add,Remove,Administer"):"None"),[s]),w=(0,a.useMemo)((()=>e?.split("<grantor ")[1]?.split('name="')[1]?.split('"')[0]),[e]),v=(0,a.useMemo)((()=>e?.split("<grantee ")[1]?.split('name="')[1]?.split('"')[0]),[e]),y=(0,a.useMemo)((()=>e?.split("<link ")[1]?.split('name="')[1]?.split('" ')[0]),[e]),[S,A]=(0,a.useState)(!1);return r().createElement(ge,null,r().createElement(i.Container,{padding:{top:"medium",horizontal:"large",bottom:"extrasmall"},width:"100%"},r().createElement(i.Row,{padding:{bottom:"medium"}},r().createElement(i.Icon,{icon:"ShareOutline",size:"large"}),r().createElement(i.Padding,{all:"extrasmall"}),r().createElement(i.Row,null,r().createElement(i.Text,{size:"large",weight:"bold"},`${w} ${(0,l.t)("label.would_like_to_share","shared its")}  ${h}`),r().createElement(i.Padding,{left:"small"},r().createElement(i.Text,{size:"large",weight:"bold",color:"primary"},`"${y}"`)),r().createElement(i.Padding,{left:"small"},r().createElement(i.Text,{size:"large",weight:"bold"},(0,l.t)("label.with_you","with you"))))),r().createElement(ie,{label:(0,l.t)("label.shared_item","Shared item"),icon:"InfoOutline",text:y}),r().createElement(ie,{label:(0,l.t)("label.owner","Owner: "),icon:"PersonOutline",text:w}),r().createElement(ie,{label:(0,l.t)("label.grantee","Grantee: "),icon:"StarOutline",text:v}),r().createElement(ie,{label:(0,l.t)("label.role","Role: "),icon:"ShieldOutline",text:d}),r().createElement(ie,{label:(0,l.t)("label.type","Type:"),icon:f,text:h}),r().createElement(ie,{label:(0,l.t)("label.allowed_actions","Allowed Actions : "),icon:"UnlockOutline",text:b}),r().createElement(r().Fragment,null,r().createElement(i.Container,null,r().createElement(i.Collapse,{orientation:"vertical",open:S,crossSize:"100%"},r().createElement(i.Container,{width:"100%",mainAlignment:"flex-start",crossAlignment:"flex-start",padding:{horizontal:"small",bottom:"small"}},r().createElement(i.Row,{padding:{right:"small"},mainAlignment:"flex-start",crossAlignment:"flex-start"},r().createElement(i.Row,{padding:{right:"small"}},r().createElement(i.Icon,{icon:"MessageSquareOutline"})),r().createElement(i.Row,{takeAvailableSpace:!0,mainAlignment:"flex-start",display:"flex"},r().createElement(i.Text,{overflow:"break-word",dangerouslySetInnerHTML:{__html:g}})))))),r().createElement(i.Row,{width:"fill",mainAlignment:"flex-start",padding:{all:"small",bottom:"medium"}},r().createElement(i.Button,{onClick:()=>A(!S),type:"outlined",size:"small",label:S?(0,l.t)("label.hide_more_info","Hide more information"):(0,l.t)("label.show_more_info","Show more information")}))),t.parent!==l.FOLDERS.TRASH&&t.parent!==l.FOLDERS.SENT&&"None"!==d&&r().createElement(r().Fragment,null,r().createElement(i.Divider,null),r().createElement(pe,{dispatch:o,t:l.t,zid:p,view:m,rid:u,msgId:t.id,sharedCalendarName:y,grantee:v,owner:w,role:d,allowedActions:b,participants:t.participants}))))};var fe=n(3011),be=n(8360);const[we,ve]=(0,l.getIntegratedComponent)("invites-reply"),Ee=({message:e,isMailPreviewOpen:t,isExternalMessage:n=!1,openEmlPreview:s,isInsideExtraWindow:c=!1})=>{const[d,m]=(0,a.useState)(!0),p=(0,E.j)(),u=(0,l.useUserAccounts)(),{prefs:g}=(0,l.useUserSettings)(),h=(0,a.useCallback)((()=>{p((0,S.SU)({operation:"trash",ids:[e.id]}))}),[e,p]);(0,a.useEffect)((()=>{e.isComplete||p((0,S.qG)({msgId:e.id}))}),[p,e.id,e.isComplete]);const f=(0,a.useMemo)((()=>e.isInvite&&e.invite?.[0]?.comp&&e.isInvite&&("REQUEST"===e.invite?.[0]?.comp[0].method||"COUNTER"===e.invite?.[0]?.comp[0].method)&&ve&&we),[e]),b=(0,a.useMemo)((()=>(0,o.find)(e?.participants,{type:q.s.READ_RECEIPT_NOTIFICATION})),[e?.participants]),w=(0,a.useMemo)((()=>g?.zimbraPrefMailSendReadReceipts),[g]),y=(0,a.useMemo)((()=>(!!b&&d&&e.isReadReceiptRequested&&!e?.isSentByMe&&"prompt"===w)??!1),[b,d,e,w]),A=(0,a.useMemo)((()=>e&&e?.shr&&e?.shr?.length>0&&e.fragment&&!e?.fragment.includes("revoked")&&!e?.fragment.includes("has accepted")&&!e?.fragment.includes("has declined")),[e]),T=(0,a.useCallback)((()=>{m(!1)}),[]),x=(0,a.useMemo)((()=>u[0]?.name),[u]),C=(0,a.useMemo)((()=>e.invite?.[0]?.comp?.[0]?.or?.a!==x),[x,e]),{inviteId:_,participationStatus:R}={inviteId:f?e.invite[0].comp[0].apptId?`${e.invite[0].comp[0].apptId}-${e.id}`:e.id:"",participationStatus:f&&e.invite[0].replies?e.invite[0].replies[0].reply[0].ptst:""},k=(0,a.useMemo)((()=>e.parts?(0,v.QX)(e.parts):[]),[e?.parts]),M=(0,a.useMemo)((()=>e?.participants),[e?.participants]);return r().createElement(i.Collapse,{open:t,crossSize:"100%",orientation:"vertical",disableTransition:!0,"data-testid":"MailMessageRendererCollapse"},e.isComplete&&r().createElement(i.Container,{"data-testid":"MessageBody",width:"100%",height:"fit",crossAlignment:"stretch",padding:c?{vertical:"small"}:{horizontal:"large",vertical:"small"},background:"gray6"},r().createElement(i.Row,null,r().createElement(O,{message:e,isExternalMessage:n,openEmlPreview:s})),r().createElement(i.Padding,{style:{width:"100%"},vertical:"medium"},f?r().createElement(i.Container,{width:"100%"},r().createElement(we,{onLoadChange:()=>null,mailMsg:e,inviteId:_,participationStatus:R,to:(0,o.filter)(e.participants,{type:"f"}),invite:e.invite,method:e.invite[0]?.comp[0].method,moveToTrash:h,isAttendee:C,parent:e.parent})):A?r().createElement(he,{sharedContent:e.shr[0].content,mailMsg:e}):r().createElement(ae.Ay,{parts:k,body:e.body,id:e.id,fragment:e.fragment,participants:M})),r().createElement(ne,{open:y,onClose:T,message:e,readReceiptSetting:w})))},ye=({message:e,open:t,onClick:n,messageActions:o,isExternalMessage:c=!1,isInsideExtraWindow:d=!1})=>{const{folderId:m}=(0,s.useParams)(),p=(0,a.useMemo)((()=>({message:e,onClick:n,open:t,isExternalMessage:c,isInsideExtraWindow:d})),[e,n,t,c,d]),u=(0,fe.R1)(o,re.PA.MARK_AS_NOT_SPAM.id);return r().createElement(r().Fragment,null,(0,K.wL)(m).id===l.FOLDERS.SPAM&&r().createElement(i.Container,{mainAlignment:"flex-start",crossAlignment:"flex-start",height:"fit",padding:{bottom:"medium"}},r().createElement(i.Container,{background:"gray6",orientation:"horizontal",padding:{all:"small"}},r().createElement(i.Row,{width:"50%",display:"flex",crossAlignment:"center",mainAlignment:"baseline"},r().createElement(i.Padding,{right:"small"},r().createElement(i.Icon,{icon:"AlertCircleOutline",size:"medium"})),r().createElement(i.Text,null,(0,l.t)("messages.snackbar.marked_as_spam","Youve marked this e-mail as Spam"))),r().createElement(i.Row,{width:"50%",mainAlignment:"flex-end"},r().createElement(i.Button,{type:"ghost",label:(0,l.t)("action.mark_as_non_spam","Not Spam"),color:"primary",onClick:u})))),e&&r().createElement(i.Row,{width:"fill"},r().createElement(te,{compProps:p,actions:o})),c&&r().createElement(i.Container,{background:"white",padding:{top:"large",bottom:"large"}},r().createElement(i.Row,{background:"gray2",width:"fill",padding:{all:"large"},mainAlignment:"flex-start"},r().createElement(i.Padding,{right:"large"},r().createElement(i.Icon,{icon:"AlertCircleOutline",size:"large"})),r().createElement(i.Text,null,(0,l.t)("label.attachments_disclaimer","You are viewing an attached message. The authenticity of the attached messages can not be verified."))),r().createElement(i.Divider,{color:"gray1"})))},Se=({message:e,expanded:t,messageActions:n,isAlone:l,isMessageView:o,isExternalMessage:s=!1,isInsideExtraWindow:c=!1})=>{const d=(0,a.useRef)(null),[m,p]=(0,a.useState)(t||l),{createWindow:u}=(0,be.k)(),g=(0,a.useCallback)((()=>{p((e=>!e))}),[]),h=(0,a.useMemo)((()=>!!o||!!l||m),[l,o,m]),f=(0,a.useCallback)(((e,t,a)=>{const i={name:`${e}-${t}`,returnComponent:!1,children:r().createElement(Se,{message:a,expanded:!1,isAlone:!0,messageActions:n,isMessageView:!0,isExternalMessage:!0,isInsideExtraWindow:!0}),title:a.subject,closeOnUnmount:!1};u&&u(i)}),[u,n]);return r().createElement(i.Container,{ref:d,height:"fit","data-testid":`MailPreview-${e.id}`,padding:c?{all:"large"}:void 0,background:"white"},r().createElement(ye,{onClick:g,message:e,open:h,messageActions:n,isExternalMessage:s,isInsideExtraWindow:c}),r().createElement(i.Container,{width:"fill",height:"fit",style:{overflowY:"auto"}},(m||l)&&r().createElement(Ee,{message:e,isMailPreviewOpen:h,openEmlPreview:f,isExternalMessage:s,isInsideExtraWindow:c})))},Ae=Se},2863:(e,t,n)=>{n.d(t,{A:()=>o});var a=n(7559),r=n.n(a),i=n(4702),l=n(7196);const o=({item:e,folderId:t})=>{const n=(0,a.useCallback)((()=>(0,l.replaceHistory)(`/folder/${t}`)),[t]),o=(0,a.useMemo)((()=>e?.subject||(0,l.t)("label.no_subject_with_tags","<No Subject>")),[e?.subject]);return r().createElement(r().Fragment,null,r().createElement(i.Container,{"data-testid":"PreviewPanelHeader",orientation:"horizontal",height:"3rem",background:"white",mainAlignment:"space-between",crossAlignment:"center",padding:{left:"large",right:"extrasmall"},style:{minHeight:"3rem"}},e?.read?r().createElement(i.Icon,{style:{width:"1.125rem"},icon:"EmailReadOutline","data-testid":"EmailReadIcon"}):r().createElement(i.Icon,{style:{width:"1.125rem"},icon:"EmailReadOutline","data-testid":"EmailUnreadIcon"}),r().createElement(i.Row,{mainAlignment:"flex-start",padding:{left:"large"},takeAvailableSpace:!0},r().createElement(i.Tooltip,{label:o},r().createElement(i.Text,{size:"medium","data-testid":"Subject",color:e?.subject?"text":"secondary"},o))),r().createElement(i.IconButton,{"data-testid":"PreviewPanelCloseIcon",icon:"CloseOutline",onClick:()=>{n()},customSize:{iconSize:"large",paddingSize:"small"}})),r().createElement(i.Divider,null))}},6958:(e,t,n)=>{n.d(t,{IU:()=>i,Rb:()=>o,bM:()=>s,h1:()=>l});var a=n(2509),r=n(6928);const i=()=>window.location.origin,l=({messageId:e,messageSubject:t,attachments:n,attachmentType:r})=>n.length>1?`${i()}/service/home/~/?auth=co&id=${e}&filename=${t}&charset=UTF-8&part=${n.join(",")}&disp=a&fmt=zip`:(0,a.includes)(["image/gif","image/png","image/jpeg","image/jpg"],r)?`${i()}/service/preview/image/${e}/${n[0]}/0x0/?quality=high`:(0,a.includes)(["application/pdf"],r)?`${i()}/service/preview/pdf/${e}/${n[0]}/?first_page=1`:(0,a.includes)(["text/csv","text/plain","application/msword","application/vnd.ms-excel","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.oasis.opendocument.text"],r)?`${i()}/service/preview/document/${e}/${n.join(",")}`:`${i()}/service/home/~/?auth=co&id=${e}&part=${n.join(",")}&disp=a`,o=({messageId:e,messageSubject:t,attachments:n})=>n?.length>1?`${i()}/service/home/~/?auth=co&id=${e}&filename=${t}&charset=UTF-8&part=${n.join(",")}&disp=a&fmt=zip`:`${i()}/service/home/~/?auth=co&id=${e}&part=${n?.join(",")}&disp=a`,s=({attachments:e,theme:t})=>(0,a.uniqBy)(e.map((e=>({extension:(0,r.QC)(e).value,color:(0,r.LY)(e.contentType??"",t)}))),"extension")},8350:(e,t,n)=>{n.d(t,{C:()=>l});var a=n(7559),r=n(8693),i=n(758);const l=()=>{const{getWindow:e}=(0,i.S)(),t=(0,a.useContext)(r.O);return t?{windowData:e&&e({windowId:t.windowId}),isInsideExtraWindow:!0}:{isInsideExtraWindow:!1}}}}]);
//# sourceMappingURL=282.45ab3521.chunk.js.map