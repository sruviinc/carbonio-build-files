(()=>{"use strict";const e="14";let i={};const r={},n={};let d;const t=e=>e.sort(((e,i)=>{const r=e.name.toLowerCase(),n=i.name.toLowerCase();return r<n?-1:r>n?1:0})),s=(e,r)=>{r.absFolderPath&&e.children.length&&e.children.forEach((e=>{const n=i[e.id];if(r.absFolderPath&&n.absFolderPath){const e=n.absFolderPath.split("/").slice(2);n.absFolderPath=`${r.absFolderPath}/${e.join("/")}`}n.children.length&&s(n,r)}))},l=({string:e})=>/#/.test(e||""),c=(e,i)=>e.id.split(":").includes(i),o=(e,i)=>({id:e.id,uuid:e.uuid,name:e.name,absFolderPath:e.absFolderPath,l:e.l,luuid:e.luuid,checked:l({string:e.f}),f:e.f,color:e.color||i?.color,rgb:e.rgb,u:e.u,i4u:e.i4u,view:e.view,rev:e.rev,ms:e.ms,md:e.md,n:e.n,i4n:e.i4n,s:e.s,i4ms:e.i4ms,i4next:e.i4next,url:e.url,activesyncdisabled:!!e.activesyncdisabled,webOfflineSyncDays:e.webOfflineSyncDays,perm:e.perm,recursive:!!e.recursive,rest:e.rest,deletable:!!e.deletable,meta:e.meta,acl:e.acl,retentionPolicy:e.retentionPolicy}),a=(e,i)=>({...o(e,i),owner:e.owner,zid:e.zid,rid:e.rid,ruuid:e.ruuid,oname:e.oname,reminder:!!e.reminder,broken:!!e.broken}),h=(e,i)=>{const n={...(d=e,{...o(d),query:d.query,sortBy:d.sortBy,types:d.types}),parent:i?.id,isLink:i?.isLink};var d;r[n.id]=n},f=(r,d,t)=>{const s={...a(r,t),isLink:!0,children:[],parent:t?.id,depth:d};i[r.id]=s;const l=(e=>e&&e.rid&&e.zid?`${e.zid}:${e.rid}`:null)(r);return l&&(n[l]=r.id),r?.folder?.forEach((i=>{if(!c(i,e)){const e=u(i,d+1,s);s.children.push(e)}})),r?.link?.forEach((i=>{if(!c(i,e)){const e=f(i,d+1,s);s.children.push(e)}})),r?.search?.forEach((e=>{h(e,s)})),s},u=(r,n,d)=>{const t={...o(r,d),isLink:!1,children:[],parent:d?.id,depth:n};return i[r.id]=t,r?.folder?.forEach((i=>{if(!c(i,e)){const e=u(i,n+1,t);c(i,"1")||t.children.push(e)}})),r?.link?.forEach((i=>{if(!c(i,e)){const e=f(i,n+1,t);c(i,"1")||t.children.push(e)}})),r?.search?.forEach((e=>{h(e,t)})),t};function p(e,i){return Object.keys(e).find((r=>i.id===`${e[r].zid}:${e[r].rid}`))}function m(e){if(!e)return!1;const r=i[e];return r?.parent?m(r?.parent):"USER_ROOT"===r?.name}const b=({data:e})=>{var n;"refresh"===e.op&&e.folder&&((e,i)=>{if(d=i,e.length>1){const i=e.slice(1);return[u(e[0],0),...i.map((e=>f(e,0)))]}u(e[0],0)})(e.folder,e.currentView),"notify"===e.op&&(n=e.notify,(n.created?.folder??[]).forEach((e=>{if(e.id&&e.l&&d&&e.view===d){const r=i[e.l],n={...o(e,r),isLink:!1,children:[],parent:r?.id,depth:r&&void 0!==r.depth?r.depth+1:0};i[e.id]=n,r.children.push(n),t(r.children)}})),(n.created?.link??[]).forEach((e=>{if(e.id&&e.l&&d&&e.view===d){const r=i[e.l],n={...a(e,r),isLink:!0,children:[],parent:r?.id,depth:r&&void 0!==r.depth?r.depth+1:0};i[e.id]=n,r.children.push(n),t(r.children)}})),[...n.modified?.folder??[],...n.modified?.link??[]].forEach((e=>{if(!e.id)return;const r=e.id.includes(":")?e.id:p(i,e),n=p(i,{id:e.l}),d=m(r),c=m(n)&&n?n:e.l,o=d&&r?r:e.id,a=o?i[o]:null;if(a){Object.assign(a,(({link:e,folder:i,search:r,...n})=>n)({...e,id:o})),s(a,e),void 0!==e.f&&(a.checked=l({string:e.f}));const r=a.parent;if(r){const n=i[r];if(n)if(e.l){const e=c?i[c]:null;e&&(n.children=n.children.filter((e=>e.id!==o)),e.children.push(a),t(e.children),a.parent=e.id,a.depth=void 0!==e?.depth?e.depth+1:0)}else n.children=n.children.map((i=>i.id!==e.id?i:a));i[o]=a}}})),(n.deleted??[]).forEach((e=>{const n=i[e];if(n){if(n.parent){const r=i[n.parent];r.children=r.children.filter((i=>i.id!==e))}delete i[e],delete r[e]}})))};onmessage=({data:e})=>{b({data:e}),postMessage({folders:i,linksIdMap:n,searches:r})}})();
//# sourceMappingURL=392.cd119972.chunk.js.map