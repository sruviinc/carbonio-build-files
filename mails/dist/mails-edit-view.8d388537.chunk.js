"use strict";(self.webpackChunkcarbonio_mails_ui=self.webpackChunkcarbonio_mails_ui||[]).push([[80],{6764:(e,t,a)=>{a.d(t,{D:()=>d});var n=a(4899),r=a(7559),o=a.n(r),l=a(4710),i=a.n(l);const c=(0,l.keyframes)(["from{transform:rotate(0deg);}to{transform:rotate(360deg);}"]),s=i().svg.withConfig({displayName:"animated-loader__AnimatedLoaderSvg",componentId:"sc-uv4h3o-0"})(["animation:"," 3s ease-in-out infinite normal forwards;"],c),d=e=>o().createElement(s,(0,n.A)({id:"e9AcbENh5Z71",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",shapeRendering:"geometricPrecision",textRendering:"geometricPrecision",fill:"currentColor"},e),o().createElement("g",{id:"e9AcbENh5Z72"},o().createElement("path",{id:"e9AcbENh5Z73",d:"M12,2C11.734800,2,11.480400,2.105360,11.292900,2.292890C11.105400,2.480430,11,2.734780,11,3L11,5C11,5.265220,11.105400,5.519570,11.292900,5.707110C11.480400,5.894640,11.734800,6,12,6C12.265200,6,12.519600,5.894640,12.707100,5.707110C12.894600,5.519570,13,5.265220,13,5L13,3C13,2.734780,12.894600,2.480430,12.707100,2.292890C12.519600,2.105360,12.265200,2,12,2L12,2Z",fill:"rgb(65,65,65)",stroke:"none",strokeWidth:"1"}),o().createElement("path",{id:"e9AcbENh5Z74",d:"M21,11L19,11C18.734800,11,18.480400,11.105400,18.292900,11.292900C18.105400,11.480400,18,11.734800,18,12C18,12.265200,18.105400,12.519600,18.292900,12.707100C18.480400,12.894600,18.734800,13,19,13L21,13C21.265200,13,21.519600,12.894600,21.707100,12.707100C21.894600,12.519600,22,12.265200,22,12C22,11.734800,21.894600,11.480400,21.707100,11.292900C21.519600,11.105400,21.265200,11,21,11Z",fill:"rgb(65,65,65)",stroke:"none",strokeWidth:"1"}),o().createElement("path",{id:"e9AcbENh5Z75",d:"M6,12C6,11.734800,5.894640,11.480400,5.707110,11.292900C5.519570,11.105400,5.265220,11,5,11L3,11C2.734780,11,2.480430,11.105400,2.292890,11.292900C2.105360,11.480400,2,11.734800,2,12C2,12.265200,2.105360,12.519600,2.292890,12.707100C2.480430,12.894600,2.734780,13,3,13L5,13C5.265220,13,5.519570,12.894600,5.707110,12.707100C5.894640,12.519600,6,12.265200,6,12Z",transform:"matrix(1 0 0 1 0.26234975000000 0)",fill:"rgb(65,65,65)",stroke:"none",strokeWidth:"1"}),o().createElement("path",{id:"e9AcbENh5Z76",d:"M6.220230,4.999950C6.025300,4.815620,5.765120,4.716280,5.496950,4.723780C5.228770,4.731290,4.974560,4.845010,4.790230,5.039950C4.605910,5.234880,4.506570,5.495050,4.514070,5.763230C4.521570,6.031410,4.635300,6.285620,4.830230,6.469950L6.270230,7.859950C6.366870,7.953260,6.481310,8.026140,6.606730,8.074250C6.732150,8.122360,6.865980,8.144700,7.000230,8.139950C7.134940,8.139430,7.268150,8.111710,7.391870,8.058440C7.515600,8.005170,7.627280,7.927450,7.720230,7.829950C7.906480,7.642580,8.011020,7.389130,8.011020,7.124950C8.011020,6.860760,7.906480,6.607310,7.720230,6.419950L6.220230,4.999950Z",transform:"matrix(1 0 0 1 0.02050050000000 0)",fill:"rgb(43,115,210)",stroke:"none",strokeWidth:"1"}),o().createElement("path",{id:"e9AcbENh5Z77",d:"M16.999600,8.139990C17.257100,8.138970,17.504200,8.038670,17.689600,7.859990L19.129600,6.469990C19.305300,6.286440,19.404500,6.042910,19.407100,5.788860C19.409700,5.534810,19.315600,5.289290,19.143700,5.102160C18.971900,4.915030,18.735200,4.800340,18.481900,4.781360C18.228500,4.762380,17.977400,4.840550,17.779600,4.999990L16.339600,6.419990C16.153400,6.607350,16.048800,6.860810,16.048800,7.124990C16.048800,7.389180,16.153400,7.642630,16.339600,7.829990C16.512800,8.012710,16.748400,8.123410,16.999600,8.139990Z",fill:"rgb(65,65,65)",stroke:"none",strokeWidth:"1"}),o().createElement("path",{id:"e9AcbENh5Z78",d:"M12,18C11.734800,18,11.480400,18.105400,11.292900,18.292900C11.105400,18.480400,11,18.734800,11,19L11,21C11,21.265200,11.105400,21.519600,11.292900,21.707100C11.480400,21.894600,11.734800,22,12,22C12.265200,22,12.519600,21.894600,12.707100,21.707100C12.894600,21.519600,13,21.265200,13,21L13,19C13,18.734800,12.894600,18.480400,12.707100,18.292900C12.519600,18.105400,12.265200,18,12,18Z",fill:"rgb(65,65,65)",stroke:"none",strokeWidth:"1"}),o().createElement("path",{id:"e9AcbENh5Z79",d:"M17.729900,16.140000C17.538900,15.955600,17.282600,15.854700,17.017200,15.859400C16.751800,15.864100,16.499200,15.974000,16.314900,16.165000C16.130600,16.355900,16.029600,16.612300,16.034300,16.877600C16.039000,17.143000,16.148900,17.395600,16.339900,17.580000L17.779900,19C17.965300,19.178600,18.212400,19.278900,18.469900,19.280000C18.603900,19.280700,18.736700,19.254600,18.860300,19.203100C18.984000,19.151500,19.096100,19.075700,19.189900,18.980000C19.283600,18.887000,19.358000,18.776400,19.408800,18.654500C19.459600,18.532700,19.485700,18.402000,19.485700,18.270000C19.485700,18.138000,19.459600,18.007200,19.408800,17.885400C19.358000,17.763500,19.283600,17.652900,19.189900,17.560000L17.729900,16.140000Z",transform:"matrix(1 0 0 1 -0.03194850000000 0)",fill:"rgb(65,65,65)",stroke:"none",strokeWidth:"1"}),o().createElement("path",{id:"e9AcbENh5Z710",d:"M6.269980,16.140000L4.829980,17.530000C4.736250,17.623000,4.661860,17.733600,4.611090,17.855400C4.560320,17.977300,4.534180,18.108000,4.534180,18.240000C4.534180,18.372000,4.560320,18.502700,4.611090,18.624600C4.661860,18.746400,4.736250,18.857000,4.829980,18.950000C4.923770,19.045700,5.035840,19.121600,5.159520,19.173100C5.283210,19.224600,5.415990,19.250800,5.549980,19.250000C5.796490,19.252100,6.035090,19.163100,6.219980,19L7.659980,17.610000C7.850930,17.425700,7.960850,17.173000,7.965530,16.907700C7.970220,16.642300,7.869300,16.385900,7.684980,16.195000C7.500650,16.004000,7.248020,15.894100,6.982660,15.889400C6.717290,15.884800,6.460930,15.985700,6.269980,16.170000L6.269980,16.140000Z",fill:"rgb(65,65,65)",stroke:"none",strokeWidth:"1"})))},2958:(e,t,a)=>{a.d(t,{B:()=>u,s:()=>m});var n=a(4899),r=a(7559),o=a.n(r),l=a(4702),i=a(4710),c=a.n(i);const s=c()(l.Container).withConfig({displayName:"gap-container__StyledGapContainer",componentId:"sc-174ivj7-0"})(["gap:",";"],(({theme:e,gap:t})=>t&&(0,l.getPadding)(t,e))),d=c()(l.Row).withConfig({displayName:"gap-container__StyledGapRow",componentId:"sc-174ivj7-1"})(["gap:",";"],(({theme:e,gap:t})=>t&&(0,l.getPadding)(t,e))),m=o().forwardRef((function({children:e,...t},a){return o().createElement(s,(0,n.A)({ref:a},t),e)})),u=o().forwardRef((function({children:e,...t},a){return o().createElement(d,(0,n.A)({ref:a},t),e)}))},4184:(e,t,a)=>{a.r(t),a.d(t,{default:()=>et});var n=a(7559),r=a.n(n),o=a(4702),l=a(7196),i=a(2509),c=a(1347),s=a(8333),d=a(8821);const m=[(0,l.t)("messages.modal.send_anyway.attach","attach"),(0,l.t)("messages.modal.send_anyway.attachment","attachment"),(0,l.t)("messages.modal.send_anyway.attachments","attachments"),(0,l.t)("messages.modal.send_anyway.attached","attached"),(0,l.t)("messages.modal.send_anyway.attaching","attaching"),(0,l.t)("messages.modal.send_anyway.enclose","enclose"),(0,l.t)("messages.modal.send_anyway.enclosed","enclosed"),(0,l.t)("messages.modal.send_anyway.enclosing","enclosing")];function u({attachmentIsExpected:e,hasAttachments:t,subject:a}){const n=e&&!t;return n&&!a?(0,l.t)("messages.modal.send_anyway.no_subject_no_attachments","Email subject is empty and you didn’t attach any files."):a?n?(0,l.t)("messages.modal.send_anyway.no_attachments","You didn’t attach any files."):"":(0,l.t)("messages.modal.send_anyway.subject","Subject is missing")}function g({editorId:e,hasAttachments:t,onConfirmCallback:a,createModal:n}){const i=(0,d.M8)({id:e});if(!i)return;const{text:g}=i,{subject:p}=i,h=m.some((e=>{const[t]=g.richText?g.richText.split(c.Vv.HTML_SEP_ID):g.plainText.split(c.Vv.PLAINTEXT_SEP);return t.toLowerCase().includes(e)}));if(h&&!t||!p){const e=n({title:(0,l.t)("header.attention","Attention"),confirmLabel:(0,l.t)("action.ok","Ok"),dismissLabel:(0,l.t)("label.cancel","Cancel"),showCloseIcon:!0,onConfirm:()=>{a(),e()},onClose:()=>{e()},onSecondaryAction:()=>{e()},children:r().createElement(s.t,null,r().createElement(o.Text,{overflow:"break-word",style:{paddingTop:"1rem"}},u({attachmentIsExpected:h,hasAttachments:t,subject:p})),r().createElement(o.Text,{overflow:"break-word",style:{paddingBottom:"1rem"}},(0,l.t)("messages.modal.send_anyway.second","Do you still want to send the email?")))})}else a()}var p=a(4710),h=a.n(p);const b=h()(o.Container).withConfig({displayName:"dropzone-attachment__BackDropLayout",componentId:"sc-uekmrc-0"})(["width:100%;position:absolute;height:100%;z-index:2;top:0;left:0;"]),C=h()(o.Container).withConfig({displayName:"dropzone-attachment__DropBackground",componentId:"sc-uekmrc-1"})(["width:calc(100% - 0.625rem);background:","b9;height:calc(100% - 0.625rem);border-radius:0.25rem;left:0.3125rem;pointer-events:none;"],(e=>e.theme.palette.primary.regular)),f=h()(o.Container).withConfig({displayName:"dropzone-attachment__BackDropLayoutInnerBox",componentId:"sc-uekmrc-2"})(["background:",";border-radius:0.625rem;min-height:11.25rem;max-width:23.75rem;max-height:13.125rem;"],(e=>e.theme.palette.gray6.regular)),E=h()(o.Container).withConfig({displayName:"dropzone-attachment__BackDropLayoutContentBox",componentId:"sc-uekmrc-3"})(["border-style:dashed;border-width:0.125rem;border-radius:0.3125rem;border-color:",";box-sizing:border-box;padding:2.5rem;"],(e=>e.theme.palette.primary.regular)),y=h()(o.Container).withConfig({displayName:"dropzone-attachment__DropBoxIconGroup",componentId:"sc-uekmrc-4"})(["margin-bottom:0.5rem;height:2.5rem;"]),k=h()(o.Text).withConfig({displayName:"dropzone-attachment__DetailText",componentId:"sc-uekmrc-5"})(["text-align:center;"]),w=({onDragOverEvent:e,onDropEvent:t,onDragLeaveEvent:a})=>r().createElement(r().Fragment,null,r().createElement(b,{onDragOver:e,onDrop:t,onDragLeave:a,borderRadius:"half"},r().createElement(C,null,r().createElement(f,null,r().createElement(o.Padding,{all:"medium"},r().createElement(E,null,r().createElement(o.Container,{mainAlignment:"center"},r().createElement(y,{mainAlignment:"center",orientation:"horizontal"},r().createElement(o.Padding,{right:"small",left:"small"},r().createElement(o.Icon,{icon:"ImageOutline",height:"2.1875rem",width:"2.1875rem",color:"primary"})),r().createElement(o.Padding,{right:"small",left:"small"},r().createElement(o.Icon,{icon:"FileAddOutline",height:"2.1875rem",width:"2.1875rem",color:"primary"})),r().createElement(o.Padding,{right:"small",left:"small"},r().createElement(o.Icon,{icon:"FilmOutline",height:"2.1875rem",width:"2.1875rem",color:"primary"}))),r().createElement(o.Container,{mainAlignment:"center",height:"auto"},r().createElement(o.Text,{color:"primary",weight:"bold"},(0,l.t)("composer.attachment.drag_and_drop.title","Drag&Drop Mode")),r().createElement(o.Padding,{top:"small"}),r().createElement(k,{size:"medium",weight:"regular",color:"primary",overflow:"break-word"},(0,l.t)("composer.attachment.drag_and_drop.content","Drop here your attachments to quickly add them to this e-mail"))))))))));var v=a(7431);const _=h()(o.Row).withConfig({displayName:"attachment-upload-status__UploadingRow",componentId:"sc-16592qm-0"})(["display:flex;"]),x=({uploadStatus:e,cancelUpload:t})=>{const[a,i]=(0,n.useState)(!1);return(0,n.useEffect)((()=>{let t=null;return"completed"===e.status&&(i(!0),t=setTimeout((()=>{i(!1)}),v.fT.COMPLETED_UPLOAD_NOTIFICATION_VISIBILITY)),function(){t&&clearTimeout(t)}}),[e.status]),r().createElement(_,{padding:{horizontal:"small",vertical:"small"},crossAlignment:"center"},"running"===e.status&&r().createElement(r().Fragment,null,r().createElement(o.Text,{color:"gray1",size:"small"},e.progress,"%"),r().createElement(o.Padding,{right:"extrasmall"}),r().createElement(o.Icon,{icon:"AnimatedLoader",color:"gray1",size:"large"}),r().createElement(o.Padding,{right:"extrasmall"}),r().createElement(o.IconButton,{icon:"CloseCircleOutline",customSize:{iconSize:"large",paddingSize:0},onClick:t})),"aborted"===e.status&&r().createElement(o.Container,{mainAlignment:"center",crossAlignment:"flex-end",height:"fit"},r().createElement(o.Row,null,r().createElement(o.Icon,{icon:"AlertCircle",color:"error",size:"medium"})),r().createElement(o.Row,null,r().createElement(o.Text,{size:"small",color:"error"},(0,l.t)("label.upload_failed","Upload failed")))),"completed"===e.status&&a&&r().createElement(o.Row,{mainAlignment:"center",crossAlignment:"flex-end"},r().createElement(o.Text,{size:"small"},"100%"),r().createElement(o.Icon,{icon:"CheckmarkCircle2",color:"success",size:"medium"})))};var I=a(6424);const A=({editorId:e,attachment:t})=>{const[a,i]=(0,l.getIntegratedFunction)("select-nodes"),c=(0,I.ZO)(t)&&t?.requiresSmartLinkConversion,{toggleSmartLink:s}=(0,d.de)(e),{saveDraft:m}=(0,d.v1)(e),u=(0,d.M8)({id:e}),g=(0,n.useCallback)((()=>{const e=u?.did;if((0,I.ZO)(t)&&e){const{partName:e}=t;s(e),m()}}),[t,u?.did,m,s]);return i&&(0,I.ZO)(t)?r().createElement(o.Tooltip,{label:c?(0,l.t)("label.convert_back_to_attachment","Convert back to attachment"):(0,l.t)("label.convert_to_smart_link","Convert to smart link")},r().createElement(o.IconButton,{size:"medium",icon:c?"Refresh":"Link2Outline",onClick:g,style:c?{transform:"scale(-1, 1)"}:{}})):r().createElement(r().Fragment,null)};var T=a(169),S=a(2864),z=a(2695),D=a(3472),R=a(6992),L=a(6764);const M=e=>({...e,icons:{...e.icons,AnimatedLoader:L.D}}),B=(0,p.createGlobalStyle)([".disable-hover,.disable-hover *{&:hover{background-color:transparent;}}"]),N=({children:e})=>r().createElement(o.ThemeProvider,{loadDefaultFont:!1,extension:M},r().createElement(B,null),e);var F=a(6958);const O=h()(o.Container).withConfig({displayName:"attachment-preview__AttachmentHoverBarContainer",componentId:"sc-1hfclv2-0"})(["display:none;"]),P=h()(o.Container).attrs((e=>({hoverBarDisabled:e.hoverBarDisabled,requiresSmartLinkConversion:e.requiresSmartLinkConversion}))).withConfig({displayName:"attachment-preview__AttachmentContainer",componentId:"sc-1hfclv2-1"})(["border-bottom:",";border-radius:0.125rem;width:calc(50% - 0.25rem);transition:0.2s ease-out;margin-bottom:",";&:hover{border-bottom:",";background-color:",";& ","{display:",";}}&:focus{border-bottom:",";background-color:",";}cursor:pointer;"],(({requiresSmartLinkConversion:e,theme:t,background:a})=>{const n=(0,o.getColor)(`${a}.regular`,t);return e?`1px solid ${t.palette.primary.regular}`:`1px solid ${n}`}),(({theme:e})=>e.sizes.padding.small),(({theme:e,background:t})=>`1px solid ${(0,o.getColor)(`${t}.hover`,e)}`),(({theme:e,background:t})=>t&&(0,o.getColor)(`${t}.hover`,e)),O,(e=>e.hoverBarDisabled?"none":"flex"),(({theme:e,background:t})=>`1px solid ${(0,o.getColor)(`${t}.focus`,e)}`),(({theme:e,background:t})=>t&&(0,o.getColor)(`${t}.focus`,e))),U=h().a.withConfig({displayName:"attachment-preview__AttachmentLink",componentId:"sc-1hfclv2-2"})(["margin-bottom:",";position:relative;text-decoration:none;"],(({theme:e})=>e.sizes.padding.small)),j=h()(o.Text).withConfig({displayName:"attachment-preview__AttachmentExtension",componentId:"sc-1hfclv2-3"})(["display:flex;justify-content:center;align-items:center;width:2rem;height:2rem;border-radius:",";background-color:",";color:",";font-size:calc("," - 0.125rem);text-transform:uppercase;margin-right:",";"],(({theme:e})=>e.borderRadius),(({background:e})=>e),(({theme:e})=>e.palette.gray6.regular),(({theme:e})=>e.sizes.font.small),(({theme:e})=>e.sizes.padding.small)),$=({editorId:e,attachment:t})=>{const a=(0,T.rC)(t).value,i=(0,I.ZO)(t)&&t?.requiresSmartLinkConversion,c=(0,n.useMemo)((()=>i?r().createElement(o.Icon,{icon:"Link2Outline",size:"large",color:"primary"}):a),[a,i]),s=(0,T.c9)(t.size),m=(0,n.useRef)(null),u=(0,n.useRef)(null),g=(0,d.M8)({id:e});if(!g)throw new Error("Cannot find the given editor");const p=((e,t)=>{const{debouncedSaveDraft:a}=(0,z.dq)(),r=(0,D.T)((a=>{const n=(0,R.qH)(a,e,t);return null===n?null:{status:a.editors[e].unsavedAttachments[n].uploadStatus,abortController:a.editors[e].unsavedAttachments[n].uploadAbortController}}));return(0,n.useMemo)((()=>r&&r.status&&r.abortController?{status:r.status,cancel:()=>{r.abortController?.abort(),D.T.getState().removeUnsavedAttachment(e,t),(0,S.p)(e),a(e)}}:null),[r,e,a,t])})(e,(0,I.Ax)(t)?t.uploadId:""),{removeUnsavedAttachment:h,removeSavedAttachment:b}=(0,d.de)(e),{subject:C}=(0,d.Fj)(e),f=(0,n.useCallback)((()=>{(0,I.Ax)(t)&&h(t.uploadId),(0,I.ZO)(t)&&b(t.partName)}),[t,b,h]),E=(0,T.zq)(t),y=(0,n.useMemo)((()=>i?"transparent":E),[E,i]),k=(0,n.useMemo)((()=>(0,I.Ax)(t)&&(0,I.dJ)(t)),[t]),w=(0,I.ZO)(t)?(0,F.h1)({messageId:g?.did??"",messageSubject:C,attachments:[t.partName],attachmentType:t.contentType}):null,v=(0,n.useCallback)((()=>{"running"===p?.status.status&&p&&p.cancel()}),[p]),_=(0,n.useMemo)((()=>(0,I.ZO)(t)||(0,I.Ax)(t)&&!(0,I.dJ)(t)),[t]),L=(0,o.useTheme)(),M=(0,n.useMemo)((()=>i?L.palette.infoBanner.regular:"gray3"),[i,L.palette.infoBanner.regular]);return r().createElement(N,null,r().createElement(P,{orientation:"horizontal",mainAlignment:"flex-start",crossAlignment:"center",height:"fit",background:M,"data-testid":`attachment-container-${t.filename}`,hoverBarDisabled:k,requiresSmartLinkConversion:i},r().createElement(o.Tooltip,{label:(0,l.t)("action.preview","Preview")},r().createElement(o.Row,{padding:{all:"small"},mainAlignment:"flex-start",onClick:e=>{e.preventDefault(),u.current&&u.current.click()},takeAvailableSpace:!0},r().createElement(j,{background:y},c),r().createElement(o.Row,{orientation:"vertical",crossAlignment:"flex-start",takeAvailableSpace:!0},i&&r().createElement(o.Padding,{top:"small"}),r().createElement(o.Padding,{style:{width:"100%"},bottom:"extrasmall"},r().createElement(o.Text,{size:"small"},t.filename||(0,l.t)("label.attachement_unknown",{mimeType:t?.contentType,defaultValue:"Unknown <{{mimeType}}>"}))),i?r().createElement(o.Padding,{top:"small"}):r().createElement(o.Text,{color:"gray1",size:"small"},s)))),p?.status&&r().createElement(x,{"data-testid":"attachmentuploadstatus-container",uploadStatus:p.status,cancelUpload:v}),r().createElement(o.Row,{orientation:"horizontal",crossAlignment:"center"},r().createElement(O,null,r().createElement(o.Row,null,r().createElement(A,{editorId:e,attachment:t}),_&&r().createElement(o.Padding,{right:"small"},r().createElement(o.Tooltip,{label:(0,l.t)("label.delete","Delete")},r().createElement(o.IconButton,{size:"large",icon:"DeletePermanentlyOutline","data-testid":"btn-delete-attachment",onClick:f})))))),(0,I.ZO)(t)&&w&&r().createElement(r().Fragment,null,r().createElement(U,{rel:"noopener",ref:u,target:"_blank",href:(0,T.L)(t)}),r().createElement(U,{ref:m,rel:"noopener",target:"_blank",href:w}))))},Z=h().input.withConfig({displayName:"edit-view-styled-components__FileInput",componentId:"sc-iwp7b9-0"})(["display:none;"]),q=(h().div.withConfig({displayName:"edit-view-styled-components__Divider",componentId:"sc-iwp7b9-1"})(["width:100%;min-height:0.0625rem;max-height:0.0625rem;border-bottom:0.0625rem solid ",";"],(e=>e.theme.palette.gray2.regular)),h()(o.IconCheckbox).withConfig({displayName:"edit-view-styled-components__ResizedIconCheckbox",componentId:"sc-iwp7b9-2"})(["[class^='Padding__Comp']{padding:0.375rem;svg{height:1.25rem;width:1.25rem;}}"])),W=h().textarea.withConfig({displayName:"edit-view-styled-components__TextArea",componentId:"sc-iwp7b9-3"})(["box-sizing:border-box;min-height:15.625rem;flex-grow:1;width:100%;border:none;resize:vertical;& :focus,:active{box-shadow:none;border:none;outline:none;}"]),H=h().div.withConfig({displayName:"edit-view-styled-components__EditorWrapper",componentId:"sc-iwp7b9-4"})(["width:100%;height:auto;position:relative;> .tox:not(.tox-tinymce-inline){width:100%;border:none;.tox-editor-container{min-height:18.75rem;}.tox-editor-header{padding:",";background-color:",";}.tox-toolbar__primary{background:none;background-color:",";border-radius:",";}}> .tox{.tox-edit-area{margin-left:calc(-1rem + ",");overflow-y:auto;max-height:100%;}.tox-edit-area__iframe{height:100%;padding-bottom:",";}&.tox-tinymce{height:100% !important;}}"],(e=>e.theme.sizes.padding.large),(e=>e.theme.palette.gray6.regular),(e=>e.theme.palette.gray4.regular),(e=>e.theme.borderRadius),(e=>e.theme.sizes.padding.large),(e=>e.theme.sizes.padding.large)),V=h()(o.Container).attrs((()=>({bottomBorderColor:void 0}))).withConfig({displayName:"edit-view-styled-components__BannerContainer",componentId:"sc-iwp7b9-5"})(["border-bottom:0.0625rem solid ",";border-top-right-radius:0.25rem;border-top-left-radius:0.25rem;padding:1rem;"],(({theme:e,$bottomBorderColor:t})=>e.palette[t].regular)),G=h()(o.Container).withConfig({displayName:"edit-view-styled-components__RowContainer",componentId:"sc-iwp7b9-6"})(["display:grid;grid-template-columns:repeat(12,1fr);grid-gap:0.5rem;height:fit-content;"]),Y=h().div.withConfig({displayName:"edit-view-styled-components__ColContainer",componentId:"sc-iwp7b9-7"})(["grid-column:",";"],(({occupyFull:e})=>"span  "+(e?12:6))),K=h()(o.Row).withConfig({displayName:"edit-view-styled-components__StickyTime",componentId:"sc-iwp7b9-8"})(["position:relative;bottom:2.375rem;right:-0.125rem;"]),J=h()(o.Row).withConfig({displayName:"edit-view-styled-components__StickyTimeContainer",componentId:"sc-iwp7b9-9"})(["position:sticky;bottom:0.625rem;right:0.625rem;height:0;"]),X=({editorId:e})=>{const[t,a]=(0,n.useState)(!1),{savedStandardAttachments:c,unsavedStandardAttachments:s,removeStandardAttachments:m}=(0,d.de)(e),u=(0,n.useMemo)((()=>[...s,...c]),[c,s]),g=(0,l.t)("label.attachment",{count:u.length,defaultValue_one:"{{count}} attachment",defaultValue_other:"{{count}} attachments"});return u.length>0?r().createElement(G,{background:"gray6"},r().createElement(Y,{occupyFull:!0},r().createElement(o.Container,{crossAlignment:"flex-start"},r().createElement(o.Container,{orientation:"horizontal",mainAlignment:"space-between",wrap:"wrap"},(0,i.map)(t?u:u.slice(0,2),((t,a)=>"unnamed"!==t.filename?r().createElement($,{key:`att-${t.filename}-${a}`,editorId:e,attachment:t}):r().createElement(r().Fragment,null)))),r().createElement(o.Row,{mainAlignment:"flex-start",padding:{vertical:"extrasmall"}},r().createElement(o.Padding,{right:"small"},u.length>0&&u.length<=2&&r().createElement(o.Text,{color:"gray1"},g),u.length>2&&(t?r().createElement(o.Row,{onClick:()=>a(!1),style:{cursor:"pointer"},"data-testid":"attachment-list-collapse-link"},r().createElement(o.Padding,{right:"small"},r().createElement(o.Text,{color:"primary"},g)),r().createElement(o.Icon,{icon:"ArrowIosUpward",color:"primary"})):r().createElement(o.Row,{onClick:()=>a(!0),style:{cursor:"pointer"},"data-testid":"attachment-list-expand-link"},r().createElement(o.Padding,{right:"small"},r().createElement(o.Text,{color:"primary"},(0,l.t)("label.show_all_attachments",{count:u.length,defaultValue_other:"Show all {{count}} attachments"}))),r().createElement(o.Icon,{icon:"ArrowIosDownward",color:"primary"})))),r().createElement(o.Link,{size:"medium",onClick:m},(0,l.t)("label.remove",{count:u.length,defaultValue_one:"Remove",defaultValue_other:"Remove all {{count}}"})))))):r().createElement(r().Fragment,null)};var Q=a(9785);const ee=e=>{const t=[];if(!e)return t;for(let a=0;a<e.length;a+=1)t.push(e[a]);return t};var te=a(7625);const ae=h()(o.Row).withConfig({displayName:"add-attachments-dropdown__SelectorContainer",componentId:"sc-7zv81j-0"})(["border-radius:4px;cursor:pointer;&:hover{background-color:",";}"],(({theme:e})=>e.palette.gray6.focus)),ne=({editorId:e})=>{const{control:t}=(0,Q.mN)(),a=(0,n.useRef)(null),{text:c,setText:s}=(0,d.I4)(e),{addStandardAttachments:m,addUploadedAttachment:u}=(0,d.de)(e),g=(0,n.useCallback)((e=>{const t=ee(e);m(t,{})}),[m]),p=(0,n.useCallback)((e=>{e.forEach((e=>{"fulfilled"===e.status&&u({attachmentId:e.value.attachmentId,fileName:e.value.fileName,contentType:e.value.contentType,size:e.value.size})}))}),[u]),h=(0,n.useCallback)((e=>{const t={plainText:(0,i.map)(e,(e=>e.value.url)).join("\n").concat(c.plainText),richText:` ${(0,i.map)(e,(e=>`<p><a href="${e.value.url}"> ${e.value.url}</a></p>`)).join("")}`.concat(c.richText)};s(t)}),[s,c]),[b,C]=(({onComplete:e})=>{const[t,a]=(0,l.useIntegratedFunction)("upload-to-target-and-get-target-id"),r=(0,o.useSnackbar)();return[(0,n.useCallback)((n=>{const o=(0,i.map)(n,(e=>(async(e,t)=>t({nodeId:e.id,targetModule:"MAILS"}))(e,t).then((({attachmentId:t})=>({attachmentId:t,fileName:e.name,contentType:e.mime_type,size:e.size})))));a&&Promise.allSettled(o).then((t=>{const a=(0,i.filter)(t,["status","fulfilled"]),n=t.length===a?.length,o=t.length===(0,i.filter)(t,["status","rejected"])?.length,c=n?"info":"warning",s=n?(0,l.t)("message.snackbar.all_att_added","Attachments added successfully"):o?(0,l.t)("message.snackbar.att_err_adding","There seems to be a problem when adding attachments, please try again"):(0,l.t)("message.snackbar.some_att_add_fails","There seems to be a problem when adding some attachments, please try again");r({key:"calendar-moved-root",replace:!0,type:c,hideButton:!0,label:s,autoHideTimeout:4e3}),e(a)}))}),[a,t,r,e]),a]})({onComplete:p}),[f,E]=(({addPublicLinkFromFiles:e})=>{const{createSnackbar:t}=(0,te.m)(),[a,r]=(0,l.useIntegratedFunction)("get-link");return[(0,n.useCallback)((n=>{const r=(0,i.map)(n,(e=>a({node:e,type:"createLink",description:e.id})));Promise.allSettled(r).then((a=>{const n=(0,i.filter)(a,["status","fulfilled"]),r=a.length===n?.length,o=a.length===(0,i.filter)(a,["status","rejected"])?.length,c=r?"info":"warning",s=r?(0,l.t)("message.snackbar.all_link_copied","Public link copied successfully"):o?(0,l.t)("message.snackbar.link_copying_error","There seems to be a problem while generating public link, please try again"):(0,l.t)("message.snackbar.some_link_copying_error","There seems to be a problem while generating public url for some files, please try again");t({key:"public-link",replace:!0,type:c,hideButton:!0,label:s,autoHideTimeout:4e3}),e(n)}))}),[e,t,a]),r]})({addPublicLinkFromFiles:h}),[y,k]=(0,l.getIntegratedFunction)("select-nodes"),w=(0,n.useMemo)((()=>({title:(0,l.t)("label.choose_file","Choose file"),confirmAction:b,confirmLabel:(0,l.t)("label.select","Select"),allowFiles:!0,allowFolders:!1})),[b]),v=(0,n.useMemo)((()=>({title:(0,l.t)("label.choose_file","Choose file"),confirmAction:f,confirmLabel:(0,l.t)("label.share_public_link","Share Public Link"),allowFiles:!0,allowFolders:!1})),[f]),_=(0,n.useCallback)((()=>{a.current&&(a.current.value="",a.current.click())}),[]),x=(0,n.useMemo)((()=>{const e={id:"localAttachment",icon:"MonitorOutline",label:(0,l.t)("composer.attachment.local","Add from local"),onClick:_,customComponent:r().createElement(r().Fragment,null,r().createElement(o.Icon,{icon:"MonitorOutline",size:"medium"}),r().createElement(o.Padding,{horizontal:"extrasmall"}),r().createElement(o.Text,null,(0,l.t)("composer.attachment.local","Add from local")))},t=k&&C?{id:"driveItem",label:(0,l.t)("composer.attachment.files","Add from Files"),icon:"DriveOutline",onClick:()=>{y(w)}}:void 0,a=k&&E?{id:"fileUrl",label:(0,l.t)("composer.attachment.url","Add public link from Files"),icon:"Link2",onClick:()=>{y(v)}}:void 0;return(0,i.compact)([e,t,a])}),[_,C,w,k,E,y,v]);return r().createElement(ae,{orientation:"horizontal",mainAlignment:"space-between"},r().createElement(Q.xI,{name:"attach",control:t,defaultValue:{},render:()=>r().createElement(Z,{type:"file",ref:a,"data-testid":"file-input",onChange:()=>{g&&a?.current?.files&&g(a.current.files)},multiple:!0})}),r().createElement(o.Tooltip,{label:(0,l.t)("tooltip.add_attachments","Add attachments")},r().createElement(o.Dropdown,{items:x,display:"inline-block",width:"fit"},r().createElement(q,{onChange:()=>null,icon:"AttachOutline"}))))};var re=a(9628),oe=a(9902),le=a(8032),ie=a(7634),ce=a(9966);const se=({ids:e,onClose:t,onConfirm:a,onDelete:i})=>{const c=(0,le.j)(),s=(0,n.useCallback)((()=>{t?.()}),[t]),d=(0,n.useCallback)((()=>{a?.(),t?.()}),[t,a]),m=(0,ie.nm)(),u=(0,n.useCallback)((a=>{m({ids:e,dispatch:c,folderId:l.FOLDERS.DRAFTS})?.onClick(a),i?.(),t?.()}),[c,e,m,t,i]);return r().createElement(r().Fragment,null,r().createElement(oe.A,{title:(0,l.t)("label.before_you_leave","Before you leave"),onClose:s}),r().createElement(o.Padding,{vertical:"medium"},r().createElement(o.Text,null,(0,l.t)("modal.delete_draft.message1","Do you want to keep this draft or delete it?"))),r().createElement(re.A,{secondaryBtnType:"outlined",onConfirm:d,label:(0,l.t)("label.keep_draft","Keep Draft"),secondaryAction:u,secondaryLabel:(0,l.t)("label.delete_draft","Delete Draft"),secondaryColor:"primary",paddingTop:"0"}))};var de=a(4222),me=a.n(de);const ue=({processStatus:e})=>{const[t,a]=(0,n.useState)(!1),i=(0,n.useRef)(null);return(0,n.useEffect)((()=>("completed"===e?.status&&(a(!0),i.current=setTimeout((()=>a(!1)),v.fT.DRAFT_INFO_HIDING_DELAY)),()=>{i.current&&clearTimeout(i.current)})),[e]),r().createElement(r().Fragment,null,t&&r().createElement(J,null,r().createElement(K,null,r().createElement(o.Row,{crossAlignment:"flex-end",background:"gray5",padding:{vertical:"medium",horizontal:"large"}},r().createElement(o.Text,{size:"extrasmall",color:"secondary"},(0,l.t)("message.email_saved_at",{time:me()(e?.lastSaveTimestamp).format("LTS"),defaultValue:"Email saved as draft at {{time}}"}))))))};var ge=a(6505),pe=a(5740);const he=h()(o.Row).withConfig({displayName:"edit-view-identity-selector__SelectorContainer",componentId:"sc-9j1x2v-0"})(["border-radius:4px;cursor:pointer;&:hover{background-color:",";}"],(({theme:e})=>e.palette.gray6.focus)),be=(e,t,a)=>{const n=e?t?(0,ge.F0)(e,l.t):e.fromAddress:a;return r().createElement(o.Container,{width:"100%",orientation:"horizontal",height:"fit"},r().createElement(o.Avatar,{label:e?.identityName||e?.fromDisplay||a}),r().createElement(o.Container,{width:"100%",crossAlignment:"flex-start",height:"fit",padding:{left:"medium"}},r().createElement(o.Text,{weight:"bold"},e?.identityDisplayName||a),r().createElement(o.Text,{size:"small",color:"gray1"},n)))},Ce=({editorId:e})=>{const{identityId:t,setIdentityId:a}=(0,d.KH)(e),{text:c,setText:s}=(0,d.I4)(e),[m,u]=(0,n.useState)(!1),g=(0,n.useMemo)((()=>(0,ge.jq)()),[]),p=(0,n.useMemo)((()=>(0,ge.AR)(t)),[t]),h=p?(0,ge.F0)(p,l.t):g,b=(0,n.useMemo)((()=>(0,ge.vj)()),[]),C=(0,n.useCallback)((e=>{a(e.id);const t=(0,pe.gU)(c,e.defaultSignatureId);s(t)}),[a,s,c]),f=(0,n.useCallback)((()=>{u((e=>!e))}),[]),E=(0,n.useCallback)((()=>{u(!1)}),[]),y=(0,n.useMemo)((()=>b.map((e=>({id:e.id,label:(0,ge.F0)(e,l.t)??g,selected:e.id===p?.id,onClick:()=>{C(e),E()},customComponent:be(e,!0,g)})))),[E,b,g,C,p]);return r().createElement(he,{orientation:"horizontal",mainAlignment:"space-between"},r().createElement(o.Tooltip,{label:h,maxWidth:"100%",placement:"top-start"},r().createElement(o.Dropdown,{items:y,width:"fit",maxWidth:"100%",selectedBackgroundColor:"highlight","data-testid":"from-dropdown"},r().createElement(o.Row,{onClick:f,width:"100%",orientation:"horizontal",height:"fit",wrap:"nowrap",padding:{all:"small"}},be(p,!1,g),r().createElement(o.IconButton,{icon:m?"ChevronUpOutline":"ChevronDownOutline",onClick:i.noop})))))},fe=h()(o.Row).withConfig({displayName:"date-picker-custom-component__CustomInputWrapper",componentId:"sc-kharq3-0"})(["border-bottom:1px solid ",";border-radius:0.125rem;&:hover{background:",";}&:focus-within{border-bottom:1px solid ",";}"],(({theme:e})=>e.palette.gray4.regular),(({theme:e})=>e.palette.gray2.regular),(({theme:e})=>e.palette.primary.regular)),Ee=h()(o.Row).withConfig({displayName:"date-picker-custom-component__CustomButtonWrapper",componentId:"sc-kharq3-1"})(["cursor:pointer;padding:0 !important;"]),ye=(0,n.forwardRef)((function({value:e,onClick:t,label:a},l){const[i,c]=(0,n.useState)(e);return(0,n.useEffect)((()=>{c(e)}),[e]),r().createElement(fe,{background:"gray4"},r().createElement(o.Row,{takeAvailableSpace:!0,minWidth:"9.375rem",background:"transparent"},r().createElement(o.Input,{label:a,value:i,hideBorder:!0,disabled:!0,ref:l})),r().createElement(Ee,null,r().createElement(o.IconButton,{icon:"CalendarOutline",size:"large",onClick:t,backgroundColor:"transparent",iconColor:"text"})))})),ke=({onAutoSendTimeSelected:e,onClose:t})=>{const[a,c]=(0,n.useState)(null),s=(0,l.t)("label.send_later","Send Later"),d=(0,l.t)("label.select_date_time","Select date and time"),m=(0,l.t)("label.schedule_send","Schedule send"),u=(0,n.useCallback)((e=>{c(e)}),[]),g=(0,n.useCallback)((()=>{a&&e(me()(a).valueOf())}),[e,a]),p=(0,n.useMemo)((()=>me()(a).isBefore(me()(),"hour")||!a?new Date:me()().hours(0).minutes(0)),[a]),h=(0,n.useMemo)((()=>new Date(0,0,0,23,45,0,0)),[]);return r().createElement(o.Container,{mainAlignment:"center",crossAlignment:"flex-start",height:"fit"},r().createElement(oe.A,{onClose:t,title:s}),r().createElement(o.Container,{padding:{all:"small"},mainAlignment:"center",crossAlignment:"flex-start",height:"fit"},r().createElement(o.Text,null,(0,l.t)("message.select_date_time","Select a date and time to send this message")),r().createElement(o.Container,{padding:{vertical:"medium"}},r().createElement(o.DateTimePicker,{label:d,isClearable:!0,width:"fill",onChange:u,dateFormat:"dd/MM/yyyy HH:mm",minDate:new Date,minTime:p,maxTime:h,timeCaption:(0,l.t)("label.time","Time"),customInput:r().createElement(ye,{label:d,value:a?.toDateString()??"",onClick:i.noop})}))),r().createElement(re.A,{onConfirm:g,label:m,disabled:!a,secondaryAction:t,secondaryLabel:(0,l.t)("label.cancel","Cancel")}))},we=({onSendLater:e,onSendNow:t,disabled:a,tooltip:i,isLoading:c})=>{const{attrs:d}=(0,l.useUserSettings)(),m=(0,o.useModal)(),u=(0,n.useCallback)((()=>{const t=m({maxHeight:"90vh",children:r().createElement(s.t,null,r().createElement(ke,{onAutoSendTimeSelected:a=>{e(a),t()},onClose:()=>t&&t()}))},!0)}),[m,e]),g=(0,n.useMemo)((()=>"TRUE"===d?.zimbraFeatureMailSendLaterEnabled),[d?.zimbraFeatureMailSendLaterEnabled]),p=(0,n.useMemo)((()=>[...g?[{id:"delayed_mail",icon:"ClockOutline",label:(0,l.t)("label.send_later","Send later"),onClick:u}]:[]]),[g,u]);return r().createElement(r().Fragment,null,p.length>0?r().createElement(o.Tooltip,{label:i,disabled:!a},r().createElement(o.MultiButton,{"data-testid":"BtnSendMailMulti",label:(0,l.t)("label.send","Send"),onClick:t,disabledPrimary:a,disabledSecondary:a,icon:c?L.D:"ChevronDownOutline",items:p})):r().createElement(o.Tooltip,{label:i,disabled:!a},r().createElement(o.Button,{color:"primary","data-testid":"BtnSendMail",disabled:a,icon:c?L.D:"PaperPlane",onClick:t,label:(0,l.t)("label.send","Send")})))},ve=({editorId:e})=>{const{isRichText:t,setIsRichText:a}=(0,d.sP)(e),{isUrgent:c,setIsUrgent:s}=(0,d.kD)(e),{requestReadReceipt:m,setRequestReadReceipt:u}=(0,d.Or)(e),g=(0,n.useCallback)((()=>{a(!t)}),[t,a]),p=(0,n.useCallback)((()=>{s(!c)}),[c,s]),h=(0,n.useCallback)((()=>{u(!m)}),[m,u]),b=(0,n.useMemo)((()=>[{id:"richText",label:t?(0,l.t)("tooltip.disable_rich_text","Disable rich text editor"):(0,l.t)("tooltip.enable_rich_text","Enable rich text editor"),onClick:g},{id:"urgent",label:c?(0,l.t)("label.mark_as_un_important","Mark as unimportant"):(0,l.t)("label.mark_as_important","Mark as important"),onClick:p},{id:"read_receipt",label:m?(0,l.t)("label.remove_request_receipt","Remove read receipt request"):(0,l.t)("label.request_receipt","Request read receipt"),onClick:h}]),[t,g,c,p,m,h]);return r().createElement(o.Dropdown,{items:b,selectedBackgroundColor:"gray5","data-testid":"options-dropdown"},r().createElement(o.IconButton,{"data-testid":"options-dropdown-icon",size:"large",icon:"MoreVertical",onClick:i.noop}))},_e=/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/,xe=({type:e,label:t,recipients:a,onRecipientsChange:c,dataTestid:s,orderedAccountIds:d})=>{const[m,u]=(0,l.useIntegratedComponent)("contact-input"),g=(0,n.useCallback)((t=>{const a=(0,i.map)(t,(t=>({...t,email:t.email,error:t.error,type:e,address:t.email,name:t.firstName,fullName:t.fullName})));c(a)}),[c,e]),p=(0,i.map)(a,(e=>({label:e.address})));return r().createElement(r().Fragment,null,u?r().createElement(m,{"data-testid":s,placeholder:t,maxChips:null,onChange:g,defaultValue:a,bottomBorderColor:"transparent",hasError:(0,i.some)(a||[],{error:!0}),dragAndDropEnabled:!0,orderedAccountIds:d}):r().createElement(o.ChipInput,{"data-testid":s,placeholder:t,maxChips:null,onAdd:e=>"string"==typeof e?{label:e,error:!_e.test(e)}:{label:"unknown data",error:!0},onChange:t=>{const a=(0,i.map)((0,i.reject)(t,["error",!0]),(t=>({name:t.label,address:t.label,fullName:t.label,type:e})));c(a)},defaultValue:p,background:"gray5",hasError:(0,i.some)(a||[],{error:!0})}))};var Ie=a(7995),Ae=a(7582);var Te=a(2958);const Se=({editorId:e})=>{const{toRecipients:t,setToRecipients:a}=(0,d.Ed)(e),{ccRecipients:c,setCcRecipients:s}=(0,d.v8)(e),{bccRecipients:m,setBccRecipients:u}=(0,d.fC)(e),{identityId:g}=(0,d.KH)(e),[p,h]=(0,n.useState)(c.length>0),[b,C]=(0,n.useState)(m.length>0),f=(0,n.useCallback)((()=>h((e=>!e))),[]),E=(0,n.useCallback)((()=>C((e=>!e))),[]),[y,k]=(0,n.useState)([]),w=(0,o.useSnackbar)();(0,n.useEffect)((()=>{const e=(0,ge.AR)(g);(async function(e){const t=await(0,Ae.r)().then((e=>{const t=[];return e?.folders&&(0,i.filter)(e.folders,["folderId",1]).forEach((e=>{e.ownerId&&e.ownerEmail&&t.push({id:e.ownerId,address:e.ownerEmail})})),t})),a=function(){const e=(0,l.getUserAccount)();if(e)return{id:e.id,address:e.name}}(),n=a?[a].concat(...t):t,r=(0,i.sortBy)(n,(t=>t.address===e?0:1));return(0,i.map)(r,(e=>e.id))})(e?e.ownerAccount:"").then((e=>{k(e)})).catch((()=>{w({key:"ordered-account-ids",replace:!0,type:"error",label:(0,l.t)("label.error_try_again","Something went wrong, please try again"),autoHideTimeout:3e3,hideButton:!0})}))}),[w,g]);const v=(0,n.useCallback)((e=>a(e)),[a]),_=(0,n.useCallback)((e=>s(e)),[s]),x=(0,n.useCallback)((e=>u(e)),[u]);return r().createElement(Te.s,{gap:"small"},r().createElement(o.Container,{orientation:"horizontal",background:"gray5",style:{overflow:"hidden"},padding:{all:"none"}},r().createElement(o.Container,{background:"gray5",style:{overflow:"hidden"}},r().createElement(xe,{type:Ie.s.TO,label:(0,l.t)("label.to","To"),dataTestid:"RecipientTo",recipients:t,onRecipientsChange:v,orderedAccountIds:y})),r().createElement(o.Container,{width:"fill",maxWidth:"fit",background:"gray5",padding:{right:"medium",left:"extrasmall"},orientation:"horizontal"},r().createElement(o.Padding,{right:"extrasmall"},r().createElement(o.Button,{label:(0,l.t)("label.cc","Cc"),type:"ghost",style:{color:"#282828"},onClick:f,forceActive:p,"data-testid":"BtnCc"})),r().createElement(o.Button,{label:(0,l.t)("label.bcc","Bcc"),type:"ghost",style:{color:"#282828"},forceActive:b,onClick:E}))),p&&r().createElement(xe,{type:Ie.s.CARBON_COPY,label:(0,l.t)("label.cc","Cc"),dataTestid:"RecipientCc",recipients:c,onRecipientsChange:_,orderedAccountIds:y}),b&&r().createElement(xe,{type:Ie.s.BLIND_CARBON_COPY,label:(0,l.t)("label.bcc","Bcc"),dataTestid:"RecipientBcc",recipients:m,onRecipientsChange:x,orderedAccountIds:y}))};var ze=a(8153);const De=({text:e,icon:t,iconColor:a,bottomBorderColor:n})=>r().createElement(V,{orientation:"horizontal",mainAlignment:"flex-start",crossAlignment:"center",background:"gray6",height:"fit",padding:{all:"large"},$bottomBorderColor:n},r().createElement(o.Padding,{right:"large"},r().createElement(o.Icon,{icon:t,color:a,size:"large"})),r().createElement(o.Text,null,e));var Re=a(8772);const Le=({editorId:e,isMailSizeWarning:t,setIsMailSizeWarning:a})=>{const o=(0,l.useUserSettings)().attrs?.zimbraMtaMaxMessageSize,{t:i}=(0,ze.useTranslation)(),c=parseInt(o,10),s=(0,Re.M8)({id:e}),d=s?(e=>(e?.size??0)-.9*(e?.totalSmartLinksSize??0))(s):0;(0,n.useEffect)((()=>{a(d>c)}),[d,c,a]);const m=i("editor.warning.mail_size_exceeds_limit","The message size exceeds the limit. Please convert some attachments to smart links.");return s&&t?r().createElement(De,{text:m,icon:"CloseCircleOutline",iconColor:"error",bottomBorderColor:"error"}):r().createElement(r().Fragment,null)},Me=({editorId:e})=>{const{subject:t,setSubject:a}=(0,d.Fj)(e),{isUrgent:i}=(0,d.kD)(e),{requestReadReceipt:c}=(0,d.Or)(e),s=(0,n.useCallback)((e=>{a(e.target.value)}),[a]);return r().createElement(o.Container,{orientation:"horizontal",background:"gray5",style:{overflow:"hidden"},padding:{all:"none"}},r().createElement(o.Container,{background:"gray5",style:{overflow:"hidden"},padding:"0"},r().createElement(o.Input,{"data-testid":"subject",label:(0,l.t)("label.subject","Subject"),value:t,onChange:s})),(c||i)&&r().createElement(o.Container,{width:"fit",background:"gray5",padding:{right:"medium",left:"small"},orientation:"horizontal"},c&&r().createElement(o.Tooltip,{label:(0,l.t)("label.request_receipt","Request read receipt")},r().createElement(o.Padding,{right:"small"},r().createElement(o.Icon,{icon:"CheckmarkSquare",color:"secondary",size:"large"}))),i&&r().createElement(o.Tooltip,{label:(0,l.t)("tooltip.marked_as_important","Marked as important")},r().createElement(o.Icon,{icon:"ArrowUpward",color:"secondary",size:"large"}))))};var Be=a(6961);const Ne=({editorId:e,onDragOver:t,onFilesSelected:a,minHeight:i,disabled:c})=>{const[s,m]=(0,l.useIntegratedComponent)("composer"),[u,g]=(0,n.useState)(!1),{text:p,setText:h}=(0,d.I4)(e),{isRichText:b}=(0,d.sP)(e),C=(0,n.useCallback)((e=>{h({plainText:e.plainText,richText:e.richText})}),[h]),{prefs:f}=(0,l.useUserSettings)(),E=(0,n.useMemo)((()=>String(f?.zimbraPrefHtmlEditorDefaultFontFamily)??"sans-serif"),[f]);return r().createElement(r().Fragment,null,p&&r().createElement(o.Container,{height:"fit",padding:{all:"small"},background:"gray6",crossAlignment:"flex-end"},b&&m?r().createElement(o.Container,{background:"gray6",mainAlignment:"flex-start",style:{minHeight:i,overflow:"hidden"}},r().createElement(H,{"data-testid":"MailEditorWrapper"},r().createElement(s,{value:p.richText,disabled:c,onFileSelect:a,onEditorChange:e=>{u&&C({plainText:e[0],richText:e[1]})},onDragOver:t,customInitOptions:{toolbar_sticky:!0,ui_mode:"split",content_style:"p { margin: 0; }"},onFocus:()=>{u||g(!0)}}))):r().createElement(o.Container,{background:"gray6",height:"fit"},r().createElement(W,{"data-testid":"MailPlainTextEditor",value:p.plainText,style:{fontFamily:E},onFocus:e=>{e.currentTarget.setSelectionRange(0,null)},onChange:e=>{C({plainText:e.target.value,richText:(0,Be.ag)(e.target.value)})}}))))};var Fe=a(3011);const Oe=(0,n.memo)(Ne),Pe=(0,n.memo)(Se),Ue=(0,n.memo)(Me),je=(0,n.memo)(ve),$e=(0,n.memo)(ne),Ze=(0,n.memo)(Ce),qe=({editorId:e})=>{const t=(0,d.T2)((t=>t.editors[e].recipients.to)),a=(0,n.useMemo)((()=>{const e=(0,i.map)((0,ge.eD)(),(e=>e.address)),a=(0,i.map)(t,(e=>e.address));return(0,i.filter)(a,(t=>e.includes(t))).length>0}),[t]),o=(0,l.t)("messages.warning.sending_to_yourself",{defaultValue:"You are sending this message to yourself"});return a?r().createElement(De,{text:o,icon:"AlertCircleOutline",iconColor:"info",bottomBorderColor:"info"}):null},We=r().forwardRef((function({editorId:e,closeController:t},a){const{setAutoSendTime:i}=(0,d.rf)(e),[c,m]=(0,n.useState)(!1),{status:u,saveDraft:p}=(0,d.v1)(e),{did:h}=(0,d.YO)(e),{status:b,send:C}=(0,d.ZJ)(e),f=(0,d.a)(e),E=(0,o.useSnackbar)(),[y,k]=(0,n.useState)(!1),{addStandardAttachments:_,addInlineAttachments:x}=(0,d.de)(e),I=(()=>{const e=(0,ce.g)();return(0,n.useCallback)((({editorId:t,draftId:a,onConfirm:n})=>{const o=()=>{(0,d.dL)({id:t})};if(a&&t){const t=e({children:r().createElement(s.t,null,r().createElement(se,{ids:[a],onDelete:o,onConfirm:()=>n?.(),onClose:()=>t()}))},!0)}}),[e])})(),A=(0,n.useCallback)((e=>{e!==v.Dz.EXTERNAL_CLOSE_REQUEST&&t&&t()}),[t]),T=(0,n.useCallback)((()=>{p()}),[p]);(0,n.useImperativeHandle)(a,(()=>({closeEditView:()=>{h&&I({onConfirm:()=>{(0,d.dL)({id:e}),A(v.Dz.EXTERNAL_CLOSE_REQUEST)},draftId:h,editorId:e})}})),[A,h,e,I]);const S=(0,n.useCallback)(((t,a)=>{E({key:"send",replace:!0,type:"info",label:(0,l.t)("messages.snackbar.sending_mail_in_count",{count:t,defaultValue_one:"Sending your message in {{count}} second",defaultValue_other:"Sending your message in {{count}} seconds"}),autoHideTimeout:1e3*(t??0),hideButton:!a,actionLabel:(0,l.t)("label.undo","Undo"),onActionClick:()=>{a(),(0,l.addBoard)({url:`${v.lU}/edit?action=${v.F5.RESUME}&id=${e}`,title:""})}})}),[E,e]),z=(0,n.useCallback)((()=>{E({key:`mail-${e}`,replace:!0,type:"error",label:(0,l.t)("label.error_try_again","Something went wrong, please try again"),autoHideTimeout:v.fT.SNACKBAR_DEFAULT_TIMEOUT,hideButton:!0}),(0,l.addBoard)({url:`${v.lU}/edit?action=${v.F5.RESUME}&id=${e}`,title:""})}),[E,e]),D=(0,n.useCallback)((()=>{E({key:`mail-${e}`,replace:!0,type:"success",label:(0,l.t)("messages.snackbar.mail_sent","Message sent"),autoHideTimeout:v.fT.SNACKBAR_DEFAULT_TIMEOUT,hideButton:!0}),(0,d.dL)({id:e})}),[E,e]),R=(0,o.useModal)(),L=(0,n.useMemo)((()=>(0,ge.vj)().length>1),[]),M=(0,n.useCallback)((e=>{const t=e?.dataTransfer?.types;t?.includes("contact")?k(!1):(e.preventDefault(),k(!0))}),[]),B=(0,n.useCallback)((e=>{e.preventDefault(),k(!1);const t=e?.dataTransfer?.files;if(!t)return;const a=ee(t);_(a)}),[_]),N=(0,n.useCallback)((e=>{e.preventDefault(),k(!1)}),[]),F="flex-start",O=(0,n.useCallback)((({editor:e,files:t})=>{const a=ee(t);x(a,{onSaveComplete:t=>{t.forEach((t=>{const a=`&nbsp;<img pnsrc="${t.cidUrl}" data-mce-src="${t.cidUrl}" src="${t.downloadServiceUrl}" /><br/>`;e?.activeEditor?.insertContent(a)}))}})}),[x]),{savedStandardAttachments:P}=(0,d.de)(e),U=(0,n.useMemo)((()=>P.filter((e=>e.requiresSmartLinkConversion)).map((e=>({draftId:e.messageId,partName:e.partName})))),[P]),[j,$]=(0,n.useState)(!1),Z=(0,n.useCallback)((()=>($(!0),(0,Fe.Pc)({editorId:e,t:l.t,createSnackbar:E}).finally((()=>$(!1))))),[e,E]),q=(0,n.useCallback)((()=>{g({editorId:e,hasAttachments:P.length>0,onConfirmCallback:async()=>{if(A(v.Dz.MESSAGE_SENT),U.length>0)try{await Z()}catch(e){return void z?.()}C({onCountdownTick:S,onComplete:D,onError:z})},createModal:R})}),[e,P,A,R,U.length,C,S,D,z,Z]),W=(0,n.useCallback)((t=>{g({editorId:e,onConfirmCallback:async()=>{if(U.length>0)try{await Z()}catch(e){return void z?.()}i(t),p(),A(v.Dz.MESSAGE_SEND_SCHEDULED)},createModal:R,hasAttachments:P.length>0})}),[e,R,P,U.length,i,p,A,Z,z]);return r().createElement(o.Container,{"data-testid":"edit-view-editor",mainAlignment:F,crossAlignment:F,padding:{all:"large"},background:"white",onDragOver:M},y&&r().createElement(w,{onDragOverEvent:M,onDropEvent:B,onDragLeaveEvent:N}),r().createElement(Te.s,{mainAlignment:F,crossAlignment:F,gap:"large"},r().createElement(Te.B,{mainAlignment:L?"space-between":"flex-end",orientation:"horizontal",width:"fill",gap:"medium"},L&&r().createElement(Ze,{editorId:e}),r().createElement(Te.B,{mainAlignment:"flex-end",gap:"medium"},r().createElement($e,{editorId:e}),r().createElement(je,{editorId:e}),r().createElement(o.Tooltip,{label:u?.reason,disabled:u?.allowed},r().createElement(o.Button,{"data-testid":"BtnSaveMail",type:"outlined",onClick:T,label:`${(0,l.t)("label.save","Save")}`,disabled:!u?.allowed})),r().createElement(we,{onSendLater:W,onSendNow:q,disabled:c||!b?.allowed||j,tooltip:b?.reason??"",isLoading:j}))),r().createElement(qe,{editorId:e}),r().createElement(Le,{editorId:e,isMailSizeWarning:c,setIsMailSizeWarning:m}),r().createElement(Te.s,{mainAlignment:F,crossAlignment:F,background:"white",padding:{all:"small"},gap:"small"},r().createElement(o.Container,{mainAlignment:F,crossAlignment:F,height:"fit"},r().createElement(Pe,{editorId:e})),r().createElement(o.Container,{mainAlignment:F,crossAlignment:F,height:"fit"},r().createElement(Ue,{editorId:e})),r().createElement(X,{editorId:e}),r().createElement(Oe,{onDragOver:M,onFilesSelected:O,editorId:e,minHeight:0,disabled:!1}),r().createElement(ue,{processStatus:f}))))}));var He=a(8698);function Ve(e,t){return new URLSearchParams((0,He.useLocation)().search).get(e)||t}var Ge=a(7656),Ye=a(348),Ke=a(903);const Je=(0,n.memo)(We),Xe=({action:e,entityId:t,message:a})=>{const o=(0,le.j)(),i=(0,l.useBoard)(),c=(0,l.useBoardHooks)(),s=(0,n.useRef)(null),m=(0,n.useRef)(!1),u=i.context?.editorId;u&&(e=v.F5.RESUME,t=u);const g=i.context?.compositionData,p=(0,Ke.hZ)({action:e,id:t,messagesStoreDispatch:o,message:a,compositionData:g});if(!p)throw new Error("No editor provided");e!==v.F5.RESUME&&(0,d.T3)({id:p.id,editor:p});const h=(0,n.useMemo)((()=>c?.updateBoard),[c?.updateBoard]);(0,n.useEffect)((()=>{h({onClose:()=>{m.current||(m.current=!1,s?.current?.closeEditView&&s.current.closeEditView())}})}),[h]);const b=(0,n.useCallback)((()=>{m.current=!0,(0,l.closeBoard)(i.id)}),[i.id]);i&&!i.context?.editorId&&(0,l.updateBoardContext)(i.id,{...i.context,editorId:p.id});const{subject:C}=(0,d.Fj)(p.id);return C&&i?.title!==C&&h({title:C??(0,l.t)("messages,new_email","new email")}),r().createElement(Je,{editorId:p.id,ref:s,closeController:b})},Qe=(0,n.memo)(Xe),et=()=>{const e=(0,le.j)(),{action:t,id:a}=((e,t)=>({action:Object.values(v.F5).includes(e)?e:v.F5.NEW,id:e===v.F5.NEW?void 0:t}))(Ve("action"),Ve("id")),l=(0,n.useMemo)((()=>(e=>[v.F5.REPLY,v.F5.REPLY_ALL,v.F5.FORWARD,v.F5.EDIT_AS_NEW,v.F5.EDIT_AS_DRAFT].includes(e))(t)&&!!a),[t,a]),c=(0,le.G)((e=>l&&a?(0,Ye.kp)(e,a):void 0)),s=(0,n.useMemo)((()=>l&&!c?.isComplete),[l,c?.isComplete]);return(0,n.useEffect)((()=>{s&&a&&e((0,Ge.qG)({msgId:a}))}),[a,s,e]),s?r().createElement(o.Container,null,r().createElement(o.Button,{loading:!0,disabled:!0,label:"",type:"ghost",onClick:i.noop})):r().createElement(Qe,{entityId:a,action:t,message:c})}}}]);
//# sourceMappingURL=mails-edit-view.8d388537.chunk.js.map