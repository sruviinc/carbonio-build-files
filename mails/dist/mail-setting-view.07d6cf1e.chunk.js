"use strict";(self.webpackChunkcarbonio_mails_ui=self.webpackChunkcarbonio_mails_ui||[]).push([[949],{6764:(e,t,a)=>{a.d(t,{D:()=>m});var l=a(4899),n=a(7559),i=a.n(n),r=a(4710),s=a.n(r);const o=(0,r.keyframes)(["from{transform:rotate(0deg);}to{transform:rotate(360deg);}"]),c=s().svg.withConfig({displayName:"animated-loader__AnimatedLoaderSvg",componentId:"sc-uv4h3o-0"})(["animation:"," 3s ease-in-out infinite normal forwards;"],o),m=e=>i().createElement(c,(0,l.A)({id:"e9AcbENh5Z71",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",shapeRendering:"geometricPrecision",textRendering:"geometricPrecision",fill:"currentColor"},e),i().createElement("g",{id:"e9AcbENh5Z72"},i().createElement("path",{id:"e9AcbENh5Z73",d:"M12,2C11.734800,2,11.480400,2.105360,11.292900,2.292890C11.105400,2.480430,11,2.734780,11,3L11,5C11,5.265220,11.105400,5.519570,11.292900,5.707110C11.480400,5.894640,11.734800,6,12,6C12.265200,6,12.519600,5.894640,12.707100,5.707110C12.894600,5.519570,13,5.265220,13,5L13,3C13,2.734780,12.894600,2.480430,12.707100,2.292890C12.519600,2.105360,12.265200,2,12,2L12,2Z",fill:"rgb(65,65,65)",stroke:"none",strokeWidth:"1"}),i().createElement("path",{id:"e9AcbENh5Z74",d:"M21,11L19,11C18.734800,11,18.480400,11.105400,18.292900,11.292900C18.105400,11.480400,18,11.734800,18,12C18,12.265200,18.105400,12.519600,18.292900,12.707100C18.480400,12.894600,18.734800,13,19,13L21,13C21.265200,13,21.519600,12.894600,21.707100,12.707100C21.894600,12.519600,22,12.265200,22,12C22,11.734800,21.894600,11.480400,21.707100,11.292900C21.519600,11.105400,21.265200,11,21,11Z",fill:"rgb(65,65,65)",stroke:"none",strokeWidth:"1"}),i().createElement("path",{id:"e9AcbENh5Z75",d:"M6,12C6,11.734800,5.894640,11.480400,5.707110,11.292900C5.519570,11.105400,5.265220,11,5,11L3,11C2.734780,11,2.480430,11.105400,2.292890,11.292900C2.105360,11.480400,2,11.734800,2,12C2,12.265200,2.105360,12.519600,2.292890,12.707100C2.480430,12.894600,2.734780,13,3,13L5,13C5.265220,13,5.519570,12.894600,5.707110,12.707100C5.894640,12.519600,6,12.265200,6,12Z",transform:"matrix(1 0 0 1 0.26234975000000 0)",fill:"rgb(65,65,65)",stroke:"none",strokeWidth:"1"}),i().createElement("path",{id:"e9AcbENh5Z76",d:"M6.220230,4.999950C6.025300,4.815620,5.765120,4.716280,5.496950,4.723780C5.228770,4.731290,4.974560,4.845010,4.790230,5.039950C4.605910,5.234880,4.506570,5.495050,4.514070,5.763230C4.521570,6.031410,4.635300,6.285620,4.830230,6.469950L6.270230,7.859950C6.366870,7.953260,6.481310,8.026140,6.606730,8.074250C6.732150,8.122360,6.865980,8.144700,7.000230,8.139950C7.134940,8.139430,7.268150,8.111710,7.391870,8.058440C7.515600,8.005170,7.627280,7.927450,7.720230,7.829950C7.906480,7.642580,8.011020,7.389130,8.011020,7.124950C8.011020,6.860760,7.906480,6.607310,7.720230,6.419950L6.220230,4.999950Z",transform:"matrix(1 0 0 1 0.02050050000000 0)",fill:"rgb(43,115,210)",stroke:"none",strokeWidth:"1"}),i().createElement("path",{id:"e9AcbENh5Z77",d:"M16.999600,8.139990C17.257100,8.138970,17.504200,8.038670,17.689600,7.859990L19.129600,6.469990C19.305300,6.286440,19.404500,6.042910,19.407100,5.788860C19.409700,5.534810,19.315600,5.289290,19.143700,5.102160C18.971900,4.915030,18.735200,4.800340,18.481900,4.781360C18.228500,4.762380,17.977400,4.840550,17.779600,4.999990L16.339600,6.419990C16.153400,6.607350,16.048800,6.860810,16.048800,7.124990C16.048800,7.389180,16.153400,7.642630,16.339600,7.829990C16.512800,8.012710,16.748400,8.123410,16.999600,8.139990Z",fill:"rgb(65,65,65)",stroke:"none",strokeWidth:"1"}),i().createElement("path",{id:"e9AcbENh5Z78",d:"M12,18C11.734800,18,11.480400,18.105400,11.292900,18.292900C11.105400,18.480400,11,18.734800,11,19L11,21C11,21.265200,11.105400,21.519600,11.292900,21.707100C11.480400,21.894600,11.734800,22,12,22C12.265200,22,12.519600,21.894600,12.707100,21.707100C12.894600,21.519600,13,21.265200,13,21L13,19C13,18.734800,12.894600,18.480400,12.707100,18.292900C12.519600,18.105400,12.265200,18,12,18Z",fill:"rgb(65,65,65)",stroke:"none",strokeWidth:"1"}),i().createElement("path",{id:"e9AcbENh5Z79",d:"M17.729900,16.140000C17.538900,15.955600,17.282600,15.854700,17.017200,15.859400C16.751800,15.864100,16.499200,15.974000,16.314900,16.165000C16.130600,16.355900,16.029600,16.612300,16.034300,16.877600C16.039000,17.143000,16.148900,17.395600,16.339900,17.580000L17.779900,19C17.965300,19.178600,18.212400,19.278900,18.469900,19.280000C18.603900,19.280700,18.736700,19.254600,18.860300,19.203100C18.984000,19.151500,19.096100,19.075700,19.189900,18.980000C19.283600,18.887000,19.358000,18.776400,19.408800,18.654500C19.459600,18.532700,19.485700,18.402000,19.485700,18.270000C19.485700,18.138000,19.459600,18.007200,19.408800,17.885400C19.358000,17.763500,19.283600,17.652900,19.189900,17.560000L17.729900,16.140000Z",transform:"matrix(1 0 0 1 -0.03194850000000 0)",fill:"rgb(65,65,65)",stroke:"none",strokeWidth:"1"}),i().createElement("path",{id:"e9AcbENh5Z710",d:"M6.269980,16.140000L4.829980,17.530000C4.736250,17.623000,4.661860,17.733600,4.611090,17.855400C4.560320,17.977300,4.534180,18.108000,4.534180,18.240000C4.534180,18.372000,4.560320,18.502700,4.611090,18.624600C4.661860,18.746400,4.736250,18.857000,4.829980,18.950000C4.923770,19.045700,5.035840,19.121600,5.159520,19.173100C5.283210,19.224600,5.415990,19.250800,5.549980,19.250000C5.796490,19.252100,6.035090,19.163100,6.219980,19L7.659980,17.610000C7.850930,17.425700,7.960850,17.173000,7.965530,16.907700C7.970220,16.642300,7.869300,16.385900,7.684980,16.195000C7.500650,16.004000,7.248020,15.894100,6.982660,15.889400C6.717290,15.884800,6.460930,15.985700,6.269980,16.170000L6.269980,16.140000Z",fill:"rgb(65,65,65)",stroke:"none",strokeWidth:"1"})))},8555:(e,t,a)=>{async function l(e){return Promise.allSettled([e]).then((async([e])=>{if("fulfilled"===e.status){const t=await e.value.text();return t?{data:JSON.parse(t)}:{data:{}}}return{error:e.reason}}))}a.d(t,{M:()=>l})},152:(e,t,a)=>{a.d(t,{R:()=>o});const l=/<p[^>]*>/g,n=/<br[^>]*>/g,i=/<div[^>]*>/g,r=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,s=/<style\b[^<]*(?:(?!<\/style>)<[^<]*)*<\/style>/gi,o=e=>{if(!e)return"";let t=e.replace(r,"").replace(s,"").replace(l,"\n\n<p>").replace(n,"\n").replace(i,"\n<div>");return t=(new DOMParser).parseFromString(t,"text/html").body.textContent||"",t}},2958:(e,t,a)=>{a.d(t,{B:()=>u,s:()=>d});var l=a(4899),n=a(7559),i=a.n(n),r=a(4702),s=a(4710),o=a.n(s);const c=o()(r.Container).withConfig({displayName:"gap-container__StyledGapContainer",componentId:"sc-174ivj7-0"})(["gap:",";"],(({theme:e,gap:t})=>t&&(0,r.getPadding)(t,e))),m=o()(r.Row).withConfig({displayName:"gap-container__StyledGapRow",componentId:"sc-174ivj7-1"})(["gap:",";"],(({theme:e,gap:t})=>t&&(0,r.getPadding)(t,e))),d=i().forwardRef((function({children:e,...t},a){return i().createElement(c,(0,l.A)({ref:a},t),e)})),u=i().forwardRef((function({children:e,...t},a){return i().createElement(m,(0,l.A)({ref:a},t),e)}))},5740:(e,t,a)=>{a.d(t,{U0:()=>o,gU:()=>m,vb:()=>s});var l=a(7196),n=a(2509),i=a(152),r=a(1347);const s="11111111-1111-1111-1111-111111111111",o="No signature",c=new RegExp(`^(${r.Vv.SIGNATURE_PRE_SEP}\\n)(((?!\\s${r.Vv.PLAINTEXT_SEP}$).)*)`,"ms"),m=(e,t="")=>{const a=""!==t?((e,t)=>((e,t,a)=>{const l=(e=>{const t=[{label:o,value:{description:"",id:s}}];return(0,n.map)(e?.signatures?.signature,(e=>t.push({label:e.name,value:{description:e.content?e.content[0]._content:"",id:e?.id}}))),t})(e);return(0,n.find)(l,(e=>e.value.id===t))??(a?l?.[0]:void 0)})(e,t)?.value.description??"")((0,l.getUserAccount)(),t):"",m=""!==a?`\n${(0,i.R)(a)}\n\n`:"",d=((e,t)=>{const a=(new DOMParser).parseFromString(e,"text/html"),l=a.getElementsByClassName(r.Vv.SIGNATURE_CLASS);let n=null;const i=a.getElementById(r.Vv.HTML_SEP_ID);return n=l.item(0),null==n||i&&n.compareDocumentPosition(i)!==Node.DOCUMENT_POSITION_FOLLOWING?e:(n.innerHTML=t,a.documentElement.innerHTML)})(e.richText,a);return{plainText:((e,t)=>{if(!e.match(c))return e;const a=e.indexOf(r.Vv.PLAINTEXT_SEP),l=e.match(c);return!l||a>=0&&a<(l.index??0)?e:e.replace(c,`$1${t}`)})(e.plainText,m),richText:d}}},6978:(e,t,a)=>{a.d(t,{U:()=>l});const l="#c2e7ff"},4990:(e,t,a)=>{a.d(t,{i:()=>d});var l=a(7559),n=a.n(l),i=a(4702),r=a(7196),s=a(2509),o=a(9628),c=a(9902),m=a(9431);const d=({folder:e,onClose:t,headerTitle:a,actionLabel:d,actionTooltip:u,disabledActionTooltip:g,inputLabel:b,confirmAction:f,showSharedAccounts:p,showTrashFolder:h,showSpamFolder:v,allowFolderCreation:E,allowRootSelection:C})=>{const[y,k]=(0,l.useState)(e),w=(0,l.useCallback)((()=>{f(y,k,t)}),[f,y,t]),_=(0,l.useMemo)((()=>(0,s.isNil)(y)||y?.id===e?.l),[e?.l,y]),S=_?g??(0,r.t)("label.folder_not_valid_destination","The selected folder is not a valid destination"):u;return n().createElement(i.Container,{padding:{all:"large"},mainAlignment:"center",crossAlignment:"flex-start",height:"fit",style:{overflowY:"auto"}},n().createElement(c.A,{onClose:t,title:a}),n().createElement(i.Container,{"data-testid":"select-folder-modal",padding:{all:"small"},mainAlignment:"center",crossAlignment:"flex-start",height:"fit",style:{overflowY:"auto"}},n().createElement(i.Container,{padding:{all:"small"},mainAlignment:"center",crossAlignment:"flex-start"},n().createElement(i.Text,{overflow:"break-word"},b)),n().createElement(m.W,{selectedFolderId:y?.id,onFolderSelected:k,showTrashFolder:h,showSpamFolder:v,allowFolderCreation:E,allowRootSelection:C,showSharedAccounts:p}),n().createElement(o.A,{tooltip:S,onConfirm:w,secondaryAction:t,label:d,secondaryLabel:(0,r.t)("label.cancel","Cancel"),disabled:_})))}},2103:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ot});var l=a(7559),n=a.n(l),i=a(4702),r=a(7196),s=a(2509),o=a(5740);const c=(e,t)=>(0,s.filter)(e,(e=>e.value===t))[0]?.label,m=({title:e,size:t="large"})=>n().createElement(n().Fragment,null,n().createElement(i.Padding,{top:"medium"}),n().createElement(i.Row,{padding:{right:"small"},mainAlignment:"baseline",crossAlignment:"baseline",width:"100%"},n().createElement(i.Text,{size:t,weight:"bold"},e)),n().createElement(i.Padding,{bottom:"medium"}));var d=a(6509);const u=({selected:e,label:t,open:a,focus:l,disabled:r})=>n().createElement(d.ZN,{orientation:"horizontal",width:"fill",crossAlignment:"center",mainAlignment:"space-between",borderRadius:"half",background:"gray5",padding:{all:"extrasmall"},disabled:r,minHeight:"3rem"},n().createElement(i.Row,{width:"100%",takeAvailableSpace:!0,mainAlignment:"space-between"},n().createElement(i.Row,{orientation:"vertical",crossAlignment:"flex-start",mainAlignment:"flex-start",padding:{left:"small"}},n().createElement(i.Text,{size:"small",color:a||l?"primary":r?"gray2":"secondary"},t),n().createElement(d.qN,{color:r?"gray2":"text"},e?.[0]?.label))),n().createElement(i.Icon,{size:"large",icon:a?"ChevronUpOutline":"ChevronDownOutline",color:a||l?"primary":"secondary",style:{alignSelf:"center"}})),g=({onChange:e,defaultSelection:t,label:a,items:r,disabled:o=!1})=>{const c=(0,l.useMemo)((()=>(e=>(0,s.map)(e,(e=>({label:e?.label,value:e?.value,customComponent:n().createElement(i.Container,{width:"100%",mainAlignment:"space-between",orientation:"horizontal",height:"fit"},n().createElement(i.Padding,{left:"small"},n().createElement(d.qN,null,e?.label)))}))))(r)),[r]);return n().createElement(i.Select,{label:a,background:"white",style:{border:"1px solid lightgray"},disabled:o,onChange:e,items:c,defaultSelection:t,LabelFactory:u,maxHeight:"20vh",dropdownWidth:"auto","data-testid":"field-select"})};var b=a(5574),f=a(7612),p=a(4710),h=a.n(p);const v=h()(i.Container).withConfig({displayName:"color-picker__ColorBox",componentId:"sc-1clu84w-0"})(["width:1.75rem;height:1.75rem;border-radius:0.5rem;border:0.1875rem solid #fff;box-shadow:0 0 0 0.0625rem rgba(0,0,0,0.1),inset 0 0 0 0.0625rem rgba(0,0,0,0.1);cursor:",";background-color:",";opacity:",";"],(({disabled:e})=>e?"no-drop":"pointer"),(({color:e})=>e),(({disabled:e})=>e?"0.5":"1")),E=h()(i.Container).withConfig({displayName:"color-picker__PopOver",componentId:"sc-1clu84w-1"})(["position:absolute;top:calc(100% + 0.125rem);left:0;width:12.5rem;height:12.5rem;border-radius:0.5625rem;box-shadow:0 0.375rem 0.75rem rgba(0,0,0,0.15);"]),C=({color:e,onChange:t,disabled:a=!1})=>{const r=(0,l.useRef)(null),[s,o]=(0,l.useState)(!1),c=(0,l.useCallback)((()=>o(!1)),[]);return m=r,u=c,(0,l.useEffect)((()=>{let e=!1,t=!1;const a=a=>{!e&&t&&m.current&&!m.current.contains(a.target)&&u(a)},l=a=>{t=m.current,e=m.current&&m.current.contains(a.target)};return document.addEventListener("mousedown",l),document.addEventListener("touchstart",l),document.addEventListener("click",a),()=>{document.removeEventListener("mousedown",l),document.removeEventListener("touchstart",l),document.removeEventListener("click",a)}}),[m,u]),n().createElement(d.ZN,{orientation:"horizontal",width:"fit",borderRadius:"half",background:"gray5",padding:{all:"small"},style:{cursor:a?"no-drop":"pointer"},onClick:()=>a?null:o(!0),height:"3rem"},n().createElement(i.Container,{style:{position:"relative"},orientation:"horizontal",width:"fit"},n().createElement(v,{color:e,disabled:a}),s&&n().createElement(E,{ref:r},n().createElement(f.jI,{color:e,onChange:t})),n().createElement(i.Icon,{size:"large",icon:s?"ChevronUpOutline":"ChevronDownOutline",color:s?"primary":"secondary",style:{alignSelf:"center"}})));var m,u},y=({settingsObj:e,updateSettings:t})=>{const[a,s]=(0,l.useState)(e?.zimbraPrefHtmlEditorDefaultFontColor??"#aabbcc"),o=(0,l.useMemo)((()=>(0,b.SW)()),[]),d=(0,l.useMemo)((()=>[{label:(0,r.t)("settings.font_size",{count:"8",defaultValue:"{{count}} pt"}),value:"8pt"},{label:(0,r.t)("settings.font_size",{count:"9",defaultValue:"{{count}} pt"}),value:"9pt"},{label:(0,r.t)("settings.font_size",{count:"10",defaultValue:"{{count}} pt"}),value:"10pt"},{label:(0,r.t)("settings.font_size",{count:"11",defaultValue:"{{count}} pt"}),value:"11pt"},{label:(0,r.t)("settings.font_size",{count:"12",defaultValue:"{{count}} pt"}),value:"12pt"},{label:(0,r.t)("settings.font_size",{count:"13",defaultValue:"{{count}} pt"}),value:"13pt"},{label:(0,r.t)("settings.font_size",{count:"14",defaultValue:"{{count}} pt"}),value:"14pt"},{label:(0,r.t)("settings.font_size",{count:"16",defaultValue:"{{count}} pt"}),value:"16pt"},{label:(0,r.t)("settings.font_size",{count:"18",defaultValue:"{{count}} pt"}),value:"18pt"},{label:(0,r.t)("settings.font_size",{count:"24",defaultValue:"{{count}} pt"}),value:"24pt"},{label:(0,r.t)("settings.font_size",{count:"36",defaultValue:"{{count}} pt"}),value:"36pt"},{label:(0,r.t)("settings.font_size",{count:"48",defaultValue:"{{count}} pt"}),value:"48pt"}]),[]),u=(0,l.useMemo)((()=>[{label:(0,r.t)("settings.fonts.sans_serif","Sans Serif"),value:"arial,helvetica,sans-serif"},{label:(0,r.t)("settings.fonts.serif","Serif"),value:"times new roman,new york,times,serif"},{label:(0,r.t)("settings.fonts.wide_block","Wide Block"),value:"arial black,avant garde"},{label:(0,r.t)("settings.fonts.monospaced","Monospaced"),value:"courier new,courier,monaco,monospace,sans-serif"},{label:(0,r.t)("settings.fonts.comic","Comic"),value:"comic sans ms,comic sans,sans-serif"},{label:(0,r.t)("settings.fonts.console","Console"),value:"lucida console,sans-serif"},{label:(0,r.t)("settings.fonts.garamond","Garamond"),value:"garamond,new york,times,serif"},{label:(0,r.t)("settings.fonts.elegant","Elegant"),value:"georgia,serif"},{label:(0,r.t)("settings.fonts.professional","Professional"),value:"tahoma,new york,times,serif"},{label:(0,r.t)("settings.fonts.terminal","Terminal"),value:"terminal,monaco"},{label:(0,r.t)("settings.fonts.modern","Modern"),value:"trebuchet ms,sans-serif"},{label:(0,r.t)("settings.fonts.wide","Wide"),value:"verdana,helvetica,sans-serif"}]),[]),f=(0,l.useCallback)((e=>{s(e),t({target:{name:"zimbraPrefHtmlEditorDefaultFontColor",value:e}})}),[t]),p=(0,l.useMemo)((()=>({label:c(d,e.zimbraPrefHtmlEditorDefaultFontSize),value:e.zimbraPrefHtmlEditorDefaultFontSize})),[d,e.zimbraPrefHtmlEditorDefaultFontSize]),h=(0,l.useMemo)((()=>({label:c(u,e.zimbraPrefHtmlEditorDefaultFontFamily),value:e.zimbraPrefHtmlEditorDefaultFontFamily})),[u,e.zimbraPrefHtmlEditorDefaultFontFamily]),v=(0,l.useMemo)((()=>"text"===e?.zimbraPrefComposeFormat),[e?.zimbraPrefComposeFormat]);return n().createElement(i.FormSubSection,{id:o.id,label:o.label,padding:{all:"medium"}},n().createElement(i.Container,{crossAlignment:"baseline",padding:{horizontal:"small",bottom:"small",top:"medium"}},n().createElement(i.Container,{orientation:"horizontal",crossAlignment:"flex-start",mainAlignment:"flex-start"},n().createElement(i.Container,{width:"fit",orientation:"horizontal",crossAlignment:"flex-start",mainAlignment:"flex-start"},n().createElement(m,{title:(0,r.t)("labels.compose_colin","Compose :"),size:"small"})," ",n().createElement(i.RadioGroup,{style:{width:"100%"},value:e?.zimbraPrefComposeFormat,onChange:e=>{t({target:{name:"zimbraPrefComposeFormat",value:e}})}},n().createElement(i.Radio,{width:"100%",label:(0,r.t)("label.as_html","As HTML"),value:"html"}),n().createElement(i.Radio,{width:"100%",label:(0,r.t)("label.as_text","As Text"),value:"text"}))),n().createElement(i.Container,{orientation:"horizontal",crossAlignment:"flex-start",mainAlignment:"space-between",padding:{left:"medium"},maxWidth:"40vw"},n().createElement(i.Container,{padding:{right:"small"},minWidth:"5.9375rem"},n().createElement(g,{items:u,background:"white",disabled:v,label:(0,r.t)("settings.font","Font"),onChange:e=>t({target:{name:"zimbraPrefHtmlEditorDefaultFontFamily",value:e}}),defaultSelection:h})),n().createElement(i.Container,{padding:{right:"small"},minWidth:"6.25rem"},n().createElement(g,{items:d,background:"gray5",label:(0,r.t)("label.size","Size"),defaultSelection:p,disabled:v,onChange:e=>t({target:{name:"zimbraPrefHtmlEditorDefaultFontSize",value:e}})})),n().createElement(i.Container,{padding:{right:"small"},crossAlignment:"flex-start"},n().createElement(C,{color:a,onChange:f,disabled:v}))))))};var k=a(7431);const w=({settingsObj:e,updateSettings:t,updateProps:a,updatedProps:s})=>{const o=(0,l.useMemo)((()=>{return t=e.zimbraPrefMailPollingInterval.includes("s"),a=e.zimbraPrefMailPollingInterval.includes("m"),[{label:(0,r.t)("settings.new_mail_optn.manually","Manually"),value:a?"31536000":t?"31536000s":"31536000"},{label:(0,r.t)("settings.new_mail_optn.when_arrive","As new e-mail arrives"),value:a?"500":t?"500s":"500"},{label:(0,r.t)("settings.new_mail_optn.minute",{count:1,defaultValue:"{{count}} minute",defaultValue_plural:"{{count}} minutes"}),value:a?"1m":t?"60s":"60"},{label:(0,r.t)("settings.new_mail_optn.minute",{count:2,defaultValue:"{{count}} minute",defaultValue_plural:"{{count}} minutes"}),value:a?"2m":t?"120s":"120"},{label:(0,r.t)("settings.new_mail_optn.minute",{count:3,defaultValue:"{{count}} minute",defaultValue_plural:"{{count}} minutes"}),value:a?"3m":t?"180s":"180"},{label:(0,r.t)("settings.new_mail_optn.minute",{count:4,defaultValue:"{{count}} minute",defaultValue_plural:"{{count}} minutes"}),value:a?"4m":t?"240s":"240"},{label:(0,r.t)("settings.new_mail_optn.minute",{count:5,defaultValue:"{{count}} minute",defaultValue_plural:"{{count}} minutes"}),value:a?"5m":t?"300s":"300"},{label:(0,r.t)("settings.new_mail_optn.minute",{count:6,defaultValue:"{{count}} minute",defaultValue_plural:"{{count}} minutes"}),value:a?"6m":t?"360s":"360"},{label:(0,r.t)("settings.new_mail_optn.minute",{count:7,defaultValue:"{{count}} minute",defaultValue_plural:"{{count}} minutes"}),value:a?"7m":t?"420s":"420"},{label:(0,r.t)("settings.new_mail_optn.minute",{count:8,defaultValue:"{{count}} minute",defaultValue_plural:"{{count}} minutes"}),value:a?"8m":t?"480s":"480"},{label:(0,r.t)("settings.new_mail_optn.minute",{count:9,defaultValue:"{{count}} minute",defaultValue_plural:"{{count}} minutes"}),value:a?"9m":t?"540s":"540"},{label:(0,r.t)("settings.new_mail_optn.minute",{count:10,defaultValue:"{{count}} minute",defaultValue_plural:"{{count}} minutes"}),value:a?"10m":t?"600s":"600"},{label:(0,r.t)("settings.new_mail_optn.minute",{count:15,defaultValue:"{{count}} minute",defaultValue_plural:"{{count}} minutes"}),value:a?"15m":t?"900s":"900"}];var t,a}),[e?.zimbraPrefMailPollingInterval]),d=(0,l.useMemo)((()=>[{label:(0,r.t)("settings.display_mail_options.html","As HTML(When Possible)"),value:"TRUE"},{label:(0,r.t)("settings.display_mail_options.text","As text"),value:"FALSE"}]),[]),u=(0,l.useMemo)((()=>[{label:(0,r.t)("settings.msg_selection_optn.below_deleted","Select message below the deleted or moved message"),value:"next"},{label:(0,r.t)("settings.msg_selection_optn.above_deleted","Select message above the deleted or moved message"),value:"previous"},{label:(0,r.t)("settings.msg_selection_optn.based_on_previous","Select next message based on previous selections"),value:"adaptive"}]),[]),g=(0,l.useMemo)((()=>[{label:(0,r.t)("settings.conv_sort_option.desc","From new to old"),value:"dateDesc"},{label:(0,r.t)("settings.conv_sort_option.asc","From old to new"),value:"dateAsc"}]),[]),f=(0,l.useMemo)((()=>[{label:(0,r.t)("settings.mail_unsend_time.no_delay","No delay"),value:"0"},{label:(0,r.t)("settings.mail_unsend_time.second",{count:3,defaultValue:"{{count}} second",defaultValue_plural:"{{count}} seconds"}),value:"3"},{label:(0,r.t)("settings.mail_unsend_time.second",{count:5,defaultValue:"{{count}} second",defaultValue_plural:"{{count}} seconds"}),value:"5"},{label:(0,r.t)("settings.mail_unsend_time.second",{count:10,defaultValue:"{{count}} second",defaultValue_plural:"{{count}} seconds"}),value:"10"},{label:(0,r.t)("settings.mail_unsend_time.second",{count:20,defaultValue:"{{count}} second",defaultValue_plural:"{{count}} seconds"}),value:"20"}]),[]),p=(0,l.useMemo)((()=>(0,b.On)()),[]),h=(0,l.useCallback)((e=>t({target:{name:"zimbraPrefConversationOrder",value:e??""}})),[t]),v=(0,l.useMemo)((()=>({label:c(g,e.zimbraPrefConversationOrder),value:e.zimbraPrefConversationOrder})),[g,e.zimbraPrefConversationOrder]),E=(0,l.useMemo)((()=>({label:c(f,s?.mails_snackbar_delay?.value),value:s?.mails_snackbar_delay?.value})),[f,s?.mails_snackbar_delay]);return n().createElement(i.FormSubSection,{id:p.id,label:p.label,padding:{all:"medium"}},n().createElement(i.Row,{width:"100%",padding:{horizontal:"small",vertical:"small"}},n().createElement(i.Select,{label:(0,r.t)("settings.label.conversation_ordering","Conversation ordering"),items:g,onChange:h,defaultSelection:v,background:"white",style:{border:"1px solid lightgray"}})),n().createElement(i.Row,{width:"100%",padding:{horizontal:"small",bottom:"small"}},n().createElement(i.Select,{label:(0,r.t)("settings.label.check_new_mail","Check new e-mail"),items:o,onChange:e=>t({target:{name:"zimbraPrefMailPollingInterval",value:e??""}}),defaultSelection:{label:c(o,e.zimbraPrefMailPollingInterval),value:e.zimbraPrefMailPollingInterval},background:"white",style:{border:"1px solid lightgray"}})),n().createElement(i.Row,{width:"100%",padding:{horizontal:"small"}},n().createElement(i.Select,{label:(0,r.t)("settings.label.display_mail","Display mail"),items:d,onChange:e=>t({target:{name:"zimbraPrefMessageViewHtmlPreferred",value:e??""}}),defaultSelection:{label:c(d,e.zimbraPrefMessageViewHtmlPreferred),value:e.zimbraPrefMessageViewHtmlPreferred},background:"white",style:{border:"1px solid lightgray"}})),n().createElement(i.Container,{crossAlignment:"baseline",padding:{all:"small"}},n().createElement(m,{title:(0,r.t)("settings.label.message_selection","Message Selection")}),n().createElement(i.Select,{items:u,onChange:e=>t({target:{name:"zimbraPrefMailSelectAfterDelete",value:e??""}}),defaultSelection:{label:c(u,e.zimbraPrefMailSelectAfterDelete),value:e.zimbraPrefMailSelectAfterDelete},background:"white",style:{border:"1px solid lightgray"}})),n().createElement(i.Container,{crossAlignment:"baseline",padding:{all:"small"}},n().createElement(m,{title:(0,r.t)("settings.label.unsend_time","Set send time")}),n().createElement(i.Select,{label:(0,r.t)("settings.label.unsend_time","Set send time"),items:f,onChange:e=>a({target:{name:"mails_snackbar_delay",value:{app:k.g6,value:e??""}}}),defaultSelection:E,background:"white",style:{border:"1px solid lightgray"}})),n().createElement(i.Container,{crossAlignment:"baseline",padding:{all:"small"}},n().createElement(m,{title:(0,r.t)("settings.label.visualization_options","Visualization Options")}),n().createElement(i.RadioGroup,{style:{width:"100%"},value:e.zimbraPrefGroupMailBy,onChange:e=>{t({target:{name:"zimbraPrefGroupMailBy",value:e}})}},n().createElement(i.Radio,{width:"100%",label:(0,r.t)("label.by_conversation","By Conversation"),value:"conversation"}),n().createElement(i.Radio,{width:"100%",label:(0,r.t)("label.by_message","By Message"),value:"message"}))),n().createElement(i.Container,{crossAlignment:"baseline",padding:{all:"small"}},n().createElement(m,{title:(0,r.t)("settings.label.default_mail_search","Default Mail Search")}),n().createElement(i.Input,{label:(0,r.t)("settings.label.search_query","Default query"),value:e.zimbraPrefMailInitialSearch,onChange:e=>t({target:{name:"zimbraPrefMailInitialSearch",value:e.target.value}}),background:"white",style:{border:"1px solid lightgray"}})),n().createElement(i.Container,{crossAlignment:"baseline",padding:{all:"small"}},n().createElement(m,{title:(0,r.t)("settings.label.mark_reading_panel","Mark as read")}),n().createElement(i.RadioGroup,{style:{width:"100%"},value:"-1"===e.zimbraPrefMarkMsgRead?"-1":"0",onChange:e=>{t({target:{name:"zimbraPrefMarkMsgRead",value:e}})}},n().createElement(i.Radio,{width:"100%",label:n().createElement(i.Row,{orientation:"column",crossAlignment:"flex-start"},n().createElement(i.Text,{weight:"bold"},(0,r.t)("settings.label.default","Default"))),value:"0"}),n().createElement(i.Padding,{left:"2rem",bottom:"0.5rem"},n().createElement(i.Text,null,(0,r.t)("label.mark_read_message_immediately","Mark as read when opening the message"))),n().createElement(i.Radio,{width:"100%",label:n().createElement(i.Text,{weight:"bold"},(0,r.t)("settings.label.mark_manually","Mark Manually")),value:"-1"}),n().createElement(i.Row,{padding:{left:"2rem"},display:"inline-flex"},n().createElement(i.Text,null,(0,r.t)("label.mark_read_message_manually","Manually mark as read by clicking this icon")),n().createElement(i.Padding,{left:"small"},n().createElement(i.Icon,{size:"medium",icon:"EmailReadOutline"}))))))},_=(0,l.createContext)({incomingFilters:{},incomingLoading:!0,outgoingFilters:{},outgoingLoading:!0}),S=h()(i.Container).withConfig({displayName:"filter-item__ContainerEl",componentId:"sc-1s4cyx8-0"})([""]),F=h()(i.Row).withConfig({displayName:"filter-item__Filter",componentId:"sc-1s4cyx8-1"})(["border-bottom:0.0625rem solid ",";display:block;border-radius:0;cursor:pointer;&:hover{background-color:",";}"],(({theme:e})=>e.palette.gray2.regular),(({theme:e})=>e.palette.gray6.focus)),T=h()(i.Icon).withConfig({displayName:"filter-item__ButtonEl",componentId:"sc-1s4cyx8-2"})(["border:0.0625rem solid ",";"],(({theme:e,disabled:t})=>t?e.palette.primary.disabled:e.palette.primary.regular)),x=({item:e,selected:t,unSelect:a,listProps:r})=>{const{toggle:o,list:c,moveDown:m,moveUp:d}=r,u=(0,l.useCallback)((()=>{a(),o(e.id)}),[e.id,o,a]),g=(0,l.useMemo)((()=>t?"highlight":""),[t]),b=(0,l.useMemo)((()=>(0,s.indexOf)(c,e)),[c,e]),f=(0,l.useMemo)((()=>0===b),[b]),p=(0,l.useMemo)((()=>b===c.length-1),[b,c.length]),[h,v]=(0,l.useState)(!1),E=(0,l.useCallback)((()=>v(!0)),[]),C=(0,l.useCallback)((()=>v(!1)),[]),y=(0,l.useCallback)((()=>d(b)),[b,d]),k=(0,l.useCallback)((()=>m(b)),[b,m]);return n().createElement(F,{onClick:u,height:"fit",background:g,orientation:"horizontal",onMouseEnter:E,onMouseLeave:C},n().createElement(i.Row,{height:"2.5rem",padding:{all:"small"}},n().createElement(S,{width:"80%",crossAlignment:"flex-start"},n().createElement(i.Text,{size:"small"},e?.name)),n().createElement(i.Container,{width:"20%",orientation:"horizontal",mainAlignment:"flex-end"},h&&n().createElement(n().Fragment,null,n().createElement(T,{icon:"ArrowheadUpOutline",color:"primary",disabled:f,size:"large",onClick:y}),n().createElement(i.Padding,{right:"small"}),n().createElement(T,{icon:"ArrowheadDownOutline",color:"primary",disabled:p,size:"large",onClick:k})))))};var A=a(7625);const M=()=>{const{createSnackbar:e}=(0,A.m)();return(0,l.useCallback)((({t,activeList:a,availableList:l,setFilters:n,setFetchFilters:i,modifierFunc:r})=>{const o=a?.list?.slice(),c=l?.list?.slice(),m=(0,s.filter)(o,{id:Object.keys(a.selected)[0]}),d=(0,s.findIndex)(o,m[0]);o.splice(d,1),c.push({...m[0],active:!1});const u=(0,s.concat)(o,c);n(u),a.unSelect(),r(u).then((()=>{i(!0)})).catch((a=>{e({key:"share",replace:!0,hideButton:!0,type:"error",label:a?.message||t("label.error_try_again","Something went wrong, please try again"),autoHideTimeout:5e3})}))}),[e])},P=()=>{const{createSnackbar:e}=(0,A.m)();return(0,l.useCallback)((({t,activeList:a,availableList:l,setFilters:n,setFetchFilters:i,modifierFunc:r})=>{const o=a?.list?.slice(),c=l?.list?.slice(),m=(0,s.filter)(c,{id:Object.keys(l.selected)[0]}),d=(0,s.findIndex)(c,m[0]);c.splice(d,1),o.push({...m[0],active:!0});const u=(0,s.concat)(o,c);n(u),l.unSelect(),r(u).then((()=>{i(!0)})).catch((a=>{e({key:"filter-delete-error",type:"error",label:a.message||t("label.error_try_again","Something went wrong, please try again"),hideButton:!0})}))}),[e])};var I=a(2575);const z=(0,l.createContext)({newFilters:[],setNewFilters:e=>{}}),R=({onConfirm:e,label:t,toolTipText:a,disabled:l,checkboxLabel:r,checked:s,onSecondaryAction:o})=>n().createElement(i.Container,{mainAlignment:"center",crossAlignment:"center",padding:{top:"large"}},n().createElement(i.Divider,null),n().createElement(i.Container,{orientation:"horizontal",padding:{top:"medium"},mainAlignment:"space-between"},n().createElement(i.Checkbox,{value:s,onClick:o,label:r}),n().createElement(i.Tooltip,{label:a},n().createElement(i.Padding,{left:"small"},n().createElement(i.Button,{onClick:e,label:t,disabled:l,"data-testid":"create-button"}))))),N=e=>[{label:e("settings.matches_exactly","matches exactly"),value:{stringComparison:"is"}},{label:e("settings.does_not_match_exactly","does not match exactly"),value:{stringComparison:"is",negative:"1"}},{label:e("settings.contains","contains"),value:{stringComparison:"contains"}},{label:e("settings.does_not_contain","does not contain"),value:{negative:"1",stringComparison:"contains"}},{label:e("settings.matches_wildcard_condition","matches wildcard condition"),value:{stringComparison:"matches"}},{label:e("settings.does_not_match_wildcard_condition","does not match wildcard condition"),value:{stringComparison:"matches",negative:"1"}}],O=(e,t)=>"TRUE"===t?[{label:e("settings.redirect_to_address","Redirect to address"),value:"redirectToAddress"}]:[],L=(e,t)=>(0,s.find)(e,{value:t}),D=(e,t,a,l=!0)=>{const n=Object.keys(t.filterActions[0]),i=t.filterActions[0];if(0===e.length)return[!0,a("settings.label.filter_name_required","Filter name is required")];if(n.includes("actionTag")){let e=!1;if((0,s.forEach)(i.actionTag,(t=>{""===t.tagName&&(e=!0)})),e)return[!0,a("settings.tag_name_required",'Fill in the "Tag" field in order to complete the action "Tag with".')]}if(n.includes("actionFileInto")){let e=!1;if((0,s.forEach)(i.actionFileInto,(t=>{""===t.folderPath&&(e=!0)})),e)return[!0,a("settings.folder_path_required",'Select a destination folder in order to complete the action "Move into folder".')]}if(n.includes("actionRedirect")){let e=!1;if((0,s.forEach)(i.actionRedirect,(t=>{""===t.a&&(e=!0)})),e)return[!0,a("settings.address_required",'Fill in the "Address" field in order to complete the action "Redirect to Address".')]}return[!1,l?a("label.create","Create"):a("label.save","Save")]},j=({t:e,activeIndex:t,defaultValue:a})=>{const r=(0,l.useMemo)((()=>N(e)),[e]),[s,o]=(0,l.useState)(!1),[c,m]=(0,l.useState)(""),[d,u]=(0,l.useState)({stringComparison:"contains"}),{newFilters:b,setNewFilters:f}=(0,l.useContext)(z);(0,l.useEffect)((()=>{if(s){const e=b.slice();e[t]={...e[t],filterTests:[{...e?.[t]?.filterTests?.[0],headerTest:[{header:"subject",...d,value:c}]}]},f(e),o(!1)}}),[d,t,b,f,c,s]),(0,l.useEffect)((()=>{a&&a?.headerTest&&m(a?.headerTest?.[0]?.value)}),[a]);const p=(0,l.useCallback)((e=>{u(e),o(!0)}),[]),h=(0,l.useCallback)((e=>{m(e.target.value),o(!0)}),[]),v=(0,l.useMemo)((()=>a?.headerTest?.[0].negative?{stringComparison:a?.headerTest?.[0]?.stringComparison,negative:"1"}:{stringComparison:a?.headerTest?.[0].stringComparison}),[a]),E=(0,l.useMemo)((()=>a?L(r,v):r[2]),[r,a,v]);return n().createElement(n().Fragment,null,n().createElement(i.Container,{minWidth:"40%",maxWidth:"40%",padding:{right:"small"}},n().createElement(g,{items:r,background:"gray5",label:"",onChange:p,defaultSelection:E})),n().createElement(i.Container,{minWidth:"20%",maxWidth:"20%",padding:{right:"small"}},n().createElement(i.Input,{label:"",backgroundColor:"gray5",value:c,placeholder:e("settings.keyword","Keyword"),onChange:h})))},B=({t:e,activeIndex:t,defaultValue:a})=>{const r=(0,l.useMemo)((()=>(e=>[{label:e("settings.is","is"),value:"TRUE"},{label:e("settings.is_not","is not"),value:"FALSE"}])(e)),[e]),s=(0,l.useMemo)((()=>(e=>[{label:e("settings.conv_is_started","in conversation I started"),value:{value:{where:"started"},key:"conversationTest"}},{label:e("settings.conv_is_participated","in conversations I participated"),value:{value:{where:"participated"},key:"conversationTest"}},{label:e("settings.mass_marketing","mass marketing (bulk)"),value:{key:"bulkTest",value:{}}},{label:e("settings.from_distribution_list","from distribution list"),value:{key:"listTest",value:{}}},{label:e("label.flagged","flagged"),value:{value:{flagName:"flagged"},key:"flaggedTest"}}])(e)),[e]),[o,c]=(0,l.useState)(!1),[m,d]=(0,l.useState)("TRUE"),[u,b]=(0,l.useState)({value:{where:"started"},key:"conversationTest"}),{newFilters:f,setNewFilters:p}=(0,l.useContext)(z);(0,l.useEffect)((()=>{if(o){const e={};switch(u.key){case"conversationTest":e.conversationTest=["FALSE"===m?{...u.value,negative:"1"}:u.value];break;case"bulkTest":e.bulkTest=["FALSE"===m?{negative:"1"}:{}];break;case"listTest":e.listTest=["FALSE"===m?{negative:"1"}:{}];break;case"flaggedTest":e.flaggedTest=["FALSE"===m?{negative:"1",flagName:"flagged"}:{flagName:"flagged"}];break;default:e.conversationTest=[{where:"started"}]}const a=f.slice();a[t]={...a[t],filterTests:[{...e}]},p(a),c(!1)}}),[u,t,f,p,o,m]);const h=(0,l.useCallback)((e=>{d(e),c(!0)}),[]),v=(0,l.useCallback)((e=>{b(e),c(!0)}),[]),E=(0,l.useMemo)((()=>{if(a){const e=Object.keys(a)[0];return a[e][0]?.negative?r[1]:r[0]}return r[0]}),[a,r]),C=(0,l.useMemo)((()=>{if(a){const e=Object.keys(a)[0];switch(e){case"conversationTest":return"started"===a[e][0]?.where?s[0]:s[1];case"bulkTest":return s[2];case"listTest":return s[3];case"flaggedTest":return s[4];default:return s[0]}}return s[0]}),[a,s]);return n().createElement(n().Fragment,null,n().createElement(i.Container,{minWidth:"30%",maxWidth:"30%",padding:{right:"small"}},n().createElement(g,{items:r,background:"gray5",label:"",onChange:h,defaultSelection:E})),n().createElement(i.Container,{minWidth:"30%",maxWidth:"30%",padding:{right:"small"}},n().createElement(g,{items:s,background:"gray5",label:"",onChange:v,defaultSelection:C})))},W=({t:e,activeIndex:t,defaultValue:a})=>{const r=(0,l.useMemo)((()=>N(e)),[e]),s=(0,l.useMemo)((()=>(e=>[{label:e("label.all","all"),value:"all"},{label:e("settings.localpart","localpart"),value:"localpart"},{label:e("settings.domain","domain"),value:"domain"}])(e)),[e]),[o,c]=(0,l.useState)(!1),[m,d]=(0,l.useState)(""),[u,b]=(0,l.useState)("all"),[f,p]=(0,l.useState)({stringComparison:"contains"}),{newFilters:h,setNewFilters:v}=(0,l.useContext)(z);(0,l.useEffect)((()=>{a&&a?.addressTest&&d(a?.addressTest?.[0]?.value)}),[a]),(0,l.useEffect)((()=>{if(o){const e=h.slice();e[t]={...e[t],filterTests:[{...e[t].filterTests[0],addressTest:[{header:e[t].key,...f,value:m,part:u}]}]},v(e),c(!1)}}),[f,t,h,v,m,o,u]);const E=(0,l.useCallback)((e=>{p(e),c(!0)}),[]),C=(0,l.useCallback)((e=>{d(e.target.value),c(!0)}),[]),y=(0,l.useCallback)((e=>{b(e),c(!0)}),[]),k=(0,l.useMemo)((()=>a?L(r,a.addressTest?.[0]?.negative?{stringComparison:a?.addressTest?.[0]?.stringComparison,negative:"1"}:{stringComparison:a?.addressTest?.[0]?.stringComparison}):r[2]),[r,a]),w=(0,l.useMemo)((()=>a?L(s,a.addressTest[0].part):s[0]),[s,a]);return n().createElement(n().Fragment,null,n().createElement(i.Container,{minWidth:"30%",maxWidth:"30%",padding:{right:"small"}},n().createElement(g,{items:r,background:"gray5",label:"",onChange:E,defaultSelection:k})),n().createElement(i.Container,{minWidth:"10%",maxWidth:"10%",padding:{right:"small"}},n().createElement(g,{items:s,background:"gray5",label:"",onChange:y,defaultSelection:w})),n().createElement(i.Container,{minWidth:"20%",maxWidth:"20%",padding:{right:"small"}},n().createElement(i.Input,{backgroundColor:"gray5",value:m,onChange:C,placeholder:e("settings.keyword","Keyword")})))},V=({t:e,activeIndex:t,defaultValue:a})=>{const r=(0,l.useMemo)((()=>(e=>[{label:e("settings.under","under"),value:{numberComparison:"under"}},{label:e("settings.not_under","not under"),value:{numberComparison:"under",negative:"1"}},{label:e("settings.over","over"),value:{numberComparison:"over"}},{label:e("settings.not_over","not over"),value:{numberComparison:"over",negative:"1"}}])(e)),[e]),o=(0,l.useMemo)((()=>(e=>[{label:e("settings.b","B"),value:""},{label:e("settings.kb","KB"),value:"K"},{label:e("settings.mb","MB"),value:"M"},{label:e("settings.gb","GB"),value:"G"}])(e)),[e]),[c,m]=(0,l.useState)({numberComparison:"under"}),[d,u]=(0,l.useState)(""),[b,f]=(0,l.useState)(""),[p,h]=(0,l.useState)(!1),{newFilters:v,setNewFilters:E}=(0,l.useContext)(z);(0,l.useEffect)((()=>{if(p){const e=v.slice();e[t]={...e[t],filterTests:[{sizeTest:[{...c,s:`${b}${d}`}]}]},E(e),h(!1)}}),[t,v,E,p,c,b,d]);const C=(0,l.useCallback)((e=>{m(e),h(!0)}),[]),y=(0,l.useCallback)((e=>{u(e),h(!0)}),[]),k=(0,l.useCallback)((e=>{f(e.target.value),h(!0)}),[]),w=(0,l.useMemo)((()=>a?L(r,a?.sizeTest?.[0]?.negative?{numberComparison:a?.sizeTest?.[0]?.numberComparison,negative:"1"}:{numberComparison:a?.sizeTest?.[0]?.numberComparison}):r[0]),[a,r]),_=(0,l.useMemo)((()=>{if(a){const e=a?.sizeTest?.[0]?.s?.split(""),t=e.pop();return(0,s.includes)(["M","G","K"],t)?L(o,t):L(o,"")}return o[0]}),[a,o]);return(0,l.useEffect)((()=>{if(a&&a?.sizeTest){const e=a?.sizeTest?.[0]?.s?.split(""),t=e.pop();(0,s.includes)(["M","G","K"],t)?f(e.join("")):f(a?.sizeTest?.[0]?.s)}}),[a]),n().createElement(n().Fragment,null,n().createElement(i.Container,{minWidth:"20%",maxWidth:"20%",padding:{right:"small"}},n().createElement(g,{items:r,background:"gray5",label:"",onChange:C,defaultSelection:w})),n().createElement(i.Container,{minWidth:"20%",maxWidth:"20%",padding:{right:"small"}},n().createElement(i.Input,{type:"number",onChange:k,value:b,backgroundColor:"gray5",placeholder:"0"})),n().createElement(i.Container,{minWidth:"20%",maxWidth:"20%",padding:{right:"small"}},n().createElement(g,{items:o,background:"gray5",label:"",onChange:y,defaultSelection:_})))};var $=a(4222),H=a.n($);const U=({t:e,activeIndex:t,defaultValue:a})=>{const r=(0,l.useMemo)((()=>(e=>[{label:e("settings.before","before"),value:{dateComparison:"before"}},{label:e("settings.not_before","not before"),value:{dateComparison:"before",negative:"1"}},{label:e("settings.after","after"),value:{dateComparison:"after"}},{label:e("settings.not_after","not after"),value:{dateComparison:"after",negative:"1"}}])(e)),[e]),[s,o]=(0,l.useState)({dateComparison:"before"}),[c,m]=(0,l.useState)(H()().format("X")),[d,u]=(0,l.useState)(!1),{newFilters:b,setNewFilters:f}=(0,l.useContext)(z);(0,l.useEffect)((()=>{if(d){const e=b.slice();e[t]={...e[t],filterTests:[{dateTest:[{...s,d:`${c}`}]}]},f(e),u(!1)}}),[t,b,f,d,s,c]);const p=(0,l.useCallback)((e=>{o(e),u(!0)}),[]),h=(0,l.useCallback)((e=>{m(`${H()(e).format("X")}`),u(!0)}),[]),v=(0,l.useMemo)((()=>a?L(r,a?.dateTest?.[0].negative?{dateComparison:a?.dateTest?.[0]?.dateComparison,negative:"1"}:{dateComparison:a?.dateTest?.[0]?.dateComparison}):r[0]),[r,a]),E=(0,l.useMemo)((()=>a?.dateTest?.[0]?.d?new Date(1e3*(a?.dateTest?.[0]?.d??1)):new Date),[a]);return n().createElement(n().Fragment,null,n().createElement(i.Container,{minWidth:"40%",maxWidth:"40%",padding:{right:"small"}},n().createElement(g,{items:r,background:"gray5",label:"",onChange:p,defaultSelection:v})),n().createElement(i.Container,{minWidth:"20%",maxWidth:"20%",padding:{right:"small"}},n().createElement(i.DateTimePicker,{includeTime:!1,defaultValue:E,label:e("settings.choose_date","Choose Date"),backgroundColor:"gray5",onChange:h,dateFormat:"d/M/yyyy"})))},q=({t:e,activeIndex:t,defaultValue:a})=>{const r=(0,l.useMemo)((()=>(e=>[{label:e("settings.contains","contains"),value:{}},{label:e("settings.does_not_contain","does not contain"),value:{negative:"1"}}])(e)),[e]),[s,o]=(0,l.useState)({value:""}),[c,m]=(0,l.useState)(""),[d,u]=(0,l.useState)(!1),{newFilters:b,setNewFilters:f}=(0,l.useContext)(z);(0,l.useEffect)((()=>{if(d){const e=b.slice();e[t]={...e[t],filterTests:[{bodyTest:[{...s,value:c}]}]},f(e),u(!1)}}),[t,b,f,d,s,c]),(0,l.useEffect)((()=>{a&&a.bodyTest&&m(a.bodyTest[0].value)}),[a]);const p=(0,l.useCallback)((e=>{o(e),u(!0)}),[]),h=(0,l.useCallback)((e=>{m(e.target.value),u(!0)}),[]),v=(0,l.useMemo)((()=>a&&a.bodyTest[0].negative?r[1]:r[0]),[a,r]);return n().createElement(n().Fragment,null,n().createElement(i.Container,{minWidth:"30%",maxWidth:"30%",padding:{right:"small"}},n().createElement(g,{items:r,background:"gray5",label:"",onChange:p,defaultSelection:v})),n().createElement(i.Container,{minWidth:"30%",padding:{right:"small"}},n().createElement(i.Input,{onChange:h,placeholder:e("settings.keyword","Keyword"),backgroundColor:"gray5",value:c})))},K=({t:e,activeIndex:t,defaultValue:a})=>{const r=(0,l.useMemo)((()=>(e=>[{label:e("settings.exists","exists"),value:{}},{label:e("settings.does_not_exists","does not exist"),value:{negative:"1"}}])(e)),[e]),[s,o]=(0,l.useState)({}),[c,m]=(0,l.useState)(!1),{newFilters:d,setNewFilters:u}=(0,l.useContext)(z),b=(0,l.useMemo)((()=>a&&a.attachmentTest[0].negative?r[1]:r[0]),[a,r]);(0,l.useEffect)((()=>{if(c){const e=d.slice();e[t]={...e[t],filterTests:[{attachmentTest:[s]}]},u(e),m(!1)}}),[t,d,u,c,s]);const f=(0,l.useCallback)((e=>{o(e),m(!0)}),[]);return n().createElement(n().Fragment,null,n().createElement(i.Container,{minWidth:"60%",maxWidth:"60%",padding:{right:"small"}},n().createElement(g,{items:r,background:"gray5",label:"",onChange:f,defaultSelection:b})))},Z=({t:e,activeIndex:t,defaultValue:a})=>{const r=(0,l.useMemo)((()=>(e=>[{label:e("settings.exists","exists"),value:{header:"Content-Type",stringComparison:"Contains",value:"message/disposition-notification"}},{label:e("settings.does_not_exists","does not exist"),value:{negative:"1",header:"Content-Type",stringComparison:"Contains",value:"message/disposition-notification"}}])(e)),[e]),[s,o]=(0,l.useState)({header:"Content-Type",stringComparison:"Contains",value:"message/disposition-notification"}),[c,m]=(0,l.useState)(!1),{newFilters:d,setNewFilters:u}=(0,l.useContext)(z);(0,l.useEffect)((()=>{if(c){const e=d.slice();e[t]={...e[t],filterTests:[{mimeHeaderTest:[s]}]},u(e),m(!1)}}),[t,d,u,c,s]);const b=(0,l.useCallback)((e=>{o(e),m(!0)}),[]),f=(0,l.useMemo)((()=>a?a?.dateTest?.[0].negative?r[0]:r[1]:r[0]),[r,a]);return n().createElement(n().Fragment,null,n().createElement(i.Container,{minWidth:"60%",maxWidth:"60%",padding:{right:"small"}},n().createElement(g,{items:r,background:"gray5",label:"",onChange:b,defaultSelection:f})))},G=({t:e,activeIndex:t,defaultValue:a})=>{const r=(0,l.useMemo)((()=>(e=>[{label:e("label.from","From"),value:"FROM"},{label:e("label.to","To"),value:"TO"},{label:e("label.cc","CC"),value:"CC"},{label:e("settings.to_cc","To or Cc"),value:"TO,CC"}])(e)),[e]),s=(0,l.useMemo)((()=>(e=>[{label:e("settings.in","in"),value:{key:"in",value:{}}},{label:e("settings.not_in","not in"),value:{key:"in",value:{negative:"1"}}},{label:e("settings.is_me","is me"),value:{key:"myTest",value:{}}},{label:e("settings.is_not_me","is not me"),value:{key:"myTest",value:{negative:"1"}}}])(e)),[e]),o=(0,l.useMemo)((()=>(e=>[{label:e("settings.contacts","contacts"),value:"addressBookTest"},{label:e("settings.my_frequent_emails","my frequent e-mails"),value:"contactRankingTest"}])(e)),[e]),[c,m]=(0,l.useState)({header:"from"}),[d,u]=(0,l.useState)("FROM"),[b,f]=(0,l.useState)({key:"",value:{}}),[p,h]=(0,l.useState)("addressBookTest"),[v,E]=(0,l.useState)(!1),{newFilters:C,setNewFilters:y}=(0,l.useContext)(z);(0,l.useEffect)((()=>{if(v){const e=C.slice();e[t]={...e[t],filterTests:["in"===b.key?{addressBookTest:[{header:d,type:"contacts",...b.value}]}:{contactRankingTest:[{header:d,type:"contacts",...b.value}]}]},y(e),E(!1)}}),[t,C,y,v,c,d,b]);const k=(0,l.useCallback)((e=>{u(e),E(!0)}),[]),w=(0,l.useCallback)((e=>{f(e),E(!0)}),[]),_=(0,l.useCallback)((e=>{h(e),E(!0)}),[]),S=(0,l.useMemo)((()=>a?L(r,a[Object.keys(a)[0]][0].header):r[0]),[r,a]),F=(0,l.useMemo)((()=>a?"meTest"===Object.keys(a)[0]?a[Object.keys(a)[0]][0].negative?s[3]:s[2]:a[Object.keys(a)[0]][0].negative?s[1]:s[0]:s[0]),[s,a]),T=(0,l.useMemo)((()=>a?"meTest"!==Object.keys(a)[0]&&"myTest"!==b.key:"myTest"!==b.key),[a,b]),x=(0,l.useMemo)((()=>a&&"contactRankingTest"===Object.keys(a)[0]?o[1]:o[0]),[o,a]);return n().createElement(n().Fragment,null,n().createElement(i.Container,{minWidth:"20%",maxWidth:"20%",padding:{right:"small"}},n().createElement(g,{items:r,background:"gray5",label:"",onChange:k,defaultSelection:S})),n().createElement(i.Container,{minWidth:"20%",maxWidth:"20%",padding:{right:"small"}},n().createElement(g,{items:s,background:"gray5",label:"",onChange:w,defaultSelection:F})),T&&n().createElement(i.Container,{minWidth:"20%",maxWidth:"20%",padding:{right:"small"}},n().createElement(g,{items:o,background:"gray5",label:"",onChange:_,defaultSelection:x})))},Y=({t:e,activeIndex:t,defaultValue:a})=>{const r=(0,l.useMemo)((()=>(e=>[{label:e("settings.invite_requested","invite is requested"),value:{method:[{_content:"anyrequest"}]}},{label:e("settings.invite_not_requested","invite is not requested"),value:{negative:"1",method:[{_content:"anyrequest"}]}},{label:e("settings.invite_replied","invite is replied"),value:{method:[{_content:"anyreply"}]}},{label:e("settings.invite_not_replied","invite is not replied "),value:{negative:"1",method:[{_content:"anyreply"}]}}])(e)),[e]),[s,o]=(0,l.useState)({method:[{_content:"anyreply"}]}),[c,m]=(0,l.useState)(!1),{newFilters:d,setNewFilters:u}=(0,l.useContext)(z);(0,l.useEffect)((()=>{if(c){const e=d.slice();e[t]={...e[t],filterTests:[{inviteTest:[s]}]},u(e),m(!1)}}),[t,d,u,c,s]);const b=(0,l.useCallback)((e=>{o(e),m(!0)}),[]),f=(0,l.useMemo)((()=>a?"anyrequest"===a.inviteTest[0].method[0]._content?a.inviteTest[0].negative?r[1]:r[0]:a.inviteTest[0].negative?r[3]:r[2]:r[2]),[a,r]);return n().createElement(n().Fragment,null,n().createElement(i.Container,{minWidth:"60%",maxWidth:"60%",padding:{right:"small"}},n().createElement(g,{items:r,background:"gray5",label:"",onChange:b,defaultSelection:f})))},X=({t:e,activeIndex:t})=>{const a=(0,l.useMemo)((()=>N(e)),[e]),[r,s]=(0,l.useState)(!1),[o,c]=(0,l.useState)({stringComparison:"contains"}),[m,d]=(0,l.useState)("header"),[u,b]=(0,l.useState)(""),{newFilters:f,setNewFilters:p}=(0,l.useContext)(z);(0,l.useEffect)((()=>{if(r){const e=f.slice();e[t]={...e[t],filterTests:[{headerTest:[{header:m,...o,value:u}]}]},p(e),s(!1)}}),[t,f,p,u,r,m,o]);const h=(0,l.useCallback)((e=>{c(e),s(!0)}),[]),v=(0,l.useCallback)((e=>{b(e.target.value),s(!0)}),[]),E=(0,l.useCallback)((e=>{d(e.target.value),s(!0)}),[]);return n().createElement(n().Fragment,null,n().createElement(i.Container,{minWidth:"20%",maxWidth:"20%",padding:{right:"small"}},n().createElement(i.Input,{backgroundColor:"gray5",defaultValue:"header",onChange:E})),n().createElement(i.Container,{minWidth:"20%",maxWidth:"20%",padding:{right:"small"}},n().createElement(g,{items:a,background:"gray5",label:"",onChange:h,defaultSelection:a[2]})),n().createElement(i.Container,{minWidth:"20%",maxWidth:"20%",padding:{right:"small"}},n().createElement(i.Input,{backgroundColor:"gray5",onChange:v})))},J=({t:e,activeIndex:t,defaultValue:a})=>{const r=(0,l.useMemo)((()=>(e=>[{label:e("settings.linkedin_msg","LinkedIn messages and connections"),value:{linkedinTest:[{}]}},{label:e("settings.twitter_notification","Twitter notifications"),value:{twitterTest:[{}]}},{label:e("settings.facebook_notification","Facebook notification"),value:{facebookTest:[{}]}}])(e)),[e]),[s,o]=(0,l.useState)({linkedinTest:[{}]}),[c,m]=(0,l.useState)(!1),{newFilters:d,setNewFilters:u}=(0,l.useContext)(z);(0,l.useEffect)((()=>{if(c){const e=d.slice();e[t]={...e[t],filterTests:[{...s}]},u(e),m(!1)}}),[t,d,u,c,s]);const b=(0,l.useCallback)((e=>{o(e),m(!0)}),[]),f=(0,l.useMemo)((()=>{if(a)switch(Object.keys(a)[0]){case"linkedinTest":return r[0];case"twitterTest":return r[1];default:return r[2]}return r[0]}),[a,r]);return n().createElement(n().Fragment,null,n().createElement(i.Container,{minWidth:"60%",maxWidth:"60%",padding:{right:"small"}},n().createElement(g,{items:r,background:"gray5",label:"",onChange:b,defaultSelection:f})))};var Q=a(790);const ee=h()(i.IconButton).withConfig({displayName:"filter-test-rows__StyledIconButton",componentId:"sc-wrvw10-0"})(["border:0.0625rem solid ",";svg{border:none !important;}"],(({theme:e,disabled:t,iconColor:a="primary"})=>t?e.palette.gray2.regular:(0,i.getColor)(String(a),e))),te=({tmpFilter:e,index:t,compProps:a})=>{const{t:r,newFilters:s,setNewFilters:o,condition:c,activeFilter:m,filterName:d}=a,u=(0,l.useMemo)((()=>(e=>[{label:e("label.from","From"),value:"from"},{label:e("label.to","To"),value:"to"},{label:e("label.cc","CC"),value:"cc"},{label:e("settings.to_cc","To or CC"),value:"to,cc"},{label:e("label.subject","Subject"),value:"subject"},{label:e("settings.message","Message"),value:"message"},{label:e("label.size","Size"),value:"size"},{label:e("settings.date","Date"),value:"date"},{label:e("settings.body","Body"),value:"body"},{label:e("label.attachment","Attachment"),value:"attachment"},{label:e("settings.read_receipt","Read Receipt"),value:"read receipt"},{label:e("settings.address_in","Address In"),value:"address in",keyName:"addressBookTest"},{label:e("settings.calendar","Calendar"),value:"calendar"},{label:e("settings.social","Social"),value:"social"},{label:e("settings.header_name","Header Named"),value:"header named"}])(r)),[r]),b=(0,l.useCallback)((()=>{const e=s.slice();e.push({filterActions:[{actionKeep:[{}],actionStop:[{}]}],active:m,name:d,key:"subject",label:"Subject",index:s.length,filterTests:[{}],comp:n().createElement(j,{t:r,activeIndex:s.length})}),o(e)}),[s,r,m,d,o]),f=(0,l.useCallback)((e=>()=>{const t=s.slice();t.splice(e,1),o(t)}),[s,o]),p=(0,l.useMemo)((()=>1===s.length),[s]),h=(0,l.useCallback)((e=>(({index:e,setNewFilters:t,newFilters:a,t:l,condition:i})=>r=>{let s,o=[];const c=a.slice();switch(r){case"from":case"to":case"cc":case"to,cc":s=n().createElement(W,{t:l,activeIndex:e}),o=[{condition:i,addressTest:[{header:"from",part:"all",stringComparison:"contains",value:""}]}];break;case"message":s=n().createElement(B,{t:l,activeIndex:e}),o=[{condition:i,conversationTest:[{where:"started"}]}];break;case"size":s=n().createElement(V,{t:l,activeIndex:e}),o=[{condition:i,sizeTest:[{numberComparison:"under",s:""}]}];break;case"date":s=n().createElement(U,{t:l,activeIndex:e}),o=[{condition:i,dateTest:[{dateComparison:"before",d:""}]}];break;case"body":s=n().createElement(q,{t:l,activeIndex:e}),o=[{condition:i,bodyTest:[{value:""}]}];break;case"attachment":s=n().createElement(K,{t:l,activeIndex:e}),o=[{condition:i,attachmentTest:[{}]}];break;case"read receipt":s=n().createElement(Z,{t:l,activeIndex:e}),o=[{condition:i,mimeHeaderTest:[{header:"Content-Type",stringComparison:"Contains",value:"message/disposition-notification"}]}];break;case"address in":s=n().createElement(G,{t:l,activeIndex:e}),o=[{condition:i}];break;case"calendar":s=n().createElement(Y,{t:l,activeIndex:e}),o=[{condition:i,inviteTest:[{method:[{_content:"anyreply"}]}]}];break;case"header named":s=n().createElement(X,{t:l,activeIndex:e}),o=[{condition:i,headerTest:[{header:"header",stringComparison:"contains",value:""}]}];break;case"social":s=n().createElement(J,{t:l,activeIndex:e}),o=[{condition:i,linkedinTest:[{}]}];break;default:s=n().createElement(j,{t:l,activeIndex:e}),o=[{condition:i,headerTest:[{header:"subject",stringComparison:"contains",value:""}]}]}c[e]={...c[e],comp:s,key:r,label:(0,Q.sK)(r),index:e,filterTests:o},t(c)})({index:e,setNewFilters:o,newFilters:s,t:r,condition:c})),[o,s,r,c]),v=(0,l.useMemo)((()=>L(u,e.key)),[e,u]),E=(0,l.useMemo)((()=>p?()=>null:f(t)),[p,f,t]);return n().createElement(i.Container,{orientation:"horizontal",padding:{top:"small"}},n().createElement(i.Container,{minWidth:"20%",maxWidth:"20%",padding:{right:"small"}},n().createElement(g,{items:u,label:"",onChange:h(t),defaultSelection:v})),e.comp&&e.comp,n().createElement(i.Container,{orientation:"horizontal",mainAlignment:"flex-end"},n().createElement(i.Tooltip,{label:r("settings.add_condition","Add new condition"),placement:"top"},n().createElement(ee,{icon:"PlusOutline",onClick:b,iconColor:"primary"})),n().createElement(i.Padding,{left:"small"},n().createElement(i.Tooltip,{label:r("settings.remove_condition","Remove this condition"),placement:"top"},n().createElement(ee,{disabled:p,icon:"MinusOutline",onClick:E,iconColor:"secondary"})))))},ae=({compProps:e})=>{const{t,newFilters:a,setCondition:r,selectedFilter:o}=e,c=(0,l.useMemo)((()=>(e=>[{label:e("label.any","any"),value:"anyof"},{label:e("label.all","all"),value:"allof"}])(t)),[t]),d=(0,l.useMemo)((()=>L(c,o?.filterTests?.[0]?.condition)||c[0]),[c,o]);return n().createElement(i.Container,{height:"fit",maxHeight:"100%",crossAlignment:"flex-start",mainAlignment:"flex-start"},n().createElement(i.Container,{crossAlignment:"flex-start",mainAlignment:"flex-start",height:"fit",maxHeight:"100%"},n().createElement(m,{title:t("settings.conditions","Conditions"),size:"medium"}),n().createElement(i.Row,null,n().createElement(i.Row,{padding:{right:"small"}},n().createElement(i.Text,null,t("settings.if","If"))),n().createElement(i.Row,{padding:{right:"small"},minWidth:"5.9375rem"},n().createElement(g,{items:c,background:"gray5",label:t("settings.field","Field"),onChange:r,defaultSelection:d,"data-testid":"filter-field"})),n().createElement(i.Row,{padding:{right:"small"}},n().createElement(i.Text,null,t("settings.condition_met","of the following conditions are met:"))))),n().createElement(i.Padding,{top:"small"}),n().createElement(i.Container,{padding:{top:"small"}},(0,s.map)(a,((t,a)=>n().createElement(te,{key:`tmp-filter-${t.key}-${a}`,index:a,tmpFilter:t,compProps:e})))))};var le=a(4990);const ne=h()(i.IconButton).withConfig({displayName:"filter-action-rows__StyledIconButton",componentId:"sc-n6dv62-0"})(["border:0.0625rem solid ",";svg{border:none !important;}"],(({theme:e,disabled:t,iconColor:a="primary"})=>t?e.palette.gray2.regular:(0,i.getColor)(String(a),e))),ie=({tmpFilter:e,index:t,compProps:a,tagOptions:o})=>{const{t:c,isIncoming:m,tempActions:d,setTempActions:u,zimbraFeatureMailForwardingInFiltersEnabled:b}=a,[f,p]=(0,l.useState)(!1),[h,v]=(0,l.useState)(0),[E,C]=(0,l.useState)({}),[y,k]=(0,l.useState)(!1),w=(0,l.useMemo)((()=>((e,t,a=!0)=>[{label:a?e("settings.keep_in_inbox","Keep in Inbox"):e("settings.keep_in_sent","Keep in Sent"),value:a?"inbox":"sent"},{label:e("settings.discard","Discard"),value:"discard"},{label:e("settings.move_into_folder","Move Into Folder"),value:"moveIntoFolder"},{label:e("settings.tag_with","Tag with"),value:"tagWith"},{label:e("settings.mark_as","Mark as"),value:"markAs"},...O(e,t)])(c,b,m??!1)),[c,b,m]),_=(0,l.useMemo)((()=>(e=>[{label:e("label.read","Read"),value:{actionFlag:[{flagName:"read"}]}},{label:e("label.flagged","Flagged"),value:{actionFlag:[{flagName:"flagged"}]}}])(c)),[c]),[S,F]=(0,l.useState)([]),T=(0,l.useCallback)((()=>{const e=d.slice();e.push({actionKeep:[{}],actionStop:[{}],id:(0,I.A)()}),u(e)}),[d,u]),[x,A]=(0,l.useState)("inbox"),M=(0,l.useMemo)((()=>"markAs"===x),[x]),P=(0,l.useMemo)((()=>"redirectToAddress"===x),[x]),[z,R]=(0,l.useState)([]),[N,L]=(0,r.useIntegratedComponent)("contact-input"),D=(0,l.useCallback)((e=>{const a=d.slice(),l=e.length>0&&""!==e[0].email?e[0].email:"";a[t]={actionRedirect:[{a:l}],id:(0,I.A)()},R([{email:l}]),u(a)}),[t,u,d]),j=(0,l.useCallback)((()=>{C({}),p(!1)}),[]),B=(0,l.useMemo)((()=>{const a=Object.keys((0,s.omit)(e,"id"))[0];if("actionRedirect"===a&&"FALSE"===b){k(!0);const e=d.slice();return e[t]={actionKeep:[{}],id:e[t].id},u(e),w[0]}switch(a){case"actionDiscard":return w[1];case"actionKeep":default:return w[0];case"actionFileInto":return A("moveIntoFolder"),C({name:e[a][0].folderPath}),w[2];case"actionFlag":return A("markAs"),w[4];case"actionTag":{A("tagWith");const t=(0,s.filter)(o,{label:e[a][0].tagName})[0];return F(e[a][0].tagName?[{label:`${e[a][0].tagName}`,hasAvatar:!0,avatarIcon:"Tag",background:"gray2",avatarBackground:r.ZIMBRA_STANDARD_COLORS[t?.color]?.hex}]:[]),w[3]}case"actionRedirect":return A("redirectToAddress"),e[a][0].a?R([{email:e[a][0].a}]):R([]),w[5]}}),[e,b,d,t,u,w,o]),W=(0,l.useMemo)((()=>{const t=Object.keys((0,s.omit)(e,"id"))[0];return"flagged"===e[t][0].flagName?_[1]:_[0]}),[e,_]),V=(0,l.useMemo)((()=>"moveIntoFolder"===x),[x]),$=(0,l.useCallback)((e=>()=>{const t=d.slice();t.splice(e,1),u(t)}),[d,u]),H=(0,l.useMemo)((()=>1===d.length),[d]),U=(0,l.useMemo)((()=>H?()=>null:$(t)),[H,$,t]),q=(0,l.useCallback)((e=>{switch(e){case"discard":{const e=d.slice();e[t]={id:e[t].id,actionDiscard:[{}]},u(e);break}case"inbox":{const e=d.slice();e[t]={actionKeep:[{}],id:e[t].id},u(e);break}case"tagWith":{const e=d.slice();let a;e[t].actionTag||(a=[{id:e[t]?.id,actionTag:[{tagName:""}]}],e[t]={id:e[t]?.id,actionTag:[{tagName:""}]},u(e),F(a));break}case"moveIntoFolder":{const e=d.slice();let a=[{}];e[t].actionFileInto||(a=[{name:""}],e[t]={id:e[t]?.id,actionFileInto:[{folderPath:""}]}),u(e),C(a[0]);break}case"redirectToAddress":{const e=d.slice();e[t].actionRedirect||(e[t]={id:e[t]?.id,actionRedirect:[{a:""}]},R([{email:""}])),u(e);break}}y&&k(!1),A(e)}),[t,y,u,d]),K=(0,l.useMemo)((()=>"moveIntoFolder"!==x),[x]),Z=(0,l.useMemo)((()=>"tagWith"===x),[x]),G=(0,l.useCallback)((e=>{const t=(0,s.filter)(o,{label:e})[0];return{label:`${e}`,hasAvatar:!0,avatarIcon:"Tag",background:"gray2",avatarBackground:r.ZIMBRA_STANDARD_COLORS[t.color].hex}}),[o]),Y=(0,l.useCallback)((()=>{v(t),p(!0)}),[p,v,t]),X=(0,l.useCallback)((e=>{const a=d.slice();if(e.length>0){const l=e.length>1?e[1]:e[0];F([l]),a[t]={id:a[t]?.id,actionTag:[{tagName:l.label}]},u(a)}else a[t]={id:a[t]?.id,actionTag:[{tagName:""}]},F([]);u(a)}),[F,d,u,t]),J=(0,l.useCallback)((e=>{const a=d.slice();a[t]=e,u(a)}),[d,t,u]),Q=(0,l.useCallback)(((e,t,a)=>{const l=d.slice();l[h]={id:l[h]?.id,actionFileInto:[{folderPath:`${e.absFolderPath}`}]},u(l),C({name:e.name}),p(!1)}),[d,h,u,C,p]),ee=c("label.choose_folder","Choose Folder"),te=c("settings.choose","Choose"),ae=c("settings.filter_folder_message","Select a folder to apply your filter:");return n().createElement(i.Container,{mainAlignment:"space-between",crossAlignment:"center",orientation:"horizontal",padding:{top:"small"}},n().createElement(i.Row,null,n().createElement(i.Row,{padding:{right:"small"},minWidth:"12.5rem"},n().createElement(g,{items:w,background:"gray5",label:c("settings.actions","Actions"),onChange:q,defaultSelection:B})),y&&("inbox"===B.value||"sent"===B.value)&&n().createElement(i.Row,{padding:{right:"small"},minWidth:"12.5rem"},n().createElement(i.Text,{size:"medium",color:"info"},c("label.admin_disabled_action","The Admin disabled the redirect action"))),V&&n().createElement(n().Fragment,null,E&&Object.keys(E).length>0&&""!==E?.name&&n().createElement(i.Row,{padding:{right:"small"}},n().createElement(i.Input,{label:c("label.destination_folder","Destination Folder"),backgroundColor:"gray5",value:E?.name,disabled:!0})),n().createElement(i.Row,null,n().createElement(i.Button,{disabled:K,label:c("settings.browse","Browse"),type:"outlined",onClick:Y}))),M&&n().createElement(i.Row,{padding:{right:"small"},minWidth:"12.5rem"},n().createElement(g,{items:_,background:"gray5",label:"",onChange:J,defaultSelection:W})),P&&n().createElement(i.Row,{padding:{right:"small"},minWidth:"22rem"},L?n().createElement(N,{placeholder:c("settings.address","Address"),onChange:D,defaultValue:z,disablePortal:!0,maxChips:1}):n().createElement(i.ChipInput,{placeholder:c("settings.address","Address"),onChange:D,defaultValue:z,maxChips:1})),Z&&n().createElement(i.Row,{padding:{right:"small"},minWidth:"12.5rem"},n().createElement(i.ChipInput,{placeholder:c("label.tag","Tag"),background:"gray4",defaultValue:[],options:o,value:S,singleSelection:!0,onChange:X,onAdd:G,disableOptions:!1,disabled:!0}))),n().createElement(i.Container,{orientation:"horizontal",mainAlignment:"flex-end",width:"auto"},n().createElement(i.Tooltip,{label:c("settings.add_action","Add new action"),placement:"top"},n().createElement(ne,{icon:"PlusOutline",onClick:T,iconColor:"primary"})),n().createElement(i.Padding,{left:"small"},n().createElement(i.Tooltip,{label:c("settings.remove_action","Remove this action"),placement:"top"},n().createElement(ne,{icon:"MinusOutline",disabled:H,onClick:U,iconColor:"secondary"})))),n().createElement(i.CustomModal,{open:f,onClose:j,maxHeight:"90vh",size:"medium"},n().createElement(le.i,{onClose:j,headerTitle:ee,actionLabel:te,inputLabel:ae,confirmAction:Q,showSharedAccounts:!1,showSpamFolder:!1,showTrashFolder:!0,allowFolderCreation:!1,allowRootSelection:!1})))},re=({compProps:e})=>{const{t,tempActions:a}=e,o=(0,l.useMemo)((()=>(0,s.map)((0,r.getTags)(),(e=>({...e,label:e.name,customComponent:n().createElement(i.Row,null,n().createElement(i.Icon,{icon:"Tag",customColor:r.ZIMBRA_STANDARD_COLORS[e.color??0].hex}),n().createElement(i.Padding,{left:"small"},n().createElement(i.Text,null,e.name)))})))),[]);return n().createElement(n().Fragment,null,n().createElement(i.Container,{padding:{top:"medium"},crossAlignment:"flex-start",mainAlignment:"flex-start"},n().createElement(m,{title:t("settings.actions","Actions"),size:"medium"}),n().createElement(i.Text,null,t("settings.perform_following_action","Perform the following actions:")),n().createElement(i.Container,{padding:{top:"small"},mainAlignment:"flex-start"},(0,s.map)(a,((t,a)=>n().createElement(ie,{key:t.id,index:a,tmpFilter:t,compProps:e,tagOptions:o}))))))};var se=a(9902);const oe=async e=>await(0,r.soapFetch)("ModifyFilterRules",{filterRules:[{filterRule:e}],_jsns:"urn:zimbraMail"}),ce=async e=>await(0,r.soapFetch)("ModifyOutgoingFilterRules",{filterRules:[{filterRule:e}],_jsns:"urn:zimbraMail"}),me=({t:e,onClose:t,incomingFilters:a,setFetchIncomingFilters:o,setIncomingFilters:c})=>{const[m,d]=(0,l.useState)(""),[u,g]=(0,l.useState)(!1),[b,f]=(0,l.useState)("anyof"),[p,h]=(0,l.useState)(!0),[v,E]=(0,l.useState)([{actionKeep:[{}],id:(0,I.A)()}]),{zimbraFeatureMailForwardingInFiltersEnabled:C}=(0,r.useUserSettings)().attrs,y=(0,l.useMemo)((()=>(0,s.reduce)(v,((e,t)=>{const a=Object.keys((0,s.omit)(t,"id"))[0];if(Object.keys(e).includes(a)){const l=(0,s.omit)(e,"id");return{...l,[a]:[...l[a],...t[a]]}}return{...e,...t}}),{})),[v]),[k,w]=(0,l.useState)([{filterActions:[{actionKeep:[{}],actionStop:[{}]}],active:u,name:m,key:"subject",label:"Subject",filterTests:[{}],index:0,comp:n().createElement(j,{t:e,activeIndex:0})}]),_=(0,l.useCallback)((()=>g(!u)),[u]),S=(0,l.useCallback)((e=>d(e.target.value)),[]),F=(0,l.useMemo)((()=>e("settings.create_new_filter","Create new Filter")),[e]),T=(0,l.useMemo)((()=>`${e("settings.filter_name","Filter Name")}*`),[e]),x=(0,l.useMemo)((()=>e("settings.active_filter","Active filter")),[e]),A=(0,l.useMemo)((()=>{const e=(0,s.map)(k,(e=>e.filterTests[0]));return(0,s.reduce)(e,((e,t)=>{const a=Object.keys((0,s.omit)(t,["condition"]))[0];return Object.keys(e).includes(a)?{...e,[a]:[...e[a],...t[a]]}:{...e,...t}}),{})}),[k]),M=(0,l.useMemo)((()=>({filterActions:p?[{...(0,s.omit)(y,"id"),actionStop:[{}]}]:[{...(0,s.omit)(y,"id")}],active:u,name:m,filterTests:[{...A,condition:b}]})),[u,m,b,A,y,p]),[P,N]=(0,l.useMemo)((()=>D(m,M,e)),[m,M,e]),O=(0,l.useMemo)((()=>a?.slice()||[]),[a]),L=(0,l.useCallback)((()=>{const e=[...O,M];c?.(e),oe(e).then((()=>{o?.(!0)})),t()}),[O,t,M,o,c]),B=(0,l.useCallback)((()=>{h(!p)}),[p]),W=(0,l.useMemo)((()=>({t:e,activeFilter:u,filterName:m,isIncoming:!0,tempActions:v,setTempActions:E,zimbraFeatureMailForwardingInFiltersEnabled:C})),[e,u,m,v,C]),V=(0,l.useMemo)((()=>({t:e,newFilters:k,setNewFilters:w,condition:b,setCondition:f,activeFilter:u,filterName:m})),[e,k,w,b,f,u,m]);return n().createElement(z.Provider,{value:{newFilters:k,setNewFilters:w}},n().createElement(i.Container,{padding:{bottom:"medium"},crossAlignment:"flex-start",mainAlignment:"flex-start",maxHeight:"100%",style:{overflowY:"scroll",overflowX:"hidden"}},n().createElement(se.A,{title:F,onClose:t}),n().createElement(i.Input,{label:T,value:m,onChange:S,backgroundColor:"gray5","data-testid":"filter-name"}),n().createElement(i.Padding,{top:"small"}),n().createElement(i.Checkbox,{value:u,onClick:_,label:x,"data-testid":"active-filter"}),n().createElement(i.Row,{padding:{vertical:"medium"},height:"fit",maxHeight:"100%",crossAlignment:"flex-start",mainAlignment:"flex-start",style:{overflowY:"scroll",overflowX:"hidden"},display:"block",maxWidth:"100%",width:"100%"},n().createElement(ae,{compProps:V}),n().createElement(i.Padding,{top:"medium"}),n().createElement(i.Divider,null),n().createElement(re,{compProps:W})),n().createElement(R,{label:e("label.create","Create"),toolTipText:N,onConfirm:L,disabled:P,onSecondaryAction:B,checked:p,checkboxLabel:e("settings.do_not_process_additional_filters","Do not process additional filters")})))};var de=a(9628);const ue=({t:e,onClose:t,availableList:a,activeList:r,setFilters:o,setFetchFilters:c,modifierFunc:m,selectedFilter:d,incomingFilters:u})=>{const g=(0,l.useMemo)((()=>e("settings.delete_filter","Delete filter")),[e]),b=(()=>{const{createSnackbar:e}=(0,A.m)();return(0,l.useCallback)((({t,setFetchFilters:a,modifierFunc:l,onClose:n,selectedFilter:i,incomingFilters:r})=>{l((0,s.filter)(r,(e=>e.name!==i.name))).then((()=>{e({key:"filter-delete-success",type:"info",label:t("settings.filter_deleted","Filter successfully deleted"),hideButton:!0}),a(!0)})).catch((a=>{e({key:"filter-delete-error",type:"error",label:a.message||t("label.error_try_again","Something went wrong, please try again"),hideButton:!0})})),n()}),[e])})(),f=(0,l.useCallback)((()=>{b({t:e,onClose:t,availableList:a,activeList:r,setFilters:o,setFetchFilters:c,modifierFunc:m,selectedFilter:d,incomingFilters:u})}),[r,a,b,u,m,t,d,c,o,e]);return n().createElement(n().Fragment,null,n().createElement(i.Container,{padding:{bottom:"medium"}},n().createElement(se.A,{title:g,onClose:t}),n().createElement(i.Container,{orientation:"horizontal",padding:{all:"medium"}},n().createElement(i.Text,{overflow:"break-word"},e("settings.delete_filter_text","Are you sure to delete filter ")),n().createElement(i.Text,{weight:"bold",style:{paddingLeft:"0.3125rem",paddingRight:"0.3125rem"}},`"${d?.name}" ?`)),n().createElement(de.A,{onConfirm:f,label:e("label.delete","Delete"),background:"error"})))},ge=({name:e,index:t,test:a,t:l})=>{switch(e){case"addressTest":return n().createElement(W,{t:l,activeIndex:t,defaultValue:a,key:`tmp-filter-${e}-${(new Date).valueOf()}`});case"bulkTest":case"listTest":case"flaggedTest":case"conversationTest":return n().createElement(B,{t:l,activeIndex:t,defaultValue:a,key:`tmp-filter-${e}-${(new Date).valueOf()}`});case"sizeTest":return n().createElement(V,{t:l,activeIndex:t,defaultValue:a,key:`tmp-filter-${e}-${(new Date).valueOf()}`});case"dateTest":return n().createElement(U,{t:l,activeIndex:t,defaultValue:a,key:`tmp-filter-${e}-${(new Date).valueOf()}`});case"bodyTest":return n().createElement(q,{t:l,activeIndex:t,defaultValue:a,key:`tmp-filter-${e}-${(new Date).valueOf()}`});case"attachmentTest":return n().createElement(K,{t:l,activeIndex:t,defaultValue:a,key:`tmp-filter-${e}-${(new Date).valueOf()}`});case"mimeHeaderTest":return n().createElement(Z,{t:l,activeIndex:t,defaultValue:a,key:`tmp-filter-${e}-${(new Date).valueOf()}`});case"contactRankingTest":case"meTest":case"addressBookTest":return n().createElement(G,{t:l,activeIndex:t,defaultValue:a,key:`tmp-filter-${e}-${(new Date).valueOf()}`});case"inviteTest":return n().createElement(Y,{t:l,activeIndex:t,defaultValue:a,key:`tmp-filter-${e}-${(new Date).valueOf()}`});case"linkedinTest":case"facebookTest":case"twitterTest":return n().createElement(J,{t:l,activeIndex:t,defaultValue:a,key:`tmp-filter-${e}-${(new Date).valueOf()}`});default:return n().createElement(j,{t:l,activeIndex:t,defaultValue:a,key:`tmp-filter-${e}-${(new Date).valueOf()}`})}},be=({name:e,test:t})=>{switch(e){case"bodyTest":return"body";case"addressTest":case"headerTest":return t.header;case"sizeTest":return"size";case"attachmentTest":return"attachment";case"bulkTest":case"listTest":case"flaggedTest":case"conversationTest":return"message";case"dateTest":return"date";case"mimeHeaderTest":return"read receipt";case"addressBookTest":case"contactRankingTest":case"meTest":return"address in";case"inviteTest":return"calendar";case"linkedinTest":case"facebookTest":case"twitterTest":return"social";default:return"subject"}},fe=({t:e,onClose:t,incomingFilters:a,setFetchIncomingFilters:o,setIncomingFilters:c,selectedFilter:m})=>{const[d,u]=(0,l.useState)(""),[g,b]=(0,l.useState)(!1),[f,p]=(0,l.useState)("anyof"),[h,v]=(0,l.useState)(!0),[E,C]=(0,l.useState)([{actionKeep:[{}],id:(0,I.A)()}]),[y,k]=(0,l.useState)({}),[w,_]=(0,l.useState)(!1),[S,F]=(0,l.useState)(!0),{zimbraFeatureMailForwardingInFiltersEnabled:T}=(0,r.useUserSettings)().attrs,{createSnackbar:x}=(0,A.m)(),[M,P]=(0,l.useState)([{filterActions:[{actionKeep:[{}],actionStop:[{}]}],active:g,name:d,key:"subject",label:"Subject",filterTests:[{}],index:0,comp:n().createElement(j,{t:e,activeIndex:0})}]),N=(0,l.useCallback)((()=>b(!g)),[g]),O=(0,l.useCallback)((e=>u(e.target.value)),[]),L=(0,l.useMemo)((()=>`${e("label.edit","Edit")} ${m?.name}`),[e,m?.name]),B=(0,l.useMemo)((()=>`${e("settings.filter_name","Filter Name")}*`),[e]),W=(0,l.useMemo)((()=>e("settings.active_filter","Active filter")),[e]),V=(0,l.useMemo)((()=>{const e=(0,s.map)(M,(e=>e.filterTests[0]));return(0,s.reduce)(e,((e,t)=>{const a=Object.keys((0,s.omit)(t,["condition"]))[0];return Object.keys(e).includes(a)?{...e,[a]:[...e[a],...t[a]]}:{...e,...t}}),{})}),[M]),$=(0,l.useMemo)((()=>(0,s.reduce)(E,((e,t)=>{const a=Object.keys((0,s.omit)(t,"id"))[0];if(Object.keys(e).includes(a)){const l=(0,s.omit)(e,"id");return{...l,[a]:[...l[a],...t[a]]}}return{...e,...t}}),{})),[E]),H=(0,l.useMemo)((()=>({filterActions:h?[{...(0,s.omit)($,"id"),actionStop:[{}]}]:[{...(0,s.omit)($,"id")}],active:g,name:d,filterTests:[{...V,condition:f}]})),[g,d,f,V,h,$]),[U,q]=(0,l.useMemo)((()=>(0,s.isEqual)(y,H)?[!0,e("settings.label.not_changed_anything","No change was made")]:D(d,H,e,!1)),[y,d,H,e]),K=(0,l.useMemo)((()=>a?.slice()),[a]),Z=(0,l.useCallback)((()=>{v((e=>!e))}),[]);(0,l.useLayoutEffect)((()=>{v(!!m.filterActions[0]?.actionStop)}),[m.filterActions]);const G=(0,l.useMemo)((()=>({t:e,activeFilter:g,filterName:d,isIncoming:!0,tempActions:E,setTempActions:C,zimbraFeatureMailForwardingInFiltersEnabled:T})),[e,g,d,E,T]),Y=(0,l.useMemo)((()=>({t:e,newFilters:M,setNewFilters:P,condition:f,setCondition:p,activeFilter:g,filterName:d,selectedFilter:m})),[e,M,P,f,p,g,d,m]);(0,l.useEffect)((()=>{m&&(u(m?.name),b(m?.active),p(m?.filterTests?.[0]?.condition),C((()=>{const e=[];return(0,s.forEach)(m?.filterActions?.[0],((t,a)=>{"actionStop"!==a&&(0,s.forEach)(t,(t=>{e.push({[a]:[{...(0,s.omit)(t,"index")}],id:(0,I.A)()})}))})),e})))}),[m]);const X=()=>{k(H)};(0,l.useEffect)((()=>{m&&S&&setTimeout((()=>{F(!1),X()}),10)}),[m,X,S]);const J=(0,l.useMemo)((()=>{const e=[];return(0,s.forEach)(m?.filterTests?.[0],((t,a)=>{"condition"!==a&&(0,s.map)(t,(t=>{e.push({...t,testName:a})}))})),e}),[m]),ee=(0,l.useMemo)((()=>(0,s.map)(J,((t,a)=>(a===J.length-1&&_(!0),{filterActions:[{actionKeep:[{}],actionStop:[{}]}],active:!1,name:"",key:be({name:t.testName,test:t}),label:(0,Q.sK)(be({name:t.testName,test:t})),filterTests:[{[t.testName]:[t],condition:m?.filterTests?.[0]?.condition}],index:0,comp:ge({name:t.testName,test:{[t.testName]:[t]},index:a,t:e})})))),[J,e,m]);(0,l.useEffect)((()=>{P(ee),w&&_(!1)}),[ee,w]);const te=(0,l.useCallback)((()=>{const a=(0,s.findIndex)(K,(e=>e.name===m?.name)),l=K.slice();l[a]=H,c(l),oe(l).then((()=>{o(!0),x({key:"share",replace:!0,hideButton:!0,type:"info",label:e("label.filter_modified","Filter modified succesfully"),autoHideTimeout:5e3})})).catch((t=>{x({key:"share",replace:!0,hideButton:!0,type:"error",label:t?.message||e("label.error_try_again","Something went wrong, please try again"),autoHideTimeout:5e3})})),t()}),[K,H,c,t,m?.name,o,x,e]);return n().createElement(z.Provider,{value:{newFilters:M,setNewFilters:P}},n().createElement(i.Container,{padding:{bottom:"medium"},crossAlignment:"flex-start",mainAlignment:"flex-start",maxHeight:"100%",style:{overflowY:"scroll",overflowX:"hidden"}},n().createElement(se.A,{title:L,onClose:t}),n().createElement(i.Input,{label:B,value:d,onChange:O,backgroundColor:"gray5"}),n().createElement(i.Padding,{top:"small"}),n().createElement(i.Checkbox,{value:g,onClick:N,label:W}),n().createElement(i.Row,{padding:{vertical:"medium"},height:"fit",maxHeight:"100%",crossAlignment:"flex-start",mainAlignment:"flex-start",style:{overflowY:"scroll"},display:"block",maxWidth:"100%",width:"100%"},n().createElement(ae,{compProps:Y}),n().createElement(i.Padding,{top:"medium"}),n().createElement(i.Divider,null),n().createElement(re,{compProps:G})),n().createElement(R,{label:e("label.save","Save"),toolTipText:q,onConfirm:te,disabled:U,onSecondaryAction:Z,checked:h,checkboxLabel:e("settings.do_not_process_additional_filters","Do not process additional filters")})))};var pe=a(8333),he=a(8153);const ve=e=>"Fault"in e;var Ee=a(2958),Ce=a(4899);const ye=h().span.withConfig({displayName:"text-styler__StyledSpan",componentId:"sc-oz0qqi-0"})(["display:inline-block;font-weight:",";"],(e=>e.bold&&"bold")),ke=n().forwardRef((function({children:e,...t},a){return n().createElement(ye,(0,Ce.A)({ref:a},t),e)})),we={showSharedAccounts:!0,showThrashFolder:!1,showSpamFolder:!1,allowRootSelection:!0,allowFolderCreation:!1,title:(0,r.t)("label.select_folder","Select folder"),hintText:"",confirmActionLabel:(0,r.t)("label.select_folder","Select folder"),confirmActionTooltip:"",disabledConfirmActionTooltip:(0,r.t)("label.no_folder_selected","No folder is selected")},_e=({criteria:e,closeModal:t})=>{const a=(0,i.useModal)(),s=(0,i.useSnackbar)(),[o,c]=(0,l.useState)(),m=o?.n??0,d=(0,l.useMemo)((()=>!!o),[o]),u=(0,r.t)("modals.apply_filters.title",{filterName:e.filterName,defaultValue:"Application filter {{filterName}}"}),g=(0,r.t)("modals.apply_filters.button_apply","Apply"),b=(0,r.t)("label.cancel","Cancel"),f=(0,l.useCallback)((()=>{o&&((async({ruleName:e,messagesId:t,foldersId:a})=>{const l=(e=>{if(e&&e.length)return{_content:`(${e.map((e=>`inid:"${e}"`)).join(" OR ")})`}})(a),n=void 0===l?(e=>{if(e&&e.length)return{ids:e.join(",")}})(t):void 0,i=await(0,r.soapFetch)("ApplyFilterRules",{filterRules:[{filterRule:{name:e}}],...n&&{m:n},...l&&{query:l},_jsns:"urn:zimbraMail"});if(ve(i))return Promise.reject(i.Fault.Reason.Text);const s=(o=i)&&!ve(o)&&o.m?.[0].ids?o.m[0].ids.split(","):[];var o;return Promise.resolve({messagesId:s})})({ruleName:e.filterName,foldersId:[o?.id]}).then((t=>{s({key:`applyFilter-${e.filterName}-completed`,type:"success",label:(0,r.t)("messages.snackbar.apply_filter_rules_completed",{filterName:e.filterName,involvedMessagesCount:t.messagesId.length,folderPath:o.absFolderPath,defaultValue:"Filter '{{filterName}}'successfully applied to {{involvedMessagesCount}} messages of the folder '{{folderPath}}'"}),replace:!0,autoHideTimeout:k.fT.SNACKBAR_DEFAULT_TIMEOUT,hideButton:!0})})).catch((t=>{s({key:`applyFilter-${e.filterName}-error`,type:"error",label:(0,r.t)("messages.snackbar.apply_filter_rules_error",{filterName:e.filterName,defaultValue:"An error occurred while applying the filter '{{filterName}}'"}),replace:!0,autoHideTimeout:k.fT.SNACKBAR_DEFAULT_TIMEOUT,hideButton:!0})})),s({key:`applyFilter-${e.filterName}-started`,type:"info",label:(0,r.t)("messages.snackbar.apply_filter_rules_started",{filterName:e.filterName,folderPath:o.absFolderPath,defaultValue:"Filter '{{filterName}}' is being applied to the messages of the folder '{{folderPath}}'"}),replace:!0,autoHideTimeout:k.fT.SNACKBAR_DEFAULT_TIMEOUT,hideButton:!0}),t())}),[t,s,e.filterName,o]),p=(0,l.useCallback)((()=>t()),[t]),h=(0,l.useMemo)((()=>o?[{label:o.absFolderPath,hasAvatar:!0,maxWidth:"12.5rem",background:"gray2",avatarBackground:(0,Q.dk)(o),avatarIcon:"FolderOutline",value:o.id}]:[]),[o]);return n().createElement(n().Fragment,null,n().createElement(i.ModalHeader,{onClose:p,title:u,showCloseIcon:!0}),n().createElement(i.Divider,null),n().createElement(Ee.s,{gap:"medium",mainAlignment:"flex-start",crossAlignment:"flex-start",minHeight:"13.63rem",padding:{top:"small"}},n().createElement(i.Text,null,(0,r.t)("settings.filter_folder_message","Select a folder to apply your filter:")),n().createElement(i.ChipInput,{background:"gray5",icon:"FolderOutline",placeholder:(0,r.t)("label.select_folder","Is contained in"),value:h,maxChips:1,disabled:!0,iconAction:e=>(()=>{const e={id:k.kq.SELECT_FOLDERS.id,icon:"FolderOutline",label:(0,r.t)("action.select_folders","Select folders"),openModal:e=>{const{uiUtilities:t,callbacks:a}=e,l=(e=>({...we,...e}))(e.config),r=t.createModal({size:"medium",children:n().createElement(i.ModalManager,null,n().createElement(le.i,{folder:l.selectedFolder,onClose:()=>{r(),a.onCancel&&a.onCancel()},headerTitle:l.title,inputLabel:l.hintText,actionLabel:l.confirmActionLabel,confirmAction:e=>{e&&(r(),a.onComplete&&a.onComplete(e))},actionTooltip:l.confirmActionTooltip,disabledActionTooltip:l.disabledConfirmActionTooltip,allowRootSelection:l.allowRootSelection,allowFolderCreation:l.allowFolderCreation,showSharedAccounts:l.showSharedAccounts,showTrashFolder:l.showThrashFolder,showSpamFolder:l.showSpamFolder}))},!0)}};e?.openModal?.({config:{allowRootSelection:!1,showSharedAccounts:!1,allowFolderCreation:!1,showThrashFolder:!0,showSpamFolder:!0},uiUtilities:{createModal:a},callbacks:{onComplete:c}})})(),onChange:e=>{0===e.length&&c(void 0)},requireUniqueChips:!0}),o&&n().createElement(n().Fragment,null,n().createElement(i.Text,null,n().createElement(he.Trans,{t:r.t,i18nKey:"modals.apply_filters.label_involved_messages",involvedMessagesCount:m},n().createElement(ke,{bold:!0},{involvedMessagesCount:m}," messages")," will be processed inside the selected folder.")),n().createElement(i.Text,null,n().createElement(he.Trans,{t:r.t,i18nKey:"modals.apply_filters.label_confirm_request"},"Do you want to apply the filter?")))),n().createElement(i.Divider,null),n().createElement(i.ModalFooter,{confirmLabel:g,confirmDisabled:!d,onConfirm:f,onSecondaryAction:p,secondaryActionLabel:b,onClose:p}))},Se=({compProps:e})=>{const{t,availableList:a,activeList:o,incomingFilters:c}=e,{setFetchIncomingFilters:m,setIncomingFilters:d}=(0,l.useContext)(_),u=(0,i.useModal)(),g=(0,l.useMemo)((()=>Object.keys(a.selected).length>0),[a.selected]),b=(0,l.useMemo)((()=>Object.keys(o.selected).length>0),[o.selected]),f=!g,p=!b,h=!g&&!b,v=!g&&!b,E=!b,C=(0,l.useMemo)((()=>Object.keys(o.selected)[0]),[o.selected]),y=(0,l.useMemo)((()=>Object.keys(a.selected)[0]),[a.selected]),w=C||y,S=(0,l.useMemo)((()=>(0,s.find)(a.list,{name:Object.keys(a.selected)[0]})||(0,s.find)(o.list,{name:Object.keys(o.selected)[0]})),[a,o]),F=(0,l.useCallback)((()=>{if(!C)return;k.uC.APPLY.id,(0,r.t)("action.apply_filter_on_folder","Apply filter on folder");const e=({criteria:e,uiUtilities:t})=>{const a=t.createModal({size:"medium",children:n().createElement(i.ModalManager,null,n().createElement(_e,{criteria:e,closeModal:()=>a()}))},!0)},t={uiUtilities:{createModal:u},criteria:{filterName:C}};e?.(t)}),[u,C]),T=(0,l.useCallback)((()=>{const e=u({size:"large",maxHeight:"80vh",children:n().createElement(pe.t,null,n().createElement(me,{t,onClose:()=>e(),incomingFilters:c,setFetchIncomingFilters:m,setIncomingFilters:d}))},!0)}),[u,t,c,d,m]),x=(0,l.useCallback)((()=>{const e=u({size:"small",children:n().createElement(pe.t,null,n().createElement(ue,{onClose:()=>e(),t,availableList:a,activeList:o,setFilters:d,setFetchFilters:m,modifierFunc:oe,filterName:w,selectedFilter:S,incomingFilters:c}))},!0)}),[o,a,u,c,S,w,m,d,t]),A=M(),I=(0,l.useCallback)((()=>A({t,availableList:a,activeList:o,setFilters:d,setFetchFilters:m,modifierFunc:oe})),[A,t,a,o,d,m]),z=P(),R=(0,l.useCallback)((()=>z({t,availableList:a,activeList:o,setFilters:d,setFetchFilters:m,modifierFunc:oe})),[z,t,a,o,d,m]),N=(0,l.useCallback)((()=>{const e=u({size:"large",maxHeight:"80vh",children:n().createElement(pe.t,null,n().createElement(fe,{t,selectedFilter:S,onClose:()=>e(),incomingFilters:c,setFetchIncomingFilters:m,setIncomingFilters:d}))},!0)}),[u,t,c,d,m,S]);return n().createElement(n().Fragment,null,n().createElement(i.Padding,{top:"medium"}),n().createElement(i.Button,{label:t("label.add","Add"),type:"outlined",icon:"ArrowheadLeftOutline",iconPlacement:"left",disabled:f,onClick:R,width:"fill"}),n().createElement(i.Padding,{bottom:"medium"}),n().createElement(i.Button,{label:t("label.remove_one","Remove"),type:"outlined",color:"error",icon:"ArrowheadRightOutline",disabled:p,onClick:I,width:"fill"}),n().createElement(i.Padding,{bottom:"medium"}),n().createElement(i.Button,{label:t("label.edit","Edit"),type:"outlined",disabled:h,width:"fill",onClick:N}),n().createElement(i.Padding,{bottom:"medium"}),n().createElement(i.Button,{label:t("filters.apply","Apply"),type:"outlined",disabled:E,width:"fill",onClick:F}),n().createElement(i.Padding,{bottom:"medium"}),n().createElement(i.Button,{label:t("label.delete","Delete"),type:"outlined",color:"error",onClick:x,disabled:v,width:"fill"}),n().createElement(i.Padding,{bottom:"medium"}),n().createElement(i.Button,{label:t("label.create","Create"),type:"outlined",width:"fill",onClick:T}))},Fe=()=>n().createElement(i.Container,{orientation:"horizontal",mainAlignment:"flex-start",width:"fill",crossAlignment:"flex-start"},n().createElement(i.Shimmer.FormSection,null,n().createElement(i.Shimmer.FormSubSection,null))),Te=(e,t,a,n)=>{const[i,r]=(0,l.useState)({}),[o,c]=(0,l.useState)(!1),[m,d]=(0,l.useState)(e);(0,l.useEffect)((()=>{c(!(0,s.isEmpty)(i))}),[i]),(0,l.useEffect)((()=>{d(e)}),[e]);const u=(0,l.useCallback)((()=>{r({})}),[]),g=(0,l.useCallback)((e=>{r({[e]:!0})}),[]),b=(0,l.useCallback)((e=>{const l=m.slice();if(e===l.length-1)return;const i=e+1,o=(0,s.cloneDeep)(l[i]);l[e+1]=(0,s.cloneDeep)(l[e]),l[e]=o,d(l),r(l[e+1].id);const c=(0,s.concat)((0,s.map)(l,(e=>(0,s.omit)(e,"id"))),n);a(c).then((()=>{t(!0)}))}),[m,n,a,t]),f=(0,l.useCallback)((e=>{const l=m.slice(),i=e-1,o=(0,s.cloneDeep)(l[i]);l[e-1]=(0,s.cloneDeep)(l[e]),l[e]=o,d(l),r(l[e-1].id);const c=(0,s.concat)((0,s.map)(l,(e=>(0,s.omit)(e,"id"))),n);a(c).then((()=>{t(!0)}))}),[m,n,a,t]);return{selected:i,isSelecting:o,toggle:g,unSelect:u,moveDown:b,moveUp:f,list:m}},xe=({t:e,selectedFilterType:t})=>{const{incomingFilters:a,incomingLoading:r,setFetchIncomingFilters:o}=(0,l.useContext)(_),c=(0,l.useMemo)((()=>a?.slice()),[a]),[d,u]=(0,l.useMemo)((()=>[(0,s.map)((0,s.filter)(c,{active:!0}),(e=>({...e,id:e.name}))),(0,s.map)((0,s.filter)(c,{active:!1}),(e=>({...e,id:e.name})))]),[c]),g=Te(d,o,oe,u),b=Te(u,o,oe,d),f=(0,l.useMemo)((()=>({t:e,availableList:b,activeList:g,selectedFilterType:t,incomingFilters:c,setFetchIncomingFilters:o})),[e,b,g,t,c,o]);return n().createElement(i.Container,{crossAlignment:"flex-start",mainAlignment:"flex-start",orientation:"horizontal"},n().createElement(i.Container,{width:"43%",minHeight:"30vh",mainAlignment:"flex-start"},n().createElement(m,{title:e("filters.active_filters","Active Filters"),size:"small"}),n().createElement(i.Container,null,r?n().createElement(Fe,null):n().createElement(i.List,{items:g.list,selected:g.selected,ItemComponent:x,itemProps:{listProps:g,unSelect:b.unSelect}}))),n().createElement(i.Container,{width:"14%",padding:{all:"large"},mainAlignment:"space-between"},n().createElement(Se,{compProps:f})),n().createElement(i.Container,{width:"43%",mainAlignment:"flex-start"},n().createElement(m,{title:e("filters.available_filters","Available Filters"),size:"small"}),n().createElement(i.Container,null,r?n().createElement(Fe,null):n().createElement(i.List,{items:b.list,selected:b.selected,ItemComponent:x,itemProps:{listProps:b,unSelect:g.unSelect}}))))},Ae=({t:e,onClose:t,outgoingFilters:a,setFetchOutgoingFilters:o,setOutgoingFilters:c})=>{const{createSnackbar:m}=(0,A.m)(),[d,u]=(0,l.useState)(""),[g,b]=(0,l.useState)(!1),[f,p]=(0,l.useState)("anyof"),[h,v]=(0,l.useState)(!0),[E,C]=(0,l.useState)([{actionKeep:[{}]}]),{zimbraFeatureMailForwardingInFiltersEnabled:y}=(0,r.useUserSettings)().attrs,k=(0,l.useMemo)((()=>(0,s.reduce)(E,((e,t)=>{const a=Object.keys((0,s.omit)(t,"id"))[0];return Object.keys(e).includes(a)?{...e,[a]:[...e[a],...t[a]]}:{...e,...t}}),{})),[E]),[w,_]=(0,l.useState)([{filterActions:[{actionKeep:[{}],actionStop:[{}]}],active:g,name:d,key:"subject",label:"Subject",filterTests:[{}],index:0,comp:n().createElement(j,{t:e,activeIndex:0})}]),S=(0,l.useCallback)((()=>b(!g)),[g]),F=(0,l.useCallback)((e=>u(e.target.value)),[]),T=(0,l.useMemo)((()=>e("settings.create_new_filter","Create new Filter")),[e]),x=(0,l.useMemo)((()=>`${e("settings.filter_name","Filter Name")}*`),[e]),M=(0,l.useMemo)((()=>e("settings.active_filter","Active filter")),[e]),P=(0,l.useMemo)((()=>{const e=(0,s.map)(w,(e=>e.filterTests[0]));return(0,s.reduce)(e,((e,t)=>{const a=Object.keys((0,s.omit)(t,["condition"]))[0];return Object.keys(e).includes(a)?{...e,[a]:[...e[a],...t[a]]}:{...e,...t}}),{})}),[w]),I=(0,l.useMemo)((()=>({filterActions:h?[{...k,actionStop:[{}]}]:[{...k}],active:g,name:d,filterTests:[{...P,condition:f}]})),[g,d,f,P,k,h]),[N,O]=(0,l.useMemo)((()=>D(d,I,e)),[d,I,e]),L=(0,l.useMemo)((()=>a?.slice()||[]),[a]),B=(0,l.useCallback)((()=>{const a=[...L,I];c(a),ce(a).then((()=>{o(!0)})).catch((t=>{m({key:"share",replace:!0,hideButton:!0,type:"error",label:t?.message||e("label.error_try_again","Something went wrong, please try again"),autoHideTimeout:5e3})})),t()}),[L,I,c,t,o,m,e]),W=(0,l.useCallback)((()=>{v(!h)}),[h]),V=(0,l.useMemo)((()=>({t:e,activeFilter:g,filterName:d,isIncoming:!1,tempActions:E,setTempActions:C,zimbraFeatureMailForwardingInFiltersEnabled:y})),[e,g,d,E,y]),$=(0,l.useMemo)((()=>({t:e,newFilters:w,setNewFilters:_,condition:f,setCondition:p,activeFilter:g,filterName:d})),[e,w,_,f,p,g,d]);return n().createElement(z.Provider,{value:{newFilters:w,setNewFilters:_}},n().createElement(i.Container,{padding:{bottom:"medium"},crossAlignment:"flex-start",mainAlignment:"flex-start",maxHeight:"100%",style:{overflowY:"scroll",overflowX:"hidden"}},n().createElement(se.A,{title:T,onClose:t}),n().createElement(i.Input,{label:x,value:d,onChange:F,backgroundColor:"gray5"}),n().createElement(i.Padding,{top:"small"}),n().createElement(i.Checkbox,{value:g,onClick:S,label:M}),n().createElement(i.Row,{padding:{vertical:"medium"},height:"fit",maxHeight:"100%",crossAlignment:"flex-start",mainAlignment:"flex-start",style:{overflowY:"scroll",overflowX:"hidden"},display:"block",maxWidth:"100%",width:"100%"},n().createElement(ae,{compProps:$}),n().createElement(i.Padding,{top:"medium"}),n().createElement(i.Divider,null),n().createElement(re,{compProps:V})),n().createElement(R,{label:e("label.create","Create"),toolTipText:O,onConfirm:B,disabled:N,onSecondaryAction:W,checked:h,checkboxLabel:e("settings.do_not_process_additional_filters","Do not process additional filters")})))},Me=({t:e,onClose:t,availableList:a,activeList:r,setFilters:o,setFetchFilters:c,modifierFunc:m,selectedFilter:d,outgoingFilters:u})=>{const g=(0,l.useMemo)((()=>e("settings.delete_filter","Delete filter")),[e]),b=(()=>{const{createSnackbar:e}=(0,A.m)();return(0,l.useCallback)((({t,setFetchFilters:a,modifierFunc:l,onClose:n,selectedFilter:i,outgoingFilters:r})=>{l((0,s.filter)(r,(e=>e.name!==i.name))).then((()=>{e({key:"filter-delete-success",type:"info",label:t("settings.filter_deleted","Filter successfully deleted"),hideButton:!0}),a(!0)})).catch((a=>{e({key:"filter-delete-error",type:"error",label:a.message||t("label.error_try_again","Something went wrong, please try again"),hideButton:!0})})),n()}),[e])})(),f=(0,l.useCallback)((()=>{b({t:e,onClose:t,availableList:a,activeList:r,setFilters:o,setFetchFilters:c,modifierFunc:m,selectedFilter:d,outgoingFilters:u})}),[b,e,t,a,r,o,c,m,d,u]);return n().createElement(n().Fragment,null,n().createElement(i.Container,{padding:{bottom:"medium"}},n().createElement(se.A,{title:g,onClose:t}),n().createElement(i.Container,{orientation:"horizontal",padding:{all:"medium"}},n().createElement(i.Text,{overflow:"break-word"},e("settings.delete_filter_text","Are you sure to delete filter ")),n().createElement(i.Text,{weight:"bold",style:{paddingLeft:"0.3125rem",paddingRight:"0.3125rem"}},`"${d?.name}" ?`)),n().createElement(de.A,{onConfirm:f,label:e("label.delete","Delete"),background:"error"})))},Pe=({t:e,onClose:t,outgoingFilters:a,setFetchOutgoingFilters:o,setOutgoingFilters:c,selectedFilter:m})=>{const{createSnackbar:d}=(0,A.m)(),[u,g]=(0,l.useState)(""),[b,f]=(0,l.useState)(!1),[p,h]=(0,l.useState)("anyof"),[v,E]=(0,l.useState)(!0),[C,y]=(0,l.useState)([{actionKeep:[{}],id:(0,I.A)()}]),[k,w]=(0,l.useState)({}),[_,S]=(0,l.useState)(!0),[F,T]=(0,l.useState)(!1),{zimbraFeatureMailForwardingInFiltersEnabled:x}=(0,r.useUserSettings)().attrs,[M,P]=(0,l.useState)([{filterActions:[{actionKeep:[{}],actionStop:[{}]}],active:b,name:u,key:"subject",label:"Subject",filterTests:[{}],index:0,comp:n().createElement(j,{t:e,activeIndex:0})}]),N=(0,l.useCallback)((()=>f(!b)),[b]),O=(0,l.useCallback)((e=>g(e.target.value)),[]),L=(0,l.useMemo)((()=>`${e("label.edit","Edit")} ${m?.name}`),[e,m?.name]),B=(0,l.useMemo)((()=>`${e("settings.filter_name","Filter Name")}*`),[e]),W=(0,l.useMemo)((()=>e("settings.active_filter","Active filter")),[e]),V=(0,l.useMemo)((()=>{const e=(0,s.map)(M,(e=>e.filterTests[0]));return(0,s.reduce)(e,((e,t)=>{const a=Object.keys((0,s.omit)(t,["condition"]))[0];return Object.keys(e).includes(a)?{...e,[a]:[...e[a],...t[a]]}:{...e,...t}}),{})}),[M]),$=(0,l.useMemo)((()=>(0,s.reduce)(C,((e,t)=>{const a=Object.keys((0,s.omit)(t,"id"))[0];if(Object.keys(e).includes(a)){const l=(0,s.omit)(e,"id");return{...l,[a]:[...l[a],...t[a]]}}return{...e,...t}}),{})),[C]),H=(0,l.useMemo)((()=>({filterActions:v?[{...(0,s.omit)($,"id"),actionStop:[{}]}]:[{...(0,s.omit)($,"id")}],active:b,name:u,filterTests:[{...V,condition:p}]})),[b,u,p,V,v,$]),[U,q]=(0,l.useMemo)((()=>(0,s.isEqual)(k,H)?[!0,e("settings.label.not_changed_anything","No change was made")]:D(u,H,e,!1)),[k,u,H,e]),K=(0,l.useMemo)((()=>a?.slice()),[a]),Z=(0,l.useCallback)((()=>{E((e=>!e))}),[]);(0,l.useLayoutEffect)((()=>{E(!!m.filterActions[0]?.actionStop)}),[m.filterActions]);const G=(0,l.useMemo)((()=>({t:e,activeFilter:b,filterName:u,tempActions:C,setTempActions:y,zimbraFeatureMailForwardingInFiltersEnabled:x})),[e,b,u,C,x]),Y=(0,l.useMemo)((()=>({t:e,newFilters:M,setNewFilters:P,condition:p,setCondition:h,activeFilter:b,filterName:u,selectedFilter:m})),[e,M,P,p,h,b,u,m]);(0,l.useEffect)((()=>{m&&(g(m?.name),f(m?.active),h(m?.filterTests?.[0]?.condition),y((()=>{const e=[];return(0,s.forEach)(m?.filterActions?.[0],((t,a)=>{"actionStop"!==a&&(0,s.forEach)(t,(t=>{e.push({[a]:[{...(0,s.omit)(t,"index")}],id:(0,I.A)()})}))})),e})))}),[m]);const X=()=>{w(H)};(0,l.useEffect)((()=>{m&&_&&setTimeout((()=>{S(!1),X()}),10)}),[m,X,_]);const J=(0,l.useMemo)((()=>{const e=[];return(0,s.forEach)(m?.filterTests?.[0],((t,a)=>{"condition"!==a&&(0,s.map)(t,(t=>{e.push({...t,testName:a})}))})),e}),[m]),ee=(0,l.useMemo)((()=>(0,s.map)(J,((t,a)=>(a===J.length-1&&T(!0),{filterActions:[{actionKeep:[{}],actionStop:[{}]}],active:!1,name:"",key:be({name:t.testName,test:t}),label:(0,Q.sK)(be({name:t.testName,test:t})),filterTests:[{[t.testName]:[t],condition:m?.filterTests?.[0]?.condition}],index:0,comp:ge({name:t.testName,test:{[t.testName]:[t]},index:a,t:e})})))),[J,e,m]);(0,l.useEffect)((()=>{P(ee),F&&T(!1)}),[ee,F]);const te=(0,l.useCallback)((()=>{const a=(0,s.findIndex)(K,(e=>e.name===m?.name)),l=K.slice();l[a]=H,c(l),ce(l).then((()=>{o(!0),d({key:"share",replace:!0,hideButton:!0,type:"info",label:e("label.filter_modified","Filter modified succesfully"),autoHideTimeout:5e3})})).catch((t=>{d({key:"share",replace:!0,hideButton:!0,type:"error",label:t?.message||e("label.error_try_again","Something went wrong, please try again"),autoHideTimeout:5e3})})),t()}),[K,H,c,t,m?.name,o,d,e]);return n().createElement(z.Provider,{value:{newFilters:M,setNewFilters:P}},n().createElement(i.Container,{padding:{bottom:"medium"},crossAlignment:"flex-start",mainAlignment:"flex-start",style:{overflow:"scroll"}},n().createElement(se.A,{title:L,onClose:t}),n().createElement(i.Input,{label:B,value:u,onChange:O,backgroundColor:"gray5"}),n().createElement(i.Padding,{top:"small"}),n().createElement(i.Checkbox,{value:b,onClick:N,label:W}),n().createElement(i.Row,{padding:{vertical:"medium"},height:"fit",maxHeight:"100%",crossAlignment:"flex-start",mainAlignment:"flex-start",style:{overflowY:"scroll",overflowX:"hidden"},display:"block",maxWidth:"100%",width:"100%"},n().createElement(ae,{compProps:Y}),n().createElement(i.Padding,{top:"medium"}),n().createElement(i.Divider,null),n().createElement(re,{compProps:G})),n().createElement(R,{label:e("label.save","Save"),toolTipText:q,onConfirm:te,disabled:U,onSecondaryAction:Z,checked:v,checkboxLabel:e("settings.do_not_process_additional_filters","Do not process additional filters")})))},Ie=({compProps:e})=>{const{t,availableList:a,activeList:r,outgoingFilters:o}=e,{setFetchOutgoingFilters:c,setOutgoingFilters:m}=(0,l.useContext)(_),d=(0,l.useMemo)((()=>Object.keys(a.selected).length<=0),[a.selected]),u=(0,l.useMemo)((()=>Object.keys(r.selected).length<=0),[r.selected]),g=(0,l.useMemo)((()=>Object.keys(r.selected)[0]||Object.keys(a.selected)[0]),[r.selected,a.selected]),b=(0,l.useMemo)((()=>(0,s.find)(a.list,{name:Object.keys(a.selected)[0]})||(0,s.find)(r.list,{name:Object.keys(r.selected)[0]})),[a,r]),f=(0,l.useMemo)((()=>!Object.keys(r.selected).length&&!Object.keys(a.selected).length),[r.selected,a.selected]),p=((0,l.useMemo)((()=>!0),[]),(0,l.useMemo)((()=>!Object.keys(r.selected).length&&!Object.keys(a.selected).length),[r.selected,a.selected])),h=(0,l.useMemo)((()=>!1),[]),v=(0,l.useContext)(i.ModalManagerContext),E=(0,l.useCallback)((()=>{const e=v({size:"large",maxHeight:"80vh",children:n().createElement(pe.t,null,n().createElement(Ae,{t,onClose:()=>e(),outgoingFilters:o,setFetchOutgoingFilters:c,setOutgoingFilters:m}))},!0)}),[v,t,o,m,c]),C=M(),y=(0,l.useCallback)((()=>C({t,availableList:a,activeList:r,setFilters:m,setFetchFilters:c,modifierFunc:ce})),[C,t,a,r,m,c]),k=P(),w=(0,l.useCallback)((()=>k({t,availableList:a,activeList:r,setFilters:m,setFetchFilters:c,modifierFunc:ce})),[k,t,a,r,m,c]),S=(0,l.useCallback)((()=>{const e=v({size:"small",children:n().createElement(pe.t,null,n().createElement(Me,{onClose:()=>e(),t,availableList:a,activeList:r,setFilters:m,setFetchFilters:c,modifierFunc:ce,filterName:g,selectedFilter:b,outgoingFilters:o}))},!0)}),[r,a,v,o,b,g,c,m,t]),F=(0,l.useCallback)((()=>{const e=v({size:"large",maxHeight:"80vh",children:n().createElement(pe.t,null,n().createElement(Pe,{t,selectedFilter:b,onClose:()=>e(),outgoingFilters:o,setFetchOutgoingFilters:c,setOutgoingFilters:m}))},!0)}),[v,t,b,o,c,m]);return n().createElement(n().Fragment,null,n().createElement(i.Padding,{top:"medium"}),n().createElement(i.Button,{label:t("label.add","Add"),type:"outlined",icon:"ArrowheadLeftOutline",iconPlacement:"left",disabled:d,onClick:w,width:"fill"}),n().createElement(i.Padding,{bottom:"medium"}),n().createElement(i.Button,{label:t("label.remove_one","Remove"),type:"outlined",color:"error",icon:"ArrowheadRightOutline",disabled:u,onClick:y,width:"fill"}),n().createElement(i.Padding,{bottom:"medium"}),n().createElement(i.Button,{label:t("label.edit","Edit"),type:"outlined",disabled:f,width:"fill",onClick:F}),n().createElement(i.Padding,{bottom:"medium"}),n().createElement(i.Padding,{bottom:"medium"}),n().createElement(i.Button,{label:t("label.delete","Delete"),type:"outlined",color:"error",disabled:p,width:"fill",onClick:S}),n().createElement(i.Padding,{bottom:"medium"}),n().createElement(i.Button,{label:t("label.create","Create"),type:"outlined",disabled:h,width:"fill",onClick:E}))},ze=({t:e,selectedFilterType:t})=>{const{outgoingFilters:a,outgoingLoading:r,setFetchOutgoingFilters:o}=(0,l.useContext)(_),c=(0,l.useMemo)((()=>a?.slice()),[a]),[d,u]=(0,l.useMemo)((()=>[(0,s.map)((0,s.filter)(c,{active:!0}),(e=>({...e,id:e.name}))),(0,s.map)((0,s.filter)(c,{active:!1}),(e=>({...e,id:e.name})))]),[c]),g=Te(d,o,ce,u),b=Te(u,o,ce,d),f=(0,l.useMemo)((()=>({t:e,availableList:b,activeList:g,selectedFilterType:t,outgoingFilters:c,setFetchOutgoingFilters:o})),[e,b,g,t,c,o]);return n().createElement(i.Container,{crossAlignment:"flex-start",mainAlignment:"flex-start",orientation:"horizontal"},n().createElement(i.Container,{width:"43%",minHeight:"30vh",mainAlignment:"flex-start"},n().createElement(m,{title:e("filters.active_filters","Active Filters"),size:"small"}),n().createElement(i.Container,null,r?n().createElement(Fe,null):n().createElement(i.List,{items:g.list,selected:g.selected,ItemComponent:x,itemProps:{listProps:g,unSelect:b.unSelect}}))),n().createElement(i.Container,{width:"14%",padding:{all:"large"},mainAlignment:"space-between"},n().createElement(Ie,{compProps:f})),n().createElement(i.Container,{width:"43%",mainAlignment:"flex-start"},n().createElement(m,{title:e("filters.available_filters","Available Filters"),size:"small"}),n().createElement(i.Container,null,r?n().createElement(Fe,null):n().createElement(i.List,{items:b.list,selected:b.selected,ItemComponent:x,itemProps:{listProps:b,unSelect:g.unSelect}}))))};var Re=a(8032);var Ne=a(2940);const Oe=(0,Ne.createAsyncThunk)("filters/get_filters",(async()=>{const{filterRules:e}=await(0,r.soapFetch)("GetOutgoingFilterRules",{_jsns:"urn:zimbraMail"});return{filterRules:e}})),Le=()=>{const[e,t]=(0,l.useState)("incoming-messages"),a=(0,l.useMemo)((()=>[{id:"incoming-messages",label:(0,r.t)("filters.incoming_msg_filters","Incoming Message Filters")},{id:"outgoing-messages",label:(0,r.t)("filters.outgoing_message_filters","Outgoing Message Filters")}]),[]),o=(0,l.useCallback)(((e,a)=>{t(a)}),[]),c=(0,Re.j)(),[m,d]=(0,l.useState)([]),[u,g]=(0,l.useState)(!0),[b,f]=(0,l.useState)(!0),[p,h]=(0,l.useState)([]),[v,E]=(0,l.useState)(!0),[C,y]=(0,l.useState)(!0),{createSnackbar:k}=(0,A.m)();(0,l.useEffect)((()=>{v&&(async()=>{const{filterRules:e}=await(0,r.soapFetch)("GetFilterRules",{_jsns:"urn:zimbraMail"});return(e=>({filterRules:[{filterRule:(0,s.map)(e?.[0]?.filterRule,(e=>{return{...e,filterTests:[(t=e.filterTests[0],(0,s.reduce)(Object.keys(t),((e,a)=>"condition"!==a?{...e,[a]:(0,s.map)(t[a],(e=>(0,s.omit)(e,"index")))}:{...e,condition:t.condition}),{}))]};var t}))}]}))(e)})().then((({filterRules:e})=>{g(!1),d(e?.[0]?.filterRule),E(!1)})).catch((e=>{k({key:"share",replace:!0,hideButton:!0,type:"error",label:e?.message||(0,r.t)("label.error_try_again","Something went wrong, please try again"),autoHideTimeout:5e3}),g(!1),E(!1)}))}),[k,c,v]),(0,l.useEffect)((()=>{C&&c(Oe()).then((e=>{f(!1),h(e?.payload?.filterRules?.[0]?.filterRule),y(!1)}))}),[c,C]);const w=(0,l.useCallback)(((e,t,a)=>{const l=t.slice();if(e===l.length-1)return;const n=l[e+1];l[e+1]=l[e],l[e]=n,a(l)}),[]);return n().createElement(i.Container,{crossAlignment:"baseline",padding:{top:"medium"}},n().createElement(_.Provider,{value:{incomingFilters:m,incomingLoading:u,setFetchIncomingFilters:E,outgoingFilters:p,outgoingLoading:b,moveUp:w,setIncomingFilters:d,setOutgoingFilters:h,setFetchOutgoingFilters:y}},n().createElement(i.TabBar,{background:"gray5",items:a,selected:e,height:"3.75rem",onChange:o}),n().createElement(i.Container,{crossAlignment:"flex-start",padding:{top:"small"}},"incoming-messages"===e&&n().createElement(xe,{selectedFilterType:e,t:r.t}),"outgoing-messages"===e&&n().createElement(ze,{selectedFilterType:e,t:r.t})),n().createElement(i.Padding,{top:"medium"}),n().createElement(i.Divider,null)))},De=()=>{const e=(0,l.useMemo)((()=>(0,b.jh)()),[]);return n().createElement(i.Container,{background:"gray6",padding:{horizontal:"medium",bottom:"large"}},n().createElement(i.Container,{orientation:"horizontal",padding:{horizontal:"medium",top:"medium"},mainAlignment:"space-between"},n().createElement(i.Container,{width:"50%",id:e.id},n().createElement(m,{title:e.label,size:"medium"})),n().createElement(i.Container,{width:"50%",crossAlignment:"flex-end"},n().createElement(i.Text,{size:"extrasmall"},(0,r.t)("filters.filter_note","Note: changes to filter rules are saved immediately")))),n().createElement(i.Divider,null),n().createElement(i.Container,{padding:{all:"medium",bottom:"small"}},n().createElement(Le,null)))},je=({settingsObj:e,updateSettings:t,updatedProps:a,updateProps:o})=>{const d=(0,l.useMemo)((()=>[{label:(0,r.t)("settings.notify_folder_optn.new_message_inbox","Display notifications for new messages that arrive in inbox"),value:"FALSE"},{label:(0,r.t)("settings.notify_folder_optn.new_message_folder","Display notifications for new messages that arrive in any folder"),value:"TRUE"}]),[]),u=(0,l.useMemo)((()=>[{label:(0,r.t)("settings.read_rcpt_optn.never","Never send a read reciept"),value:"never"},{label:(0,r.t)("settings.read_rcpt_optn.always","Always send a read reciept"),value:"always"},{label:(0,r.t)("settings.read_rcpt_optn.ask_me","Ask me"),value:"prompt"}]),[]),g=(0,l.useMemo)((()=>[{label:(0,r.t)("settings.msg_from_optn.inbox","Place in inbox"),value:"dedupeNone"},{label:(0,r.t)("settings.msg_from_optn.inbox_if_cc","Place in inbox if I'm in To: or Cc:"),value:"secondCopyifOnToOrCC"},{label:(0,r.t)("settings.msg_from_optn.discard","Discard message automatically"),value:"dedupeAll"}]),[]),f=(0,l.useMemo)((()=>(0,b.W2)()),[]),p=(0,l.useMemo)((()=>!!(0,s.isNil)(a?.mailNotificationSound?.value)||"TRUE"===a?.mailNotificationSound?.value),[a?.mailNotificationSound?.value]);return n().createElement(i.FormSubSection,{label:f.label,id:f.id},n().createElement(i.Container,{crossAlignment:"baseline",padding:{all:"small"}},n().createElement(m,{title:(0,r.t)("label.message_arrival","Message Arrival")}),n().createElement(i.Input,{label:(0,r.t)("label.send_notification","Send a notification message to"),value:e.zimbraPrefNewMailNotificationAddress,onChange:e=>{t({target:{name:"zimbraPrefNewMailNotificationAddress",value:e.target.value}})},background:"white",style:{border:"1px solid lightgray"}})),n().createElement(i.Container,{crossAlignment:"baseline",padding:{all:"small"}},n().createElement(m,{title:(0,r.t)("label.arrival_notifications","Arrival Notifications")}),n().createElement(i.Checkbox,{label:(0,r.t)("label.show_popup","Show a popup notification"),value:"TRUE"===e.zimbraPrefMailToasterEnabled,onClick:()=>t({target:{name:"zimbraPrefMailToasterEnabled",value:"TRUE"===e.zimbraPrefMailToasterEnabled?"FALSE":"TRUE"}})}),n().createElement(i.Padding,{bottom:"small"}),n().createElement(i.Checkbox,{label:(0,r.t)("label.notification_audio","Play audio hint when new notification appears"),value:p,onClick:()=>{o({target:{name:"mailNotificationSound",value:{app:k.g6,value:p?"FALSE":"TRUE"}}})}})),n().createElement(i.Container,{crossAlignment:"baseline",padding:{all:"small"}},n().createElement(m,{title:(0,r.t)("label.notification_folders","Notification Folders")}),n().createElement(i.Select,{label:(0,r.t)("label.select_folder","Select folder"),items:d,onChange:e=>t({target:{name:"zimbraPrefShowAllNewMailNotifications",value:e}}),defaultSelection:{label:c(d,e.zimbraPrefShowAllNewMailNotifications),value:e.zimbraPrefShowAllNewMailNotifications},background:"white",style:{border:"1px solid lightgray"}})),n().createElement(i.Container,{crossAlignment:"baseline",padding:{all:"small"}},n().createElement(m,{title:(0,r.t)("label.read_receipt","Read Receipt")}),n().createElement(i.Select,{items:u,onChange:e=>t({target:{name:"zimbraPrefMailSendReadReceipts",value:e}}),defaultSelection:{label:c(u,e.zimbraPrefMailSendReadReceipts),value:e.zimbraPrefMailSendReadReceipts},background:"white",style:{border:"1px solid lightgray"}})),n().createElement(i.Container,{crossAlignment:"baseline",padding:{all:"small"}},n().createElement(m,{title:(0,r.t)("label.message_from_me","Messages from me")}),n().createElement(i.Select,{items:g,onChange:e=>t({target:{name:"zimbraPrefDedupeMessagesSentToSelf",value:e}}),defaultSelection:{label:c(g,e.zimbraPrefDedupeMessagesSentToSelf),value:e.zimbraPrefDedupeMessagesSentToSelf},background:"white",style:{border:"1px solid lightgray"}})),n().createElement(i.Container,{crossAlignment:"baseline",padding:{all:"small"}},n().createElement(m,{title:(0,r.t)("label.duplicate_messages","Duplicate Messages")}),n().createElement(i.Checkbox,{label:(0,r.t)("label.automatically_delete_duplicates","Automatically delete duplicate copies of the same message when received"),value:"TRUE"===e.zimbraPrefMessageIdDedupingEnabled,onClick:()=>t({target:{name:"zimbraPrefMessageIdDedupingEnabled",value:"TRUE"===e.zimbraPrefMessageIdDedupingEnabled?"FALSE":"TRUE"}})})))};var Be=a(6764),We=a(4736);const Ve=({onConfirm:e,onClose:t})=>{const a=(0,We.h)().status===k.vk.loading,l=a?(0,r.t)("label.searching_recover_emails","Searching for e-mails to recover"):(0,r.t)("label.search_recover_emails","Search e-mails to recover"),s=a?(0,r.t)("label.loading_results","Loading results..."):(0,r.t)("label.start_search","Start Search"),o=` ${(0,r.t)("label.want_to_continue","Do you want to continue?")}`;return n().createElement(i.Container,{padding:{all:"large"},mainAlignment:"center",crossAlignment:"flex-start",height:"fit"},n().createElement(se.A,{onClose:t,title:l,showCloseIcon:!a}),n().createElement(i.Container,{padding:{all:"small"},mainAlignment:"center",crossAlignment:"flex-start",height:"fit"},n().createElement(i.Text,{style:{whiteSpace:"pre-line"}},(0,r.t)("messages.searching_deleted_emails","Searching deleted e-mails from Trash may take some time. Once the operation is completed, you will be directed to the results.")),!a&&n().createElement(i.Text,null,o),n().createElement(de.A,{disabled:a,onConfirm:e,label:s,primaryButtonIcon:a&&Be.D})))};var $e=a(8555),He=a(1501);const Ue=()=>{const e=(0,i.useModal)(),t=(0,i.useSnackbar)(),{zimbraPrefLocale:a}=(0,r.useUserSettings)().prefs,[o,c]=(0,l.useState)(""),[m,d]=(0,l.useState)(null),u=(0,l.useCallback)((async e=>{if(!m&&!o)return;const a=We.h.getState();a.setStatus(k.vk.loading);const l={...function(e){if(!e)return{};const t=new Date(e),a=new Date(e);return t.setUTCDate(e.getUTCDate()-k.kD),a.setUTCDate(e.getUTCDate()+k.kD+1),a.setMilliseconds(a.getMilliseconds()-1),{startDate:t,endDate:a}}(m),...""===o?{}:{searchString:o}},n=await async function({startDate:e,endDate:t,searchString:a}){const l=new URLSearchParams;e&&l.set("after",e.toISOString()),t&&l.set("before",t.toISOString()),a&&l.set("searchString",a);const n=fetch(`/zx/backup/v1/searchDeleted?${l}`,{method:"GET",credentials:"same-origin"});return(0,$e.M)(n)}(l);e(),"error"in n?t({key:"recover-messages-error",replace:!0,type:"error",label:(0,r.t)("label.error_try_again","Something went wrong, please try again"),autoHideTimeout:3e3,hideButton:!0}):(a.setStatus(k.vk.completed),a.setMessages(n.data.messages),a.setSearchParams(l),d(null),c(""),(0,s.isEmpty)(n.data.messages)?t({key:"recover-no-messages-error",replace:!0,type:"info",label:(0,r.t)("label.error_no_backup_messages","Your search did not find any message"),autoHideTimeout:3e3,hideButton:!0}):(0,r.replaceHistory)({route:k.e$,path:"/"}))}),[t,m,o]),g=(0,r.t)("settings.label.recover_messages_infotext","Recover e-mails deleted from the Trash by typing a keyword included within the first 100 characters of the message or by selecting a date.\n\n        The selected date will include emails deleted 3 days before and 3 days after.\n\n        Once the search is completed you will be redirected to the results page where you can choose which items to restore."),f=(0,r.t)("label.search_emails","SEARCH E-MAILS"),p=(0,r.t)("label.select_recovery_date","Select recovery date"),h=(0,b.wW)(),{backupSelfUndeleteAllowed:v}=(0,He.y)(),E=(0,l.useCallback)((()=>{const t=e({children:n().createElement(pe.t,null,n().createElement(Ve,{onClose:()=>t(),onConfirm:()=>u(t)}))},!0)}),[e,u]),C=(0,l.useCallback)((e=>{d(e)}),[]),y=(0,l.useCallback)((e=>{c(e.target.value)}),[]);return v?n().createElement(i.FormSubSection,{id:h.id,"data-testid":"recover-messages-form",label:h.label,padding:{all:"medium"}},n().createElement(i.Padding,{top:"large"}),n().createElement(i.Text,{style:{whiteSpace:"pre-line"}},g),n().createElement(i.Padding,{top:"large"}),n().createElement(i.Container,{width:"100%",crossAlignment:"flex-start"},n().createElement(i.Row,{width:"30%",mainAlignment:"flex-start"},n().createElement(i.Input,{value:o,onChange:y,label:(0,r.t)("settings.keyword","Keyword")})),n().createElement(i.Padding,{top:"large"}),n().createElement(i.Row,{width:"30%",mainAlignment:"flex-start"},n().createElement(i.DateTimePicker,{label:p,isClearable:!0,width:"fill",onChange:C,timeCaption:(0,r.t)("label.time","Time"),includeTime:!1,locale:a,dateFormat:"P"})),n().createElement(i.Padding,{top:"large"}),n().createElement(i.Row,{width:"30%",mainAlignment:"flex-start"},n().createElement(i.Button,{type:"outlined",onClick:E,label:f,disabled:!m&&!o})))):n().createElement(n().Fragment,null)},qe=({acc:e,signatures:t,signatureSelectItems:a,updateIdentities:c})=>{const m=(0,l.useCallback)(((e,a=!1)=>{const l=(0,s.find)(t,["id",e]);return!l&&a&&t.length>0?t[0]:l}),[t]),d=(0,l.useMemo)((()=>({label:(0,r.t)("label.no_signature",o.U0),name:"no signature",description:"",id:o.vb})),[]),[u,g]=(0,l.useMemo)((()=>[m(e._attrs?.zimbraPrefDefaultSignatureId??"")??d,m(String(e._attrs?.zimbraPrefForwardReplySignatureId))??d]),[e._attrs?.zimbraPrefDefaultSignatureId,e._attrs?.zimbraPrefForwardReplySignatureId,m,d]);return n().createElement(i.Row,{width:"100%",padding:{horizontal:"small",vertical:"small"}},n().createElement(i.Container,{width:"20%",mainAlignment:"flex-start",crossAlignment:"flex-start",padding:{right:"medium"}},n().createElement(i.Text,null,e.name)),n().createElement(i.Container,{width:"40%",padding:{right:"medium"}},n().createElement(i.Select,{items:a,label:(0,r.t)("title.new_messages","New Messages"),selection:{label:u?.label,value:u?.id},onChange:t=>{t!==u?.id&&c({...e,_attrs:{...e._attrs,zimbraPrefDefaultSignatureId:t}})},background:"white",style:{border:"1px solid lightgray"}})),n().createElement(i.Container,{width:"40%"},n().createElement(i.Select,{items:a,label:(0,r.t)("title.replies_forwards","Replies & Forwards"),selection:{label:g?.label,value:g?.id},onChange:t=>{t!==g?.id&&c({...e,_attrs:{...e._attrs,zimbraPrefForwardReplySignatureId:t}})},background:"white",style:{border:"1px solid lightgray"}})))},Ke=(0,Ne.createAsyncThunk)("SignatureRequest",(async e=>{const t={},{itemsAdd:a,itemsEdit:l,itemsDelete:n,account:i}=e;let r="",o="",c="";n?.length&&(r=(0,s.map)(n,(e=>`<DeleteSignatureRequest xmlns="urn:zimbraAccount" requestId='${e.index}'><signature id='${e.id}'/></DeleteSignatureRequest>`)).join("")),a?.length&&(o=(0,s.map)(a,(e=>`<CreateSignatureRequest  xmlns="urn:zimbraAccount"><signature name='${e.label}'><content type="text/html">${(0,s.escape)(e.description)}</content></signature></CreateSignatureRequest>`)).join("")),l?.length&&(c=(0,s.map)(l,(e=>`<ModifySignatureRequest  xmlns="urn:zimbraAccount"> \n\t\t\t<signature id='${e.id}' name='${e.label}'> \n\t\t\t\t<content type="text/html">${(0,s.escape)(e.description)}</content>\n\t\t\t</signature>\n\t\t</ModifySignatureRequest>`)).join("")),t.SignatureRequest=`<BatchRequest xmlns="urn:zimbra" onerror="stop">\n        ${r}    \n        ${o}    \n        ${c}    \n        </BatchRequest>`;const m=await fetch("/service/soap/BatchRequest",{method:"POST",headers:{"content-type":"application/soap+xml"},body:`<?xml version="1.0" encoding="utf-8"?>\n\t\t\t<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">\n\t\t\t\t<soap:Header>\n\t\t\t\t\t<context xmlns="urn:zimbra">\n\t\t\t\t\t\t<account by="name">${i.name}</account>\n\t\t\t\t\t\t<format type="js"/>\n\t\t\t\t\t</context>\n\t\t\t\t</soap:Header>\n\t\t\t\t<soap:Body>\n\t\t\t\t\t${t.SignatureRequest??""}\t\t\t\t\n\t\t\t\t</soap:Body>\n\t\t\t</soap:Envelope>\n\t\t`}),d=await m.json();if(d.Body.BatchResponse.Fault)throw new Error(d.Body.BatchResponse.Fault.Reason.Text);return{response:d}}));var Ze=a(6978),Ge=a(8548),Ye=a(5709),Xe=a(7975),Je=a(5889);const Qe=h()(Ge.A).withConfig({displayName:"signature-settings__DeleteButton",componentId:"sc-ocmnmu-0"})(["display:none;"]),et=h()(i.Row).withConfig({displayName:"signature-settings__Signature",componentId:"sc-ocmnmu-1"})(["border-bottom:0.0625rem solid ",";display:block;border-radius:0;cursor:pointer;&:hover{background-color:",";& ","{display:flex;}}"],(({theme:e})=>e.palette.gray2.regular),(({theme:e})=>e.palette.gray6.focus),Qe),tt=h().div.withConfig({displayName:"signature-settings__EditorWrapper",componentId:"sc-ocmnmu-2"})(["width:100%;height:100%;overflow-y:auto;position:relative;"]),at=({updatedIdentities:e,updateIdentities:t,setDisabled:a,signatures:c,setSignatures:m,setOriginalSignatures:d})=>{const[u,g]=(0,l.useState)(void 0),[f,p]=(0,r.useIntegratedComponent)("composer"),h=(0,l.useMemo)((()=>(0,b.jo)()),[]),v=(0,l.useMemo)((()=>(0,b.uH)()),[]),E=(0,l.useRef)({editor:void 0}),C=(0,l.useCallback)((e=>{const t=(0,s.map)(e,((e,t)=>({label:e.name,name:e.name,id:e.id,description:(0,s.unescape)(e?.content?.[0]?._content)})));m(t),d(t.map((e=>({id:e.id,name:e.label??"",label:e.label??"",description:e.description??""}))))}),[d,m]);(0,l.useEffect)((()=>{(0,r.soapFetch)("GetSignatures",{_jsns:"urn:zimbraAccount"}).then((({signature:e})=>C(e))).catch((e=>{console.error(e)}))}),[C]),(0,l.useEffect)((()=>{c?.length&&!u&&g(c[0])}),[u,g,c]);const y=(0,l.useCallback)((()=>({id:(0,I.A)(),label:(0,r.t)("label.enter_name","Enter Name"),name:(0,r.t)("label.enter_name","Enter Name"),description:""})),[]),k=(0,l.useCallback)((()=>{const e=[...c],t=y();e.push(t),m(e),g(t)}),[y,m,c]),w=(0,l.useMemo)((()=>({label:(0,r.t)("label.no_signature",o.U0),name:"no signature",description:"",id:o.vb})),[]),_=(0,l.useMemo)((()=>(0,s.concat)(w,c).map((e=>({label:e.label,value:e.id})))),[w,c]),S=(0,l.useMemo)((()=>void 0===u),[u]),F=(0,l.useCallback)((e=>{if(!u)return;const t=e.target.value;if(u?.name===t)return;g((e=>({...e,name:t,label:t})));const l=c.map((e=>e.id===u?.id?{...e,label:t,name:t}:e));a(!1),m(l)}),[u,g,a,m,c]),T=(0,l.useCallback)((e=>{if(!E.current.editor?.hasFocus())return;if(void 0===u)return;const t=e[1];if(u?.description===t)return;g((e=>({...e,description:t})));const l=c.map((e=>e.id===u?.id&&e.description!==t?{...e,description:t}:e));a(!1),m(l)}),[u,g,a,m,c]),x={auto_focus:!1,content_style:"p { margin: 0; }",init_instance_callback:e=>{(e=>{E.current.editor=e})(e)}};return n().createElement(n().Fragment,null,n().createElement(i.FormSubSection,{label:h.label,id:h.id,padding:{all:"large"}},n().createElement(i.Container,{crossAlignment:"flex-start",orientation:"horizontal",padding:{all:"medium"}},n().createElement(i.Container,{width:"25%",padding:{right:"medium"}},n().createElement(i.Container,{mainAlignment:"flex-start"},n().createElement(i.Container,null,n().createElement(Qe,{startIcon:n().createElement(Je.A,null),variant:"outlined",onClick:k,disabled:c?.length>0&&!u?.name},(0,r.t)("signatures.add_signature","Add signature"))),n().createElement(i.Padding,{all:"small"}),n().createElement(i.Container,{height:"31.25rem"},c.length>0&&n().createElement(i.List,{"data-testid":"signatures-list",items:c??[],ItemComponent:({item:e})=>{const t=(0,l.useCallback)((t=>{g({id:e.id,name:e.label??"",label:e.label??"",description:e.description??""})}),[e.description,e.id,e.label]),r=(0,l.useCallback)((t=>{t.stopPropagation();const l=(0,s.reject)(c,["id",e.id]);u?.id===e.id&&g(void 0),m(l),a(!1)}),[e.id]);return n().createElement(et,{height:"fit",orientation:"horizontal",background:u?.id===e.id?Ze.U:"",onClick:t},n().createElement(i.Row,{height:"2.5rem",padding:{all:"small"}},n().createElement(i.Container,{orientation:"horizontal",mainAlignment:"space-between"},n().createElement(i.TextWithTooltip,{weight:"bold"},e.label),n().createElement(Ye.A,{onClick:r},n().createElement(Xe.A,{style:{color:"#ff6600"}})))))}})))),n().createElement(i.Container,{width:"75%",mainAlignment:"flex-start"},n().createElement(i.Container,{orientation:"vertical",mainAlignment:"space-around",width:"100%"},n().createElement(i.Input,{label:(0,r.t)("signatures.name","Name"),value:u?.name??"",disabled:S,backgroundColor:"gray5",onChange:F})),n().createElement(i.Padding,{all:"small"}),p&&n().createElement(tt,null,n().createElement(f,{"data-testid":"signature-editor",value:u?.description??"",customInitOptions:x,disabled:S,onEditorChange:T}))))),n().createElement(i.FormSubSection,{label:v.label,id:v.id,padding:{all:"large"}},n().createElement(i.Container,{crossAlignment:"baseline",padding:{all:"small"}},c.length>0&&(0,s.map)(e,(e=>n().createElement(qe,{acc:e,signatures:c,signatureSelectItems:_,updateIdentities:t}))))))},lt=h()(i.Row).withConfig({displayName:"trustee-list-item__ListItem",componentId:"sc-1qwcmb6-0"})(["border-bottom:0.0625rem solid ",";display:block;border-radius:0;cursor:pointer;background-color:",";&:hover{background-color:",";}"],(({theme:e})=>e.palette.gray2.regular),(({theme:e})=>e.palette.gray6.regular),(({theme:e})=>e.palette.gray6.focus)),nt=({item:e,onRemove:t})=>{const[a,s]=(0,l.useState)(!1),o=(0,l.useCallback)((()=>s(!0)),[]),c=(0,l.useCallback)((()=>s(!1)),[]),m=(0,l.useCallback)((()=>{t(e.value)}),[e,t]);return n().createElement(lt,{height:"fit",orientation:"horizontal",onMouseEnter:o,onMouseLeave:c,mainAlignment:"center",crossAlignment:"center"},n().createElement(i.Row,{height:"2.5rem",padding:{all:"small"}},n().createElement(i.Container,{width:"80%",crossAlignment:"flex-start"},n().createElement(i.Text,{size:"small"},e.value)),n().createElement(i.Container,{width:"20%",orientation:"horizontal",mainAlignment:"flex-end"},a&&n().createElement(i.Button,{size:"small",color:"error",type:"outlined",label:(0,r.t)("label.remove_one","Remove"),onClick:m}))))},it=/[!#$%^&*()+=[\]{};':"\\|,<>/?|/^\s*$/]+/,rt=({settingsObj:e,updateSettings:t})=>{const[a,o]=(0,l.useState)(""),[c,d]=(0,l.useState)(!0),[u,g]=(0,l.useState)([]),f=(0,l.useMemo)((()=>(0,b.Fl)()),[]),p=(0,l.useMemo)((()=>(0,r.t)("messages.trustee_addresses","Mail from these addresses or domains will be considered trusted and images will automatically be displayed.")),[]),h=(0,l.useCallback)((e=>{const a=(0,s.filter)(u,(t=>t!==e));t({target:{name:"zimbraPrefMailTrustedSenderList",value:a}}),g(a)}),[u,t]),v=(0,l.useCallback)((()=>{t({target:{name:"zimbraPrefMailTrustedSenderList",value:[...u,a]}}),g([...u,a]),o("")}),[a,u,t]);(0,l.useEffect)((()=>{const t=e?.zimbraPrefMailTrustedSenderList;g("string"==typeof t?[t]:t??[]),d(!1)}),[e?.zimbraPrefMailTrustedSenderList]);const E=(0,l.useMemo)((()=>!!(0,s.find)(u,(e=>e===a))||it.test(a)),[a,u]),C=(0,l.useMemo)((()=>E?(0,r.t)("messages.invalid_trustee_address","Please enter only e-mail addresses or domains"):""),[E]),y=(0,l.useMemo)((()=>(0,s.map)(u,(e=>({id:e,value:e,label:e})))),[u]);return n().createElement(i.Container,{background:"gray6",padding:{horizontal:"medium",bottom:"large"}},n().createElement(i.Container,{orientation:"horizontal",padding:{horizontal:"medium",top:"medium"}},n().createElement(i.Container,{id:f.id},n().createElement(m,{title:f.label,size:"medium"})),n().createElement(i.Container,{width:"auto",crossAlignment:"flex-end"},n().createElement(i.TextWithTooltip,{size:"extrasmall"},p))),n().createElement(i.Divider,null),n().createElement(i.Container,{padding:{all:"medium",bottom:"small"},orientation:"horizontal",mainAlignment:"flex-start"},n().createElement(i.Row,{mainAlignment:"flex-start",width:"50vw"},n().createElement(i.Input,{label:(0,r.t)("label.enter_email_address","Enter email address or domain"),value:a,hasError:E,description:C,backgroundColor:"gray5",onChange:e=>o(e.target.value)})),n().createElement(i.Padding,{left:"medium"},n().createElement(i.Tooltip,{label:C,disabled:!E,maxWidth:"100%"},n().createElement(i.Button,{label:(0,r.t)("label.add","Add"),type:"outlined",onClick:v,disabled:E})))),n().createElement(i.Container,{padding:{horizontal:"medium",bottom:"small"},orientation:"horizontal",mainAlignment:"flex-start"},c?n().createElement(Fe,null):n().createElement(i.List,{items:y,ItemComponent:nt,itemProps:{onRemove:h},"data-testid":"trustee-list"})))};var st=a(817);const ot=()=>{const{prefs:e,props:t,attrs:a}=(0,r.useUserSettings)(),c=(0,r.useUserAccount)(),{identity:m}=(0,s.cloneDeep)(c.identities),d=(0,s.remove)(m,(e=>"DEFAULT"===e.name)).concat(m),{validate:u}=(()=>{const{attrs:e}=(0,r.useUserSettings)(),[t]=(0,he.useTranslation)(),a=(0,l.useCallback)((a=>{const l=new Set;return a.forEach((a=>{l.add(((e,t)=>void 0===e.name||""===e.name.trim()?t("label.signature_required","Signature information is required."):null)(a,t)),l.add(((e,t,a)=>e.description&&""!==e.description.trim()?t&&e.description.trim().length>t?a("label.signature_size_exceed","One or more signatures exceed the size limit."):null:a("label.signature_required","Signature information is required."))(a,Number(e.zimbraMailSignatureMaxLength),t))})),Array.from(l).reduce(((e,t)=>(null!==t&&e.push(t),e)),[])}),[e.zimbraMailSignatureMaxLength,t]);return{validate:a}})(),[g,b]=(0,l.useState)({...e}),[f,p]=(0,l.useState)({}),h=(0,l.useMemo)((()=>(0,s.reduce)(t??{},((e,t)=>({...e,[t.name]:{app:t.zimlet,value:t._content}})),{})),[t]),[v,E]=(0,l.useState)(h),[C,_]=(0,l.useState)(h),[S,F]=(0,l.useState)(d),[T,x]=(0,l.useState)(d),[M,P]=(0,l.useState)((()=>[])),[I,z]=(0,l.useState)((()=>[])),[R,N]=(0,l.useState)(!0),[O,L]=(0,l.useState)(!1),D=(0,Re.j)(),{createSnackbar:j}=(0,A.m)(),B=(0,l.useMemo)((()=>{const t=(0,s.cloneDeep)(e);return void 0===t?.zimbraPrefNewMailNotificationAddress&&(t.zimbraPrefNewMailNotificationAddress=""),void 0===t?.zimbraPrefForwardReplySignatureId&&(t.zimbraPrefForwardReplySignatureId=o.vb),void 0===t?.zimbraPrefDefaultSignatureId&&(t.zimbraPrefDefaultSignatureId=o.vb),t}),[e]),W=(0,l.useCallback)((()=>{b({...e}),p({}),_(v),x(d)}),[v,d,e]),V=(0,l.useCallback)((e=>{b({...g,[e.target.name]:e.target.value}),p({...f,[e.target.name]:e.target.value})}),[g,f]),$=(0,l.useCallback)((e=>{_({...C,[e.target.name]:e.target.value})}),[C]),H=(0,l.useCallback)((e=>{const t=(0,s.map)(T,(t=>t.id===e.id?e:t));x(t)}),[T]),U=(0,l.useMemo)((()=>function e(t,a){return(0,s.transform)(t,((t,l,n)=>{(0,s.isEqual)(l,a[n])||(t[n]="zimbraPrefMailTrustedSenderList"===n?l:(0,s.isObject)(l)&&(0,s.isObject)(a[n])?e(l,a[n]):l)}))}(f,B)),[f,B]),q=(0,l.useMemo)((()=>{return e=v,t=C,(0,s.reduce)(Object.keys(t),((a,l)=>e?.[l]?.value===t?.[l]?.value?a:{...a,[l]:t[l]}),{});var e,t}),[v,C]),K=(0,l.useMemo)((()=>((e,t)=>{const a=[];return(0,s.map)(t,(t=>{(0,s.isEqual)(t,(0,s.find)(e,["id",t.id]))||a.push({id:t.id,name:t.name,prefs:{zimbraPrefDefaultSignatureId:t._attrs.zimbraPrefDefaultSignatureId?t._attrs.zimbraPrefDefaultSignatureId:o.vb,zimbraPrefForwardReplySignatureId:t._attrs.zimbraPrefForwardReplySignatureId?t._attrs.zimbraPrefForwardReplySignatureId:o.vb}})})),a})(S,T)),[S,T]),Z=(0,l.useMemo)((()=>0===Object.keys(U).length&&R&&0===Object.keys(q).length&&0===Object.keys(K).length),[U,R,q,K]),G=(0,l.useCallback)(((e,t,a,l)=>{const n=e?.find((e=>e.id===a));if(n&&t?.payload?.response?.Body?.BatchResponse?.CreateSignatureResponse){const e=t.payload.response.Body.BatchResponse.CreateSignatureResponse[0].signature.find((e=>e.name===n.label)).id,a=l?"zimbraPrefForwardReplySignatureId":"zimbraPrefDefaultSignatureId";(0,r.editSettings)({prefs:{[a]:e}}).then((()=>{p({})}))}}),[]),Y=(0,l.useCallback)((()=>{if(!(0,s.isEqual)(M,I)){const a=u(M);if(a.length)return j({key:"signature-validation-error",type:"error",label:a[a.length-1],autoHideTimeout:k.fT.SNACKBAR_DEFAULT_TIMEOUT,hideButton:!0,replace:!0}),Promise.allSettled([Promise.reject(new Error("Invalid signature"))]);const l=(0,s.filter)(I,(e=>{let t=!1;return(0,s.map)(M,(a=>{e.id===a?.id&&(t=!0)})),!t})),n=(e=M,t=I,(0,s.filter)(e,(e=>-1===t.map((e=>e.id)).indexOf(e.id)))),i=(0,s.filter)(M,(e=>(0,s.find)(I,(t=>e.id===t.id&&(e.label!==t.label||e.description!==t.description))))),o=U.zimbraPrefForwardReplySignatureId;let m="";o&&n.length>0&&-1!==n.findIndex((e=>e?.id===U.zimbraPrefForwardReplySignatureId))&&(m=U.zimbraPrefForwardReplySignatureId,delete U.zimbraPrefForwardReplySignatureId);const d=U.zimbraPrefDefaultSignatureId;let g="";d&&n.length>0&&-1!==n.findIndex((e=>e.id===U.zimbraPrefDefaultSignatureId))&&(g=U.zimbraPrefDefaultSignatureId,delete U.zimbraPrefDefaultSignatureId),D(Ke({itemsAdd:n,itemsEdit:i,itemsDelete:l,account:c})).then((e=>{""!==m&&G(n,e,m,!0),""!==g&&G(n,e,g,!1),e.type.includes("fulfilled")?(j({key:"new",replace:!0,type:"info",label:(0,r.t)("message.snackbar.settings_saved","Settings saved correctly"),autoHideTimeout:3e3,hideButton:!0}),L(!O),N(!0)):j({key:"new",replace:!0,type:"error",label:(0,r.t)("label.error_try_again","Something went wrong, please try again"),autoHideTimeout:3e3,hideButton:!0})}))}var e,t;let a={};if(Object.keys(U).length>0&&(a={...a,prefs:U}),Object.keys(q).length>0&&(a={...a,props:q}),Object.keys(K).length>0&&(a={...a,identity:{modifyList:K}}),!(0,s.isEmpty)(a)){const e=(0,r.editSettings)(a).then((e=>{e.type.includes("fulfilled")?(j({key:"new",replace:!0,type:"info",label:(0,r.t)("message.snackbar.settings_saved","Settings saved correctly"),autoHideTimeout:3e3,hideButton:!0}),E((e=>({...e,...q}))),Object.keys(K).length>0&&F(T)):j({key:"new",replace:!0,type:"error",label:(0,r.t)("label.error_try_again","Something went wrong, please try again"),autoHideTimeout:3e3,hideButton:!0})}));return Promise.allSettled([e])}return Promise.allSettled([Promise.resolve()])}),[M,I,U,q,K,u,D,c,j,G,O,T]),X=(0,l.useMemo)((()=>(0,r.t)("label.mail_settings","Mails settings")),[]);return n().createElement(n().Fragment,null,n().createElement(r.SettingsHeader,{onSave:Y,onCancel:W,isDirty:!Z,title:X}),n().createElement(i.Container,{orientation:"vertical",mainAlignment:"baseline",crossAlignment:"baseline",background:"white",style:{overflowY:"auto"}},n().createElement(i.FormSection,{minWidth:"calc(min(100%, 32rem))"},n().createElement(st.A,{variant:"outlined",sx:{padding:"1rem",width:"100%"}},n().createElement(w,{settingsObj:g,updateSettings:V,updatedProps:C,updateProps:$})),n().createElement(st.A,{variant:"outlined",sx:{padding:"1rem",width:"100%",marginTop:"16px"}},n().createElement(je,{settingsObj:g,updateSettings:V,updatedProps:C,updateProps:$})),n().createElement(st.A,{variant:"outlined",sx:{padding:"1rem",width:"100%",marginTop:"16px"}},n().createElement(Ue,null),n().createElement(at,{settingsObj:g,setSignatures:P,setOriginalSignatures:z,updateSettings:V,updatedIdentities:T,updateIdentities:H,setDisabled:N,signatures:M,flag:O})),n().createElement(st.A,{variant:"outlined",sx:{padding:"1rem",width:"100%",marginTop:"16px"}},n().createElement(y,{settingsObj:g,updateSettings:V})),n().createElement(st.A,{variant:"outlined",sx:{padding:"1rem",width:"100%",marginTop:"16px"}},n().createElement(De,null)),n().createElement(st.A,{variant:"outlined",sx:{padding:"1rem",width:"100%",marginTop:"16px"}},n().createElement(rt,{settingsObj:g,updateSettings:V})))))}}}]);
//# sourceMappingURL=mail-setting-view.07d6cf1e.chunk.js.map