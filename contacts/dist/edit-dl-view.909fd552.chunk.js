"use strict";(self.webpackChunkcarbonio_contacts_ui=self.webpackChunkcarbonio_contacts_ui||[]).push([[162],{4413:(e,t,n)=>{n.d(t,{q:()=>o});var a=n(7559),i=n(4702),r=n(8153);var l=n(9812);const o=()=>{const[e]=(0,r.useTranslation)(),t=(0,i.useSnackbar)(),n=(0,a.useCallback)((()=>!0),[]),o=(0,a.useCallback)((n=>{n&&(e=>window.parent.navigator.clipboard?window.parent.navigator.clipboard.writeText(e):(e=>{const t=window.parent.document.createElement("textarea");window.parent.document.body.appendChild(t),t.value=e,t.select();const n=window.parent.document.execCommand("copy");return window.parent.document.body.removeChild(t),new Promise(((e,t)=>{n?e():t()}))})(e))(n).then((()=>{t({key:`clipboard-copy-success-${Date.now()}`,replace:!0,type:"success",hideButton:!0,label:e("snackbar.email_copied_to_clipboard","Email copied to clipboard.")})}))}),[t,e]);return(0,a.useMemo)((()=>({id:l.kM.copyToClipboard,label:e("action.copy","Copy"),icon:"Copy",canExecute:n,execute:o})),[n,o,e])}},1722:(e,t,n)=>{n.d(t,{m:()=>o});var a=n(7559),i=n(4577),r=n(8153),l=n(9812);const o=()=>{const[e]=(0,r.useTranslation)(),[t,n]=(0,i.useIntegratedFunction)("composePrefillMessage"),o=(0,a.useCallback)((e=>{e&&t({recipients:e.map((e=>({type:"t",address:"string"==typeof e?e:e.email,email:"string"==typeof e?e:e.email,isGroup:"string"!=typeof e&&e.isGroup})))})}),[t]),s=(0,a.useCallback)((()=>n),[n]);return(0,a.useMemo)((()=>({id:l.kM.sendEmail,label:e("action.mail","Send e-mail"),icon:"EmailOutline",canExecute:s,execute:o})),[s,o,e])}},8989:(e,t,n)=>{n.d(t,{E:()=>m});var a=n(7559),i=n.n(a),r=n(4702),l=n(4710);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},o.apply(this,arguments)}const s=n.n(l)()((({withTooltip:e,children:t=null,...n})=>e?i().createElement(r.TextWithTooltip,n,t):i().createElement(r.Text,n,t))).withConfig({displayName:"Text__StyledText",componentId:"sc-w6pptn-0"})(["width:",";display:",";font-style:",";text-align:",";line-height:",";"],(({$width:e})=>e),(({$inline:e})=>e&&"inline"),(({$italic:e})=>e&&"italic"),(({$centered:e})=>e&&"center"),(({$lineHeight:e})=>e)),m=({width:e,centered:t,italic:n,inline:a,lineHeight:r=1.5,withTooltip:l=!1,...m})=>i().createElement(s,o({$width:e,$centered:t,$italic:n,$inline:a,$lineHeight:r,withTooltip:l},m))},9128:(e,t,n)=>{n.d(t,{H:()=>c});var a=n(7559),i=n.n(a),r=n(4702),l=n(4836),o=n(8989),s=n(4413);function m(){return m=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},m.apply(this,arguments)}const c=({displayName:e,email:t,...n})=>{const c=(0,s.q)(),d=(0,a.useCallback)((()=>{c.execute(t)}),[c,t]);return i().createElement(r.Container,m({orientation:"horizontal",gap:"1rem",mainAlignment:"flex-start",crossAlignment:"flex-start",height:"auto","data-testid":"info-container"},n),i().createElement(l.Gz,{shape:"square",icon:"DistributionListOutline",label:e||t,size:"large"}),i().createElement(r.Container,{minWidth:0,crossAlignment:"flex-start",mainAlignment:"center"},i().createElement(o.E,{weight:"bold"},e),i().createElement(r.Row,{gap:"0.25rem"},i().createElement(o.E,{size:e?"small":"medium",weight:e?"regular":"bold",color:e?"gray1":"text"},t),i().createElement(r.IconButton,{icon:c.icon,color:"primary",onClick:d,type:"ghost"}))))}},124:(e,t,n)=>{n.d(t,{$:()=>l});var a=n(7559),i=n.n(a),r=n(4702);const l=()=>i().createElement(r.Icon,{icon:"FunnelOutline",size:"large"})},885:(e,t,n)=>{n.d(t,{P:()=>s});var a=n(7559),i=n.n(a),r=n(2509),l=n(4702);const o=()=>i().createElement(l.Row,{width:"fill",mainAlignment:"space-between",padding:"small",gap:"0.5rem","data-testid":"shimmed-list-item",wrap:"nowrap"},i().createElement(l.Row,{wrap:"nowrap",gap:"0.5rem",flexShrink:1,minWidth:"1rem"},i().createElement(l.Row,{flexShrink:0},i().createElement(l.Shimmer.Avatar,{size:"medium"})),i().createElement(l.Row,{flexShrink:1,minWidth:"1rem"},i().createElement(l.Shimmer.Text,{size:"small",width:"25ch"})))),s=e=>(0,r.times)(e,(e=>i().createElement(o,{key:e})))},1838:(e,t,n)=>{n.d(t,{S:()=>d});var a=n(7559),i=n.n(a),r=n(4702),l=n(2509),o=n(8153),s=n(885),m=n(693),c=n(8989);const d=({managers:e,loading:t})=>{const[n]=(0,o.useTranslation)(),d=(0,a.useMemo)((()=>(0,l.map)(e,(e=>i().createElement(m.A,{email:e.name,key:e.id})))),[e]);return i().createElement(r.Container,{mainAlignment:"flex-start",crossAlignment:"flex-start",gap:"0.5rem"},i().createElement(r.Row,null,i().createElement(c.E,{size:"small",color:"secondary"},n("displayer.distribution_list.label.manager_total","Manager list {{total}}",{total:e?.length??0}))),i().createElement(r.Container,{minHeight:0,mainAlignment:"flex-start"},i().createElement(r.ListV2,null,!t&&d||(0,s.P)(3))))}},693:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(7559),i=n.n(a),r=n(4702),l=n(4413),o=n(1722);const s=({email:e})=>{const t=(0,o.m)(),n=(0,l.q)(),s=(0,a.useCallback)((()=>{t.execute([e])}),[e,t]),m=(0,a.useCallback)((()=>{n.execute(e)}),[n,e]),c=(0,a.useMemo)((()=>t.canExecute()),[t]);return i().createElement(r.Row,{width:"fill",mainAlignment:"space-between",padding:"small",gap:"0.5rem","data-testid":"member-list-item",wrap:"nowrap"},i().createElement(r.Row,{wrap:"nowrap",gap:"0.5rem",flexShrink:1,minWidth:"1rem"},i().createElement(r.Avatar,{size:"medium",label:e}),i().createElement(r.Row,{flexShrink:1,minWidth:"1rem"},i().createElement(r.TextWithTooltip,{size:"small"},e))),i().createElement(r.Row,{wrap:"nowrap",gap:"0.25rem",flexShrink:1,minWidth:"fit-content"},c&&i().createElement(r.Button,{type:"outlined",size:"medium",icon:t.icon,onClick:s,minWidth:"fit-content"}),i().createElement(r.Button,{type:"outlined",size:"medium",icon:n.icon,onClick:m,minWidth:"fit-content"})))}},3041:(e,t,n)=>{n.d(t,{p:()=>o});var a=n(7559),i=n.n(a),r=n(4702),l=n(8153);const o=({email:e,onRemove:t})=>{const[n]=(0,l.useTranslation)(),o=(0,a.useCallback)((()=>t()),[t]);return i().createElement(r.Row,{width:"fill",mainAlignment:"space-between",padding:"small",gap:"0.5rem","data-testid":"member-list-item",wrap:"nowrap"},i().createElement(r.Row,{wrap:"nowrap",gap:"0.5rem",flexShrink:1,minWidth:"1rem"},i().createElement(r.Avatar,{size:"medium",label:e}),i().createElement(r.Row,{flexShrink:1,minWidth:"1rem"},i().createElement(r.TextWithTooltip,{size:"small"},e))),i().createElement(r.Button,{type:"outlined",size:"medium",label:n("members_list_item_component.button.remove","remove"),icon:"Trash2Outline",color:"error",onClick:o,minWidth:"fit-content"}))}},4836:(e,t,n)=>{n.d(t,{BG:()=>m,FE:()=>s,Gz:()=>p,HF:()=>c,J5:()=>l,Np:()=>d,sf:()=>o});var a=n(4702),i=n(4710),r=n.n(i);const l=r()(a.Row).withConfig({displayName:"styled-components__HoverRow",componentId:"sc-1p4lrn0-0"})(["position:relative;cursor:pointer;background:",";&:hover{background:",";}"],(({theme:e})=>e.palette.transparent.regular),(({theme:e})=>e.palette.transparent.hover)),o=r()(a.Row).withConfig({displayName:"styled-components__HoverContainer",componentId:"sc-1p4lrn0-1"})([""]),s=r()(a.Row).withConfig({displayName:"styled-components__HoverBarContainer",componentId:"sc-1p4lrn0-2"})(["display:none;position:absolute;top:0;right:0;background:linear-gradient(to right,transparent,currentColor);"]),m=r()(a.Container).withConfig({displayName:"styled-components__ListItemContainer",componentId:"sc-1p4lrn0-3"})(["position:relative;cursor:pointer;","{display:none;}&:hover{","{display:flex;}}"],s,s),c=r()(a.ListItem).attrs((({background:e,selectedBackground:t,activeBackground:n,active:a,selected:i})=>({backgroundColor:a&&n||i&&t||e}))).withConfig({displayName:"styled-components__StyledListItem",componentId:"sc-1p4lrn0-4"})([""," transition:none;",""],(({backgroundColor:e,theme:t})=>e&&(0,a.pseudoClasses)(t,e,"color")),(({backgroundColor:e,theme:t})=>e&&(0,i.css)(["","{background:linear-gradient(to right,transparent,",");}&:focus ","{background:linear-gradient( to right,transparent,"," );}&:hover ","{background:linear-gradient( to right,transparent,"," );}&:active ","{background:linear-gradient( to right,transparent,"," );}"],s,(0,a.getColor)(e,t),s,(0,a.getColor)(`${e}.focus`,t),s,(0,a.getColor)(`${e}.hover`,t),s,(0,a.getColor)(`${e}.active`,t)))),d=r()(a.Container).withConfig({displayName:"styled-components__ScrollableContainer",componentId:"sc-1p4lrn0-5"})(["overflow-y:auto;"]),p=r()(a.Avatar).withConfig({displayName:"styled-components__CustomIconAvatar",componentId:"sc-1p4lrn0-6"})(["& > svg{max-width:1.5rem;max-height:1.5rem;min-width:1.5rem;min-height:1.5rem;}"])},4039:(e,t,n)=>{n.d(t,{C:()=>l});var a=n(7559),i=n(8153),r=n(9812);const l=()=>{const[e]=(0,i.useTranslation)(),[t,n]=(0,a.useState)(r.mp.details);return{items:(0,a.useMemo)((()=>[{id:r.mp.details,label:e("distribution_list.tabs.details","Details")},{id:r.mp.members,label:e("distribution_list.tabs.members","Member list")},{id:r.mp.managers,label:e("distribution_list.tabs.managers","Manager list")}]),[e]),selected:t,onChange:(0,a.useCallback)(((e,t)=>{n(t)}),[])}}},496:(e,t,n)=>{n.r(t),n.d(t,{default:()=>N});var a=n(7559),i=n.n(a),r=n(4702),l=n(4577),o=n(8153),s=n(2509),m=n(9128);const c=({name:e,nameError:t,description:n,onChange:l})=>{const[s]=(0,o.useTranslation)(),m=(0,a.useCallback)((e=>{l({displayName:e.currentTarget.value})}),[l]),c=(0,a.useCallback)((e=>{l({description:e.currentTarget.value})}),[l]);return i().createElement(r.Container,{gap:"1rem",height:"auto"},i().createElement(r.Input,{label:s("edit_dl_component.input.name.label","Distribution List name"),value:e,onChange:m,description:t,hasError:!!t}),i().createElement(r.TextArea,{label:s("edit_dl_component.input.description.label","Description"),value:n,onChange:c}))};n(3619);var d=n(124),p=n(885),u=n(3041),g=n(8989),b=n(7626),h=n(7770);const y="duplicated",w=({members:e,totalMembers:t,onRemoveMember:n,onAddMembers:l,loading:m,resetRef:c})=>{const[w]=(0,o.useTranslation)(),[v,f]=(0,a.useState)([]),[E,C]=(0,a.useState)(""),k=(0,a.useRef)(null);(0,a.useImperativeHandle)(c,(()=>({reset:()=>{f([]),k.current&&(k.current.value="")}})),[]);const _=(0,a.useMemo)((()=>(0,s.reduce)(e,((e,t)=>(t.includes(E)&&e.push(i().createElement(u.p,{email:t,onRemove:()=>n(t),key:t})),e)),[])),[e,n,E]),x=(0,a.useCallback)((t=>e.includes(t)),[e]),{validEmails:T,invalidEmailContacts:A,duplicatedContacts:N}=(0,a.useMemo)((()=>v.reduce(((e,t)=>(t.error||void 0===t.email?e.invalidEmailContacts.push(t):x(t.email)?e.duplicatedContacts.push(t):e.validEmails.push(t.email),e)),{validEmails:[],invalidEmailContacts:[],duplicatedContacts:[]})),[v,x]),M=(0,a.useMemo)((()=>{const e=T.length,t=N.length,n=A.length;if(!(e>0))return n>0&&t>0?w("edit_dl_component.error.invalid_and_duplicated_addresses","Invalid and already present addresses"):n>=1&&0===t?w("edit_dl_component.error.invalid_address",{count:n,defaultValue_one:"Invalid address",defaultValue_other:"Invalid addresses"}):0===n&&t>=1?w("edit_dl_component.error.duplicated_address",{count:t,defaultValue_one:"Address already present",defaultValue_other:"Addresses already present"}):void 0}),[N.length,A.length,w,T.length]),R=(0,a.useMemo)((()=>0===T.length&&(A.length>0||N.length>0)),[N.length,A.length,T.length]),S=(0,a.useMemo)((()=>T.length>0),[T]),I=(0,a.useCallback)((e=>e.map((e=>{const t=void 0!==e.email&&x(e.email),n=e.actions?.some((e=>e.id===y));return t&&!n?{...e,actions:[{id:y,color:"error",type:"icon",icon:"AlertCircle"},...e.actions??[]]}:!t&&n?{...e,actions:e.actions?.filter((e=>e.id!==y))??[]}:e}))),[x]);(0,a.useEffect)((()=>{f((e=>I(e)))}),[I]);const z=(0,a.useCallback)((e=>{const t=(0,s.uniqBy)(e,(e=>e.email));f(I(t))}),[I]),B=(0,a.useCallback)((e=>{C(e.currentTarget.value)}),[]),$=(0,a.useCallback)((()=>{T.length>0&&(l(T),f([...A,...N]))}),[N,A,l,T]);return i().createElement(r.Container,{mainAlignment:"flex-start",crossAlignment:"flex-start",gap:"0.5rem"},i().createElement(r.Row,null,i().createElement(g.E,{size:"small",color:"secondary"},w("edit_dl_component.label.members_total","Member list {{total}}",{total:t}))),i().createElement(g.E,{size:"small",overflow:"break-word"},w("edit_dl_component.label.hint","You can filter this list by looking for specific member’s name or add new ones by editing the Distribution List.")),i().createElement(r.Row,{width:"fill"},i().createElement(h.p,{placeholder:w("edit_dl_component.placeholder.add_members","Type an address, click '+' to add to the distribution list"),defaultValue:v,icon:"Plus",iconAction:$,onChange:z,iconDisabled:!S,chipDisplayName:b.P.email,description:M,hasError:R,inputRef:k})),i().createElement(r.Input,{"data-testid":"dl-members-filter-input",label:w("edit_dl_component.placeholder.filter_member","Filter an address"),CustomIcon:d.$,value:E,onChange:B}),i().createElement(r.Container,{minHeight:"10rem",mainAlignment:"flex-start"},i().createElement(r.ListV2,null,!m&&_||(0,p.P)(3))))};var v=n(1838),f=n(4836),E=n(9812),C=n(4039),k=n(4362),_=n(4457);const x=({email:e,displayName:t,description:n,members:d,loadingMembers:p,owners:u,loadingOwners:g})=>{const[b]=(0,o.useTranslation)(),{items:h,onChange:y,selected:x}=(0,C.C)(),[T,A]=(0,a.useState)({displayName:t??"",description:n??""}),[N,M]=(0,a.useState)(d?.members??[]),[R,S]=(0,a.useState)(d?.total??0),[I,z]=(0,a.useState)({members:d?.members??[],totalMembers:d?.total??0,displayName:t??"",description:n??""});(0,a.useEffect)((()=>{p||M(d?.members??[])}),[p,d?.members]);const B=(e=>{const[t]=(0,o.useTranslation)(),{upsertDistributionList:n}=(0,_._)(),i=(0,r.useSnackbar)();return(0,a.useCallback)((({email:a,members:r,displayName:l,description:o})=>{const{membersToAdd:m,membersToRemove:c}=(d=e.members?.members??[],p=r?.members??[],{membersToAdd:(0,s.difference)(p,d),membersToRemove:(0,s.difference)(d,p)});var d,p;return k.u.distributionListAction({email:a,membersToAdd:m,membersToRemove:c,displayName:l,description:o}).then((()=>{n({email:a,displayName:l??e.displayName,description:o??e.description,members:r?{members:r.members,total:r.total,more:e.members?.more??!1}:e.members,canRequireMembers:!0}),i({key:`dl-save-success-${a}`,type:"success",label:t("snackbar.edit_distribution_list.save.success",'"{{displayName}}" distribution list edits saved successfully',{displayName:void 0!==l&&l.length>50&&`${l.substring(0,50)}...`||l||a}),hideButton:!0})})).catch((e=>{i({key:`dl-save-error-${a}`,type:"error",label:t("label.error_try_again","Something went wrong, please try again"),hideButton:!0}),console.error(e)}))}),[i,e.description,e.displayName,e.members,t,n])})({email:e,members:d,displayName:t,description:n}),{updateBoard:$}=(0,l.useBoardHooks)(),W=(0,a.useCallback)((e=>{M((t=>[...e,...t])),S((t=>t+e.length))}),[]),O=(0,a.useCallback)((e=>{M((t=>t.filter((t=>t!==e)))),S((e=>e-1))}),[]),H=(0,a.useCallback)((()=>{const t=(0,s.pickBy)(T,((e,t)=>I[t]!==e));B({email:e,members:{members:N,total:R},...t}).then((()=>{z({members:N,totalMembers:R,...T})}))}),[T,e,I,N,R,B]),D=(0,a.useMemo)((()=>(0,s.xor)(N,I.members).length>0||(0,s.some)(T,((e,t)=>I[t]!==e))),[T,I,N]),L=(0,a.useCallback)((e=>{void 0!==e.displayName&&$({title:e.displayName}),A((t=>({...t,...e})))}),[$]),P=(0,a.useMemo)((()=>{if(T.displayName.length>E.hq)return b("edit_dl_component.input.name.error.max_length","Maximum length allowed is 256 characters")}),[b,T.displayName]),q=(0,a.useMemo)((()=>void 0!==P),[P]),V=(0,a.useRef)(null),j=(0,a.useCallback)((()=>{M(I.members),S(I.totalMembers),A({description:I.description,displayName:I.displayName}),$({title:I.displayName}),V.current?.reset()}),[I,$]);return i().createElement(r.Container,{orientation:"vertical",padding:{horizontal:"large"},mainAlignment:"flex-start",crossAlignment:"flex-start",height:"100%",background:"gray5","data-testid":"edit-dl-component"},i().createElement(r.Container,{orientation:"horizontal",padding:{vertical:"small"},mainAlignment:"flex-end",gap:"0.5rem",height:"auto"},i().createElement(r.Button,{label:b("label.discard","Discard"),type:"outlined",onClick:j}),i().createElement(r.Button,{label:b("label.save","Save"),disabled:!D||q,onClick:H})),i().createElement(m.H,{displayName:T.displayName,email:e,padding:{bottom:"large"}}),i().createElement(r.Divider,null),i().createElement(f.Np,{padding:{top:"large",bottom:"extralarge",left:"large",right:"large"},mainAlignment:"flex-start",crossAlignment:"flex-start",background:"gray6",flexGrow:1},i().createElement(r.TabBar,{items:h,selected:x,onChange:y,background:"gray6",flexShrink:0,height:"3rem",maxWidth:"50vw",borderColor:{bottom:"gray3"}}),i().createElement(f.Np,{padding:{top:"large"},mainAlignment:"flex-start"},x===E.mp.details&&i().createElement(c,{name:T.displayName,nameError:P,description:T.description,onChange:L}),x===E.mp.members&&i().createElement(w,{members:N,totalMembers:R,onRemoveMember:O,onAddMembers:W,loading:p,resetRef:V}),x===E.mp.managers&&i().createElement(v.S,{managers:u,loading:g}))))};var T=n(3e3),A=n(4230);const N=()=>{const[e]=(0,o.useTranslation)(),{context:t}=(0,l.useBoard)(),{distributionList:n,loading:s}=(0,T.i)({id:t?.id},{skip:void 0===t?.id}),{loading:m,members:c=[],total:d=0,more:p=!1}=(0,A.b)(n?.email??"",{skip:!n?.email}),u=(0,a.useMemo)((()=>({members:c,total:d,more:p})),[c,p,d]);return void 0===n?i().createElement(r.Container,null,i().createElement(g.E,{color:"error"},e("label.error_try_again","Something went wrong, please try again"))):i().createElement(x,{email:n.email,displayName:n.displayName,description:n.description,members:u,loadingMembers:m,owners:n.owners,loadingOwners:s})}}}]);
//# sourceMappingURL=edit-dl-view.909fd552.chunk.js.map