"use strict";(self.webpackChunkcarbonio_contacts_ui=self.webpackChunkcarbonio_contacts_ui||[]).push([[767],{7388:(e,t,a)=>{a.d(t,{s:()=>o});var r=a(7559),l=a(4577);let n=function(e){return e.ACCOUNT="urn:zimbraAccount",e.ADMIN="urn:zimbraAdmin",e.MAIL="urn:zimbraMail",e.ALL="urn:zimbra",e.SYNC="urn:zimbraSync",e}({});const o=()=>{const e=(0,r.useCallback)((()=>{(async()=>{const e={_jsns:n.MAIL},t=await(0,l.soapFetch)("NoOp",e);if("Fault"in t)throw new Error(t.Fault.Reason.Text)})()}),[]);(0,r.useEffect)((()=>(window.addEventListener("updateView",e),function(){window.removeEventListener("updateView",e)})),[e])}},8542:(e,t,a)=>{a.r(t),a.d(t,{default:()=>q}),a(3619);var r=a(7559),l=a.n(r),n=a(4702),o=a(4577),s=a(2509),i=a(8153),c=a(8698);const m=({compProps:e})=>{const{otherKeywords:t,setOtherKeywords:a,query:o}=e,[s]=(0,i.useTranslation)(),c=(0,r.useCallback)((e=>({label:e,hasAvatar:!1,isGeneric:!0})),[]),m=(0,r.useCallback)((e=>{a(e)}),[a]);return l().createElement(n.Container,{padding:{bottom:"small",top:"medium"}},l().createElement(n.ChipInput,{placeholder:s("label.keyword","Keyword"),background:"gray5",value:t,onChange:m,onAdd:c,defaultValue:o}))},d=({compProps:e})=>{const[t]=(0,i.useTranslation)(),{tagOptions:a,tag:c,setTag:m}=e,d=(0,r.useCallback)(((e,t,a,r,l,n,o)=>({label:`${t}:${e}`,hasAvatar:a,isGeneric:r,avatarIcon:n,background:"gray2",avatarBackground:o||"gray2",isQueryFilter:l,value:`${t}:"${e}"`})),[]),u=(0,r.useCallback)((e=>{const t=(0,s.filter)(a,{label:e})[0];return d(e,"tag",!0,!1,!0,"Tag",o.ZIMBRA_STANDARD_COLORS[t.color].hex)}),[d,a]),h=(0,r.useMemo)((()=>t("label.tag","Tag")),[t]),g=(0,r.useCallback)((e=>{m(e)}),[m]);return l().createElement(n.Container,{padding:{bottom:"small",top:"medium"},orientation:"horizontal"},l().createElement(n.ChipInput,{placeholder:h,background:"gray5",defaultValue:[],options:a,value:c,onChange:g,onAdd:u,disableOptions:!1,disabled:!0,requireUniqueChips:!0}))},u=({compProps:e})=>{const{isSharedFolderIncludedTobe:t,setIsSharedFolderIncludedTobe:a}=e,s=(0,r.useCallback)((()=>{a(!t)}),[t,a]);return l().createElement(l().Fragment,null,l().createElement(n.Container,{orientation:"horizontal",mainAlignment:"center",crossAlignment:"center"},l().createElement(n.Container,{padding:{all:"extrasmall"},mainAlignment:"flex-start",crossAlignment:"flex-start"},l().createElement(n.Container,{orientation:"horizontal",mainAlignment:"baseline",crossAlignment:"center"},l().createElement(n.Padding,{right:"small"},l().createElement(n.Switch,{onClick:s,value:t})),l().createElement(n.Text,{size:"large",weight:"bold"},(0,o.t)("label.include_shared_folders","Include shared address books"))),l().createElement(n.Padding,{bottom:"small"}),l().createElement(n.Text,{color:"secondary",size:"small",overflow:"break-word"},(0,o.t)("search.shared_folders_note","Include shared address books in searches.")),l().createElement(n.Padding,{bottom:"small"}))))};var h=a(9767),g=a(4743);const p=({open:e,onClose:t,t:a,query:i,updateQuery:c,setIsSharedFolderIncluded:p,isSharedFolderIncluded:y})=>{const[f,b]=(0,r.useState)([]),[E,A]=(0,r.useState)([]),w=(0,r.useMemo)((()=>(0,s.map)((0,o.getTags)(),(e=>({...e,label:e.name,customComponent:l().createElement(n.Row,{takeAvailableSpace:!0,mainAlignment:"flex-start"},l().createElement(n.Row,{takeAvailableSpace:!0,mainAlignment:"space-between"},l().createElement(n.Row,{mainAlignment:"flex-end"},l().createElement(n.Padding,{right:"small"},l().createElement(n.Icon,{icon:"Tag",color:o.ZIMBRA_STANDARD_COLORS[e.color??0].hex}))),l().createElement(n.Row,{takeAvailableSpace:!0,mainAlignment:"flex-start"},l().createElement(n.TextWithTooltip,null,e.name))))})))),[]),[C,v]=(0,r.useState)(y);(0,r.useEffect)((()=>{const e=(0,s.map)((0,s.filter)(i,(e=>!/^tag:/.test(e.label??"")&&!e.isQueryFilter)),(e=>({...e,hasAvatar:!1}))),t=(0,s.map)((0,s.filter)(i,(e=>/^tag:/.test(e.label??""))),(e=>({...e,hasAvatar:!0,icon:"TagOutline"})));A(t),b(e)}),[i]);const S=(0,r.useMemo)((()=>(0,s.filter)(f,(e=>!0===e.isGeneric||!0===e.isQueryFilter)).length),[f]),k=(0,r.useMemo)((()=>(0,s.concat)(f,E)),[f,E]),I=(({queryToBe:e,query:t,isSharedFolderIncluded:a,isSharedFolderIncludedTobe:l})=>(0,r.useMemo)((()=>a===l&&(0,s.isEqualWith)(e,t,((e,t)=>0===e.length&&0===t.length||e.length===t.length&&e[0].value===t[0].value))),[a,l,t,e]))({query:i,queryToBe:k,isSharedFolderIncluded:y,isSharedFolderIncludedTobe:C}),T=(({tag:e,totalKeywords:t})=>(0,r.useMemo)((()=>0===t&&0===e.length),[e.length,t]))({tag:E,totalKeywords:S}),R=(0,r.useCallback)((()=>{b([]),A([])}),[]),M=(0,r.useCallback)((()=>{const e=[...f];c(e),p(C),t()}),[f,c,p,C,t]),_=(0,r.useMemo)((()=>({otherKeywords:f,setOtherKeywords:b,query:i})),[f,i]),x=(0,r.useMemo)((()=>({tagOptions:w,tag:E,setTag:A})),[w,E,A]),F=(0,r.useMemo)((()=>({query:i,setIsSharedFolderIncludedTobe:v,isSharedFolderIncludedTobe:C})),[i,C]);return l().createElement(n.CustomModal,{open:e,onClose:t,maxHeight:"90vh",size:"medium"},l().createElement(n.Container,{padding:{bottom:"medium"}},l().createElement(g.r,{onClose:t,title:a("title.advanced_filters","Advanced Filters")}),l().createElement(n.Container,{padding:{horizontal:"medium",vertical:"small"}},l().createElement(u,{compProps:F}),l().createElement(m,{compProps:_}),l().createElement(d,{compProps:x})),l().createElement(h.A,{onConfirm:M,disabled:I,secondaryDisabled:T,label:a("action.search","Search"),secondaryLabel:a("action.reset_filters","Reset Filters"),secondaryAction:R,secondaryBtnType:"outlined",secondaryColor:"primary",paddingTop:"small"})))};var y=a(4710),f=a.n(y),b=a(7760),E=a(7848),A=a(5157),w=a(3201),C=a(9153),v=a(3863),S=a(856);const k=({item:e,selected:t,selecting:a,toggle:i,active:c})=>{const m=(0,b.useDispatch)(),d=e.parent,u=(0,E.G)((e=>(0,w.$0)(e,d))),h=(0,r.useCallback)((()=>{u||m((0,A.w)(d)),(0,o.pushHistory)(`/folder/${e.parent}/contacts/${e.id}`)}),[m,d,u,e]),g=(0,r.useMemo)((()=>(e=>e.firstName??e.middleName??e.lastName?(0,s.trim)(`${e.firstName??""} ${e.middleName??""} ${e.lastName??""}`):e.fullName??e?.email?.email?.mail??"")(e)),[e]),p=(0,r.useMemo)((()=>(0,s.trim)(`${Object.values(e.email).length>0?Object.values(e.email)[0].mail:""}, ${Object.values(e.phone).length>0?Object.values(e.phone)[0].number:""}`,", ")),[e]),y=(0,o.useTags)(),f=(0,r.useMemo)((()=>(0,s.reduce)(y,((t,a)=>((0,s.includes)(e.tags,a.id)&&t.push({...a,color:o.ZIMBRA_STANDARD_COLORS[parseInt(a.color??"0",10)].hex}),t)),[])),[e.tags,y]);return l().createElement(n.Container,{mainAlignment:"flex-start","data-testid":`ConversationListItem-${e.id}`},l().createElement(S.A,{item:e,current:c,onClick:h,contact:e},l().createElement("div",{style:{alignSelf:"center"},"data-testid":"AvatarContainer"},l().createElement(C.V,{item:e,selected:t,selecting:a,toggle:i,folderId:d,isSearch:!0}),l().createElement(n.Padding,{horizontal:"extrasmall"})),l().createElement(n.Row,{takeAvailableSpace:!0,wrap:"wrap",mainAlignment:"space-around",crossAlignment:"flex-start",orientation:"vertical",padding:{left:"small",top:"small",bottom:"small",right:"large"}},g!==e?.email?.email?.mail?l().createElement(l().Fragment,null,l().createElement(n.Container,{orientation:"horizontal",height:"fit",width:"fill"},l().createElement(n.Row,{wrap:"nowrap",takeAvailableSpace:!0,mainAlignment:"flex-start"},l().createElement(n.Text,null,g)),l().createElement(v.t,{item:e,tags:f})),l().createElement(n.Tooltip,{label:e?.email?.email?.mail,overflow:"break-word",maxWidth:"60vw",disabled:!e?.email?.email?.mail},l().createElement(n.Row,{takeAvailableSpace:!0,mainAlignment:"flex-start"},l().createElement(n.Text,{size:"small",weight:"regular",color:"secondary"},p)))):l().createElement(n.Text,{size:"large"},g))))},I=()=>l().createElement(l().Fragment,null,(0,s.map)(Array.from(Array(15).keys()),((e,t)=>l().createElement(n.Shimmer.ListItem,{type:1,key:`${e}${t}`})))),T=f()(n.Container).withConfig({displayName:"search-list__BorderContainer",componentId:"sc-iyw5sd-0"})(["border-bottom:0.0625rem solid ",";border-right:0.0625rem solid ",";"],(({theme:e})=>e?.palette?.gray2?.regular),(({theme:e})=>e?.palette?.gray2?.regular)),R=({searchResults:e,search:t,query:a,loading:o,filterCount:s,setShowAdvanceFilters:m})=>{const[d]=(0,i.useTranslation)(),{itemId:u}=(0,c.useParams)(),h=(0,r.useCallback)((()=>{e&&e.contacts.length>0&&e.more&&t(a,!1)}),[a,t,e]),g=(0,r.useMemo)((()=>!o&&e&&e.contacts.length>0&&e.more),[o,e]),[p,y]=(0,r.useState)(0);(0,r.useEffect)((()=>{y(0===p?1:0)}),[e?.contacts.length,a]);const f=(0,r.useMemo)((()=>0===e?.contacts.length?0===p?d("displayer.search_list_title1","It looks like there are no results. Keep searching!"):d("displayer.search_list_title2","None of your items matches your search."):null),[p,d,e?.contacts.length]);return l().createElement(n.Container,{background:"gray6",maxWidth:"40.625rem",width:"25%",orientation:"vertical",mainAlignment:"flex-start","data-testid":"ContactsSearchResultListContainer"},l().createElement(T,{padding:"small",height:"fit",borderRadius:"none"},l().createElement(n.Button,{onClick:()=>m(!0),type:s>0?"default":"outlined",width:"fill",label:0===s?d("title.advanced_filters","Advanced Filters"):d("label.advanced_filter",{count:s,defaultValue_one:"{{count}} Advanced Filter",defaultValue_other:'"{{count}} Advanced Filters'}),icon:"Options2Outline"})),o&&l().createElement(I,null),e?.contacts.length>0&&!o&&l().createElement(n.Container,null,l().createElement(n.List,{background:"gray6",items:e?.contacts??[],ItemComponent:k,onListBottom:g?h:void 0,active:u,"data-testid":"SearchResultContactsContainer"})),0===e?.contacts.length&&!o&&l().createElement(n.Container,null,l().createElement(n.Padding,{top:"medium"},l().createElement(n.Text,{color:"gray1",overflow:"break-word",size:"small",style:{whiteSpace:"pre-line",textAlign:"center"}},f))))};var M=a(8689),_=a(2295);const x=({searchResults:e,query:t,width:a})=>{const{path:o}=(0,c.useRouteMatch)(),[s]=(0,i.useTranslation)(),m=(0,r.useMemo)((()=>(e=>[{title:e("displayer.search_title1","Start another search"),description:e("displayer.search_description1","Or select “Advanced Filters” to refine your search.")},{title:e("displayer.search_title2","We’re sorry but there are no results for your search"),description:e("displayer.search_description2","Try to start another search.")},{title:e("displayer.search_title3","There are no results for your search."),description:e("displayer.search_description3","Check the spelling and the filters' options or try with another keyword.")}])(s)),[s]),d=(0,r.useMemo)((()=>(e=>[{title:e("displayer.search_title4","Select one or more results to perform actions or display details."),description:""}])(s)),[s]),[u,h]=(0,r.useState)(0);(0,r.useEffect)((()=>{const e=Math.floor(3*Math.random());h(e)}),[e?.contacts.length,t]);const g=(0,r.useMemo)((()=>0===e?.contacts.length?m[u]:d[0]),[u,m,d,e?.contacts.length]),p=(0,r.useMemo)((()=>g?.title),[g?.title]),y=(0,r.useMemo)((()=>g?.description),[g?.description]);return l().createElement(n.Container,{width:a??"55%",mainAlignment:"flex-start"},l().createElement(c.Switch,null,l().createElement(c.Route,{exact:!0,path:`${o}/folder/:folderId/contacts/:contactId`},l().createElement(_.A,null)),l().createElement(c.Route,{exact:!0,path:`${o}/folder/:folderId/edit/:editId`},l().createElement(M.A,null)),l().createElement(c.Route,{path:o,render:()=>l().createElement(n.Container,{background:"gray5"},l().createElement(n.Padding,{all:"medium"},l().createElement(n.Text,{color:"gray1",overflow:"break-word",weight:"bold",size:"large",style:{whiteSpace:"pre-line",textAlign:"center"}},p)),l().createElement(n.Text,{size:"small",color:"gray1",overflow:"break-word",style:{whiteSpace:"pre-line",textAlign:"center"}},y))})))};var F=a(2816),O=a(7388),z=a(5302),$=a(1295);const q=({useQuery:e,ResultsHeader:t})=>{const[a,m]=e();(0,O.s)();const[d,u]=(0,r.useState)({contacts:[],more:!1,offset:0,sortBy:"nameAsc",query:""}),[h,g]=(0,r.useState)(!1),[y]=(0,i.useTranslation)(),[f,b]=(0,r.useState)(0),[E,A]=(0,r.useState)(!1),{zimbraPrefIncludeTrashInSearch:w,zimbraPrefIncludeSharedItemsInSearch:C}=(()=>{const{prefs:e}=(0,o.useUserSettings)();return e})(),[v,S]=(0,r.useMemo)((()=>["TRUE"===w,"TRUE"===C]),[w,C]),[k,I]=(0,r.useState)(S),T=(0,z.Fi)(),M=(0,r.useMemo)((()=>(0,s.reduce)(T,((e,t,a)=>(v&&(0,F.vF)(a)&&e.push(a),t.perm&&!(0,F.vF)(a)&&e.push(a),e)),[])),[T,v]),_=(0,r.useMemo)((()=>`( ${(0,s.map)(M,(e=>`inid:"${e}"`)).join(" OR ")} OR is:local) `),[M]),q=(0,r.useMemo)((()=>k&&M?.length>0?`(${a.map((e=>e.value?e.value:e.label)).join(" ")}) ${_}`:`${a.map((e=>e.value?e.value:e.label)).join(" ")}`),[k,M.length,a,_]),B=(0,r.useCallback)(((e,t)=>{g(!0),(0,o.soapFetch)("Search",{limit:100,query:e,offset:t?0:d.offset,sortBy:d.sortBy,types:"contact",_jsns:"urn:zimbraMail"}).then((({cn:a,more:r,offset:l,sortBy:n})=>({query:e,contacts:[...t?[]:d.contacts??[],...(0,$.O)(a)??[]],more:r,offset:(l??0)+100,sortBy:n??"nameAsc"}))).then((e=>{u(e),g(!1)}))}),[d.contacts,d.offset,d.sortBy]);(0,r.useEffect)((()=>{a&&a.length>0&&q!==d.query&&(g(!0),b(a.length),B(q,!0))}),[a,q,B,d.query]);const{path:N}=(0,c.useRouteMatch)();return l().createElement(l().Fragment,null,l().createElement(n.Container,null,l().createElement(t,{label:y("label.results_for","Results for:")}),l().createElement(n.Container,{orientation:"horizontal",background:"gray4",style:{overflowY:"auto"},mainAlignment:"flex-start"},l().createElement(c.Switch,null,l().createElement(c.Route,{path:`${N}/:folder?/:folderId?/:type?/:itemId?`},l().createElement(R,{searchResults:d,search:B,query:a,loading:h,filterCount:f,setShowAdvanceFilters:A}))),l().createElement(r.Suspense,{fallback:l().createElement(o.Spinner,null)},l().createElement(x,{searchResults:d,query:a,width:"75%"}))),l().createElement(p,{query:a,updateQuery:m,open:E,isSharedFolderIncluded:k,setIsSharedFolderIncluded:I,onClose:()=>A(!1),t:y})))}}}]);
//# sourceMappingURL=search-view.9129c5d4.chunk.js.map