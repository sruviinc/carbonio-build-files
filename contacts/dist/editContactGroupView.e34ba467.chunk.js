"use strict";(self.webpackChunkcarbonio_contacts_ui=self.webpackChunkcarbonio_contacts_ui||[]).push([[541],{3041:(e,t,n)=>{n.d(t,{p:()=>l});var r=n(7559),o=n.n(r),a=n(4702),i=n(8153);const l=({email:e,onRemove:t})=>{const[n]=(0,i.useTranslation)(),l=(0,r.useCallback)((()=>t()),[t]);return o().createElement(a.Row,{width:"fill",mainAlignment:"space-between",padding:"small",gap:"0.5rem","data-testid":"member-list-item",wrap:"nowrap"},o().createElement(a.Row,{wrap:"nowrap",gap:"0.5rem",flexShrink:1,minWidth:"1rem"},o().createElement(a.Avatar,{size:"medium",label:e}),o().createElement(a.Row,{flexShrink:1,minWidth:"1rem"},o().createElement(a.TextWithTooltip,{size:"small"},e))),o().createElement(a.Button,{type:"outlined",size:"medium",label:n("members_list_item_component.button.remove","remove"),icon:"Trash2Outline",color:"error",onClick:l,minWidth:"fit-content"}))}},8312:(e,t,n)=>{n.d(t,{e0:()=>d}),n(3619);var r=n(2509),o=n(1621);function a(e,t){const n=e.toLowerCase(),r=t.toLowerCase();return n>r?1:r>n?-1:0}const i={orderedContactGroups:[],unorderedContactGroups:[],offset:0};function l(e,t,n){const o=(0,r.findIndex)(e,(e=>a(n.title,e.title)<0));if(o<e.length&&o>=0)e.splice(o,0,n);else if(0===t.length)t.push(n);else{const e=(0,r.findIndex)(t,(e=>a(n.title,e.title)<0));t.splice(e,0,n)}}const d=(0,o.vt)()(((e,t)=>({...i,reset:()=>{e(i)},updateContactGroup:n=>{const{orderedContactGroups:r,unorderedContactGroups:o,offset:a}=t(),i=r.findIndex((e=>e.id===n.id)),d=[...r],s=[...o];if(i>=0)d.splice(i,1),l(d,s,n),e((()=>({orderedContactGroups:d,unorderedContactGroups:s,offset:d.length===r.length||-1===a?a:a+d.length-r.length})));else{const t=o.findIndex((e=>e.id===n.id));if(!(t>=0))throw new Error("Contact group not found");s.splice(t,1),l(d,s,n),e((()=>({orderedContactGroups:d,unorderedContactGroups:s,offset:d.length===r.length||-1===a?a:a+d.length-r.length})))}},setOffset:t=>e((()=>({offset:t}))),addContactGroups:n=>{const{orderedContactGroups:o,unorderedContactGroups:a}=t();if(a.length>0){const t=(0,r.differenceBy)(a,n,(e=>e.id));e((()=>({orderedContactGroups:[...o??[],...n],unorderedContactGroups:t})))}else e((()=>({orderedContactGroups:[...o??[],...n]})))},removeContactGroup:n=>{const{orderedContactGroups:r,unorderedContactGroups:o,offset:a}=t();if(r.findIndex((e=>e.id===n))>=0)e((()=>({orderedContactGroups:r.filter((e=>e.id!==n)),offset:a-1})));else{if(!(o.findIndex((e=>e.id===n))>=0))throw new Error("Contact group not found");e((()=>({unorderedContactGroups:o.filter((e=>e.id!==n))})))}},addContactGroupInSortedPosition:n=>{const{orderedContactGroups:r,unorderedContactGroups:o,offset:a}=t(),i=[...r],d=[...o];l(i,d,n),e((()=>({orderedContactGroups:i,unorderedContactGroups:d,offset:i.length===r.length||-1===a?a:a+i.length-r.length})))}})))},2788:(e,t,n)=>{n.d(t,{A:()=>b,w:()=>h}),n(3619);var r=n(7559),o=n.n(r),a=n(4702),i=n(4577),l=n(2509),d=n(8153),s=n(4710),c=n.n(s),u=n(3041),m=n(9812),p=n(7626),g=n(7770);function h(e){return 0===e.trim().length||e.length>m.n}const f=c()(a.ListV2).withConfig({displayName:"common-contact-group-board__List",componentId:"sc-1f18734-0"})(["min-height:0;"]),b=({onSave:e,nameValue:t,memberListEmails:n,isOnSaveDisabled:s,setMemberListEmails:c,initialNameValue:h,initialMemberListEmails:b,setNameValue:C})=>{const[G]=(0,d.useTranslation)(),{updateBoard:v}=(0,i.useBoardHooks)(),E=(0,r.useCallback)((e=>{C(e.target.value),v({title:e.target.value})}),[C,v]),w=(0,r.useMemo)((()=>0===t.trim().length?G("board.newContactGroup.input.name_input.error.required","Group name is required, enter a name to proceed"):t.length>m.n?G("board.newContactGroup.input.name_input.error.max_length","Maximum length allowed is 256 characters"):void 0),[G,t]),[_,y]=(0,r.useState)([]),k=(0,r.useCallback)((()=>{C(h),c(b),v({title:h}),y([])}),[b,h,c,C,v]),x=(0,r.useCallback)((()=>{const e=[],t=[];_.forEach((n=>{n.error||n.duplicated||void 0===n.email?t.push(n):e.push(n.email)})),y(t),c((t=>[...t,...e]))}),[_,c]),A=(0,r.useCallback)((e=>{const t=n.filter((t=>t!==e));c(t),y((e=>e.map((e=>{const n=void 0!==e.email&&t.includes(e.email),r=[...e.actions??[]];return!n&&e.duplicated&&(0,l.remove)(r,(e=>"duplicated"===e.id)),{...e,duplicated:n,actions:r}}))))}),[n,c]),S=(0,r.useMemo)((()=>{let e=0,t=0,n=0;if(_.forEach((r=>{r.duplicated?t+=1:r.error?n+=1:e+=1})),!(e>0))return n>0&&t>0?G("board.newContactGroup.input.contact_input.error.invalid_already_present_addresses","Invalid and already present addresses"):n>0&&0===t?G("board.newContactGroup.input.contact_input.error.invalid_address",{count:n,defaultValue_one:"Invalid address",defaultValue_other:"Invalid addresses"}):t>0&&0===n?G("board.newContactGroup.input.contact_input.error.address_already_present",{count:t,defaultValue_one:"Address already present",defaultValue_other:"Addresses already present"}):void 0}),[_,G]),I=(0,r.useMemo)((()=>!(0,l.some)(_,(e=>!e.error&&!e.duplicated))),[_]),L=(0,r.useMemo)((()=>n.map((e=>o().createElement(u.p,{key:e,email:e,onRemove:()=>A(e)})))),[n,A]);return o().createElement(a.Container,{crossAlignment:"flex-end",background:"gray5",padding:{horizontal:"large",bottom:"2.625rem"},height:"fill",minHeight:"30rem"},o().createElement(a.Container,{gap:"0.5rem",orientation:"horizontal",mainAlignment:"flex-end",height:"fit",padding:{vertical:"0.5rem"}},o().createElement(a.Button,{disabled:!1,size:"medium",label:G("label.discard","discard"),onClick:k,type:"outlined"}),o().createElement(a.Button,{disabled:s,size:"medium",label:G("label.save","save"),icon:"SaveOutline",onClick:e})),o().createElement(a.Container,{height:"fit",orientation:"horizontal",mainAlignment:"flex-start",gap:"1rem",padding:"1rem 0"},o().createElement(a.Avatar,{size:"large",label:t,icon:"PeopleOutline"}),o().createElement(a.Container,{height:"fit",crossAlignment:"flex-start",minWidth:0},o().createElement(a.Text,{weight:"bold"},t),o().createElement(a.Text,{color:"gray1"},G("board.newContactGroup.addresses.label","Addresses"),": ",n.length))),o().createElement(a.Container,{background:"gray6",mainAlignment:"flex-start",crossAlignment:"flex-start",padding:{horizontal:"large",top:"large"},gap:"0.5rem",height:"calc(100% - 8rem)"},o().createElement(a.Input,{label:G("board.newContactGroup.input.name_input.name.label","Group name*"),backgroundColor:"gray5",borderColor:"gray3",value:t,onChange:E,description:w,hasError:0===t.trim().length||t.length>m.n}),o().createElement(a.Row,{padding:{top:"0.5rem"}},o().createElement(a.Text,{color:"secondary"},G("board.newContactGroup.input.contact_input.title","Addresses list"))),o().createElement(a.Container,{orientation:"horizontal",height:"fit",crossAlignment:"flex-start"},o().createElement(g.p,{"data-testid":"contact-group-contact-input",defaultValue:_,onChange:e=>{const t=(0,l.uniqBy)(e,(e=>e.email)).map((e=>{const t=void 0!==e.email&&n.includes(e.email),r=!e.actions?.find((e=>"duplicated"===e.id)),o=[...e.actions??[],...t&&r?[{id:"duplicated",color:"error",type:"icon",icon:"AlertCircle"}]:[]];return{...e,duplicated:t,actions:o}}));y(t)},placeholder:G("board.newContactGroup.input.contact_input.placeholder","Type an address, click ‘+’ to add to the group"),icon:"Plus",iconAction:x,iconDisabled:I,description:S,hasError:_.length>0&&I,chipDisplayName:p.P.email})),o().createElement(f,{"data-testid":"members-list"},L)))}},9681:(e,t,n)=>{n.r(t),n.d(t,{default:()=>p});var r=n(7559),o=n.n(r),a=n(4702),i=n(2509),l=n(8153),d=n(2788),s=n(4577),c=n(8312),u=n(4362);const m=({contactGroup:e})=>{const[t]=(0,l.useTranslation)(),n=(0,a.useSnackbar)(),[s,m]=(0,r.useState)(e.title),[p,g]=(0,r.useState)(e.members),h=(0,r.useCallback)((()=>{const r=(0,i.difference)(p,e.members),o=(0,i.difference)(e.members,p);u.u.modifyContactGroup({id:e.id,addedMembers:r.length>0?r:void 0,removedMembers:o.length>0?o:void 0,name:e.title!==s?s:void 0}).then((e=>{c.e0.getState().updateContactGroup(e),n({key:(new Date).toLocaleString(),type:"success",label:t("board.editContactGroup.snackbar.contact_group_edited","Group successfully updated")})})).catch((()=>{n({key:(new Date).toLocaleString(),type:"error",label:t("board.editContactGroup.snackbar.error","Something went wrong saving the edits, try again")})}))}),[e.id,e.members,e.title,n,p,s,t]),f=(0,r.useMemo)((()=>(0,d.w)(s)||0===(0,i.xor)(p,e.members).length&&e.title===s),[e.members,e.title,p,s]);return o().createElement(d.A,{onSave:h,nameValue:s,memberListEmails:p,isOnSaveDisabled:f,setMemberListEmails:g,initialNameValue:e.title,initialMemberListEmails:e.members,setNameValue:m})},p=()=>{const e=(()=>{const{context:e}=(0,s.useBoard)();return[...(0,c.e0)((e=>e.orderedContactGroups)),...(0,c.e0)((e=>e.unorderedContactGroups))].find((t=>t.id===e?.contactGroupId))})();return e?o().createElement(m,{contactGroup:e}):null}}}]);
//# sourceMappingURL=editContactGroupView.e34ba467.chunk.js.map