"use strict";(self.webpackChunkcarbonio_contacts_ui=self.webpackChunkcarbonio_contacts_ui||[]).push([[300],{2300:(e,t,n)=>{n.r(t),n.d(t,{default:()=>H});var a=n(7559),r=n.n(a),o=n(4702),i=n(4577),s=n(8153),l=n(2861),c=n(2509);const d=async({id:e,view:t},n)=>{const a=(0,c.omitBy)({_jsns:"urn:zimbraMail",folder:e?{l:e}:void 0,view:t,tr:1},c.isNil);return(0,i.soapFetch)("GetFolder",a,n)};var u=n(5302),m=n(7218);var p=n(9812),f=n(6815),h=n(7770);const b=e=>r().createElement(h.p,e);var g=n(4362);const y=(e,t)=>n=>{g.u.createContactFromVcard(n.messageId,n.part).then((()=>{e({key:(new Date).toLocaleString(),type:"success",label:t("import_contacts.snackbar.contact_import_success","Contact imported in your address book successfully.")})})).catch((()=>{e({key:(new Date).toLocaleString(),type:"error",label:t("label.error_try_again","Something went wrong, please try again")})}))};var v=n(9967),E=n(7848),S=n(1906),w=n(1295);const C=()=>{const e=(0,i.useNotify)(),[t,n]=(0,a.useState)(-1),r=(0,i.useRefresh)(),o=(0,E.j)(),[s,l]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{(0,c.isEmpty)(r)||s||l(!0)}),[o,s,r]),(0,a.useEffect)((()=>{s&&e.length>0&&(0,c.forEach)((0,c.sortBy)(e,"seq"),(e=>{if(!(0,c.isEmpty)(e)&&e.seq>t){if(e.created?.cn&&o((0,S.vY)((0,w.t)(e.created.cn))),e.modified?.cn){const t=(0,w.t)(e.modified.cn);o((0,S.q5)(t))}e.deleted?.length>0&&o((0,S.EM)(e.deleted)),n(e.seq)}}))}),[o,s,e,t]),null},_=(0,a.lazy)((()=>Promise.all([n.e(837),n.e(936),n.e(406)]).then(n.bind(n,2421)))),k=(0,a.lazy)((()=>n.e(37).then(n.bind(n,9772)))),N=(0,a.lazy)((()=>Promise.all([n.e(837),n.e(583),n.e(473),n.e(200)]).then(n.bind(n,1863)))),F=(0,a.lazy)((()=>n.e(631).then(n.bind(n,7572)))),R=(0,a.lazy)((()=>n.e(62).then(n.bind(n,2435)))),O=(0,a.lazy)((()=>Promise.all([n.e(473),n.e(0),n.e(111),n.e(998),n.e(767)]).then(n.bind(n,8542)))),A=(0,a.lazy)((()=>Promise.all([n.e(0),n.e(807)]).then(n.bind(n,7124)))),M=(0,a.lazy)((()=>n.e(725).then(n.bind(n,4253)))),T=(0,a.lazy)((()=>n.e(541).then(n.bind(n,9681)))),I=(0,a.lazy)((()=>n.e(162).then(n.bind(n,496)))),x=()=>r().createElement(a.Suspense,{fallback:r().createElement(i.Spinner,null)},r().createElement(v.tv,null,r().createElement(o.ModalManager,null,r().createElement(_,null)))),j=e=>r().createElement(a.Suspense,{fallback:r().createElement(i.Spinner,null)},r().createElement(o.ModalManager,null,r().createElement(k,e))),D=()=>r().createElement(a.Suspense,{fallback:r().createElement(i.Spinner,null)},r().createElement(F,null)),L=()=>r().createElement(a.Suspense,{fallback:r().createElement(i.Spinner,null)},r().createElement(v.tv,null,r().createElement(o.ModalManager,null,r().createElement(A,null)))),B=()=>r().createElement(a.Suspense,{fallback:r().createElement(i.Spinner,null)},r().createElement(o.ModalManager,null,r().createElement(M,null))),z=()=>r().createElement(a.Suspense,{fallback:r().createElement(i.Spinner,null)},r().createElement(o.ModalManager,null,r().createElement(T,null))),P=()=>r().createElement(a.Suspense,{fallback:r().createElement(i.Spinner,null)},r().createElement(I,null)),q=()=>r().createElement(a.Suspense,{fallback:r().createElement(i.Spinner,null)},r().createElement(v.tv,null,r().createElement(o.ModalManager,null,r().createElement(R,null)))),$=e=>r().createElement(a.Suspense,{fallback:r().createElement(i.Spinner,null)},r().createElement(v.tv,null,r().createElement(o.ModalManager,null,r().createElement(O,e)))),G=e=>r().createElement(a.Suspense,{fallback:r().createElement(i.Spinner,null)},r().createElement(v.tv,null,r().createElement(o.ModalManager,null,r().createElement(N,e)))),H=()=>{const[e]=(0,s.useTranslation)(),{navigateTo:t}=(0,f.c)(),n=(0,o.useSnackbar)();return(0,a.useEffect)((()=>{(0,i.addRoute)({route:p.Iy,position:300,visible:!0,label:e("label.app_name","Contacts"),primaryBar:"ContactsModOutline",secondaryBar:G,appView:x}),(0,i.addRoute)({route:p.zE,position:310,visible:!0,label:e("label.groups_app_name","Contact Groups and Distribution Lists"),primaryBar:"ListOutline",secondaryBar:j,appView:D}),(0,i.addSettingsView)({route:p.Iy,label:e("label.app_name","Contacts"),component:q}),(0,i.addSearchView)({route:p.Iy,label:e("label.app_name","Contacts"),component:$}),(0,i.addBoardView)({route:p.Iy,component:L}),(0,i.addBoardView)({id:p.rs,route:p.rs,component:B}),(0,i.addBoardView)({id:p.BJ,route:p.BJ,component:z}),(0,i.addBoardView)({id:p.Zb,route:p.Zb,component:P})}),[e]),(0,a.useEffect)((()=>{(0,i.registerComponents)({id:"contact-input",component:b}),(0,i.registerActions)({action:()=>({id:"new-contact",label:e("label.new_contact","New Contact"),icon:"ContactsModOutline",onClick:t=>{t?.preventDefault?.(),(0,i.addBoard)({url:`${p.Iy}/new`,title:e("label.new_contact","New Contact")})},disabled:!1,group:p.K0,primary:!0}),id:"new-contact",type:i.ACTION_TYPES.NEW},{id:"new-contact-group",type:i.ACTION_TYPES.NEW,action:()=>({id:"new-contact-group",label:e("label.newContactGroup","New contact group"),icon:"PeopleOutline",onClick:()=>{(0,i.addBoard)({url:p.rs,title:e("board.newContactGroup.title","New Group"),context:{navigateTo:t}})},disabled:!1,primary:!1,group:p.K0})}),(0,i.registerFunctions)({id:"create_contact_from_vcard",fn:y(n,e)})}),[n,t,e]),(e=>{const[t,n]=(0,a.useState)(!0),[r,o]=(0,a.useState)(-1),s=(0,i.useNotify)();(0,a.useEffect)((()=>{t&&e&&(n((e=>!e)),d({view:e}).then((t=>{(async()=>{const e=await(0,i.soapFetch)("GetShareInfo",{_jsns:"urn:zimbraAccount",includeSelf:0});return"Fault"in e?Promise.reject(e.Fault):Promise.resolve({isFulfilled:!(0,c.isEmpty)(e),folders:e?.share??[]})})().then((n=>{if(n?.folders){const a=(0,c.filter)(n.folders,["folderId",1]);if(a.length){const n=(0,c.reject)(t.folder[0].link,["rid",1]);(async(e,t)=>Promise.all((0,c.map)(e,(async({ownerEmail:e})=>{const n=await d({view:t},e);return n?.folder?.length?{...n.folder[0],oname:n.folder[0].name,owner:e,name:e}:n}))))(a,e).then((a=>{if(a.Fault){const a=[{...t.folder[0],link:n}];m.N.postMessage({op:"refresh",currentView:e,folder:a??[]})}else{const r=[{...t.folder[0],link:n},...a];m.N.postMessage({op:"refresh",currentView:e,folder:r??[]})}}))}else m.N.postMessage({op:"refresh",currentView:e,folder:t?.folder??[]})}}))})).catch((()=>{n(!0)})))}),[t,e]),(0,a.useEffect)((()=>{!t&&s.length>0&&(0,c.forEach)((0,c.sortBy)(s,"seq"),(e=>{!(0,c.isEmpty)(s)&&(e.seq>r||r>1&&1===e.seq)&&(!(0,c.isEmpty)(s)&&(e?.created?.folder||e?.modified?.folder||e.deleted||e?.created?.link||e?.modified?.link)&&m.N.postMessage({op:"notify",notify:e,state:u.v1.getState().folders}),o(e.seq))}))}),[t,s,r,e])})(l.P6.contact),r().createElement(v.tv,null,r().createElement(C,null))}},2861:(e,t,n)=>{n.d(t,{P6:()=>a});const a={search_folder:"search folder",tag:"tag",conversation:"conversation",message:"message",contact:"contact",document:"document",appointment:"appointment",virtual_conversation:"virtual conversation",remote_folder:"remote folder",wiki:"wiki",task:"task",chat:"chat"}},2816:(e,t,n)=>{n.d(t,{JC:()=>y,PJ:()=>d,Pe:()=>b,_u:()=>h,bc:()=>u,bp:()=>l,iQ:()=>p,jX:()=>c,mY:()=>m,q7:()=>g,vF:()=>f,wL:()=>i});var a=n(4577),r=(n(2509),n(5302));const o=/^([^:]+(?=:))*:?(\d+)$/,i=e=>{const t={zid:null,id:null};if(!e||!e.match(o))return t;const n=o.exec(e);return n?([,t.zid=null,t.id=null]=n,t):t},s=(e,t)=>!!e&&i(e).id===t,l=e=>e===a.FOLDERS.USER_ROOT,c=e=>s(e,a.FOLDERS.USER_ROOT),d=e=>(e&&e.isLink&&null===i(e.id).zid)??!1;function u(e){return null!==i(e).zid}const m=e=>{const{id:t}=i(e);return!!t&&Object.values(a.FOLDERS).includes(e)},p=({folder:e,folderId:t})=>{if(!e&&!t)return!1;const n=r.v1.getState()?.folders?.[t??""]?.absFolderPath,a=e?e.absFolderPath:n;return!!a&&a.toLowerCase().startsWith("/trash")},f=e=>s(e,a.FOLDERS.TRASH),h=e=>!e.perm||e.perm.includes("w"),b=e=>!e.perm||e.perm.includes("c"),g=e=>!e.perm||e.perm.includes("d"),y=e=>!e.perm||e.perm.includes("a")},2014:(e,t,n)=>{n.d(t,{Fi:()=>l,L2:()=>s,a4:()=>i,e0:()=>d,sW:()=>u}),n(7559);var a=n(4577),r=n(2509),o=n(9003);n(2651);const i=e=>(0,o.v)((t=>t.folders?.[e])),s=e=>o.v.getState()?.folders?.[e],l=()=>(0,o.v)((e=>e.folders));function c(e){const t=e?.parent&&s(e.parent);return"oname"in e&&e?.oname===a.ROOT_NAME?e.id:t?c(t):e.id}const d=e=>(0,o.v)((t=>{const n=t.folders?.[e];if(n){const e=c(n);return t.folders?.[e]}})),u=()=>(0,o.v)((e=>(0,r.filter)(e.folders,(e=>e.id?.split(":")?.includes(a.FOLDERS.USER_ROOT)))))},5302:(e,t,n)=>{n.d(t,{Fi:()=>r.Fi,L2:()=>r.L2,a4:()=>r.a4,e0:()=>r.e0,sW:()=>r.sW,v1:()=>a.v});var a=n(9003),r=n(2014)},9003:(e,t,n)=>{n.d(t,{v:()=>i});var a=n(6535),r=n(1621),o=n(7218);const i=(0,r.vt)()((e=>({folders:{},linksIdMap:{},searches:{},updateFolder:(t,n)=>{e((0,a.Ay)((e=>{e?.folders?.[t]&&(e.folders[t]={...e.folders[t],...n})})))}})));o.N.onmessage=({data:e})=>{i.setState(e)}},2651:(e,t,n)=>{n.d(t,{HL:()=>a}),n(3619),n(4577),n(2509);const a=e=>!!e?.absFolderPath?.includes("/Trash/")},7218:(e,t,n)=>{n.d(t,{N:()=>a}),n(8608),n(9727),n(6098);const a=new Worker(new URL(n.p+n.u(392),n.b))},7626:(e,t,n)=>{n.d(t,{P:()=>a});const a={label:"label",email:"email"}},9812:(e,t,n)=>{n.d(t,{BJ:()=>s,Iy:()=>a,K0:()=>r,M3:()=>p,MA:()=>h,T$:()=>f,Zb:()=>l,bw:()=>m,dg:()=>g,fT:()=>S,hq:()=>d,kM:()=>o,l7:()=>E,mp:()=>v,n:()=>c,qn:()=>y,rs:()=>i,xw:()=>b,zE:()=>u});const a="contacts",r="carbonio-contacts-ui",o={editDL:"dl-edit-action",expandDL:"dl-expand-action",sendEmail:"send-email-action",sendEmailCG:"cg-send-email-action",deleteCG:"cg-delete-action",editCG:"cg-edit-action",copyToClipboard:"copy-to-clipboard-action",addSharedAddressBooks:"shares-add-action",trashAddressBook:"trash-address-book-action",deleteAddressBook:"delete-address-book-action",createAddressBook:"create-address-book-action",moveAddressBook:"move-address-book-action",editAddressBook:"edit-address-book-action",emptyAddressBook:"empty-address-book-action",emptyTrash:"empty-trash-action",removeAddressBookLink:"remove-address-book-link-action",exportAddressBook:"export-address-book-action",importContacts:"import-contacts-action",showShareInfo:"show-share-info-action",moveContacts:"move-contacts-action",restoreContacts:"restore-contacts-action",trashContacts:"trash-contacts-action",exportContact:"export-contact-action"},i="new-contact-group-board",s="edit-contact-group-board",l="edit-dl-board",c=256,d=256,u="groups",m={mainRoute:"/:route",contactGroups:"/:id?",distributionLists:"/:filter?/:id?"},p={route:{contactGroups:"contact-groups",distributionLists:"distribution-lists"},filter:{member:"member",manager:"manager"}},f="60%",h="40%",b="4rem",g=100,y=100,v={details:"dl-details-tab",members:"dl-members-tab",managers:"dl-managers-tab"},E={EXPANDED_ADDRESSBOOKS:"open_address_books"},S={defaultSnackbar:3e3,trashAddressBook:5e3}},4230:(e,t,n)=>{n.d(t,{b:()=>l});var a=n(7559),r=n(4702),o=n(8153),i=n(4362),s=n(4457);const l=(e,{limit:t,skip:n}={})=>{const[l]=(0,o.useTranslation)(),c=(0,r.useSnackbar)(),{distributionLists:d,upsertDistributionList:u}=(0,s._)(),m=(0,a.useRef)(0),[p,f]=(0,a.useState)(),[h,b]=(0,a.useState)(!1),g=(0,a.useCallback)((t=>t.find((t=>t.email===e))?.members),[e]),y=(0,a.useMemo)((()=>d&&g(d)),[d,g]),v=(0,a.useMemo)((()=>y??p),[y,p]),E=(0,a.useCallback)(((t,n)=>{m.current=n+t.members.length,f((e=>({members:0===n?t.members:[...e?.members??[],...t.members],more:t.more,total:t.total})));const a=g(s._.getState().distributionLists??[]);u({email:e,members:{members:0===n?t.members:[...a?.members??[],...t.members],more:t.more,total:t.total},canRequireMembers:!0})}),[e,g,u]),S=(0,a.useCallback)(((t,n)=>e?(b(!0),i.u.getDistributionListMembers(e,{offset:t,limit:n}).then((e=>(E(e,t),e))).catch((()=>{c({key:(new Date).toDateString(),replace:!0,type:"error",label:l("label.error_try_again","Something went wrong, please try again"),autoHideTimeout:3e3,hideButton:!0})})).finally((()=>{b(!1)}))):Promise.reject(new Error(`Cannot load members of distribution list. Invalid email: "${e}"`))),[c,e,l,E]),w=(0,a.useMemo)((()=>{const e=void 0===y||void 0!==t&&t>0&&y.members.length<t&&y.more;return!n&&e}),[t,n,y]);(0,a.useEffect)((()=>{w&&S(0,t)}),[S,t,w]);const C=(0,a.useCallback)(((e=t)=>{if(!1===v?.more)throw new Error("No more members available");return S(m.current,e)}),[v?.more,S,t]);return{members:v?.members,more:v?.more,total:v?.total,findMore:C,loading:h}}},3e3:(e,t,n)=>{n.d(t,{i:()=>d});var a=n(7559),r=n(4702),o=n(2509),i=n(8153),s=n(4362),l=n(4457);const c=["id","displayName","owners","description","isMember","isOwner"],d=({id:e,email:t},{skip:n}={})=>{const[d]=(0,i.useTranslation)(),u=(0,r.useSnackbar)(),{distributionLists:m,upsertDistributionList:p}=(0,l._)(),[f,h]=(0,a.useState)(!1),b=(0,a.useMemo)((()=>m?.find((n=>(n.id===e||n.email===t)&&void 0!==n.id))),[m,t,e]),[g,y]=(0,a.useState)(),v=(0,a.useMemo)((()=>void 0===b||(0,o.some)(c,(e=>void 0===b[e]))),[b]);return(0,a.useEffect)((()=>{v&&!n&&(h(!0),s.u.getDistributionList({id:e,email:t}).then((e=>{e&&(y(e),p(e))})).catch((()=>{u({key:(new Date).toDateString(),replace:!0,type:"error",label:d("label.error_try_again","Something went wrong, please try again"),autoHideTimeout:3e3,hideButton:!0})})).finally((()=>{h(!1)})))}),[u,t,e,v,n,d,p]),{distributionList:b??g,loading:f}}},6815:(e,t,n)=>{n.d(t,{c:()=>i});var a=n(7559),r=n(4577),o=n(9812);const i=()=>{const e=(0,r.usePushHistoryCallback)(),t=(0,r.useReplaceHistoryCallback)();return{navigateTo:(0,a.useCallback)(((n,a)=>{a?.replace?t({route:o.zE,path:n}):e({route:o.zE,path:n})}),[e,t])}}},7848:(e,t,n)=>{n.d(t,{G:()=>o,j:()=>r});var a=n(7760);const r=a.useDispatch,o=a.useSelector},7770:(e,t,n)=>{n.d(t,{p:()=>A});var a=n(7559),r=n.n(a),o=n(4702),i=n(4577),s=n(2509),l=n(8153),c=n(4710),d=n.n(c),u=(n(3619),n(9812)),m=n(7626),p=n(3e3),f=n(4230);function h(){return h=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},h.apply(this,arguments)}const b=d()(o.Chip).withConfig({displayName:"contact-input-custom-chip-component__StyledChip",componentId:"sc-troit6-0"})(["cursor:default;&:hover{background:",";}"],(({theme:e})=>e.palette.gray3.regular)),g=e=>(e.isGroup&&!!e.email)??!1,y=e=>(0,s.debounce)(e,500,{trailing:!1,leading:!0}),v=({id:e,label:t,email:n,contactInputOnChange:i,contactInputValue:c,actions:d,...m})=>{const[p]=(0,l.useTranslation)(),[g,v]=(0,a.useState)(!1),{members:E,more:S,total:w,findMore:C}=(0,f.b)(n,{limit:u.qn,skip:!g}),_=p("label.show_more","Show more"),k=p("label.select_all_addresses",{count:w,defaultValue_one:"Select address",defaultValue_other:"Select all {{count}} addresses"}),N=(0,a.useMemo)((()=>(0,s.map)(E,(e=>({id:e,label:e,keepOpen:!0,icon:"PersonOutline",itemIconSize:"large"})))),[E]),F=(0,a.useCallback)((t=>{const n=(0,s.map)(t,(e=>({label:e,value:e,id:e,email:e})));i?.([...(0,s.filter)(c,(t=>t.id!==e)),...n])}),[i,c,e]),R=(0,a.useCallback)((()=>{void 0!==E&&E.length>0&&(S?C(0).then((e=>{e&&F([...E,...e.members])})):F(E))}),[S,C,F,E]),O=(0,a.useMemo)((()=>({id:"dl-select-all",label:k,tooltipLabel:k,keepOpen:!1,customComponent:r().createElement(o.Container,{width:"fill",mainAlignment:"center",orientation:"horizontal"},r().createElement(o.Button,{size:"small",shape:"regular",width:"fill",label:k,onClick:y(R)}))})),[R,k]),A=(0,a.useMemo)((()=>y((()=>C()))),[C]),M=(0,a.useMemo)((()=>({id:"dl-get-more",label:_,tooltipLabel:_,keepOpen:!0,customComponent:r().createElement(o.Container,{width:"fill",mainAlignment:"center",orientation:"horizontal"},r().createElement(o.Button,{size:"small",type:"outlined",shape:"regular",width:"fill",label:_,onClick:A}))})),[A,_]),T=(0,a.useMemo)((()=>S?[O,...N,M]:[O,...N]),[N,S,M,O]),I=(0,a.useCallback)((()=>{v(!0)}),[]),x=(0,a.useCallback)((()=>{v(!1)}),[]),j=(0,a.useMemo)((()=>{const e=[...d??[]];return e.push({id:u.kM.expandDL,label:p("expand_distribution_list","Expand address list"),type:"button",icon:g?"ChevronUpOutline":"ChevronDownOutline",onClick:g?x:I}),e}),[x,I,g,d,p]),D=(0,a.useCallback)((e=>{e.stopPropagation()}),[]);return r().createElement(o.Dropdown,{items:T,placement:"bottom",forceOpen:g,disableAutoFocus:!0,width:"18.75rem",onClose:x},r().createElement("div",null,r().createElement(b,h({},m,{id:e,label:t,background:"gray3",color:"text","data-testid":"distribution-list-chip",hasAvatar:!0,shape:"regular",closable:!0,onClick:D,actions:j}))))},E=({email:e,isGroup:t=!1,label:n,chipDisplayName:i=m.P.label,contactActions:l,actions:c,...d})=>{const u=(0,a.useMemo)((()=>({email:e,isGroup:t})),[e,t]),{distributionList:f}=(0,p.i)({email:e},{skip:!g(u)}),b=(0,a.useMemo)((()=>n&&i===m.P.label?n:e&&i===m.P.email?e:n||e||""),[i,e,n]),y=(0,a.useMemo)((()=>(0,s.reduce)(l,((e,t)=>((0,s.some)(e,(e=>t.id===e.id))||t.isVisible(f??u)&&e.push({...t,onClick:()=>{t.onClick(f??u)}}),e)),[...c??[]])),[c,u,l,f]);return g(u)?r().createElement(v,h({},d,{label:b,email:u.email,isGroup:u.isGroup,actions:y})):r().createElement(o.Chip,h({},d,{label:b,"data-testid":"default-chip",actions:y}))};var S=n(9967);function w(){return w=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},w.apply(this,arguments)}const C=/[^\s@]+@[^\s@]+\.[^\s@]+/;function _(e){return(e?.isGroup&&null!=e?.display&&!e?.email)??!1}const k=e=>{if(e.firstName??e.middleName??e.lastName)return(0,s.trim)(`${e.firstName??""} ${e.middleName??""} ${e.lastName??""}`);const t="string"==typeof e.email?e.email:void 0,n="string"==typeof e.address?e.address:void 0;return e.fullName??t??e.name??n??e.display??""},N=({contact:e})=>{const t=k(e);return r().createElement(o.Container,{orientation:"horizontal",mainAlignment:"flex-start",crossAlignment:"center",minWidth:"16rem",minHeight:"2rem"},r().createElement(o.Avatar,{label:t}),r().createElement(o.Container,{orientation:"vertical",crossAlignment:"flex-start",padding:{left:"small"}},_(e)?r().createElement(o.Text,{size:"large"},t):r().createElement(r().Fragment,null,r().createElement(o.Row,{takeAvailableSpace:!0,mainAlignment:"flex-start"},r().createElement(o.Text,{size:"large"},t)),r().createElement(o.Row,{takeAvailableSpace:!0,mainAlignment:"flex-start"},r().createElement(o.Text,{color:"secondary"},e.email)))))},F=d().div.withConfig({displayName:"contact-input__SkeletonTile",componentId:"sc-jqkxp-0"})(["width:",";max-width:",";min-width:",";height:",";max-height:",";min-height:",";border-radius:",";background:",";"],(({width:e})=>e??"1rem"),(({width:e})=>e??"1rem"),(({width:e})=>e??"1rem"),(({height:e})=>e??"1rem"),(({height:e})=>e??"1rem"),(({height:e})=>e??"1rem"),(({radius:e})=>e??"0.125rem"),(({theme:e})=>e.palette.gray2.regular)),R=()=>r().createElement(o.Container,{orientation:"horizontal",mainAlignment:"flex-start",crossAlignment:"center",minWidth:"16rem",minHeight:"2rem"},r().createElement(F,{radius:"50%",width:"2rem",height:"2rem"}),r().createElement(o.Container,{orientation:"vertical",crossAlignment:"flex-start",padding:{left:"small"}},r().createElement(F,{radius:"0.25rem",width:9.375*Math.random()+4+"rem",height:"0.875rem",style:{marginBottom:"0.25rem"}}),r().createElement(F,{radius:"0.25rem",width:9.375*Math.random()+4+"rem",height:"0.75rem"}))),O=({onChange:e,defaultValue:t,placeholder:n,background:c="gray5",dragAndDropEnabled:d=!1,chipDisplayName:u=m.P.label,orderedAccountIds:p=[],contactActions:f,inputRef:h=null,...b})=>{const[g,y]=(0,a.useState)([]),[v,S]=(0,a.useState)([]),[F,O]=(0,a.useState)(""),[A]=(0,l.useTranslation)(),M=(0,o.useCombinedRefs)(h),T=(0,a.useMemo)((()=>({id:"",email:"",dragStartRef:null})),[]),I=(0,a.useRef)(T),x=(0,a.useRef)(!1),j=(0,a.useCallback)((e=>t=>{t.dataTransfer.setData("contact",JSON.stringify(e)),t.dataTransfer.dropEffect="move",I.current={id:e.id,email:e.email??e.address,dragStartRef:M.current}}),[M]);(0,a.useEffect)((()=>{y((0,s.map)((0,s.filter)(t,(e=>e.id!==F))??[],(e=>({...e,label:k(e),draggable:d,onDragStart:d?j(e):s.noop}))))}),[j,t,d,F]);const D=(0,a.useCallback)((e=>({...e,draggable:!0,onDragStart:j(e)})),[j]),L=(0,a.useCallback)((e=>C.test(e)),[]),B=(0,a.useCallback)(((e,t)=>{O(t),M?.current&&(M.current.value=e,M.current.style.width=M.current.value?`${M.current.scrollWidth}px`:"")}),[M]),z=(0,a.useCallback)((({key:t,textContent:n})=>{if("Enter"===t){if(M?.current&&(M.current.innerText=M.current.innerText?.replaceAll("\n","")),v.length>0&&!(0,s.find)(v,{id:"loading"}))return e?.([...g,{...v[0].value}]),M.current&&(M.current.innerText=""),void S([]);const t=M.current?.innerText.replaceAll("\n",""),n=Date.now().toString(),a={id:n,label:t,error:!L(t),actions:[{id:"action1",label:L(t)?A("label.edit_email","Edit E-mail"):A("label.edit_invalid_email","E-mail is invalid, click to edit it"),icon:"EditOutline",type:"button",onClick:()=>B(t,n)}]};return L(t)||(a.avatarIcon="AlertCircleOutline"),""!==t&&e?.([...g,{...a}]),void(M?.current&&(M.current.innerText=""))}n&&""!==n?(S([{id:"loading",label:"loading",customComponent:r().createElement(R,null)}]),(0,i.soapFetch)("FullAutocomplete",{...p?.length>0&&{orderedAccountIds:p.toString()},AutoCompleteRequest:{name:n,includeGal:1},_jsns:"urn:zimbraMail"}).then((e=>(0,s.map)(e.match,(e=>({...e,email:_(e)?void 0:C.exec(e.email??"")?.[0]?.slice(1,-1)}))))).then((e=>{const t=(0,s.map)(e,(e=>({email:e.email,firstName:e.first,lastName:e.last,company:e.company,fullName:e.full,display:e.display,isGroup:e.isGroup,id:e.id,l:e.l,exp:e.exp,label:k(e)})));S((0,s.map)(t,(e=>({label:e?.label??k(e),value:{id:`${e.id} ${e.email}`,email:e?.email,firstName:e?.firstName,lastName:e?.lastName,company:e?.company,fullName:e?.fullName,display:e?.display,isGroup:e?.isGroup,groupId:e?.id,label:e?.label??k(e)},customComponent:r().createElement(N,{contact:e}),id:`${e.id} ${e.email}`}))))})).catch((()=>{S([])}))):S([])}),[g,B,M,L,e,v,p,A]);(0,a.useEffect)((()=>{const t=(0,s.filter)(g,(e=>_(e)));t.length>0&&(0,s.forEach)(t,(t=>{(0,i.soapFetch)("GetContacts",{_jsns:"urn:zimbraMail",cn:{id:t.groupId},derefGroupMember:!0}).then((t=>{const n=Date.now().toString(),a=t?.cn?.[0].m,r=(0,s.map)(a,(e=>{const t=e.cn?.[0]._attrs.email??e.value;return{email:t,id:n,label:t,error:!L(t),draggable:!0,onDragStart:j({id:n,email:t,label:t})}})),o=[...(0,s.reject)(g,(e=>_(e))),...r];e?.(o),y(o)}))}))}),[j,g,L,e]);const P=(0,a.useMemo)((()=>(0,s.uniqBy)(g,"email")),[g]),q=(0,a.useCallback)((e=>{if("string"==typeof e){const t=Date.now().toString(),n={email:e,id:t,label:e,error:!L(e),actions:[{id:"action1",label:L(e)?A("label.edit_email","Edit E-mail"):A("label.edit_invalid_email","E-mail is invalid, click to edit it"),icon:"EditOutline",type:"button",onClick:()=>B(e,t)}]};return L(e)||(n.avatarIcon="AlertCircleOutline"),n}return{...e,error:!L(e.email),actions:[{id:"action1",label:L(e.email)?A("label.edit_email","Edit E-mail"):A("label.edit_invalid_email","E-mail is invalid, click to edit it"),icon:"EditOutline",type:"button",onClick:()=>B(e.email,e.id)}]}}),[B,L,A]),$=(0,a.useCallback)((t=>r().createElement(E,w({},t,{contactActions:f,chipDisplayName:u,contactInputOnChange:e,contactInputValue:P}))),[u,f,P,e]),G=(0,a.useCallback)((e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"}),[]),H=(0,a.useCallback)((()=>{I.current=T}),[T]),J=(0,a.useCallback)((t=>{if(t.preventDefault(),"none"===t?.dataTransfer?.dropEffect||x.current)return H(),void(x.current=!1);y((e=>(0,s.filter)(e,(e=>e.id!==I.current.id))));const n=(0,s.filter)(g,(e=>e.email?e.email!==I.current.email:e.id!==I.current.id));e?.(n),H(),x.current=!1}),[g,e,H]),U=(0,a.useCallback)((t=>{if(t.preventDefault(),I.current.dragStartRef===M.current)return x.current=!0,void H();const n=t.dataTransfer.getData("contact");if(n){const t=JSON.parse(n),a=D(t);y((e=>(0,s.find)(e,{id:a.id})?e:{...e,newChip:a})),e?.([...g,{...a}]),H(),x.current=!1}}),[D,g,M,e,H]);return r().createElement(o.Container,{width:"100%",onDrop:U,height:"100%"},r().createElement(o.ChipInput,w({"data-testid":"contact-input",disableOptions:!0,placeholder:n,confirmChipOnBlur:!0,inputRef:M,onInputType:z,onChange:e,options:v,value:P,background:c,onAdd:q,requireUniqueChips:!0,createChipOnPaste:!0,pasteSeparators:[","," ",";","\n"],separators:[{code:"NumpadEnter",ctrlKey:!1},{key:",",ctrlKey:!1}],ChipComponent:$,onDragEnter:d?G:s.noop,onDragOver:d?G:s.noop,onDragEnd:d?J:s.noop},b)))},A=e=>r().createElement(S.tv,null,r().createElement(O,e))},9602:(e,t,n)=>{n.d(t,{H:()=>i});var a=n(2940),r=n(4577),o=n(2509);const i=(0,a.createAsyncThunk)("contacts/contactAction",(async({contactsIDs:e,destinationID:t,op:n,tagName:a})=>{const i=e.join(",");return(0,r.soapFetch)("ContactAction",{_jsns:"urn:zimbraMail",action:(0,o.omitBy)({id:i,op:n,l:t,tn:a},o.isNil)})}))},586:(e,t,n)=>{n.d(t,{v:()=>i});var a=n(2940),r=n(4577),o=n(8122);const i=(0,a.createAsyncThunk)("contacts/createContact",(async e=>{const t={...e,fileAsStr:e.firstName},{cn:n}=await(0,r.soapFetch)("CreateContact",{_jsns:"urn:zimbraMail",cn:{m:[],l:t.parent,a:(0,o.U8)(t)}});return n}))},5428:(e,t,n)=>{n.d(t,{P:()=>i});var a=n(2940),r=n(4577),o=n(8122);const i=(0,a.createAsyncThunk)("contacts/modifyContact",(async({updatedContact:e})=>{const{cn:t}=await(0,r.soapFetch)("ModifyContact",{_jsns:"urn:zimbraMail",force:"1",replace:"0",cn:{m:[],id:e.id,a:(0,o.U8)(e)}});return t}))},5157:(e,t,n)=>{n.d(t,{w:()=>o});var a=n(2940),r=n(4577);const o=(0,a.createAsyncThunk)("contacts/searchContacts",(async e=>{const{cn:t}=await(0,r.soapFetch)("Search",{_jsns:"urn:zimbraMail",limit:"500",offset:0,sortBy:"nameAsc",types:"contact",query:{_content:`inid:"${e}"`}});return t}))},9967:(e,t,n)=>{n.d(t,{tv:()=>u});var a=n(7559),r=n.n(a),o=n(2940),i=n(7760),s=n(9812),l=n(1906);const c=(0,o.combineReducers)({contacts:l.bj}),d=((0,o.combineReducers)({}),(0,o.configureStore)({devTools:{name:s.K0},reducer:c})),u=({children:e})=>r().createElement(i.Provider,{store:d},e)},1906:(e,t,n)=>{n.d(t,{bj:()=>T,vY:()=>O,EM:()=>M,q5:()=>A});var a=n(2940),r=n(9602),o=n(586),i=n(4577),s=n(2509);const l=(0,a.createAsyncThunk)("contacts/folderAction",(async({folder:e,op:t,name:n,l:a,recursive:r,color:o,zid:l})=>(0,i.soapFetch)("FolderAction",{action:(0,s.omitBy)({id:e.id,op:t,l:a,recursive:r,name:n,color:o,zid:l},s.isNil),_jsns:"urn:zimbraMail"})));var c=n(5428),d=n(5157),u=n(7134);function m(e,t){const{op:n,contactsIDs:a,destinationID:r}=t.meta.arg;if(e.contacts){e.status.pendingActions=!0;const o=(0,s.map)((0,u.f9)(e,a),(e=>({...e,parent:r})));switch(t.meta.arg.prevState=(0,s.cloneDeep)(e.contacts),n){case"move":a&&(0,u.FI)(e,a),o&&(0,u.Ru)(e,o);break;case"delete":a&&(0,u.FI)(e,a)}}}function p(e){e.contacts&&(e.status.pendingActions=!1),e.folders&&(e.status="idle")}function f(e,{meta:t}){e.contacts&&(e.contacts=t.arg.prevState,e.status.pendingActions=!1),e.folders&&(e.folders=t.arg.prevState)}function h(e,{meta:t}){t&&t.arg&&(0,u.Ru)(e,[t.arg]),e.status.pendingActions=!0}function b(e,{payload:t}){e.contacts&&(t&&(0,u.vz)(e),e.status.pendingActions=!1)}function g(e){(0,u.FI)(e),e.status.pendingActions=!1}var y=n(2816);function v(e,{meta:t}){const{folder:n,l:a,op:r,name:o,color:l,zid:c}=t.arg;if(e.folders){t.arg.prevFolderState=(0,s.cloneDeep)(e.folders);const d={...n,parent:a,label:o||n.label,color:l??n.color};switch(r){case"move":case"rename":case"update":(0,u.pO)(e,[d]);break;case"delete":(0,u.Nf)(e,[n.id]);break;case"!grant":{const t=(0,s.filter)(n.sharedWith.grant,(e=>e.zid!==c)),a={...d,sharedWith:t};(0,u.pO)(e,[a]),e.status="updating";break}case"empty":e.folders=(0,s.reject)(e.folders,(t=>(0,s.split)(t.path,"/")[0]===(0,s.find)(e.folders,["id",i.FOLDERS.TRASH]).label&&!(0,y.vF)(t.id)));break;default:console.warn("Operation not handled",r)}}}function E(e,t){e.folders&&(e.folders=t.meta.arg.prevFolderState,e.status="failed")}function S(e,{meta:t}){const{updatedContact:n}=t.arg;n&&(0,u.pN)(e,[n]),e.status.pendingActions=!0}function w(e){e.status.pendingActions=!1}function C(e,{meta:t}){const{editContact:n}=t.arg;n&&(0,u.pN)(e,[n]),e.status.pendingActions=!1}var _=n(1295);function k(e){e.status.pendingActions=!0}function N(e){e.status.pendingActions=!1}function F(e,{meta:t,payload:n}){const a=(0,_.O)(n);e.contacts&&(n?((0,u.FI)(e,(0,s.map)(a,(e=>e.id))),a&&(0,u.Ru)(e,a,t.arg)):e.contacts[t.arg]=[],e.status.pendingActions=!1,e.status[t.arg]=!0)}const R=(0,a.createSlice)({name:"contacts",initialState:{status:{pendingActions:!1},contacts:{}},reducers:{handleModifiedContactsSync:function(e,{payload:t}){(0,s.forEach)(t,(t=>{t.id&&(e.contacts=(0,s.reduce)(e.contacts,((n,a,r)=>{const o=(0,s.find)(a,["id",t.id]);if(o){const i={...o,...t};return o.parent!==i.parent?{...n,[r]:(0,s.reject)(a,["id",i.id]),[i.parent]:[...e.contacts?.[i.parent]??[],i]}:{...n,[i.parent]:(0,s.map)(e.contacts[i.parent],(e=>e.id===i.id?i:e))}}return{...n,[r]:(0,s.uniqBy)([...n[r]??[],...a],"id")}}),{}))}))},handleCreatedContactsSync:function(e,{payload:t}){(0,s.forEach)(t,(t=>{t.id&&t.parent&&(e.contacts[t.parent]=(0,s.orderBy)([...(0,s.map)((0,s.reject)(e.contacts[t.parent],(e=>e.id===t.id||!e.id)),(e=>({...e,fileAsStr:e.fileAsStr.toLowerCase()}))),t],"fileAsStr"))}))},handleDeletedContactsSync:function(e,{payload:t}){(0,u.FI)(e,t)}},extraReducers:e=>{e.addCase(d.w.pending,k),e.addCase(d.w.fulfilled,F),e.addCase(d.w.rejected,N),e.addCase(o.v.pending,h),e.addCase(o.v.fulfilled,b),e.addCase(o.v.rejected,g),e.addCase(c.P.pending,S),e.addCase(c.P.fulfilled,w),e.addCase(c.P.rejected,C),e.addCase(r.H.pending,m),e.addCase(r.H.fulfilled,p),e.addCase(r.H.rejected,f),e.addCase(l.pending,v),e.addCase(l.rejected,E)}}),{handleCreatedContactsSync:O,handleModifiedContactsSync:A,handleDeletedContactsSync:M}=R.actions,T=R.reducer},7134:(e,t,n)=>{n.d(t,{FI:()=>u,Nf:()=>i,Ru:()=>m,f9:()=>c,k0:()=>p,pN:()=>l,pO:()=>s,vz:()=>d}),n(3619);var a=n(4577),r=n(2509);const o=/^(.+:)*(\d+)$/;function i(e,t){e.folders=(0,r.reduce)(e.folders,((e,n)=>(0,r.some)(t,(e=>e===n.id))?[...e]:[...e,n]),[])}const s=(e,t)=>{(0,r.forEach)(t,(t=>{const n=(0,r.find)(e.folders,["id",t.id]);n?(0,r.merge)(n,t):e.folders=[...e.folders,t]}))};function l(e,t){e.contacts=(0,r.reduce)(e.contacts,((e,n,a)=>({...e,[a]:(0,r.reduce)(n,((e,n)=>(0,r.reduce)(t,((e,t)=>t.id===n.id?[...e,t]:[...e,n]),e)),[])})),{})}function c(e,t){return(0,r.reduce)(t,((t,n)=>(0,r.reduce)(e.contacts,((e,t)=>{const a=(0,r.find)(t,(e=>e.id===n));return a?[...e,(0,r.cloneDeep)(a)]:e}),t)),[])}function d(e){(0,r.map)(e.contacts,(e=>(0,r.reject)(e,(e=>!e.id))))}function u(e,t){e.contacts=(0,r.reduce)(e.contacts,((e,n,a)=>t?{...e,[a]:(0,r.filter)(n,(e=>!(0,r.some)(t,(t=>t===e.id))))}:{...e,[a]:(0,r.filter)(n,(e=>!!e.id&&e))}),{})}function m(e,t,n){(0,r.reduce)(t,((e,t)=>(e[n??t.parent]||(e[n??t.parent]=[]),e[n??t.parent].push(t),e)),e.contacts)}const p=(e,t,n)=>{const r=o.exec(t??"")?.[2];let i;switch(r){case a.FOLDERS.CONTACTS:i="contacts";break;case a.FOLDERS.AUTO_CONTACTS:i="auto_contacts";break;case a.FOLDERS.TRASH:i="trash";break;default:return n}return e(`folders.${i}`,n)}},1295:(e,t,n)=>{n.d(t,{O:()=>b,t:()=>g}),n(3619);var a=n(2509);let r=function(e){return e.MOBILE="mobile",e.WORK="work",e.HOME="home",e.OTHER="other",e}({}),o=function(e){return e.OTHER="other",e.WORK="work",e.HOME="home",e}({});const i=/^email(\d*)$/,s=/^(.*)Phone(\d*)$/,l=/^(.*)URL(\d*)$/,c=/^(.*)(City|Country|PostalCode|State|Street)(\d*)$/;function d(e){if(!s.test(e))return r.OTHER;switch(e.match(s)?.[1]){case"mobile":return r.MOBILE;case"work":return r.WORK;case"home":return r.HOME;default:return r.OTHER}}function u(e){if(!l.test(e))return o.OTHER;switch(e.match(l)?.[1]){case"work":return o.WORK;case"home":return o.HOME;default:return o.OTHER}}function m(e){return(0,a.reduce)(e._attrs,((e,t,n)=>{if(c.test(n)){const[r,o,i]=function(e){const[t,n,r,o]=(0,a.words)(e);return[t,(0,a.lowerFirst)("Postal"===n?"postalCode":n),(0,a.parseInt)("Code"===r?o:r)||1]}(n),s=`${r}Address${i>1?i:""}`;void 0===e[s]?e[s]={[o]:t,type:r}:e[s]={...e[s],[o]:t}}return e}),{})}function p(e){return(0,a.reduce)((0,a.pickBy)(e._attrs,((e,t)=>i.test(t))),((e,t,n)=>({...e,[n]:{mail:t}})),{})}function f(e){return(0,a.reduce)((0,a.pickBy)(e._attrs,((e,t)=>s.test(t))),((e,t,n)=>({...e,[n]:{number:t,type:d(n)}})),{})}function h(e){return(0,a.reduce)((0,a.pickBy)(e._attrs,((e,t)=>l.test(t))),((e,t,n)=>({...e,[n]:{url:t,type:u(n)}})),{})}function b(e){return(0,a.isEmpty)(e)?void 0:(0,a.reduce)(e||[],((e,t)=>("group"===t._attrs?.type||e.push({parent:t.l,id:t.id,fileAsStr:t.fileAsStr,tags:(0,a.isNil)(t.t)?[]:(0,a.filter)(t.t.split(","),(e=>""!==e)),address:m(t),company:t._attrs?.company??"",department:t._attrs?.department??"",displayName:t._attrs?.displayName??"",email:p(t),firstName:t._attrs?.firstName??t._attrs?.givenName??"",middleName:t._attrs?.middleName??"",lastName:t._attrs?.lastName??"",nickName:t._attrs?.nickname??"",image:t._attrs?.image?`/service/home/~/?auth=co&id=${t.id}&part=${t._attrs.image.part}&max_width=32&max_height=32`:"",jobTitle:t._attrs?.jobTitle??"",notes:t._attrs?.notes??"",phone:f(t),nameSuffix:t._attrs?.nameSuffix??"",namePrefix:t._attrs?.namePrefix??"",URL:h(t)}),e)),[])}function g(e){return(0,a.isEmpty)(e)?void 0:(0,a.reduce)(e,((e,t)=>("group"===t._attrs?.type||e.push((0,a.omitBy)({parent:t.l,id:t.id,tags:(0,a.isNil)(t.t)?[]:(0,a.filter)(t.t.split(","),(e=>""!==e)),fileAsStr:t.fileAsStr,address:t._attrs?m(t):void 0,company:t._attrs?.company,department:t._attrs?.department,displayName:t._attrs?.displayName,email:t._attrs?p(t):void 0,firstName:t._attrs?.firstName||t._attrs?.givenName,middleName:t._attrs?.middleName,lastName:t._attrs?.lastName,nickName:t._attrs?.nickname,image:t._attrs?.image?`/service/home/~/?auth=co&id=${t.id}&part=${t._attrs.image.part}&max_width=32&max_height=32`:void 0,jobTitle:t._attrs?.jobTitle,notes:t._attrs?.notes,phone:t._attrs?f(t):void 0,nameSuffix:t._attrs?.nameSuffix,namePrefix:t._attrs?.namePrefix,URL:t._attrs?h(t):void 0},a.isNil)),e)),[])}},8122:(e,t,n)=>{n.d(t,{U8:()=>o});var a=n(2509);const r=(e,t,n)=>{const r=e.match(/(\d+)$/);return`${t.type}${o=n,o.replace(/^\w/,(e=>e.toUpperCase()))}${r&&r.length>0?(0,a.parseInt)(r[0],10):""}`;var o};function o(e){const t=(0,a.pick)(e,["nameSuffix","namePrefix","firstName","lastName","middleName","image","jobTitle","department","company","notes"]);var n,o,i,s;return e.nickName&&(t.nickname=e.nickName),e.email&&(0,a.merge)(t,(n=e.email,(0,a.reduce)(n,((e,t,n)=>({...e,[n]:t.mail})),{}))),e.phone&&(0,a.merge)(t,(o=e.phone,(0,a.reduce)(o,((e,t,n)=>"type"===n?e:{...e,[n]:t.number}),{}))),e.address&&(0,a.merge)(t,(i=e.address,(0,a.reduce)(i,((e,t,n)=>({...e,...(0,a.reduce)(t,((e,a,o)=>"isRemove"!==o?"type"===o?e:{...e,[r(n,t,o)]:a}:{}),{})})),{}))),e.URL&&(0,a.merge)(t,(s=e.URL,(0,a.reduce)(s,((e,t,n)=>"type"===n?e:{...e,[n]:t.url}),{}))),(0,a.map)(t,((e,t)=>({n:t,_content:e})))}},4362:(e,t,n)=>{n.d(t,{u:()=>u});var a=n(4577),r=n(2861),o=n(2509);const i=({contactsIds:e,operation:t,folderId:n})=>{const r={action:{op:t,id:e.join(","),...void 0!==n&&{l:n}},_jsns:a.JSNS.mail};return(0,a.soapFetch)("ContactAction",r).then((e=>{if("Fault"in e)throw new Error(e.Fault.Reason.Text,{cause:e.Fault});return e}))},s=e=>{const t={action:{id:e.folderId,op:e.operation,...void 0!==e.parentId&&{l:e.parentId},...void 0!==e.recursive&&{recursive:e.recursive},...void 0!==e.name&&{name:e.name},...void 0!==e.color&&{color:e.color},...void 0!==e.granteeId&&{zid:e.granteeId},...void 0!==e.type&&{type:e.type}},_jsns:a.JSNS.mail};return(0,a.soapFetch)("FolderAction",t).then((e=>{if("Fault"in e)throw new Error(e.Fault.Reason.Text,{cause:e.Fault})}))};n(3619);var l=n(9812);const c=e=>(0,o.flatMap)(e,(e=>(0,o.filter)(e.owner,(e=>!!e?.id&&!!e.name))));n(8608),n(9727),n(6098);const d=e=>{let t="";for(let n=0;n<e.length;n+=1){const a=e.charCodeAt(n);if(a>127||34===a){let e=a.toString(10);for(;e.length<4;)e=`0${e}`;t+=`&#${e};`}else t+=e.charAt(n)}return t},u={createContactGroup:(e,t)=>fetch("/service/soap/CreateContactRequest",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({Body:{CreateContactRequest:{_jsns:"urn:zimbraMail",cn:{a:[{n:"fullName",_content:e},{n:"nickname",_content:e},{n:"type",_content:"group"},{n:"fileAs",_content:`8:${e}`}],m:t.map((e=>({type:"I",value:e})))}}},Header:{context:{_jsns:"urn:zimbra"}}})}).then((e=>{if(e.ok)return e.json();throw new Error("Something went wrong")})).then((({Body:e})=>{const t=e.CreateContactResponse.cn[0];return{id:t.id,title:t._attrs.fullName??"",members:t.m?.map((e=>e.value))??[]}})),distributionListAction:({email:e,displayName:t,description:n,membersToRemove:r,membersToAdd:o})=>{const i=[];if(void 0!==t||void 0!==n){const r=[];void 0!==t&&r.push({n:"displayName",_content:t}),void 0!==n&&r.push({n:"description",_content:n}),i.push({dl:{by:"name",_content:e},action:{op:"modify",a:r},_jsns:a.JSNS.account,requestId:"modify"})}return o&&o.length>0&&i.push({dl:{by:"name",_content:e},action:{op:"addMembers",dlm:o.map((e=>({_content:e})))},_jsns:a.JSNS.account,requestId:"addMembers"}),r&&r.length>0&&i.push({dl:{by:"name",_content:e},action:{op:"removeMembers",dlm:r.map((e=>({_content:e})))},_jsns:a.JSNS.account,requestId:"removeMembers"}),0===i.length?Promise.resolve():(0,a.soapFetch)("Batch",{DistributionListActionRequest:i,_jsns:a.JSNS.all}).then((e=>{if("Fault"in e)throw new Error(e.Fault?.map((e=>e.Reason.Text)).join(",\n"),{cause:e.Fault})}))},getDistributionList:({id:e,email:t})=>{if(void 0===e&&void 0===t)throw new Error("At least one between id and email is required");let n={by:"name",_content:""};return void 0!==t?n={by:"name",_content:t}:void 0!==e&&(n={by:"id",_content:e}),(0,a.soapFetch)("GetDistributionList",{_jsns:a.JSNS.account,dl:n,needOwners:!0}).then((e=>{if("Fault"in e)throw new Error(e.Fault.Reason.Text,{cause:e.Fault});return(e=>{const t=(0,o.first)(e.dl);if(void 0!==t)return{id:t.id,email:t.name,displayName:t._attrs?.displayName??"",isOwner:t.isOwner??!1,isMember:t.isMember??!1,owners:c(t.owners),description:t._attrs?.description??"",canRequireMembers:"TRUE"!==t._attrs?.zimbraHideInGal||!0===t.isOwner}})(e)}))},getDistributionListMembers:(e,t={})=>(0,a.soapFetch)("GetDistributionListMembers",{_jsns:a.JSNS.account,dl:{_content:e},limit:t.limit,offset:t.offset}).then((e=>{if("Fault"in e)throw new Error(e.Fault.Reason.Text,{cause:e.Fault});return(e=>({total:e.total??0,more:e.more??!1,members:(0,o.map)(e.dlm,(e=>e._content))}))(e)})),findContactGroups:(e=0)=>fetch("/service/soap/SearchRequest",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({Body:{SearchRequest:{_jsns:"urn:zimbraMail",limit:l.dg,offset:e,sortBy:"nameAsc",types:"contact",query:"#type:group in:contacts"}},Header:{context:{_jsns:"urn:zimbra"}}})}).then((e=>{if(e.ok)return e.json();throw new Error("Something went wrong")})).then((e=>({contactGroups:e.Body.SearchResponse.cn?e.Body.SearchResponse.cn.map((e=>({id:e.id,title:e._attrs.fullName??"",members:e.m?.filter((e=>"I"===e.type)).map((e=>e.value))??[]}))):[],hasMore:e.Body.SearchResponse.more}))),deleteContact:e=>i({operation:"delete",contactsIds:e}),moveContact:(e,t)=>i({operation:"move",contactsIds:e,folderId:t}),getAccountDistributionLists:e=>(0,a.soapFetch)("GetAccountDistributionLists",{_jsns:a.JSNS.account,ownerOf:e.ownerOf,memberOf:e.memberOf?"all":"none",attrs:"description,zimbraHideInGal"}).then((e=>{if("Fault"in e)throw new Error(e.Fault.Reason.Text,{cause:e.Fault});return(e=>(0,o.map)(e.dl,(e=>({id:e.id,email:e.name,displayName:e.d,isOwner:e.isOwner,isMember:e.isMember,description:e._attrs?.description,canRequireMembers:"TRUE"!==e._attrs?.zimbraHideInGal||!0===e.isOwner}))))(e)})),modifyContactGroup:({id:e,addedMembers:t,removedMembers:n,name:r})=>(({id:e,addedMembers:t,removedMembers:n,attributes:r})=>{const o={cn:{id:e,m:t||n?(t??[]).map((e=>({type:"I",op:"+",value:e}))).concat((n??[]).map((e=>({type:"I",op:"-",value:e})))):void 0,a:r},_jsns:a.JSNS.mail};return(0,a.soapFetch)("ModifyContact",o).then((e=>{if("Fault"in e)throw new Error(e.Fault.Reason.Text,{cause:e.Fault});return e}))})({id:e,addedMembers:t,removedMembers:n,attributes:r?[{n:"fullName",_content:r},{n:"fileAs",_content:`8:${r}`},{n:"nickname",_content:r}]:void 0}).then((e=>({id:e.cn[0].id,title:e.cn[0]._attrs.fullName??"",members:e.cn[0].m?.map((e=>e.value))??[]}))),getShareInfo:()=>(0,a.soapFetch)("GetShareInfo",{includeSelf:0,_jsns:a.JSNS.account}).then((e=>{if("Fault"in e)throw new Error(e.Fault.Reason.Text,{cause:e.Fault});return(e=>{if(void 0===e?.share||0===e.share.length)return;const t=(0,o.uniqWith)((0,o.filter)(e.share,["view","contact"]),o.isEqual);return(0,o.map)(t,(e=>({folderId:`${e.folderId}`,folderPath:e.folderPath,folderUuid:e.folderUuid,granteeType:e.granteeType,ownerEmail:e.ownerEmail,ownerId:e.ownerId,ownerName:e.ownerName??e.ownerEmail,rights:e.rights})))})(e)})),createMountpoints:e=>(0,a.soapFetch)("Batch",{CreateMountpointRequest:(0,o.map)(e,(e=>({link:{l:a.FOLDERS.USER_ROOT,name:e.mountpointName,rid:e.folderId,view:"contact",zid:e.ownerId},_jsns:"urn:zimbraMail"}))),_jsns:a.JSNS.all}).then((e=>{if("Fault"in e)throw new Error(e.Fault.Reason.Text,{cause:e.Fault})})),deleteFolder:e=>s({folderId:e,operation:"delete"}),trashFolder:e=>s({folderId:e,operation:"trash"}),moveFolder:(e,t)=>s({folderId:e,operation:"move",parentId:t}),emptyFolder:e=>s({folderId:e,operation:"empty",recursive:!0,type:"contacts"}),exportContacts:e=>{const t={_jsns:"urn:zimbraMail",ct:"csv",csvfmt:"thunderbird-csv",l:e};return(0,a.soapFetch)("ExportContacts",t).then((e=>{if("Fault"in e)throw new Error(e.Fault.Reason.Text,{cause:e.Fault});return(e=>e.content?.[0]._content)(e)}))},importContacts:async({folderId:e,aid:t})=>(0,a.soapFetch)("ImportContacts",{_jsns:a.JSNS.mail,ct:"csv",csvfmt:"thunderbird-csv",l:e,content:{aid:t}}).then((e=>{if("Fault"in e)throw new Error(e.Fault.Reason.Text,{cause:e.Fault});return(e=>({contactsCount:e.cn?.[0]?.n??0,contactsIds:e.cn?.[0]?.ids?e.cn?.[0].ids.split(","):[]}))(e)})),upload:e=>fetch("/service/upload?fmt=extended,raw",{method:"POST",headers:{"Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest","Content-Type":`${e.type||"application/octet-stream"};`,"Content-Disposition":`attachment; filename="${d(e.name)}"`},body:e}).then((e=>e.text())).then((e=>{const t=(e=>{const t=Function(`'use strict'; return ([${e}])`)();return 3!==t.length?[]:t[2].map((e=>({aid:e.aid,contentType:e.ct,fileName:e.filename,size:e.s})))})(e);if(0===t.length)throw new Error("No file uploaded");return t})),shareFolder:({addresses:e,folderId:t,role:n})=>{const r=e.map(((e,r)=>({action:{id:t,op:"grant",grant:{gt:"usr",d:e,perm:n}},_jsns:a.JSNS.mail})));return(0,a.soapFetch)("Batch",{FolderActionRequest:r,_jsns:a.JSNS.all}).then((e=>{if("Fault"in e){if((0,o.isArray)(e.Fault))throw new Error(e.Fault?.map((e=>e.Reason.Text)).join(",\n"),{cause:e.Fault});throw new Error(e.Fault?.Reason.Text,{cause:e.Fault})}}))},revokeFolderGrant:(e,t)=>s({folderId:e,operation:"!grant",granteeId:t}),sendShareNotification:async({accountName:e,folderId:t,addresses:n,message:a})=>Promise.all((0,o.map)(n,(n=>fetch("/service/soap/SendShareNotificationRequest",{method:"POST",headers:{"content-type":"application/soap+xml"},body:`<?xml version="1.0" encoding="utf-8"?>\n                <soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">\n                    <soap:Header>\n                        <context xmlns="urn:zimbra">\n                            <account by="name">${e}</account>\n                            <format type="js"/>\n                        </context>\n                    </soap:Header>\n                    <soap:Body>\n                    <SendShareNotificationRequest xmlns="urn:zimbraMail">\n                           <item id="${t}"/>\n                           <e a="${n}"/>\n                           ${a?`<notes>${a}</notes>`:""}\n                           \n                    </SendShareNotificationRequest>\t\t\t\t\n                    </soap:Body>\n                </soap:Envelope>\n            `}).then((e=>e.json()))))),updateFolder:({folderId:e,name:t,parentId:n,color:a})=>s({folderId:e,name:t,parentId:n,color:a,operation:"update"}),createFolder:e=>{const t={folder:{view:r.P6.contact,l:e.parentFolderId,name:e.name},_jsns:a.JSNS.mail};return(0,a.soapFetch)("CreateFolder",t).then((e=>{if("Fault"in e)throw new Error(e.Fault.Reason.Text,{cause:e.Fault})}))},getItem:e=>{const t=`/service/home/~/?${new URLSearchParams({id:e}).toString()}`;return new URL(t,"http://localhost/").toString(),fetch(t,{method:"get"}).then((e=>e.text()))},createContactFromVcard:(e,t)=>fetch("/service/soap/CreateContactRequest",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({Body:{CreateContactRequest:{_jsns:"urn:zimbraMail",cn:{l:a.FOLDERS.CONTACTS,vcard:{mid:e,part:t}}}},Header:{context:{_jsns:"urn:zimbra"}}})}).then((e=>{if(e.ok)return e.json();throw new Error("Something went wrong")})).then((({Body:e})=>e.CreateContactResponse.cn[0]))}},4457:(e,t,n)=>{n.d(t,{_:()=>i});var a=n(2509),r=n(1621);const o={distributionLists:void 0},i=(0,r.vt)()(((e,t)=>({...o,setDistributionLists:t=>{e({distributionLists:t})},upsertDistributionList:n=>{const r=t().distributionLists;if(void 0!==r){const t=r.findIndex((e=>e.id===n.id||e.email===n.email)),o=[...r];o.splice(t,-1===t?0:1,{...o[t],...n}),e({distributionLists:(0,a.sortBy)(o,(e=>(0,a.toLower)(e.displayName||e.email)))})}},reset:()=>{e(o)}})))}}]);
//# sourceMappingURL=300.cee3e5b4.chunk.js.map