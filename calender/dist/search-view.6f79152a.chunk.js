"use strict";(self.webpackChunkcarbonio_calendars_ui=self.webpackChunkcarbonio_calendars_ui||[]).push([[809],{45859:(e,t,a)=>{a.d(t,{j:()=>n});var r=a(6017);const n=()=>{const{prefs:e}=(0,r.useUserSettings)();return e}},58542:(e,t,a)=>{a.d(t,{Et:()=>r,Li:()=>l,Ou:()=>n,tw:()=>o});const r="#FFFFFF",n="#c2e7ff",l="#0a1153",o="#0a1153"},82454:(e,t,a)=>{a.r(t),a.d(t,{default:()=>J});var r=a(92652),n=a.n(r),l=a(97363),o=a(6017),i=a(51235),s=a(93747),c=a(27244),m=a(93046);const d=({fromDate:e,setFromDate:t,toDate:a,setToDate:i})=>{const s=(0,r.useCallback)((e=>{t(e)}),[t]),c=(0,r.useCallback)((e=>{i(e)}),[i]);return n().createElement(l.Container,{padding:{bottom:"small",top:"medium"},orientation:"horizontal"},n().createElement(l.Container,{padding:{right:"extrasmall"}},n().createElement(l.DateTimePicker,{width:"fill",label:(0,o.t)("search.from_date","From Date"),enableChips:!0,chipProps:{avatarBackground:"gray1",avatarIcon:"CalendarOutline"},dateFormat:"dd/MM/yyyy",includeTime:!1,defaultValue:e,onChange:s})),n().createElement(l.Container,{padding:{horizontal:"extrasmall"}},n().createElement(l.DateTimePicker,{width:"fill",label:(0,o.t)("search.to_date","To Date"),enableChips:!0,chipProps:{avatarBackground:"gray1",avatarIcon:"CalendarOutline"},dateFormat:"dd/MM/yyyy",includeTime:!1,defaultValue:a,onChange:c})))},u=({compProps:e})=>{const{otherKeywords:t,setOtherKeywords:a}=e,i=(0,r.useCallback)(((e,t)=>{t(e)}),[]),s=(0,r.useCallback)((e=>({label:e,hasAvatar:!1,isGeneric:!0})),[]),c=(0,r.useCallback)((e=>i(e,a)),[i,a]);return n().createElement(n().Fragment,null,n().createElement(l.Container,{padding:{bottom:"small",top:"medium"},orientation:"horizontal"},n().createElement(l.Container,{padding:{right:"extrasmall"},maxWidth:"100%"},n().createElement(l.ChipInput,{placeholder:(0,o.t)("label.keywords","Keywords"),background:"gray5",value:t,separators:[{key:"Enter",ctrlKey:!1},{key:",",ctrlKey:!1}],onChange:c,onAdd:s}))))};var p=a(37312),g=a(18671),E=a(750),h=a.n(E);const f=h()().startOf("day").subtract(1,"months").valueOf(),y=h()().startOf("day").add(1,"months").valueOf(),b=({open:e,onClose:t,query:a,updateQuery:s,dateStart:c,dateEnd:m,setDateStart:E,setDateEnd:h})=>{const[b,v]=(0,r.useState)([]),[C,w]=(0,r.useState)([]),[x,A]=(0,r.useState)(c),[S,R]=(0,r.useState)(m),k=(0,r.useMemo)((()=>["has:attachment","is:flagged","is:unread"]),[]);(0,r.useEffect)((()=>{const e=(0,i.map)((0,i.filter)(a,(e=>!(0,i.includes)(k,e.label)&&!/^Is:/.test(e.label)&&!e.isQueryFilter)),(e=>({...e,hasAvatar:!1})));v(e)}),[a,k]);const I=(0,r.useCallback)((()=>{A(f),E(f),R(y),h(y),s([]),w([])}),[h,E,s]),T=(0,r.useMemo)((()=>(0,i.concat)(b,C)),[C,b]),F=(0,r.useCallback)((()=>{s(T),E(x.valueOf()),h(S.valueOf()),t()}),[s,T,E,x,h,S,t]),z=(0,r.useMemo)((()=>({otherKeywords:b,setOtherKeywords:v})),[b]);return n().createElement(l.CustomModal,{open:e,onClose:t,maxHeight:"90vh",size:"medium"},n().createElement(l.Container,{padding:{bottom:"medium"}},n().createElement(g.x,{onClose:t,title:(0,o.t)("label.single_advanced_filter","Advanced Filters")}),n().createElement(l.Container,{padding:{horizontal:"medium",vertical:"small"}},n().createElement(u,{compProps:z}),n().createElement(d,{fromDate:x,setFromDate:A,toDate:S,setToDate:R})),n().createElement(p.Z,{onConfirm:F,label:(0,o.t)("action.search","Search"),secondaryLabel:(0,o.t)("action.reset","Reset"),secondaryAction:I,secondaryBtnType:"outlined",secondaryColor:"primary",paddingTop:"small"})))};var v=a(91750),C=a.n(v);const w=C()(l.Container).withConfig({displayName:"advanced-filter-button__BorderContainer",componentId:"sc-144n5lw-0"})(["border-bottom:0.0625rem solid ",";border-right:0.0625rem solid ",";"],(({theme:e})=>e?.palette?.gray2?.regular),(({theme:e})=>e?.palette?.gray2?.regular)),x=({setShowAdvanceFilters:e,searchDisabled:t,filterCount:a})=>{const[r]=(0,s.useTranslation)();return n().createElement(w,{padding:{all:"small"},height:"fit",mainAlignment:"flex-start",crossAlignment:"flex-start",borderRadius:"none"},n().createElement(l.Tooltip,{label:r("label.results_for_error","Unable to parse the search query, clear it and retry"),placement:"top",maxWidth:"100%",disabled:!t},n().createElement(l.Button,{onClick:()=>e(!0),type:a>0?"default":"outlined",width:"fill",label:0===a?r("label.single_advanced_filter","Advanced Filters"):r("label.advanced_filters",{count:a,defaultValue_one:"{{count}} Advanced Filter",defaultValue_other:"{{count}} Advanced Filters"}),disabled:t,icon:"Options2Outline"})))};var A=a(366),S=a(50364),R=a(46609),k=a(68242),I=a(57154),T=a(65107);const F=({item:e,active:t})=>{const a=e?.resource?.l?.includes(":"),c=(0,m.tc)(),d=(0,k.C)((0,I.m)(e?.resource?.inviteId)),u=(0,k.T)(),p=a?(0,i.find)(c,(t=>`${t.zid}:${t.rid}`===e.resource?.l)):(0,i.find)(c,(t=>t.id===e.resource?.l)),[g]=(0,s.useTranslation)(),E=(0,r.useMemo)((()=>e.resource?.flags?.includes("a")),[e.resource?.flags]),f=(0,r.useMemo)((()=>["TE","DE","AC"].includes(e.resource?.ptst)),[e.resource?.ptst]),[y,b]=(0,r.useMemo)((()=>"TE"===e.resource?.ptst?["warning","QuestionMarkOutline"]:"DE"===e.resource?.ptst?["error","CloseOutline"]:["success","CheckmarkOutline"]),[e.resource?.ptst]),v=(0,r.useMemo)((()=>`${h().utc(e.resource?.ridZ,"YYYYMMDD[T]HHmmss[Z]").local()} - ${h().utc(e.resource?.ridZ,"YYYYMMDD[T]HHmmss[Z]").add(e.resource?.dur).local().format("HH:mm")}`),[e.resource?.dur,e.resource?.ridZ]),C=(0,r.useMemo)((()=>E||"PRI"===e.resource?.class||e.resource?.location||e?.resource?.isRecurrent?{minWidth:"3.125rem",flexBasis:"content",flexGrow:1}:void 0),[E,e.resource?.class,e.resource?.isRecurrent,e.resource?.location]),w=(0,o.useTags)(),x=(0,r.useMemo)((()=>(0,i.reduce)(w,((t,a)=>((0,i.includes)(e?.resource?.tags,a.id)&&t.push({...a,color:o.ZIMBRA_STANDARD_COLORS[parseInt(a.color??"0",10)].hex}),t)),[])),[e?.resource?.tags,w]),F=(0,r.useMemo)((()=>x?.length>1?"TagsMoreOutline":"Tag"),[x]),z=(0,r.useMemo)((()=>1===x?.length?x?.[0]?.color:void 0),[x]),M=(0,T.ab)(x),D=(0,r.useMemo)((()=>e.resource.tags&&0!==e.resource.tags.length&&""!==e.resource.tags?.[0]&&M),[M,e.resource.tags]),_=(0,r.useCallback)((t=>{const a=(0,A.eh)({event:e,context:{panelView:S.lg.SEARCH}});d?a(t):u((0,R.E)({inviteId:e.resource.inviteId})).then((()=>{a(t)}))}),[u,d,e]);return n().createElement(l.Container,{wrap:"nowrap",style:{cursor:"default"},onClick:_,active:t},n().createElement(l.Row,{wrap:"nowrap",width:"fill",mainAlignment:"flex-start",padding:{all:"small",right:"large"}},(e.resource?.organizer?.name||e.resource?.organizer?.email)&&n().createElement(l.Avatar,{selecting:!1,selected:!1,label:e.resource?.organizer?.name||e.resource?.organizer?.email,onClick:()=>null,size:"large"}),n().createElement(l.Container,{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:" ellipsis"},mainAlignment:"space-around"},n().createElement(l.Row,{width:"fill",wrap:"nowrap"},v&&n().createElement(n().Fragment,null,n().createElement(l.Padding,{left:"small"}),n().createElement(l.Row,{wrap:"nowrap",style:{minWidth:"3.125rem",flexBasis:"content",flexGrow:1},mainAlignment:"flex-start"},n().createElement(l.Tooltip,{label:v,maxWidth:"100%"},n().createElement(l.Text,{size:"small"},v)))),n().createElement(l.Row,{wrap:"nowrap",style:C,mainAlignment:"flex-end",takeAvailableSpace:!C},e.resource?.isRecurrent&&n().createElement(n().Fragment,null,n().createElement(l.Padding,{left:"small"}),n().createElement(l.Row,{mainAlignment:"flex-end"},n().createElement(l.Tooltip,{label:g("label.recurrent","Recurrent appointment")},n().createElement("div",null,n().createElement(l.Icon,{icon:"Repeat",size:"medium",color:"gray0"}))))),D&&n().createElement(l.Padding,{left:"small"},n().createElement(l.Icon,{"data-testid":"TagIcon",icon:F,color:z})),E&&n().createElement(n().Fragment,null,n().createElement(l.Padding,{left:"small"}),n().createElement(l.Row,{mainAlignment:"flex-end"},n().createElement(l.Tooltip,{label:g("has_attachments","Has attachments")},n().createElement("div",null,n().createElement(l.Icon,{"data-testid":"AttachmentIcon",icon:"AttachOutline",size:"medium",color:"gray0"}))))),"PRI"===e.resource?.class&&n().createElement(n().Fragment,null,n().createElement(l.Padding,{left:"small"}),n().createElement(l.Row,{mainAlignment:"flex-end"},n().createElement(l.Tooltip,{label:g("is_private","Is private")},n().createElement("div",null,n().createElement(l.Icon,{"data-testid":"LockIcon",icon:"Lock",size:"medium",color:"gray0"}))))),e.resource?.location&&n().createElement(n().Fragment,null,n().createElement(l.Padding,{left:"small"}),n().createElement(l.Tooltip,{label:e.resource?.location,maxWidth:"100%"},n().createElement(l.Text,{size:"small",color:"secondary"},e.resource?.location)))),p?.color?.label&&n().createElement(n().Fragment,null,n().createElement(l.Padding,{left:"small"}),n().createElement(l.Row,{mainAlignment:"flex-end"},n().createElement(l.Icon,{"data-testid":"CalendarIcon",icon:"Calendar2",size:"medium",customColor:p.color.label})))),n().createElement(l.Row,{width:"fill",wrap:"nowrap"},e.title&&n().createElement(n().Fragment,null,n().createElement(l.Padding,{left:"small"}),n().createElement(l.Row,{style:{minWidth:"3.125rem",flexBasis:"content",flexGrow:1},mainAlignment:"flex-start"},n().createElement(l.Tooltip,{label:e.title,maxWidth:"100%"},n().createElement(l.Text,{size:"small"},e.title)))),e.resource?.organizer?.name&&n().createElement(n().Fragment,null,n().createElement(l.Padding,{left:"small"}),n().createElement(l.Row,{style:{minWidth:"3.125rem",flexBasis:"content",flexGrow:1},mainAlignment:"flex-end"},n().createElement(l.Tooltip,{label:`${g("search.organized_by","organized by")} ${e.resource?.organizer?.name}`,maxWidth:"100%"},n().createElement(l.Text,{size:"small",color:"secondary"},g("search.organized_by","organized by")," ",e.resource?.organizer?.name)))),f&&n().createElement(n().Fragment,null,n().createElement(l.Padding,{left:"small"}),n().createElement(l.Row,{mainAlignment:"flex-end"},n().createElement(l.Icon,{"data-testid":"AppointmentIcon",icon:b,color:y,size:"medium"})))))))},z=()=>n().createElement(n().Fragment,null,(0,i.map)(Array.from(Array(15).keys()),((e,t)=>n().createElement(l.Shimmer.ListItem,{type:1,key:`${e}${t}`}))));var M=a(58542);const D=({appointments:e,loadMore:t,loading:a,searchDisabled:r,filterCount:s,setShowAdvanceFilters:m,dateStart:d,dateEnd:u})=>{const{apptId:p,ridZ:g}=(0,c.useParams)();return n().createElement(l.Container,{background:M.Et,width:"30%",mainAlignment:"flex-start",crossAlignment:"flex-start","data-testid":"CalendarsSearchResultListContainer"},n().createElement(l.Row,{padding:{horizontal:"small",top:"medium",bottom:"small"},orientation:"horizontal",mainAlignment:"flex-start"},n().createElement(l.Text,{size:"medium",color:"secondary"},(0,o.t)("search.from_date","From")," ",h()(d).format("DD/MM/YYYY")),n().createElement(l.Padding,{left:"small"}),n().createElement(l.Text,{size:"medium",color:"secondary"},(0,o.t)("search.to_date","to")," ",h()(u).format("DD/MM/YYYY"))),n().createElement(x,{setShowAdvanceFilters:m,filterCount:s,searchDisabled:r}),a?n().createElement(z,null):n().createElement(l.List,{items:(0,i.sortBy)(e??[],["start"]),ItemComponent:F,active:`${p}:${g}`,onListBottom:t,background:"gray6","data-testid":"SearchResultCalendarsContainer"}))};var _=a(78571),P=a(55559),O=a(25350),B=a(34130),Z=a(74880),$=a(31945),Y=a(71930),L=a(58726),H=a(81834),q=a(31779);const W=C()(l.Container).withConfig({displayName:"displayer__BodyContainer",componentId:"sc-12t3qer-0"})(["overflow-x:hidden;overflow-y:auto;white-space:pre-wrap;word-wrap:break-word !important;"]),K=({event:e})=>{const t=(0,O.s)(e?.resource?.inviteId);return t?n().createElement(l.Container,{mainAlignment:"flex-start",crossAlignment:"flex-start",padding:{bottom:"medium"}},e&&n().createElement(l.Container,{padding:{all:"none"},mainAlignment:"flex-start"},n().createElement($.s,{event:e,panelView:S.lg.SEARCH}),n().createElement(W,{mainAlignment:"flex-start",crossAlignment:"flex-start",width:"fill",height:"min(calc(100% - 3.125rem), fit)",padding:{all:"large"}},n().createElement(Z.P,{event:e,subject:e?.title,isPrivate:e?.resource.isPrivate,inviteNeverSent:e?.resource?.inviteNeverSent,invite:t}),n().createElement(P.Z,null),e.resource.organizer&&!e?.resource?.iAmOrganizer&&!e?.resource?.owner&&t&&n().createElement(n().Fragment,null,n().createElement(q.$,{invite:t,event:e}),n().createElement(P.Z,null)),t&&e&&t.organizer&&n().createElement(n().Fragment,null,n().createElement(L.Y,{invite:t,event:e,organizer:t.organizer,participants:t?.participants}),n().createElement(P.Z,null)),t&&(0,_.cd)(t?.textDescription?.[0]?._content)&&n().createElement(l.Container,null,n().createElement(Y.X,{fullInvite:t,inviteId:e?.resource?.inviteId,parts:t?.parts}),n().createElement(P.Z,null)),t&&t?.alarmString&&n().createElement(n().Fragment,null,n().createElement(H.q,{alarmString:t?.alarmString,invite:t,event:e}),n().createElement(P.Z,null)),t?.attachmentFiles?.length>0&&n().createElement(n().Fragment,null,n().createElement(l.Container,{padding:{all:"medium"},background:M.Et},n().createElement(B.A,{attachments:t?.attachmentFiles,id:e?.resource?.inviteId,subject:e?.title})),n().createElement(P.Z,null))))):null};var N=a(40232);const j=C()(l.Icon).withConfig({displayName:"search-panel__LargeIcon",componentId:"sc-is0xrz-0"})(["transform:scale(3.5);"]),Q=({appointments:e})=>{const{path:t}=(0,c.useRouteMatch)(),a=(e=>{const{apptId:t,ridZ:a}=(0,c.useParams)();return(0,r.useMemo)((()=>(0,i.find)(e,(e=>e?.resource?.id===t&&e?.resource?.ridZ===a))),[e,t,a])})(e);return n().createElement(c.Switch,null,n().createElement(c.Route,{path:`${t}/:action(${N.x.EXPAND})/:apptId/:ridZ?`},n().createElement(K,{event:a})),n().createElement(c.Route,{path:t,render:()=>n().createElement(l.Container,{background:"gray5",mainAlignment:"center"},n().createElement(j,{icon:"SearchOutline",color:"secondary"}),n().createElement(l.Padding,{top:"medium"}),n().createElement(l.Padding,{top:"extralarge"}),n().createElement(l.Text,{color:"secondary",size:"large",weight:"bold"},(0,o.t)("label.search_hint")),n().createElement(l.Padding,{top:"medium"}),n().createElement(l.Text,{color:"secondary"},(0,o.t)("message.search_hints")))}))};var V=a(45859),G=a(82163),U=a(89323),X=a(53776);const J=({useQuery:e,ResultsHeader:t})=>{const[a,d]=e(),[u]=(0,s.useTranslation)(),[p,g]=(0,r.useState)({appointments:{},more:!1,offset:0,sortBy:"none",query:[]}),[E,h]=(0,r.useState)(!1),v=(0,k.T)(),[C,w]=(0,r.useState)(!1),{path:x}=(0,c.useRouteMatch)(),{zimbraPrefIncludeTrashInSearch:A,zimbraPrefIncludeSharedItemsInSearch:S}=(0,V.j)(),R=(0,r.useMemo)((()=>u("label.results_for","Results for: ")),[u]),[I,T]=(0,r.useState)(R),[F,z]=(0,r.useState)(!1),[M,_]=(0,r.useMemo)((()=>["TRUE"===A,"TRUE"===S]),[A,S]),P=(0,m.tc)(),O=(0,r.useMemo)((()=>(0,i.reduce)(P,((e,t)=>((0,G.rR)(t,o.FOLDERS.TRASH)&&M&&t.checked&&e.push(t.id),t.isLink&&_&&t.checked&&e.push(t.id),(0,G.rR)(t,o.FOLDERS.TRASH)||t.isLink||!t.checked||e.push(t.id),e)),[])),[P,_,M]),B=(0,r.useMemo)((()=>{const e=(0,i.map)(O,(e=>`inid:"${e}"`)).join(" OR ");return`( ${e})`}),[O]),[Z,$]=(0,r.useState)((()=>f)),[Y,L]=(0,r.useState)((()=>y)),H=(0,r.useCallback)(((e,t)=>{T(R),h(!0);const a=`${e.map((e=>e.value??e.label)).join(" ")} ${B}`;v((0,U.C)({spanStart:Z,spanEnd:Y,query:a,offset:t?0:p.offset,sortBy:p.sortBy})).then((({payload:t})=>{if(h(!0),t){const a=(0,i.reduce)(t.appt,((e,t)=>({...e,[t.id]:(0,i.map)(t.inst,"ridZ")})),{});g({query:e,appointments:a,more:t.more??!1,offset:(t.offset??0)+100,sortBy:t.sortBy??"none"})}h(!1)})).catch((()=>{h(!1);const t=[...e],a=(0,i.map)(t,(e=>({...e,disabled:!0,isQueryFilter:!0})));d(a),z(!0),T(u("label.results_for_error","Unable to start the search, clear it and retry: "))}))}),[R,B,v,Z,Y,p.offset,p.sortBy,d,u]),[q,W]=(0,r.useState)(0),K=(0,r.useCallback)((()=>{!E&&p&&!(0,i.isEmpty)(p.appointments)&&p.more&&H(a,!1)}),[E,a,H,p]);(0,r.useEffect)((()=>{a&&a.length>0&&a!==p.query&&!F&&(H(a,!0),W(1)),a&&0===a.length&&(z(!1),W(0),T(R))}),[a,H,p.query,F,u,R]);const N=(0,k.C)((e=>(0,X.Lo)(e,p.appointments??[],P)));return n().createElement(n().Fragment,null,n().createElement(l.Container,{style:{whiteSpace:"nowrap"}},n().createElement(t,{label:I}),n().createElement(l.Container,{orientation:"horizontal",style:{minHeight:"0"},mainAlignment:"flex-start"},n().createElement(c.Switch,null,n().createElement(c.Route,{path:`${x}/:action?/:apptId?/:ridZ?`},n().createElement(D,{loadMore:K,appointments:N,loading:E,filterCount:q,setShowAdvanceFilters:w,searchDisabled:!1,dateStart:Z,dateEnd:Y}),n().createElement(l.Container,{background:"gray5",width:"75%",mainAlignment:"center"},n().createElement(Q,{appointments:N})))))),n().createElement(b,{query:a,updateQuery:d,open:C,onClose:()=>w(!1),dateStart:Z,dateEnd:Y,setDateStart:$,setDateEnd:L}))}}}]);
//# sourceMappingURL=search-view.6f79152a.chunk.js.map